(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function sp(t,e){const n=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const _C="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",MC=sp(_C);function Sv(t){return!!t||t===""}function op(t){if(de(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],i=ot(r)?DC(r):op(r);if(i)for(const s in i)e[s]=i[s]}return e}else{if(ot(t))return t;if(He(t))return t}}const OC=/;(?![^(]*\))/g,NC=/:(.+)/;function DC(t){const e={};return t.split(OC).forEach(n=>{if(n){const r=n.split(NC);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Zt(t){let e="";if(ot(t))e=t;else if(de(t))for(let n=0;n<t.length;n++){const r=Zt(t[n]);r&&(e+=r+" ")}else if(He(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}function RC(t,e){if(t.length!==e.length)return!1;let n=!0;for(let r=0;n&&r<t.length;r++)n=wu(t[r],e[r]);return n}function wu(t,e){if(t===e)return!0;let n=wm(t),r=wm(e);if(n||r)return n&&r?t.getTime()===e.getTime():!1;if(n=Ca(t),r=Ca(e),n||r)return t===e;if(n=de(t),r=de(e),n||r)return n&&r?RC(t,e):!1;if(n=He(t),r=He(e),n||r){if(!n||!r)return!1;const i=Object.keys(t).length,s=Object.keys(e).length;if(i!==s)return!1;for(const o in t){const a=t.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!wu(t[o],e[o]))return!1}}return String(t)===String(e)}function Tv(t,e){return t.findIndex(n=>wu(n,e))}const Mr=t=>ot(t)?t:t==null?"":de(t)||He(t)&&(t.toString===Iv||!Ce(t.toString))?JSON.stringify(t,Cv,2):String(t),Cv=(t,e)=>e&&e.__v_isRef?Cv(t,e.value):Js(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[r,i])=>(n[`${r} =>`]=i,n),{})}:Eu(e)?{[`Set(${e.size})`]:[...e.values()]}:He(e)&&!de(e)&&!Av(e)?String(e):e,Ue={},Gs=[],Un=()=>{},PC=()=>!1,LC=/^on[^a-z]/,vu=t=>LC.test(t),ap=t=>t.startsWith("onUpdate:"),Ft=Object.assign,lp=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},BC=Object.prototype.hasOwnProperty,Me=(t,e)=>BC.call(t,e),de=Array.isArray,Js=t=>ll(t)==="[object Map]",Eu=t=>ll(t)==="[object Set]",wm=t=>ll(t)==="[object Date]",Ce=t=>typeof t=="function",ot=t=>typeof t=="string",Ca=t=>typeof t=="symbol",He=t=>t!==null&&typeof t=="object",kv=t=>He(t)&&Ce(t.then)&&Ce(t.catch),Iv=Object.prototype.toString,ll=t=>Iv.call(t),FC=t=>ll(t).slice(8,-1),Av=t=>ll(t)==="[object Object]",cp=t=>ot(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,cc=sp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),xu=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},VC=/-(\w)/g,dr=xu(t=>t.replace(VC,(e,n)=>n?n.toUpperCase():"")),$C=/\B([A-Z])/g,Ao=xu(t=>t.replace($C,"-$1").toLowerCase()),Su=xu(t=>t.charAt(0).toUpperCase()+t.slice(1)),Ph=xu(t=>t?`on${Su(t)}`:""),ka=(t,e)=>!Object.is(t,e),uc=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},Ic=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},Rd=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let vm;const UC=()=>vm||(vm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Xn;class zC{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&Xn&&(this.parent=Xn,this.index=(Xn.scopes||(Xn.scopes=[])).push(this)-1)}run(e){if(this.active){const n=Xn;try{return Xn=this,e()}finally{Xn=n}}}on(){Xn=this}off(){Xn=this.parent}stop(e){if(this.active){let n,r;for(n=0,r=this.effects.length;n<r;n++)this.effects[n].stop();for(n=0,r=this.cleanups.length;n<r;n++)this.cleanups[n]();if(this.scopes)for(n=0,r=this.scopes.length;n<r;n++)this.scopes[n].stop(!0);if(this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.active=!1}}}function HC(t,e=Xn){e&&e.active&&e.effects.push(t)}const up=t=>{const e=new Set(t);return e.w=0,e.n=0,e},_v=t=>(t.w&ri)>0,Mv=t=>(t.n&ri)>0,jC=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=ri},KC=t=>{const{deps:e}=t;if(e.length){let n=0;for(let r=0;r<e.length;r++){const i=e[r];_v(i)&&!Mv(i)?i.delete(t):e[n++]=i,i.w&=~ri,i.n&=~ri}e.length=n}},Pd=new WeakMap;let Qo=0,ri=1;const Ld=30;let Ln;const ji=Symbol(""),Bd=Symbol("");class hp{constructor(e,n=null,r){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,HC(this,r)}run(){if(!this.active)return this.fn();let e=Ln,n=Wr;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=Ln,Ln=this,Wr=!0,ri=1<<++Qo,Qo<=Ld?jC(this):Em(this),this.fn()}finally{Qo<=Ld&&KC(this),ri=1<<--Qo,Ln=this.parent,Wr=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ln===this?this.deferStop=!0:this.active&&(Em(this),this.onStop&&this.onStop(),this.active=!1)}}function Em(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Wr=!0;const Ov=[];function _o(){Ov.push(Wr),Wr=!1}function Mo(){const t=Ov.pop();Wr=t===void 0?!0:t}function yn(t,e,n){if(Wr&&Ln){let r=Pd.get(t);r||Pd.set(t,r=new Map);let i=r.get(n);i||r.set(n,i=up()),Nv(i)}}function Nv(t,e){let n=!1;Qo<=Ld?Mv(t)||(t.n|=ri,n=!_v(t)):n=!t.has(Ln),n&&(t.add(Ln),Ln.deps.push(t))}function Tr(t,e,n,r,i,s){const o=Pd.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(n==="length"&&de(t))o.forEach((l,c)=>{(c==="length"||c>=r)&&a.push(l)});else switch(n!==void 0&&a.push(o.get(n)),e){case"add":de(t)?cp(n)&&a.push(o.get("length")):(a.push(o.get(ji)),Js(t)&&a.push(o.get(Bd)));break;case"delete":de(t)||(a.push(o.get(ji)),Js(t)&&a.push(o.get(Bd)));break;case"set":Js(t)&&a.push(o.get(ji));break}if(a.length===1)a[0]&&Fd(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);Fd(up(l))}}function Fd(t,e){const n=de(t)?t:[...t];for(const r of n)r.computed&&xm(r);for(const r of n)r.computed||xm(r)}function xm(t,e){(t!==Ln||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const qC=sp("__proto__,__v_isRef,__isVue"),Dv=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Ca)),WC=dp(),GC=dp(!1,!0),JC=dp(!0),Sm=XC();function XC(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const r=Be(this);for(let s=0,o=this.length;s<o;s++)yn(r,"get",s+"");const i=r[e](...n);return i===-1||i===!1?r[e](...n.map(Be)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){_o();const r=Be(this)[e].apply(this,n);return Mo(),r}}),t}function dp(t=!1,e=!1){return function(r,i,s){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_isShallow")return e;if(i==="__v_raw"&&s===(t?e?dk:Fv:e?Bv:Lv).get(r))return r;const o=de(r);if(!t&&o&&Me(Sm,i))return Reflect.get(Sm,i,s);const a=Reflect.get(r,i,s);return(Ca(i)?Dv.has(i):qC(i))||(t||yn(r,"get",i),e)?a:Nt(a)?o&&cp(i)?a:a.value:He(a)?t?Vv(a):Cu(a):a}}const YC=Rv(),QC=Rv(!0);function Rv(t=!1){return function(n,r,i,s){let o=n[r];if(io(o)&&Nt(o)&&!Nt(i))return!1;if(!t&&(!Ac(i)&&!io(i)&&(o=Be(o),i=Be(i)),!de(n)&&Nt(o)&&!Nt(i)))return o.value=i,!0;const a=de(n)&&cp(r)?Number(r)<n.length:Me(n,r),l=Reflect.set(n,r,i,s);return n===Be(s)&&(a?ka(i,o)&&Tr(n,"set",r,i):Tr(n,"add",r,i)),l}}function ZC(t,e){const n=Me(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&Tr(t,"delete",e,void 0),r}function ek(t,e){const n=Reflect.has(t,e);return(!Ca(e)||!Dv.has(e))&&yn(t,"has",e),n}function tk(t){return yn(t,"iterate",de(t)?"length":ji),Reflect.ownKeys(t)}const Pv={get:WC,set:YC,deleteProperty:ZC,has:ek,ownKeys:tk},nk={get:JC,set(t,e){return!0},deleteProperty(t,e){return!0}},rk=Ft({},Pv,{get:GC,set:QC}),fp=t=>t,Tu=t=>Reflect.getPrototypeOf(t);function Dl(t,e,n=!1,r=!1){t=t.__v_raw;const i=Be(t),s=Be(e);n||(e!==s&&yn(i,"get",e),yn(i,"get",s));const{has:o}=Tu(i),a=r?fp:n?yp:Ia;if(o.call(i,e))return a(t.get(e));if(o.call(i,s))return a(t.get(s));t!==i&&t.get(e)}function Rl(t,e=!1){const n=this.__v_raw,r=Be(n),i=Be(t);return e||(t!==i&&yn(r,"has",t),yn(r,"has",i)),t===i?n.has(t):n.has(t)||n.has(i)}function Pl(t,e=!1){return t=t.__v_raw,!e&&yn(Be(t),"iterate",ji),Reflect.get(t,"size",t)}function Tm(t){t=Be(t);const e=Be(this);return Tu(e).has.call(e,t)||(e.add(t),Tr(e,"add",t,t)),this}function Cm(t,e){e=Be(e);const n=Be(this),{has:r,get:i}=Tu(n);let s=r.call(n,t);s||(t=Be(t),s=r.call(n,t));const o=i.call(n,t);return n.set(t,e),s?ka(e,o)&&Tr(n,"set",t,e):Tr(n,"add",t,e),this}function km(t){const e=Be(this),{has:n,get:r}=Tu(e);let i=n.call(e,t);i||(t=Be(t),i=n.call(e,t)),r&&r.call(e,t);const s=e.delete(t);return i&&Tr(e,"delete",t,void 0),s}function Im(){const t=Be(this),e=t.size!==0,n=t.clear();return e&&Tr(t,"clear",void 0,void 0),n}function Ll(t,e){return function(r,i){const s=this,o=s.__v_raw,a=Be(o),l=e?fp:t?yp:Ia;return!t&&yn(a,"iterate",ji),o.forEach((c,u)=>r.call(i,l(c),l(u),s))}}function Bl(t,e,n){return function(...r){const i=this.__v_raw,s=Be(i),o=Js(s),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=i[t](...r),u=n?fp:e?yp:Ia;return!e&&yn(s,"iterate",l?Bd:ji),{next(){const{value:h,done:d}=c.next();return d?{value:h,done:d}:{value:a?[u(h[0]),u(h[1])]:u(h),done:d}},[Symbol.iterator](){return this}}}}function Or(t){return function(...e){return t==="delete"?!1:this}}function ik(){const t={get(s){return Dl(this,s)},get size(){return Pl(this)},has:Rl,add:Tm,set:Cm,delete:km,clear:Im,forEach:Ll(!1,!1)},e={get(s){return Dl(this,s,!1,!0)},get size(){return Pl(this)},has:Rl,add:Tm,set:Cm,delete:km,clear:Im,forEach:Ll(!1,!0)},n={get(s){return Dl(this,s,!0)},get size(){return Pl(this,!0)},has(s){return Rl.call(this,s,!0)},add:Or("add"),set:Or("set"),delete:Or("delete"),clear:Or("clear"),forEach:Ll(!0,!1)},r={get(s){return Dl(this,s,!0,!0)},get size(){return Pl(this,!0)},has(s){return Rl.call(this,s,!0)},add:Or("add"),set:Or("set"),delete:Or("delete"),clear:Or("clear"),forEach:Ll(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=Bl(s,!1,!1),n[s]=Bl(s,!0,!1),e[s]=Bl(s,!1,!0),r[s]=Bl(s,!0,!0)}),[t,n,e,r]}const[sk,ok,ak,lk]=ik();function pp(t,e){const n=e?t?lk:ak:t?ok:sk;return(r,i,s)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?r:Reflect.get(Me(n,i)&&i in r?n:r,i,s)}const ck={get:pp(!1,!1)},uk={get:pp(!1,!0)},hk={get:pp(!0,!1)},Lv=new WeakMap,Bv=new WeakMap,Fv=new WeakMap,dk=new WeakMap;function fk(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pk(t){return t.__v_skip||!Object.isExtensible(t)?0:fk(FC(t))}function Cu(t){return io(t)?t:gp(t,!1,Pv,ck,Lv)}function gk(t){return gp(t,!1,rk,uk,Bv)}function Vv(t){return gp(t,!0,nk,hk,Fv)}function gp(t,e,n,r,i){if(!He(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const s=i.get(t);if(s)return s;const o=pk(t);if(o===0)return t;const a=new Proxy(t,o===2?r:n);return i.set(t,a),a}function Xs(t){return io(t)?Xs(t.__v_raw):!!(t&&t.__v_isReactive)}function io(t){return!!(t&&t.__v_isReadonly)}function Ac(t){return!!(t&&t.__v_isShallow)}function $v(t){return Xs(t)||io(t)}function Be(t){const e=t&&t.__v_raw;return e?Be(e):t}function mp(t){return Ic(t,"__v_skip",!0),t}const Ia=t=>He(t)?Cu(t):t,yp=t=>He(t)?Vv(t):t;function bp(t){Wr&&Ln&&(t=Be(t),Nv(t.dep||(t.dep=up())))}function wp(t,e){t=Be(t),t.dep&&Fd(t.dep)}function Nt(t){return!!(t&&t.__v_isRef===!0)}function vp(t){return mk(t,!1)}function mk(t,e){return Nt(t)?t:new yk(t,e)}class yk{constructor(e,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?e:Be(e),this._value=n?e:Ia(e)}get value(){return bp(this),this._value}set value(e){const n=this.__v_isShallow||Ac(e)||io(e);e=n?e:Be(e),ka(e,this._rawValue)&&(this._rawValue=e,this._value=n?e:Ia(e),wp(this))}}function Uv(t){return Nt(t)?t.value:t}const bk={get:(t,e,n)=>Uv(Reflect.get(t,e,n)),set:(t,e,n,r)=>{const i=t[e];return Nt(i)&&!Nt(n)?(i.value=n,!0):Reflect.set(t,e,n,r)}};function zv(t){return Xs(t)?t:new Proxy(t,bk)}class wk{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:n,set:r}=e(()=>bp(this),()=>wp(this));this._get=n,this._set=r}get value(){return this._get()}set value(e){this._set(e)}}function vk(t){return new wk(t)}var Hv;class Ek{constructor(e,n,r,i){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this[Hv]=!1,this._dirty=!0,this.effect=new hp(e,()=>{this._dirty||(this._dirty=!0,wp(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=r}get value(){const e=Be(this);return bp(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}Hv="__v_isReadonly";function xk(t,e,n=!1){let r,i;const s=Ce(t);return s?(r=t,i=Un):(r=t.get,i=t.set),new Ek(r,i,s||!i,n)}function Gr(t,e,n,r){let i;try{i=r?t(...r):t()}catch(s){ku(s,e,n)}return i}function _n(t,e,n,r){if(Ce(t)){const s=Gr(t,e,n,r);return s&&kv(s)&&s.catch(o=>{ku(o,e,n)}),s}const i=[];for(let s=0;s<t.length;s++)i.push(_n(t[s],e,n,r));return i}function ku(t,e,n,r=!0){const i=e?e.vnode:null;if(e){let s=e.parent;const o=e.proxy,a=n;for(;s;){const c=s.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](t,o,a)===!1)return}s=s.parent}const l=e.appContext.config.errorHandler;if(l){Gr(l,null,10,[t,o,a]);return}}Sk(t,n,i,r)}function Sk(t,e,n,r=!0){console.error(t)}let Aa=!1,Vd=!1;const Mt=[];let tr=0;const Ys=[];let yr=null,Oi=0;const jv=Promise.resolve();let Ep=null;function Kv(t){const e=Ep||jv;return t?e.then(this?t.bind(this):t):e}function Tk(t){let e=tr+1,n=Mt.length;for(;e<n;){const r=e+n>>>1;_a(Mt[r])<t?e=r+1:n=r}return e}function xp(t){(!Mt.length||!Mt.includes(t,Aa&&t.allowRecurse?tr+1:tr))&&(t.id==null?Mt.push(t):Mt.splice(Tk(t.id),0,t),qv())}function qv(){!Aa&&!Vd&&(Vd=!0,Ep=jv.then(Gv))}function Ck(t){const e=Mt.indexOf(t);e>tr&&Mt.splice(e,1)}function kk(t){de(t)?Ys.push(...t):(!yr||!yr.includes(t,t.allowRecurse?Oi+1:Oi))&&Ys.push(t),qv()}function Am(t,e=Aa?tr+1:0){for(;e<Mt.length;e++){const n=Mt[e];n&&n.pre&&(Mt.splice(e,1),e--,n())}}function Wv(t){if(Ys.length){const e=[...new Set(Ys)];if(Ys.length=0,yr){yr.push(...e);return}for(yr=e,yr.sort((n,r)=>_a(n)-_a(r)),Oi=0;Oi<yr.length;Oi++)yr[Oi]();yr=null,Oi=0}}const _a=t=>t.id==null?1/0:t.id,Ik=(t,e)=>{const n=_a(t)-_a(e);if(n===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function Gv(t){Vd=!1,Aa=!0,Mt.sort(Ik);const e=Un;try{for(tr=0;tr<Mt.length;tr++){const n=Mt[tr];n&&n.active!==!1&&Gr(n,null,14)}}finally{tr=0,Mt.length=0,Wv(),Aa=!1,Ep=null,(Mt.length||Ys.length)&&Gv()}}function Ak(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||Ue;let i=n;const s=e.startsWith("update:"),o=s&&e.slice(7);if(o&&o in r){const u=`${o==="modelValue"?"model":o}Modifiers`,{number:h,trim:d}=r[u]||Ue;d&&(i=n.map(f=>f.trim())),h&&(i=n.map(Rd))}let a,l=r[a=Ph(e)]||r[a=Ph(dr(e))];!l&&s&&(l=r[a=Ph(Ao(e))]),l&&_n(l,t,6,i);const c=r[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,_n(c,t,6,i)}}function Jv(t,e,n=!1){const r=e.emitsCache,i=r.get(t);if(i!==void 0)return i;const s=t.emits;let o={},a=!1;if(!Ce(t)){const l=c=>{const u=Jv(c,e,!0);u&&(a=!0,Ft(o,u))};!n&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!s&&!a?(He(t)&&r.set(t,null),null):(de(s)?s.forEach(l=>o[l]=null):Ft(o,s),He(t)&&r.set(t,o),o)}function Iu(t,e){return!t||!vu(e)?!1:(e=e.slice(2).replace(/Once$/,""),Me(t,e[0].toLowerCase()+e.slice(1))||Me(t,Ao(e))||Me(t,e))}let In=null,Xv=null;function _c(t){const e=In;return In=t,Xv=t&&t.type.__scopeId||null,e}function Yv(t,e=In,n){if(!e||t._n)return t;const r=(...i)=>{r._d&&Um(-1);const s=_c(e),o=t(...i);return _c(s),r._d&&Um(1),o};return r._n=!0,r._c=!0,r._d=!0,r}function Lh(t){const{type:e,vnode:n,proxy:r,withProxy:i,props:s,propsOptions:[o],slots:a,attrs:l,emit:c,render:u,renderCache:h,data:d,setupState:f,ctx:p,inheritAttrs:g}=t;let m,w;const _=_c(t);try{if(n.shapeFlag&4){const y=i||r;m=Zn(u.call(y,y,h,s,f,d,p)),w=l}else{const y=e;m=Zn(y.length>1?y(s,{attrs:l,slots:a,emit:c}):y(s,null)),w=e.props?l:_k(l)}}catch(y){ca.length=0,ku(y,t,1),m=Dt(zn)}let M=m;if(w&&g!==!1){const y=Object.keys(w),{shapeFlag:L}=M;y.length&&L&7&&(o&&y.some(ap)&&(w=Mk(w,o)),M=ii(M,w))}return n.dirs&&(M=ii(M),M.dirs=M.dirs?M.dirs.concat(n.dirs):n.dirs),n.transition&&(M.transition=n.transition),m=M,_c(_),m}const _k=t=>{let e;for(const n in t)(n==="class"||n==="style"||vu(n))&&((e||(e={}))[n]=t[n]);return e},Mk=(t,e)=>{const n={};for(const r in t)(!ap(r)||!(r.slice(9)in e))&&(n[r]=t[r]);return n};function Ok(t,e,n){const{props:r,children:i,component:s}=t,{props:o,children:a,patchFlag:l}=e,c=s.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return r?_m(r,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let h=0;h<u.length;h++){const d=u[h];if(o[d]!==r[d]&&!Iu(c,d))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?_m(r,o,c):!0:!!o;return!1}function _m(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let i=0;i<r.length;i++){const s=r[i];if(e[s]!==t[s]&&!Iu(n,s))return!0}return!1}function Nk({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const Dk=t=>t.__isSuspense;function Rk(t,e){e&&e.pendingBranch?de(t)?e.effects.push(...t):e.effects.push(t):kk(t)}function Pk(t,e){if(ct){let n=ct.provides;const r=ct.parent&&ct.parent.provides;r===n&&(n=ct.provides=Object.create(r)),n[t]=e}}function Bh(t,e,n=!1){const r=ct||In;if(r){const i=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(i&&t in i)return i[t];if(arguments.length>1)return n&&Ce(e)?e.call(r.proxy):e}}function Lk(t,e){return Sp(t,null,e)}const Mm={};function Fh(t,e,n){return Sp(t,e,n)}function Sp(t,e,{immediate:n,deep:r,flush:i,onTrack:s,onTrigger:o}=Ue){const a=ct;let l,c=!1,u=!1;if(Nt(t)?(l=()=>t.value,c=Ac(t)):Xs(t)?(l=()=>t,r=!0):de(t)?(u=!0,c=t.some(w=>Xs(w)||Ac(w)),l=()=>t.map(w=>{if(Nt(w))return w.value;if(Xs(w))return $i(w);if(Ce(w))return Gr(w,a,2)})):Ce(t)?e?l=()=>Gr(t,a,2):l=()=>{if(!(a&&a.isUnmounted))return h&&h(),_n(t,a,3,[d])}:l=Un,e&&r){const w=l;l=()=>$i(w())}let h,d=w=>{h=m.onStop=()=>{Gr(w,a,4)}};if(Oa)return d=Un,e?n&&_n(e,a,3,[l(),u?[]:void 0,d]):l(),Un;let f=u?[]:Mm;const p=()=>{if(!!m.active)if(e){const w=m.run();(r||c||(u?w.some((_,M)=>ka(_,f[M])):ka(w,f)))&&(h&&h(),_n(e,a,3,[w,f===Mm?void 0:f,d]),f=w)}else m.run()};p.allowRecurse=!!e;let g;i==="sync"?g=p:i==="post"?g=()=>en(p,a&&a.suspense):(p.pre=!0,a&&(p.id=a.uid),g=()=>xp(p));const m=new hp(l,g);return e?n?p():f=m.run():i==="post"?en(m.run.bind(m),a&&a.suspense):m.run(),()=>{m.stop(),a&&a.scope&&lp(a.scope.effects,m)}}function Bk(t,e,n){const r=this.proxy,i=ot(t)?t.includes(".")?Qv(r,t):()=>r[t]:t.bind(r,r);let s;Ce(e)?s=e:(s=e.handler,n=e);const o=ct;so(this);const a=Sp(i,s.bind(r),n);return o?so(o):Ki(),a}function Qv(t,e){const n=e.split(".");return()=>{let r=t;for(let i=0;i<n.length&&r;i++)r=r[n[i]];return r}}function $i(t,e){if(!He(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),Nt(t))$i(t.value,e);else if(de(t))for(let n=0;n<t.length;n++)$i(t[n],e);else if(Eu(t)||Js(t))t.forEach(n=>{$i(n,e)});else if(Av(t))for(const n in t)$i(t[n],e);return t}function Fk(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Mu(()=>{t.isMounted=!0}),ul(()=>{t.isUnmounting=!0}),t}const xn=[Function,Array],Vk={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:xn,onEnter:xn,onAfterEnter:xn,onEnterCancelled:xn,onBeforeLeave:xn,onLeave:xn,onAfterLeave:xn,onLeaveCancelled:xn,onBeforeAppear:xn,onAppear:xn,onAfterAppear:xn,onAppearCancelled:xn},setup(t,{slots:e}){const n=p0(),r=Fk();let i;return()=>{const s=e.default&&e0(e.default(),!0);if(!s||!s.length)return;let o=s[0];if(s.length>1){for(const g of s)if(g.type!==zn){o=g;break}}const a=Be(t),{mode:l}=a;if(r.isLeaving)return Vh(o);const c=Om(o);if(!c)return Vh(o);const u=$d(c,a,r,n);Ud(c,u);const h=n.subTree,d=h&&Om(h);let f=!1;const{getTransitionKey:p}=c.type;if(p){const g=p();i===void 0?i=g:g!==i&&(i=g,f=!0)}if(d&&d.type!==zn&&(!Ni(c,d)||f)){const g=$d(d,a,r,n);if(Ud(d,g),l==="out-in")return r.isLeaving=!0,g.afterLeave=()=>{r.isLeaving=!1,n.update()},Vh(o);l==="in-out"&&c.type!==zn&&(g.delayLeave=(m,w,_)=>{const M=Zv(r,d);M[String(d.key)]=d,m._leaveCb=()=>{w(),m._leaveCb=void 0,delete u.delayedLeave},u.delayedLeave=_})}return o}}},$k=Vk;function Zv(t,e){const{leavingVNodes:n}=t;let r=n.get(e.type);return r||(r=Object.create(null),n.set(e.type,r)),r}function $d(t,e,n,r){const{appear:i,mode:s,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:u,onBeforeLeave:h,onLeave:d,onAfterLeave:f,onLeaveCancelled:p,onBeforeAppear:g,onAppear:m,onAfterAppear:w,onAppearCancelled:_}=e,M=String(t.key),y=Zv(n,t),L=(N,J)=>{N&&_n(N,r,9,J)},R=(N,J)=>{const ie=J[1];L(N,J),de(N)?N.every(he=>he.length<=1)&&ie():N.length<=1&&ie()},j={mode:s,persisted:o,beforeEnter(N){let J=a;if(!n.isMounted)if(i)J=g||a;else return;N._leaveCb&&N._leaveCb(!0);const ie=y[M];ie&&Ni(t,ie)&&ie.el._leaveCb&&ie.el._leaveCb(),L(J,[N])},enter(N){let J=l,ie=c,he=u;if(!n.isMounted)if(i)J=m||l,ie=w||c,he=_||u;else return;let ve=!1;const Ee=N._enterCb=Oe=>{ve||(ve=!0,Oe?L(he,[N]):L(ie,[N]),j.delayedLeave&&j.delayedLeave(),N._enterCb=void 0)};J?R(J,[N,Ee]):Ee()},leave(N,J){const ie=String(t.key);if(N._enterCb&&N._enterCb(!0),n.isUnmounting)return J();L(h,[N]);let he=!1;const ve=N._leaveCb=Ee=>{he||(he=!0,J(),Ee?L(p,[N]):L(f,[N]),N._leaveCb=void 0,y[ie]===t&&delete y[ie])};y[ie]=t,d?R(d,[N,ve]):ve()},clone(N){return $d(N,e,n,r)}};return j}function Vh(t){if(Au(t))return t=ii(t),t.children=null,t}function Om(t){return Au(t)?t.children?t.children[0]:void 0:t}function Ud(t,e){t.shapeFlag&6&&t.component?Ud(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function e0(t,e=!1,n){let r=[],i=0;for(let s=0;s<t.length;s++){let o=t[s];const a=n==null?o.key:String(n)+String(o.key!=null?o.key:s);o.type===Tn?(o.patchFlag&128&&i++,r=r.concat(e0(o.children,e,a))):(e||o.type!==zn)&&r.push(a!=null?ii(o,{key:a}):o)}if(i>1)for(let s=0;s<r.length;s++)r[s].patchFlag=-2;return r}function cl(t){return Ce(t)?{setup:t,name:t.name}:t}const hc=t=>!!t.type.__asyncLoader,Au=t=>t.type.__isKeepAlive;function Uk(t,e){t0(t,"a",e)}function zk(t,e){t0(t,"da",e)}function t0(t,e,n=ct){const r=t.__wdc||(t.__wdc=()=>{let i=n;for(;i;){if(i.isDeactivated)return;i=i.parent}return t()});if(_u(e,r,n),n){let i=n.parent;for(;i&&i.parent;)Au(i.parent.vnode)&&Hk(r,e,n,i),i=i.parent}}function Hk(t,e,n,r){const i=_u(e,t,r,!0);n0(()=>{lp(r[e],i)},n)}function _u(t,e,n=ct,r=!1){if(n){const i=n[t]||(n[t]=[]),s=e.__weh||(e.__weh=(...o)=>{if(n.isUnmounted)return;_o(),so(n);const a=_n(e,n,t,o);return Ki(),Mo(),a});return r?i.unshift(s):i.push(s),s}}const Ir=t=>(e,n=ct)=>(!Oa||t==="sp")&&_u(t,(...r)=>e(...r),n),jk=Ir("bm"),Mu=Ir("m"),Kk=Ir("bu"),qk=Ir("u"),ul=Ir("bum"),n0=Ir("um"),Wk=Ir("sp"),Gk=Ir("rtg"),Jk=Ir("rtc");function Xk(t,e=ct){_u("ec",t,e)}function Nm(t,e){const n=In;if(n===null)return t;const r=Nu(n)||n.proxy,i=t.dirs||(t.dirs=[]);for(let s=0;s<e.length;s++){let[o,a,l,c=Ue]=e[s];Ce(o)&&(o={mounted:o,updated:o}),o.deep&&$i(a),i.push({dir:o,instance:r,value:a,oldValue:void 0,arg:l,modifiers:c})}return t}function Ei(t,e,n,r){const i=t.dirs,s=e&&e.dirs;for(let o=0;o<i.length;o++){const a=i[o];s&&(a.oldValue=s[o].value);let l=a.dir[r];l&&(_o(),_n(l,n,8,[t.el,a,t,e]),Mo())}}const r0="components";function zd(t,e){return Qk(r0,t,!0,e)||t}const Yk=Symbol();function Qk(t,e,n=!0,r=!1){const i=In||ct;if(i){const s=i.type;if(t===r0){const a=NI(s,!1);if(a&&(a===e||a===dr(e)||a===Su(dr(e))))return s}const o=Dm(i[t]||s[t],e)||Dm(i.appContext[t],e);return!o&&r?s:o}}function Dm(t,e){return t&&(t[e]||t[dr(e)]||t[Su(dr(e))])}function Zk(t,e,n,r){let i;const s=n&&n[r];if(de(t)||ot(t)){i=new Array(t.length);for(let o=0,a=t.length;o<a;o++)i[o]=e(t[o],o,void 0,s&&s[o])}else if(typeof t=="number"){i=new Array(t);for(let o=0;o<t;o++)i[o]=e(o+1,o,void 0,s&&s[o])}else if(He(t))if(t[Symbol.iterator])i=Array.from(t,(o,a)=>e(o,a,void 0,s&&s[a]));else{const o=Object.keys(t);i=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];i[a]=e(t[c],c,a,s&&s[a])}}else i=[];return n&&(n[r]=i),i}const Hd=t=>t?g0(t)?Nu(t)||t.proxy:Hd(t.parent):null,Mc=Ft(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Hd(t.parent),$root:t=>Hd(t.root),$emit:t=>t.emit,$options:t=>Tp(t),$forceUpdate:t=>t.f||(t.f=()=>xp(t.update)),$nextTick:t=>t.n||(t.n=Kv.bind(t.proxy)),$watch:t=>Bk.bind(t)}),eI={get({_:t},e){const{ctx:n,setupState:r,data:i,props:s,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return r[e];case 2:return i[e];case 4:return n[e];case 3:return s[e]}else{if(r!==Ue&&Me(r,e))return o[e]=1,r[e];if(i!==Ue&&Me(i,e))return o[e]=2,i[e];if((c=t.propsOptions[0])&&Me(c,e))return o[e]=3,s[e];if(n!==Ue&&Me(n,e))return o[e]=4,n[e];jd&&(o[e]=0)}}const u=Mc[e];let h,d;if(u)return e==="$attrs"&&yn(t,"get",e),u(t);if((h=a.__cssModules)&&(h=h[e]))return h;if(n!==Ue&&Me(n,e))return o[e]=4,n[e];if(d=l.config.globalProperties,Me(d,e))return d[e]},set({_:t},e,n){const{data:r,setupState:i,ctx:s}=t;return i!==Ue&&Me(i,e)?(i[e]=n,!0):r!==Ue&&Me(r,e)?(r[e]=n,!0):Me(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(s[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:i,propsOptions:s}},o){let a;return!!n[o]||t!==Ue&&Me(t,o)||e!==Ue&&Me(e,o)||(a=s[0])&&Me(a,o)||Me(r,o)||Me(Mc,o)||Me(i.config.globalProperties,o)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Me(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let jd=!0;function tI(t){const e=Tp(t),n=t.proxy,r=t.ctx;jd=!1,e.beforeCreate&&Rm(e.beforeCreate,t,"bc");const{data:i,computed:s,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:h,mounted:d,beforeUpdate:f,updated:p,activated:g,deactivated:m,beforeDestroy:w,beforeUnmount:_,destroyed:M,unmounted:y,render:L,renderTracked:R,renderTriggered:j,errorCaptured:N,serverPrefetch:J,expose:ie,inheritAttrs:he,components:ve,directives:Ee,filters:Oe}=e;if(c&&nI(c,r,null,t.appContext.config.unwrapInjectedRef),o)for(const T in o){const O=o[T];Ce(O)&&(r[T]=O.bind(n))}if(i){const T=i.call(n,n);He(T)&&(t.data=Cu(T))}if(jd=!0,s)for(const T in s){const O=s[T],W=Ce(O)?O.bind(n,n):Ce(O.get)?O.get.bind(n,n):Un,ne=!Ce(O)&&Ce(O.set)?O.set.bind(n):Un,me=RI({get:W,set:ne});Object.defineProperty(r,T,{enumerable:!0,configurable:!0,get:()=>me.value,set:xe=>me.value=xe})}if(a)for(const T in a)i0(a[T],r,n,T);if(l){const T=Ce(l)?l.call(n):l;Reflect.ownKeys(T).forEach(O=>{Pk(O,T[O])})}u&&Rm(u,t,"c");function v(T,O){de(O)?O.forEach(W=>T(W.bind(n))):O&&T(O.bind(n))}if(v(jk,h),v(Mu,d),v(Kk,f),v(qk,p),v(Uk,g),v(zk,m),v(Xk,N),v(Jk,R),v(Gk,j),v(ul,_),v(n0,y),v(Wk,J),de(ie))if(ie.length){const T=t.exposed||(t.exposed={});ie.forEach(O=>{Object.defineProperty(T,O,{get:()=>n[O],set:W=>n[O]=W})})}else t.exposed||(t.exposed={});L&&t.render===Un&&(t.render=L),he!=null&&(t.inheritAttrs=he),ve&&(t.components=ve),Ee&&(t.directives=Ee)}function nI(t,e,n=Un,r=!1){de(t)&&(t=Kd(t));for(const i in t){const s=t[i];let o;He(s)?"default"in s?o=Bh(s.from||i,s.default,!0):o=Bh(s.from||i):o=Bh(s),Nt(o)&&r?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[i]=o}}function Rm(t,e,n){_n(de(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,n)}function i0(t,e,n,r){const i=r.includes(".")?Qv(n,r):()=>n[r];if(ot(t)){const s=e[t];Ce(s)&&Fh(i,s)}else if(Ce(t))Fh(i,t.bind(n));else if(He(t))if(de(t))t.forEach(s=>i0(s,e,n,r));else{const s=Ce(t.handler)?t.handler.bind(n):e[t.handler];Ce(s)&&Fh(i,s,t)}}function Tp(t){const e=t.type,{mixins:n,extends:r}=e,{mixins:i,optionsCache:s,config:{optionMergeStrategies:o}}=t.appContext,a=s.get(e);let l;return a?l=a:!i.length&&!n&&!r?l=e:(l={},i.length&&i.forEach(c=>Oc(l,c,o,!0)),Oc(l,e,o)),He(e)&&s.set(e,l),l}function Oc(t,e,n,r=!1){const{mixins:i,extends:s}=e;s&&Oc(t,s,n,!0),i&&i.forEach(o=>Oc(t,o,n,!0));for(const o in e)if(!(r&&o==="expose")){const a=rI[o]||n&&n[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const rI={data:Pm,props:ki,emits:ki,methods:ki,computed:ki,beforeCreate:zt,created:zt,beforeMount:zt,mounted:zt,beforeUpdate:zt,updated:zt,beforeDestroy:zt,beforeUnmount:zt,destroyed:zt,unmounted:zt,activated:zt,deactivated:zt,errorCaptured:zt,serverPrefetch:zt,components:ki,directives:ki,watch:sI,provide:Pm,inject:iI};function Pm(t,e){return e?t?function(){return Ft(Ce(t)?t.call(this,this):t,Ce(e)?e.call(this,this):e)}:e:t}function iI(t,e){return ki(Kd(t),Kd(e))}function Kd(t){if(de(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function zt(t,e){return t?[...new Set([].concat(t,e))]:e}function ki(t,e){return t?Ft(Ft(Object.create(null),t),e):e}function sI(t,e){if(!t)return e;if(!e)return t;const n=Ft(Object.create(null),t);for(const r in e)n[r]=zt(t[r],e[r]);return n}function oI(t,e,n,r=!1){const i={},s={};Ic(s,Ou,1),t.propsDefaults=Object.create(null),s0(t,e,i,s);for(const o in t.propsOptions[0])o in i||(i[o]=void 0);n?t.props=r?i:gk(i):t.type.props?t.props=i:t.props=s,t.attrs=s}function aI(t,e,n,r){const{props:i,attrs:s,vnode:{patchFlag:o}}=t,a=Be(i),[l]=t.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const u=t.vnode.dynamicProps;for(let h=0;h<u.length;h++){let d=u[h];if(Iu(t.emitsOptions,d))continue;const f=e[d];if(l)if(Me(s,d))f!==s[d]&&(s[d]=f,c=!0);else{const p=dr(d);i[p]=qd(l,a,p,f,t,!1)}else f!==s[d]&&(s[d]=f,c=!0)}}}else{s0(t,e,i,s)&&(c=!0);let u;for(const h in a)(!e||!Me(e,h)&&((u=Ao(h))===h||!Me(e,u)))&&(l?n&&(n[h]!==void 0||n[u]!==void 0)&&(i[h]=qd(l,a,h,void 0,t,!0)):delete i[h]);if(s!==a)for(const h in s)(!e||!Me(e,h)&&!0)&&(delete s[h],c=!0)}c&&Tr(t,"set","$attrs")}function s0(t,e,n,r){const[i,s]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if(cc(l))continue;const c=e[l];let u;i&&Me(i,u=dr(l))?!s||!s.includes(u)?n[u]=c:(a||(a={}))[u]=c:Iu(t.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(s){const l=Be(n),c=a||Ue;for(let u=0;u<s.length;u++){const h=s[u];n[h]=qd(i,l,h,c[h],t,!Me(c,h))}}return o}function qd(t,e,n,r,i,s){const o=t[n];if(o!=null){const a=Me(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&Ce(l)){const{propsDefaults:c}=i;n in c?r=c[n]:(so(i),r=c[n]=l.call(null,e),Ki())}else r=l}o[0]&&(s&&!a?r=!1:o[1]&&(r===""||r===Ao(n))&&(r=!0))}return r}function o0(t,e,n=!1){const r=e.propsCache,i=r.get(t);if(i)return i;const s=t.props,o={},a=[];let l=!1;if(!Ce(t)){const u=h=>{l=!0;const[d,f]=o0(h,e,!0);Ft(o,d),f&&a.push(...f)};!n&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!s&&!l)return He(t)&&r.set(t,Gs),Gs;if(de(s))for(let u=0;u<s.length;u++){const h=dr(s[u]);Lm(h)&&(o[h]=Ue)}else if(s)for(const u in s){const h=dr(u);if(Lm(h)){const d=s[u],f=o[h]=de(d)||Ce(d)?{type:d}:d;if(f){const p=Vm(Boolean,f.type),g=Vm(String,f.type);f[0]=p>-1,f[1]=g<0||p<g,(p>-1||Me(f,"default"))&&a.push(h)}}}const c=[o,a];return He(t)&&r.set(t,c),c}function Lm(t){return t[0]!=="$"}function Bm(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function Fm(t,e){return Bm(t)===Bm(e)}function Vm(t,e){return de(e)?e.findIndex(n=>Fm(n,t)):Ce(e)&&Fm(e,t)?0:-1}const a0=t=>t[0]==="_"||t==="$stable",Cp=t=>de(t)?t.map(Zn):[Zn(t)],lI=(t,e,n)=>{if(e._n)return e;const r=Yv((...i)=>Cp(e(...i)),n);return r._c=!1,r},l0=(t,e,n)=>{const r=t._ctx;for(const i in t){if(a0(i))continue;const s=t[i];if(Ce(s))e[i]=lI(i,s,r);else if(s!=null){const o=Cp(s);e[i]=()=>o}}},c0=(t,e)=>{const n=Cp(e);t.slots.default=()=>n},cI=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=Be(e),Ic(e,"_",n)):l0(e,t.slots={})}else t.slots={},e&&c0(t,e);Ic(t.slots,Ou,1)},uI=(t,e,n)=>{const{vnode:r,slots:i}=t;let s=!0,o=Ue;if(r.shapeFlag&32){const a=e._;a?n&&a===1?s=!1:(Ft(i,e),!n&&a===1&&delete i._):(s=!e.$stable,l0(e,i)),o=e}else e&&(c0(t,e),o={default:1});if(s)for(const a in i)!a0(a)&&!(a in o)&&delete i[a]};function u0(){return{app:null,config:{isNativeTag:PC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hI=0;function dI(t,e){return function(r,i=null){Ce(r)||(r=Object.assign({},r)),i!=null&&!He(i)&&(i=null);const s=u0(),o=new Set;let a=!1;const l=s.app={_uid:hI++,_component:r,_props:i,_container:null,_context:s,_instance:null,version:PI,get config(){return s.config},set config(c){},use(c,...u){return o.has(c)||(c&&Ce(c.install)?(o.add(c),c.install(l,...u)):Ce(c)&&(o.add(c),c(l,...u))),l},mixin(c){return s.mixins.includes(c)||s.mixins.push(c),l},component(c,u){return u?(s.components[c]=u,l):s.components[c]},directive(c,u){return u?(s.directives[c]=u,l):s.directives[c]},mount(c,u,h){if(!a){const d=Dt(r,i);return d.appContext=s,u&&e?e(d,c):t(d,c,h),a=!0,l._container=c,c.__vue_app__=l,Nu(d.component)||d.component.proxy}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,u){return s.provides[c]=u,l}};return l}}function Wd(t,e,n,r,i=!1){if(de(t)){t.forEach((d,f)=>Wd(d,e&&(de(e)?e[f]:e),n,r,i));return}if(hc(r)&&!i)return;const s=r.shapeFlag&4?Nu(r.component)||r.component.proxy:r.el,o=i?null:s,{i:a,r:l}=t,c=e&&e.r,u=a.refs===Ue?a.refs={}:a.refs,h=a.setupState;if(c!=null&&c!==l&&(ot(c)?(u[c]=null,Me(h,c)&&(h[c]=null)):Nt(c)&&(c.value=null)),Ce(l))Gr(l,a,12,[o,u]);else{const d=ot(l),f=Nt(l);if(d||f){const p=()=>{if(t.f){const g=d?u[l]:l.value;i?de(g)&&lp(g,s):de(g)?g.includes(s)||g.push(s):d?(u[l]=[s],Me(h,l)&&(h[l]=u[l])):(l.value=[s],t.k&&(u[t.k]=l.value))}else d?(u[l]=o,Me(h,l)&&(h[l]=o)):f&&(l.value=o,t.k&&(u[t.k]=o))};o?(p.id=-1,en(p,n)):p()}}}const en=Rk;function fI(t){return pI(t)}function pI(t,e){const n=UC();n.__VUE__=!0;const{insert:r,remove:i,patchProp:s,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:h,nextSibling:d,setScopeId:f=Un,insertStaticContent:p}=t,g=(b,E,I,$=null,B=null,S=null,G=!1,D=null,A=!!E.dynamicChildren)=>{if(b===E)return;b&&!Ni(b,E)&&($=mt(b),xe(b,B,S,!0),b=null),E.patchFlag===-2&&(A=!1,E.dynamicChildren=null);const{type:F,ref:Q,shapeFlag:Y}=E;switch(F){case Ip:m(b,E,I,$);break;case zn:w(b,E,I,$);break;case dc:b==null&&_(E,I,$,G);break;case Tn:ve(b,E,I,$,B,S,G,D,A);break;default:Y&1?L(b,E,I,$,B,S,G,D,A):Y&6?Ee(b,E,I,$,B,S,G,D,A):(Y&64||Y&128)&&F.process(b,E,I,$,B,S,G,D,A,yt)}Q!=null&&B&&Wd(Q,b&&b.ref,S,E||b,!E)},m=(b,E,I,$)=>{if(b==null)r(E.el=a(E.children),I,$);else{const B=E.el=b.el;E.children!==b.children&&c(B,E.children)}},w=(b,E,I,$)=>{b==null?r(E.el=l(E.children||""),I,$):E.el=b.el},_=(b,E,I,$)=>{[b.el,b.anchor]=p(b.children,E,I,$,b.el,b.anchor)},M=({el:b,anchor:E},I,$)=>{let B;for(;b&&b!==E;)B=d(b),r(b,I,$),b=B;r(E,I,$)},y=({el:b,anchor:E})=>{let I;for(;b&&b!==E;)I=d(b),i(b),b=I;i(E)},L=(b,E,I,$,B,S,G,D,A)=>{G=G||E.type==="svg",b==null?R(E,I,$,B,S,G,D,A):J(b,E,B,S,G,D,A)},R=(b,E,I,$,B,S,G,D)=>{let A,F;const{type:Q,props:Y,shapeFlag:te,transition:x,dirs:C}=b;if(A=b.el=o(b.type,S,Y&&Y.is,Y),te&8?u(A,b.children):te&16&&N(b.children,A,null,$,B,S&&Q!=="foreignObject",G,D),C&&Ei(b,null,$,"created"),Y){for(const H in Y)H!=="value"&&!cc(H)&&s(A,H,null,Y[H],S,b.children,$,B,je);"value"in Y&&s(A,"value",null,Y.value),(F=Y.onVnodeBeforeMount)&&Jn(F,$,b)}j(A,b,b.scopeId,G,$),C&&Ei(b,null,$,"beforeMount");const V=(!B||B&&!B.pendingBranch)&&x&&!x.persisted;V&&x.beforeEnter(A),r(A,E,I),((F=Y&&Y.onVnodeMounted)||V||C)&&en(()=>{F&&Jn(F,$,b),V&&x.enter(A),C&&Ei(b,null,$,"mounted")},B)},j=(b,E,I,$,B)=>{if(I&&f(b,I),$)for(let S=0;S<$.length;S++)f(b,$[S]);if(B){let S=B.subTree;if(E===S){const G=B.vnode;j(b,G,G.scopeId,G.slotScopeIds,B.parent)}}},N=(b,E,I,$,B,S,G,D,A=0)=>{for(let F=A;F<b.length;F++){const Q=b[F]=D?Pr(b[F]):Zn(b[F]);g(null,Q,E,I,$,B,S,G,D)}},J=(b,E,I,$,B,S,G)=>{const D=E.el=b.el;let{patchFlag:A,dynamicChildren:F,dirs:Q}=E;A|=b.patchFlag&16;const Y=b.props||Ue,te=E.props||Ue;let x;I&&xi(I,!1),(x=te.onVnodeBeforeUpdate)&&Jn(x,I,E,b),Q&&Ei(E,b,I,"beforeUpdate"),I&&xi(I,!0);const C=B&&E.type!=="foreignObject";if(F?ie(b.dynamicChildren,F,D,I,$,C,S):G||O(b,E,D,null,I,$,C,S,!1),A>0){if(A&16)he(D,E,Y,te,I,$,B);else if(A&2&&Y.class!==te.class&&s(D,"class",null,te.class,B),A&4&&s(D,"style",Y.style,te.style,B),A&8){const V=E.dynamicProps;for(let H=0;H<V.length;H++){const ce=V[H],Ne=Y[ce],vn=te[ce];(vn!==Ne||ce==="value")&&s(D,ce,Ne,vn,B,b.children,I,$,je)}}A&1&&b.children!==E.children&&u(D,E.children)}else!G&&F==null&&he(D,E,Y,te,I,$,B);((x=te.onVnodeUpdated)||Q)&&en(()=>{x&&Jn(x,I,E,b),Q&&Ei(E,b,I,"updated")},$)},ie=(b,E,I,$,B,S,G)=>{for(let D=0;D<E.length;D++){const A=b[D],F=E[D],Q=A.el&&(A.type===Tn||!Ni(A,F)||A.shapeFlag&70)?h(A.el):I;g(A,F,Q,null,$,B,S,G,!0)}},he=(b,E,I,$,B,S,G)=>{if(I!==$){if(I!==Ue)for(const D in I)!cc(D)&&!(D in $)&&s(b,D,I[D],null,G,E.children,B,S,je);for(const D in $){if(cc(D))continue;const A=$[D],F=I[D];A!==F&&D!=="value"&&s(b,D,F,A,G,E.children,B,S,je)}"value"in $&&s(b,"value",I.value,$.value)}},ve=(b,E,I,$,B,S,G,D,A)=>{const F=E.el=b?b.el:a(""),Q=E.anchor=b?b.anchor:a("");let{patchFlag:Y,dynamicChildren:te,slotScopeIds:x}=E;x&&(D=D?D.concat(x):x),b==null?(r(F,I,$),r(Q,I,$),N(E.children,I,Q,B,S,G,D,A)):Y>0&&Y&64&&te&&b.dynamicChildren?(ie(b.dynamicChildren,te,I,B,S,G,D),(E.key!=null||B&&E===B.subTree)&&kp(b,E,!0)):O(b,E,I,Q,B,S,G,D,A)},Ee=(b,E,I,$,B,S,G,D,A)=>{E.slotScopeIds=D,b==null?E.shapeFlag&512?B.ctx.activate(E,I,$,G,A):Oe(E,I,$,B,S,G,A):ze(b,E,A)},Oe=(b,E,I,$,B,S,G)=>{const D=b.component=II(b,$,B);if(Au(b)&&(D.ctx.renderer=yt),AI(D),D.asyncDep){if(B&&B.registerDep(D,v),!b.el){const A=D.subTree=Dt(zn);w(null,A,E,I)}return}v(D,b,E,I,B,S,G)},ze=(b,E,I)=>{const $=E.component=b.component;if(Ok(b,E,I))if($.asyncDep&&!$.asyncResolved){T($,E,I);return}else $.next=E,Ck($.update),$.update();else E.el=b.el,$.vnode=E},v=(b,E,I,$,B,S,G)=>{const D=()=>{if(b.isMounted){let{next:Q,bu:Y,u:te,parent:x,vnode:C}=b,V=Q,H;xi(b,!1),Q?(Q.el=C.el,T(b,Q,G)):Q=C,Y&&uc(Y),(H=Q.props&&Q.props.onVnodeBeforeUpdate)&&Jn(H,x,Q,C),xi(b,!0);const ce=Lh(b),Ne=b.subTree;b.subTree=ce,g(Ne,ce,h(Ne.el),mt(Ne),b,B,S),Q.el=ce.el,V===null&&Nk(b,ce.el),te&&en(te,B),(H=Q.props&&Q.props.onVnodeUpdated)&&en(()=>Jn(H,x,Q,C),B)}else{let Q;const{el:Y,props:te}=E,{bm:x,m:C,parent:V}=b,H=hc(E);if(xi(b,!1),x&&uc(x),!H&&(Q=te&&te.onVnodeBeforeMount)&&Jn(Q,V,E),xi(b,!0),Y&&Qt){const ce=()=>{b.subTree=Lh(b),Qt(Y,b.subTree,b,B,null)};H?E.type.__asyncLoader().then(()=>!b.isUnmounted&&ce()):ce()}else{const ce=b.subTree=Lh(b);g(null,ce,I,$,b,B,S),E.el=ce.el}if(C&&en(C,B),!H&&(Q=te&&te.onVnodeMounted)){const ce=E;en(()=>Jn(Q,V,ce),B)}(E.shapeFlag&256||V&&hc(V.vnode)&&V.vnode.shapeFlag&256)&&b.a&&en(b.a,B),b.isMounted=!0,E=I=$=null}},A=b.effect=new hp(D,()=>xp(F),b.scope),F=b.update=()=>A.run();F.id=b.uid,xi(b,!0),F()},T=(b,E,I)=>{E.component=b;const $=b.vnode.props;b.vnode=E,b.next=null,aI(b,E.props,$,I),uI(b,E.children,I),_o(),Am(),Mo()},O=(b,E,I,$,B,S,G,D,A=!1)=>{const F=b&&b.children,Q=b?b.shapeFlag:0,Y=E.children,{patchFlag:te,shapeFlag:x}=E;if(te>0){if(te&128){ne(F,Y,I,$,B,S,G,D,A);return}else if(te&256){W(F,Y,I,$,B,S,G,D,A);return}}x&8?(Q&16&&je(F,B,S),Y!==F&&u(I,Y)):Q&16?x&16?ne(F,Y,I,$,B,S,G,D,A):je(F,B,S,!0):(Q&8&&u(I,""),x&16&&N(Y,I,$,B,S,G,D,A))},W=(b,E,I,$,B,S,G,D,A)=>{b=b||Gs,E=E||Gs;const F=b.length,Q=E.length,Y=Math.min(F,Q);let te;for(te=0;te<Y;te++){const x=E[te]=A?Pr(E[te]):Zn(E[te]);g(b[te],x,I,null,B,S,G,D,A)}F>Q?je(b,B,S,!0,!1,Y):N(E,I,$,B,S,G,D,A,Y)},ne=(b,E,I,$,B,S,G,D,A)=>{let F=0;const Q=E.length;let Y=b.length-1,te=Q-1;for(;F<=Y&&F<=te;){const x=b[F],C=E[F]=A?Pr(E[F]):Zn(E[F]);if(Ni(x,C))g(x,C,I,null,B,S,G,D,A);else break;F++}for(;F<=Y&&F<=te;){const x=b[Y],C=E[te]=A?Pr(E[te]):Zn(E[te]);if(Ni(x,C))g(x,C,I,null,B,S,G,D,A);else break;Y--,te--}if(F>Y){if(F<=te){const x=te+1,C=x<Q?E[x].el:$;for(;F<=te;)g(null,E[F]=A?Pr(E[F]):Zn(E[F]),I,C,B,S,G,D,A),F++}}else if(F>te)for(;F<=Y;)xe(b[F],B,S,!0),F++;else{const x=F,C=F,V=new Map;for(F=C;F<=te;F++){const Z=E[F]=A?Pr(E[F]):Zn(E[F]);Z.key!=null&&V.set(Z.key,F)}let H,ce=0;const Ne=te-C+1;let vn=!1,_r=0;const wi=new Array(Ne);for(F=0;F<Ne;F++)wi[F]=0;for(F=x;F<=Y;F++){const Z=b[F];if(ce>=Ne){xe(Z,B,S,!0);continue}let le;if(Z.key!=null)le=V.get(Z.key);else for(H=C;H<=te;H++)if(wi[H-C]===0&&Ni(Z,E[H])){le=H;break}le===void 0?xe(Z,B,S,!0):(wi[le-C]=F+1,le>=_r?_r=le:vn=!0,g(Z,E[le],I,null,B,S,G,D,A),ce++)}const P=vn?gI(wi):Gs;for(H=P.length-1,F=Ne-1;F>=0;F--){const Z=C+F,le=E[Z],Re=Z+1<Q?E[Z+1].el:$;wi[F]===0?g(null,le,I,Re,B,S,G,D,A):vn&&(H<0||F!==P[H]?me(le,I,Re,2):H--)}}},me=(b,E,I,$,B=null)=>{const{el:S,type:G,transition:D,children:A,shapeFlag:F}=b;if(F&6){me(b.component.subTree,E,I,$);return}if(F&128){b.suspense.move(E,I,$);return}if(F&64){G.move(b,E,I,yt);return}if(G===Tn){r(S,E,I);for(let Y=0;Y<A.length;Y++)me(A[Y],E,I,$);r(b.anchor,E,I);return}if(G===dc){M(b,E,I);return}if($!==2&&F&1&&D)if($===0)D.beforeEnter(S),r(S,E,I),en(()=>D.enter(S),B);else{const{leave:Y,delayLeave:te,afterLeave:x}=D,C=()=>r(S,E,I),V=()=>{Y(S,()=>{C(),x&&x()})};te?te(S,C,V):V()}else r(S,E,I)},xe=(b,E,I,$=!1,B=!1)=>{const{type:S,props:G,ref:D,children:A,dynamicChildren:F,shapeFlag:Q,patchFlag:Y,dirs:te}=b;if(D!=null&&Wd(D,null,I,b,!0),Q&256){E.ctx.deactivate(b);return}const x=Q&1&&te,C=!hc(b);let V;if(C&&(V=G&&G.onVnodeBeforeUnmount)&&Jn(V,E,b),Q&6)Pe(b.component,I,$);else{if(Q&128){b.suspense.unmount(I,$);return}x&&Ei(b,null,E,"beforeUnmount"),Q&64?b.type.remove(b,E,I,B,yt,$):F&&(S!==Tn||Y>0&&Y&64)?je(F,E,I,!1,!0):(S===Tn&&Y&384||!B&&Q&16)&&je(A,E,I),$&&Qe(b)}(C&&(V=G&&G.onVnodeUnmounted)||x)&&en(()=>{V&&Jn(V,E,b),x&&Ei(b,null,E,"unmounted")},I)},Qe=b=>{const{type:E,el:I,anchor:$,transition:B}=b;if(E===Tn){ke(I,$);return}if(E===dc){y(b);return}const S=()=>{i(I),B&&!B.persisted&&B.afterLeave&&B.afterLeave()};if(b.shapeFlag&1&&B&&!B.persisted){const{leave:G,delayLeave:D}=B,A=()=>G(I,S);D?D(b.el,S,A):A()}else S()},ke=(b,E)=>{let I;for(;b!==E;)I=d(b),i(b),b=I;i(E)},Pe=(b,E,I)=>{const{bum:$,scope:B,update:S,subTree:G,um:D}=b;$&&uc($),B.stop(),S&&(S.active=!1,xe(G,b,E,I)),D&&en(D,E),en(()=>{b.isUnmounted=!0},E),E&&E.pendingBranch&&!E.isUnmounted&&b.asyncDep&&!b.asyncResolved&&b.suspenseId===E.pendingId&&(E.deps--,E.deps===0&&E.resolve())},je=(b,E,I,$=!1,B=!1,S=0)=>{for(let G=S;G<b.length;G++)xe(b[G],E,I,$,B)},mt=b=>b.shapeFlag&6?mt(b.component.subTree):b.shapeFlag&128?b.suspense.next():d(b.anchor||b.el),kt=(b,E,I)=>{b==null?E._vnode&&xe(E._vnode,null,null,!0):g(E._vnode||null,b,E,null,null,null,I),Am(),Wv(),E._vnode=b},yt={p:g,um:xe,m:me,r:Qe,mt:Oe,mc:N,pc:O,pbc:ie,n:mt,o:t};let It,Qt;return e&&([It,Qt]=e(yt)),{render:kt,hydrate:It,createApp:dI(kt,It)}}function xi({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function kp(t,e,n=!1){const r=t.children,i=e.children;if(de(r)&&de(i))for(let s=0;s<r.length;s++){const o=r[s];let a=i[s];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[s]=Pr(i[s]),a.el=o.el),n||kp(o,a))}}function gI(t){const e=t.slice(),n=[0];let r,i,s,o,a;const l=t.length;for(r=0;r<l;r++){const c=t[r];if(c!==0){if(i=n[n.length-1],t[i]<c){e[r]=i,n.push(r);continue}for(s=0,o=n.length-1;s<o;)a=s+o>>1,t[n[a]]<c?s=a+1:o=a;c<t[n[s]]&&(s>0&&(e[r]=n[s-1]),n[s]=r)}}for(s=n.length,o=n[s-1];s-- >0;)n[s]=o,o=e[o];return n}const mI=t=>t.__isTeleport,la=t=>t&&(t.disabled||t.disabled===""),$m=t=>typeof SVGElement<"u"&&t instanceof SVGElement,Gd=(t,e)=>{const n=t&&t.to;return ot(n)?e?e(n):null:n},yI={__isTeleport:!0,process(t,e,n,r,i,s,o,a,l,c){const{mc:u,pc:h,pbc:d,o:{insert:f,querySelector:p,createText:g,createComment:m}}=c,w=la(e.props);let{shapeFlag:_,children:M,dynamicChildren:y}=e;if(t==null){const L=e.el=g(""),R=e.anchor=g("");f(L,n,r),f(R,n,r);const j=e.target=Gd(e.props,p),N=e.targetAnchor=g("");j&&(f(N,j),o=o||$m(j));const J=(ie,he)=>{_&16&&u(M,ie,he,i,s,o,a,l)};w?J(n,R):j&&J(j,N)}else{e.el=t.el;const L=e.anchor=t.anchor,R=e.target=t.target,j=e.targetAnchor=t.targetAnchor,N=la(t.props),J=N?n:R,ie=N?L:j;if(o=o||$m(R),y?(d(t.dynamicChildren,y,J,i,s,o,a),kp(t,e,!0)):l||h(t,e,J,ie,i,s,o,a,!1),w)N||Fl(e,n,L,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const he=e.target=Gd(e.props,p);he&&Fl(e,he,null,c,0)}else N&&Fl(e,R,j,c,1)}},remove(t,e,n,r,{um:i,o:{remove:s}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:u,target:h,props:d}=t;if(h&&s(u),(o||!la(d))&&(s(c),a&16))for(let f=0;f<l.length;f++){const p=l[f];i(p,e,n,!0,!!p.dynamicChildren)}},move:Fl,hydrate:bI};function Fl(t,e,n,{o:{insert:r},m:i},s=2){s===0&&r(t.targetAnchor,e,n);const{el:o,anchor:a,shapeFlag:l,children:c,props:u}=t,h=s===2;if(h&&r(o,e,n),(!h||la(u))&&l&16)for(let d=0;d<c.length;d++)i(c[d],e,n,2);h&&r(a,e,n)}function bI(t,e,n,r,i,s,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const u=e.target=Gd(e.props,l);if(u){const h=u._lpa||u.firstChild;if(e.shapeFlag&16)if(la(e.props))e.anchor=c(o(t),e,a(t),n,r,i,s),e.targetAnchor=h;else{e.anchor=o(t);let d=h;for(;d;)if(d=o(d),d&&d.nodeType===8&&d.data==="teleport anchor"){e.targetAnchor=d,u._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(h,e,u,n,r,i,s)}}return e.anchor&&o(e.anchor)}const wI=yI,Tn=Symbol(void 0),Ip=Symbol(void 0),zn=Symbol(void 0),dc=Symbol(void 0),ca=[];let Fn=null;function Ht(t=!1){ca.push(Fn=t?null:[])}function vI(){ca.pop(),Fn=ca[ca.length-1]||null}let Ma=1;function Um(t){Ma+=t}function h0(t){return t.dynamicChildren=Ma>0?Fn||Gs:null,vI(),Ma>0&&Fn&&Fn.push(t),t}function hn(t,e,n,r,i,s){return h0(q(t,e,n,r,i,s,!0))}function d0(t,e,n,r,i){return h0(Dt(t,e,n,r,i,!0))}function Jd(t){return t?t.__v_isVNode===!0:!1}function Ni(t,e){return t.type===e.type&&t.key===e.key}const Ou="__vInternal",f0=({key:t})=>t!=null?t:null,fc=({ref:t,ref_key:e,ref_for:n})=>t!=null?ot(t)||Nt(t)||Ce(t)?{i:In,r:t,k:e,f:!!n}:t:null;function q(t,e=null,n=null,r=0,i=null,s=t===Tn?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&f0(e),ref:e&&fc(e),scopeId:Xv,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null};return a?(Ap(l,n),s&128&&t.normalize(l)):n&&(l.shapeFlag|=ot(n)?8:16),Ma>0&&!o&&Fn&&(l.patchFlag>0||s&6)&&l.patchFlag!==32&&Fn.push(l),l}const Dt=EI;function EI(t,e=null,n=null,r=0,i=null,s=!1){if((!t||t===Yk)&&(t=zn),Jd(t)){const a=ii(t,e,!0);return n&&Ap(a,n),Ma>0&&!s&&Fn&&(a.shapeFlag&6?Fn[Fn.indexOf(t)]=a:Fn.push(a)),a.patchFlag|=-2,a}if(DI(t)&&(t=t.__vccOpts),e){e=xI(e);let{class:a,style:l}=e;a&&!ot(a)&&(e.class=Zt(a)),He(l)&&($v(l)&&!de(l)&&(l=Ft({},l)),e.style=op(l))}const o=ot(t)?1:Dk(t)?128:mI(t)?64:He(t)?4:Ce(t)?2:0;return q(t,e,n,r,i,o,s,!0)}function xI(t){return t?$v(t)||Ou in t?Ft({},t):t:null}function ii(t,e,n=!1){const{props:r,ref:i,patchFlag:s,children:o}=t,a=e?TI(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&f0(a),ref:e&&e.ref?n&&i?de(i)?i.concat(fc(e)):[i,fc(e)]:fc(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:o,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Tn?s===-1?16:s|16:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&ii(t.ssContent),ssFallback:t.ssFallback&&ii(t.ssFallback),el:t.el,anchor:t.anchor}}function Ii(t=" ",e=0){return Dt(Ip,null,t,e)}function SI(t,e){const n=Dt(dc,null,t);return n.staticCount=e,n}function _s(t="",e=!1){return e?(Ht(),d0(zn,null,t)):Dt(zn,null,t)}function Zn(t){return t==null||typeof t=="boolean"?Dt(zn):de(t)?Dt(Tn,null,t.slice()):typeof t=="object"?Pr(t):Dt(Ip,null,String(t))}function Pr(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:ii(t)}function Ap(t,e){let n=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(de(e))n=16;else if(typeof e=="object")if(r&65){const i=e.default;i&&(i._c&&(i._d=!1),Ap(t,i()),i._c&&(i._d=!0));return}else{n=32;const i=e._;!i&&!(Ou in e)?e._ctx=In:i===3&&In&&(In.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Ce(e)?(e={default:e,_ctx:In},n=32):(e=String(e),r&64?(n=16,e=[Ii(e)]):n=8);t.children=e,t.shapeFlag|=n}function TI(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const i in r)if(i==="class")e.class!==r.class&&(e.class=Zt([e.class,r.class]));else if(i==="style")e.style=op([e.style,r.style]);else if(vu(i)){const s=e[i],o=r[i];o&&s!==o&&!(de(s)&&s.includes(o))&&(e[i]=s?[].concat(s,o):o)}else i!==""&&(e[i]=r[i])}return e}function Jn(t,e,n,r=null){_n(t,e,7,[n,r])}const CI=u0();let kI=0;function II(t,e,n){const r=t.type,i=(e?e.appContext:t.appContext)||CI,s={uid:kI++,vnode:t,type:r,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new zC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:o0(r,i),emitsOptions:Jv(r,i),emit:null,emitted:null,propsDefaults:Ue,inheritAttrs:r.inheritAttrs,ctx:Ue,data:Ue,props:Ue,attrs:Ue,slots:Ue,refs:Ue,setupState:Ue,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=e?e.root:s,s.emit=Ak.bind(null,s),t.ce&&t.ce(s),s}let ct=null;const p0=()=>ct||In,so=t=>{ct=t,t.scope.on()},Ki=()=>{ct&&ct.scope.off(),ct=null};function g0(t){return t.vnode.shapeFlag&4}let Oa=!1;function AI(t,e=!1){Oa=e;const{props:n,children:r}=t.vnode,i=g0(t);oI(t,n,i,e),cI(t,r);const s=i?_I(t,e):void 0;return Oa=!1,s}function _I(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=mp(new Proxy(t.ctx,eI));const{setup:r}=n;if(r){const i=t.setupContext=r.length>1?OI(t):null;so(t),_o();const s=Gr(r,t,0,[t.props,i]);if(Mo(),Ki(),kv(s)){if(s.then(Ki,Ki),e)return s.then(o=>{zm(t,o,e)}).catch(o=>{ku(o,t,0)});t.asyncDep=s}else zm(t,s,e)}else m0(t,e)}function zm(t,e,n){Ce(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:He(e)&&(t.setupState=zv(e)),m0(t,n)}let Hm;function m0(t,e,n){const r=t.type;if(!t.render){if(!e&&Hm&&!r.render){const i=r.template||Tp(t).template;if(i){const{isCustomElement:s,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Ft(Ft({isCustomElement:s,delimiters:a},o),l);r.render=Hm(i,c)}}t.render=r.render||Un}so(t),_o(),tI(t),Mo(),Ki()}function MI(t){return new Proxy(t.attrs,{get(e,n){return yn(t,"get","$attrs"),e[n]}})}function OI(t){const e=r=>{t.exposed=r||{}};let n;return{get attrs(){return n||(n=MI(t))},slots:t.slots,emit:t.emit,expose:e}}function Nu(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(zv(mp(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in Mc)return Mc[n](t)}}))}function NI(t,e=!0){return Ce(t)?t.displayName||t.name:t.name||e&&t.__name}function DI(t){return Ce(t)&&"__vccOpts"in t}const RI=(t,e)=>xk(t,e,Oa);function qi(t,e,n){const r=arguments.length;return r===2?He(e)&&!de(e)?Jd(e)?Dt(t,null,[e]):Dt(t,e):Dt(t,null,e):(r>3?n=Array.prototype.slice.call(arguments,2):r===3&&Jd(n)&&(n=[n]),Dt(t,e,n))}const PI="3.2.40",LI="http://www.w3.org/2000/svg",Di=typeof document<"u"?document:null,jm=Di&&Di.createElement("template"),BI={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const i=e?Di.createElementNS(LI,t):Di.createElement(t,n?{is:n}:void 0);return t==="select"&&r&&r.multiple!=null&&i.setAttribute("multiple",r.multiple),i},createText:t=>Di.createTextNode(t),createComment:t=>Di.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Di.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,r,i,s){const o=n?n.previousSibling:e.lastChild;if(i&&(i===s||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),n),!(i===s||!(i=i.nextSibling)););else{jm.innerHTML=r?`<svg>${t}</svg>`:t;const a=jm.content;if(r){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function FI(t,e,n){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function VI(t,e,n){const r=t.style,i=ot(n);if(n&&!i){for(const s in n)Xd(r,s,n[s]);if(e&&!ot(e))for(const s in e)n[s]==null&&Xd(r,s,"")}else{const s=r.display;i?e!==n&&(r.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(r.display=s)}}const Km=/\s*!important$/;function Xd(t,e,n){if(de(n))n.forEach(r=>Xd(t,e,r));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const r=$I(t,e);Km.test(n)?t.setProperty(Ao(r),n.replace(Km,""),"important"):t[r]=n}}const qm=["Webkit","Moz","ms"],$h={};function $I(t,e){const n=$h[e];if(n)return n;let r=dr(e);if(r!=="filter"&&r in t)return $h[e]=r;r=Su(r);for(let i=0;i<qm.length;i++){const s=qm[i]+r;if(s in t)return $h[e]=s}return e}const Wm="http://www.w3.org/1999/xlink";function UI(t,e,n,r,i){if(r&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(Wm,e.slice(6,e.length)):t.setAttributeNS(Wm,e,n);else{const s=MC(e);n==null||s&&!Sv(n)?t.removeAttribute(e):t.setAttribute(e,s?"":n)}}function zI(t,e,n,r,i,s,o){if(e==="innerHTML"||e==="textContent"){r&&o(r,i,s),t[e]=n==null?"":n;return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=n;const l=n==null?"":n;(t.value!==l||t.tagName==="OPTION")&&(t.value=l),n==null&&t.removeAttribute(e);return}let a=!1;if(n===""||n==null){const l=typeof t[e];l==="boolean"?n=Sv(n):n==null&&l==="string"?(n="",a=!0):l==="number"&&(n=0,a=!0)}try{t[e]=n}catch{}a&&t.removeAttribute(e)}const[y0,HI]=(()=>{let t=Date.now,e=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(t=performance.now.bind(performance));const n=navigator.userAgent.match(/firefox\/(\d+)/i);e=!!(n&&Number(n[1])<=53)}return[t,e]})();let Yd=0;const jI=Promise.resolve(),KI=()=>{Yd=0},qI=()=>Yd||(jI.then(KI),Yd=y0());function Ri(t,e,n,r){t.addEventListener(e,n,r)}function WI(t,e,n,r){t.removeEventListener(e,n,r)}function GI(t,e,n,r,i=null){const s=t._vei||(t._vei={}),o=s[e];if(r&&o)o.value=r;else{const[a,l]=JI(e);if(r){const c=s[e]=XI(r,i);Ri(t,a,c,l)}else o&&(WI(t,a,o,l),s[e]=void 0)}}const Gm=/(?:Once|Passive|Capture)$/;function JI(t){let e;if(Gm.test(t)){e={};let r;for(;r=t.match(Gm);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Ao(t.slice(2)),e]}function XI(t,e){const n=r=>{const i=r.timeStamp||y0();(HI||i>=n.attached-1)&&_n(YI(r,n.value),e,5,[r])};return n.value=t,n.attached=qI(),n}function YI(t,e){if(de(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(r=>i=>!i._stopped&&r&&r(i))}else return e}const Jm=/^on[a-z]/,QI=(t,e,n,r,i=!1,s,o,a,l)=>{e==="class"?FI(t,r,i):e==="style"?VI(t,n,r):vu(e)?ap(e)||GI(t,e,n,r,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):ZI(t,e,r,i))?zI(t,e,r,s,o,a,l):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),UI(t,e,r,i))};function ZI(t,e,n,r){return r?!!(e==="innerHTML"||e==="textContent"||e in t&&Jm.test(e)&&Ce(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||Jm.test(e)&&ot(n)?!1:e in t}const eA={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};$k.props;const Nc=t=>{const e=t.props["onUpdate:modelValue"]||!1;return de(e)?n=>uc(e,n):e};function tA(t){t.target.composing=!0}function Xm(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const nA={created(t,{modifiers:{lazy:e,trim:n,number:r}},i){t._assign=Nc(i);const s=r||i.props&&i.props.type==="number";Ri(t,e?"change":"input",o=>{if(o.target.composing)return;let a=t.value;n&&(a=a.trim()),s&&(a=Rd(a)),t._assign(a)}),n&&Ri(t,"change",()=>{t.value=t.value.trim()}),e||(Ri(t,"compositionstart",tA),Ri(t,"compositionend",Xm),Ri(t,"change",Xm))},mounted(t,{value:e}){t.value=e==null?"":e},beforeUpdate(t,{value:e,modifiers:{lazy:n,trim:r,number:i}},s){if(t._assign=Nc(s),t.composing||document.activeElement===t&&t.type!=="range"&&(n||r&&t.value.trim()===e||(i||t.type==="number")&&Rd(t.value)===e))return;const o=e==null?"":e;t.value!==o&&(t.value=o)}},rA={deep:!0,created(t,e,n){t._assign=Nc(n),Ri(t,"change",()=>{const r=t._modelValue,i=iA(t),s=t.checked,o=t._assign;if(de(r)){const a=Tv(r,i),l=a!==-1;if(s&&!l)o(r.concat(i));else if(!s&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Eu(r)){const a=new Set(r);s?a.add(i):a.delete(i),o(a)}else o(b0(t,s))})},mounted:Ym,beforeUpdate(t,e,n){t._assign=Nc(n),Ym(t,e,n)}};function Ym(t,{value:e,oldValue:n},r){t._modelValue=e,de(e)?t.checked=Tv(e,r.props.value)>-1:Eu(e)?t.checked=e.has(r.props.value):e!==n&&(t.checked=wu(e,b0(t,!0)))}function iA(t){return"_value"in t?t._value:t.value}function b0(t,e){const n=e?"_trueValue":"_falseValue";return n in t?t[n]:e}const sA=["ctrl","shift","alt","meta"],oA={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>sA.some(n=>t[`${n}Key`]&&!e.includes(n))},aA=(t,e)=>(n,...r)=>{for(let i=0;i<e.length;i++){const s=oA[e[i]];if(s&&s(n,e))return}return t(n,...r)},lA=Ft({patchProp:QI},BI);let Qm;function cA(){return Qm||(Qm=fI(lA))}const uA=(...t)=>{const e=cA().createApp(...t),{mount:n}=e;return e.mount=r=>{const i=hA(r);if(!i)return;const s=e._component;!Ce(s)&&!s.render&&!s.template&&(s.template=i.innerHTML),i.innerHTML="";const o=n(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},e};function hA(t){return ot(t)?document.querySelector(t):t}function bt(t){this.content=t}bt.prototype={constructor:bt,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new bt(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new bt(n)},addToStart:function(t,e){return new bt([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new bt(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new bt(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=bt.from(t),t.size?new bt(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=bt.from(t),t.size?new bt(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=bt.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};bt.from=function(t){if(t instanceof bt)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new bt(e)};function w0(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=w0(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function v0(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=v0(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class z{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{a.isText?(s+=a.text.slice(Math.max(e,l)-l,n-l),o=!r):a.isLeaf?(i?s+=typeof i=="function"?i(a):i:a.type.spec.leafText&&(s+=a.type.spec.leafText(a)),o=!r):!o&&a.isBlock&&(s+=r,o=!0)},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new z(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new z(r,i)}cutByIndex(e,n){return e==n?z.empty:e==0&&n==this.content.length?this:new z(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new z(i,s)}addToStart(e){return new z([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new z(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return w0(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return v0(this,e,n,r)}findIndex(e,n=-1){if(e==0)return Vl(0,e);if(e==this.size)return Vl(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,i=0;;r++){let s=this.child(r),o=i+s.nodeSize;if(o>=e)return o==e||n>0?Vl(r+1,o):Vl(r,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return z.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return z.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new z(n||e,r)}static from(e){if(!e)return z.empty;if(e instanceof z)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new z([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}z.empty=new z([],0);const Uh={index:0,offset:0};function Vl(t,e){return Uh.index=t,Uh.offset=e,Uh}function Dc(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Dc(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Dc(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}class Fe{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Dc(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);return r.create(n.attrs)}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Fe.none;if(e instanceof Fe)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}}Fe.none=[];class Na extends Error{}class X{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=x0(this.content,e+this.openStart,n);return r&&new X(r,this.openStart,this.openEnd)}removeBetween(e,n){return new X(E0(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return X.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new X(z.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new X(e,r,i)}}X.empty=new X(z.empty,0,0);function E0(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(E0(s.content,e-i-1,n-i-1)))}function x0(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=x0(o.content,e-s-1,n);return a&&t.replaceChild(i,o.copy(a))}function dA(t,e,n){if(n.openStart>t.depth)throw new Na("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Na("Inconsistent open depths");return S0(t,e,n,0)}function S0(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=S0(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Gi(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=fA(n,t);return Gi(s,C0(t,o,a,e,r))}else return Gi(s,Rc(t,e,r))}function T0(t,e){if(!e.type.compatibleContent(t.type))throw new Na("Cannot join "+e.type.name+" onto "+t.type.name)}function Qd(t,e,n){let r=t.node(n);return T0(r,e.node(n)),r}function Wi(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function ua(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(Wi(t.nodeAfter,r),s++));for(let a=s;a<o;a++)Wi(i.child(a),r);e&&e.depth==n&&e.textOffset&&Wi(e.nodeBefore,r)}function Gi(t,e){if(!t.type.validContent(e))throw new Na("Invalid content for node "+t.type.name);return t.copy(e)}function C0(t,e,n,r,i){let s=t.depth>i&&Qd(t,e,i+1),o=r.depth>i&&Qd(n,r,i+1),a=[];return ua(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(T0(s,o),Wi(Gi(s,C0(t,e,n,r,i+1)),a)):(s&&Wi(Gi(s,Rc(t,e,i+1)),a),ua(e,n,i,a),o&&Wi(Gi(o,Rc(n,r,i+1)),a)),ua(r,null,i,a),new z(a)}function Rc(t,e,n){let r=[];if(ua(null,t,n,r),t.depth>n){let i=Qd(t,e,n+1);Wi(Gi(i,Rc(t,e,n+1)),r)}return ua(e,null,n,r),new z(r)}function fA(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(z.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class Da{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Fe.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new Pc(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new Da(n,r,s)}static resolveCached(e,n){for(let i=0;i<zh.length;i++){let s=zh[i];if(s.pos==n&&s.doc==e)return s}let r=zh[Hh]=Da.resolve(e,n);return Hh=(Hh+1)%pA,r}}let zh=[],Hh=0,pA=12;class Pc{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const gA=Object.create(null);class ur{constructor(e,n,r,i=Fe.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||z.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Dc(this.attrs,n||e.defaultAttrs||gA)&&Fe.sameSet(this.marks,r||Fe.none)}copy(e=null){return e==this.content?this:new ur(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new ur(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return X.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new X(c,i.depth-o,s.depth-o)}replace(e,n,r){return dA(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return Da.resolveCached(this,e)}resolveNoCache(e){return Da.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),k0(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=z.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){if(!this.type.validContent(this.content))throw new RangeError(`Invalid content for node ${this.type.name}: ${this.content.toString().slice(0,50)}`);let e=Fe.none;for(let n=0;n<this.marks.length;n++)e=this.marks[n].addToSet(e);if(!Fe.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=z.fromJSON(e,n.content);return e.nodeType(n.type).create(n.attrs,i,r)}}ur.prototype.text=void 0;class Lc extends ur{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):k0(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Lc(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Lc(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function k0(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class rs{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new mA(e,n);if(r.next==null)return rs.empty;let i=I0(r);r.next&&r.err("Unexpected trailing text");let s=SA(xA(i));return TA(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return z.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:h}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);let d=s(h,a.concat(u));if(d)return d}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}rs.empty=new rs(!0);class mA{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function I0(t){let e=[];do e.push(yA(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function yA(t){let e=[];do e.push(bA(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function bA(t){let e=EA(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=wA(t,e);else break;return e}function Zm(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function wA(t,e){let n=Zm(t),r=n;return t.eat(",")&&(t.next!="}"?r=Zm(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function vA(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.groups.indexOf(e)>-1&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function EA(t){if(t.eat("(")){let e=I0(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=vA(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function xA(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function A0(t,e){return e-t}function ey(t,e){let n=[];return r(e),n.sort(A0);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function SA(t){let e=Object.create(null);return n(ey(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);ey(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new rs(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(A0);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function TA(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function _0(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function M0(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function O0(t){let e=Object.create(null);if(t)for(let n in t)e[n]=new CA(t[n]);return e}class Bc{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=O0(r.attrs),this.defaultAttrs=_0(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==rs.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:M0(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new ur(this,this.computeAttrs(e),z.from(n),Fe.setFrom(r))}createChecked(e=null,n,r){if(n=z.from(n),!this.validContent(n))throw new RangeError("Invalid content for node "+this.name);return new ur(this,this.computeAttrs(e),n,Fe.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=z.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(z.empty,!0);return s?new ur(this,e,n.append(s),Fe.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Fe.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new Bc(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}}class CA{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class Du{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=O0(i.attrs),this.excluded=null;let s=_0(this.attrs);this.instance=s?new Fe(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Fe(this,M0(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new Du(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}excludes(e){return this.excluded.indexOf(e)>-1}}class kA{constructor(e){this.cached=Object.create(null),this.spec={nodes:bt.from(e.nodes),marks:bt.from(e.marks||{}),topNode:e.topNode},this.nodes=Bc.compile(this.spec.nodes,this),this.marks=Du.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let i=this.nodes[r],s=i.spec.content||"",o=i.spec.marks;i.contentMatch=n[s]||(n[s]=rs.parse(s,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.markSet=o=="_"?null:o?ty(this,o.split(" ")):o==""||!i.inlineContent?[]:null}for(let r in this.marks){let i=this.marks[r],s=i.spec.excludes;i.excluded=s==null?[i]:s==""?[]:ty(this,s.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Bc){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new Lc(r,r.defaultAttrs,e,Fe.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeFromJSON(e){return ur.fromJSON(this,e)}markFromJSON(e){return Fe.fromJSON(this,e)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function ty(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}class oo{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[],n.forEach(r=>{r.tag?this.tags.push(r):r.style&&this.styles.push(r)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new ry(this,n,!1);return r.addAll(e,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new ry(this,n,!0);return r.addAll(e,n.from,n.to),X.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(_A(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=iy(o)),o.mark=i})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=iy(o)),o.node=i})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new oo(e,oo.schemaRules(e)))}}const N0={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},IA={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},D0={ol:!0,ul:!0},Fc=1,Vc=2,ha=4;function ny(t,e,n){return e!=null?(e?Fc:0)|(e==="full"?Vc:0):t&&t.whitespace=="pre"?Fc|Vc:n&~ha}class $l{constructor(e,n,r,i,s,o,a){this.type=e,this.attrs=n,this.marks=r,this.pendingMarks=i,this.solid=s,this.options=a,this.content=[],this.activeMarks=Fe.none,this.stashMarks=[],this.match=o||(a&ha?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(z.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Fc)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=z.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}popFromStashMark(e){for(let n=this.stashMarks.length-1;n>=0;n--)if(e.eq(this.stashMarks[n]))return this.stashMarks.splice(n,1)[0]}applyPending(e){for(let n=0,r=this.pendingMarks;n<r.length;n++){let i=r[n];(this.type?this.type.allowsMarkType(i.type):OA(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!N0.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class ry{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0;let i=n.topNode,s,o=ny(null,n.preserveWhitespace,0)|(r?ha:0);i?s=new $l(i.type,i.attrs,Fe.none,Fe.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new $l(null,null,Fe.none,Fe.none,!0,null,o):s=new $l(e.schema.topNodeType,null,Fe.none,Fe.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){let n=e.getAttribute("style"),r=n?this.readStyles(MA(n)):null,i=this.top;if(r!=null)for(let s=0;s<r.length;s++)this.addPendingMark(r[s]);if(this.addElement(e),r!=null)for(let s=0;s<r.length;s++)this.removePendingMark(r[s],i)}}addTextNode(e){let n=e.nodeValue,r=this.top;if(r.options&Vc||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(r.options&Fc)r.options&Vc?n=n.replace(/\r\n?/g,`
`):n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let i=r.content[r.content.length-1],s=e.previousSibling;(!i||s&&s.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n)),this.findInText(e)}else this.findInside(e)}addElement(e,n){let r=e.nodeName.toLowerCase(),i;D0.hasOwnProperty(r)&&this.parser.normalizeLists&&AA(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,n));if(s?s.ignore:IA.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let o,a=this.top,l=this.needsBlock;if(N0.hasOwnProperty(r))o=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),o&&this.sync(a),this.needsBlock=l}else this.addElementByRule(e,s,s.consuming===!1?i:void 0)}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let n=Fe.none;e:for(let r=0;r<e.length;r+=2)for(let i=void 0;;){let s=this.parser.matchStyle(e[r],e[r+1],this,i);if(!s)continue e;if(s.ignore)return null;if(n=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(n),s.consuming===!1)i=s;else break}return n}addElementByRule(e,n,r){let i,s,o;n.node?(s=this.parser.schema.nodes[n.node],s.isLeaf?this.insertNode(s.create(n.attrs))||this.leafFallback(e):i=this.enter(s,n.attrs||null,n.preserveWhitespace)):(o=this.parser.schema.marks[n.mark].create(n.attrs),this.addPendingMark(o));let a=this.top;if(s&&s.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l)}i&&this.sync(a)&&this.open--,o&&this.removePendingMark(o,a)}addAll(e,n,r){let i=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=r==null?null:e.childNodes[r];s!=o;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s);this.findAtPoint(e,i)}findPlace(e){let n,r;for(let i=this.open;i>=0;i--){let s=this.nodes[i],o=s.findWrapping(e);if(o&&(!n||n.length>o.length)&&(n=o,r=s,!o.length)||s.solid)break}if(!n)return!1;this.sync(r);for(let i=0;i<n.length;i++)this.enterInner(n[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let n=this.textblockFromContext();n&&this.enterInner(n)}if(this.findPlace(e)){this.closeExtra();let n=this.top;n.applyPending(e.type),n.match&&(n.match=n.match.matchType(e.type));let r=n.activeMarks;for(let i=0;i<e.marks.length;i++)(!n.type||n.type.allowsMarkType(e.marks[i].type))&&(r=e.marks[i].addToSet(r));return n.content.push(e.mark(r)),!0}return!1}enter(e,n,r){let i=this.findPlace(e.create(n));return i&&this.enterInner(e,n,!0,r),i}enterInner(e,n=null,r=!1,i){this.closeExtra();let s=this.top;s.applyPending(e),s.match=s.match&&s.match.matchType(e);let o=ny(e,i,s.options);s.options&ha&&s.content.length==0&&(o|=ha),this.nodes.push(new $l(e,n,s.activeMarks,s.pendingMarks,r,null,o)),this.open++}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let n=this.open;n>=0;n--)if(this.nodes[n]==e)return this.open=n,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&u.groups.indexOf(c)==-1)return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}addPendingMark(e){let n=NA(e,this.top.pendingMarks);n&&this.top.stashMarks.push(n),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,n){for(let r=this.open;r>=0;r--){let i=this.nodes[r];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let o=i.popFromStashMark(e);o&&i.type&&i.type.allowsMarkType(o.type)&&(i.activeMarks=o.addToSet(i.activeMarks))}if(i==n)break}}}function AA(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&D0.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function _A(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function MA(t){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,n,r=[];for(;n=e.exec(t);)r.push(n[1],n[2].trim());return r}function iy(t){let e={};for(let n in t)e[n]=t[n];return e}function OA(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}function NA(t,e){for(let n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}class sr{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=jh(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=sr.renderSpec(jh(n),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&sr.renderSpec(jh(r),i(e,n))}static renderSpec(e,n,r=null){if(typeof n=="string")return{dom:e.createTextNode(n)};if(n.nodeType!=null)return{dom:n};if(n.dom&&n.dom.nodeType!=null)return n;let i=n[0],s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,a=r?e.createElementNS(r,i):e.createElement(i),l=n[1],c=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){c=2;for(let u in l)if(l[u]!=null){let h=u.indexOf(" ");h>0?a.setAttributeNS(u.slice(0,h),u.slice(h+1),l[u]):a.setAttribute(u,l[u])}}for(let u=c;u<n.length;u++){let h=n[u];if(h===0){if(u<n.length-1||u>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:d,contentDOM:f}=sr.renderSpec(e,h,r);if(a.appendChild(d),f){if(o)throw new RangeError("Multiple content holes");o=f}}}return{dom:a,contentDOM:o}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new sr(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=sy(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return sy(e.marks)}}function sy(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function jh(t){return t.document||window.document}const R0=65535,P0=Math.pow(2,16);function DA(t,e){return t+e*P0}function oy(t){return t&R0}function RA(t){return(t-(t&R0))/P0}const L0=1,B0=2,pc=4,F0=8;class Zd{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&F0)>0}get deletedBefore(){return(this.delInfo&(L0|pc))>0}get deletedAfter(){return(this.delInfo&(B0|pc))>0}get deletedAcross(){return(this.delInfo&pc)>0}}class Cn{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Cn.empty)return Cn.empty}recover(e){let n=0,r=oy(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+RA(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],h=l+c;if(e<=h){let d=c?e==l?-1:e==h?1:n:n,f=l+i+(d<0?0:u);if(r)return f;let p=e==(n<0?l:h)?null:DA(a/3,e-l),g=e==l?B0:e==h?L0:pc;return(n<0?e!=l:e!=h)&&(g|=F0),new Zd(f,g,p)}i+=u-c}return r?e+i:new Zd(e+i,0,null)}touches(e,n){let r=0,i=oy(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Cn(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Cn.empty:new Cn(e<0?[0,-e,0]:[0,0,e])}}Cn.empty=new Cn([]);class Qs{constructor(e=[],n,r=0,i=e.length){this.maps=e,this.mirror=n,this.from=r,this.to=i}slice(e=0,n=this.maps.length){return new Qs(this.maps,this.mirror,e,n)}copy(){return new Qs(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,n){this.to=this.maps.push(e),n!=null&&this.setMirror(this.maps.length-1,n)}appendMapping(e){for(let n=0,r=this.maps.length;n<e.maps.length;n++){let i=e.getMirror(n);this.appendMap(e.maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this.maps.length+e.maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e.maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new Qs;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this.maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this.maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new Zd(e,i,null)}}const Kh=Object.create(null);class cn{getMap(){return Cn.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Kh[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Kh)throw new RangeError("Duplicate use of step JSON ID "+e);return Kh[e]=n,n.prototype.jsonID=e,n}}class st{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new st(e,null)}static fail(e){return new st(null,e)}static fromReplace(e,n,r,i){try{return st.ok(e.replace(n,r,i))}catch(s){if(s instanceof Na)return st.fail(s.message);throw s}}}function _p(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(_p(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return z.fromArray(r)}class Ur extends cn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new X(_p(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return st.fromReplace(e,this.from,this.to,s)}invert(){return new or(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ur(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ur&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ur(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ur(n.from,n.to,e.markFromJSON(n.mark))}}cn.jsonID("addMark",Ur);class or extends cn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new X(_p(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return st.fromReplace(e,this.from,this.to,r)}invert(){return new Ur(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new or(n.pos,r.pos,this.mark)}merge(e){return e instanceof or&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new or(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new or(n.from,n.to,e.markFromJSON(n.mark))}}cn.jsonID("removeMark",or);class zr extends cn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return st.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return st.fromReplace(e,this.pos,this.pos+1,new X(z.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new zr(this.pos,n.marks[i]);return new zr(this.pos,this.mark)}}return new ao(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new zr(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new zr(n.pos,e.markFromJSON(n.mark))}}cn.jsonID("addNodeMark",zr);class ao extends cn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return st.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return st.fromReplace(e,this.pos,this.pos+1,new X(z.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new zr(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ao(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ao(n.pos,e.markFromJSON(n.mark))}}cn.jsonID("removeNodeMark",ao);class _t extends cn{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&ef(e,this.from,this.to)?st.fail("Structure replace would overwrite content"):st.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Cn([this.from,this.to-this.from,this.slice.size])}invert(e){return new _t(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new _t(n.pos,Math.max(n.pos,r.pos),this.slice)}merge(e){if(!(e instanceof _t)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?X.empty:new X(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new _t(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?X.empty:new X(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new _t(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new _t(n.from,n.to,X.fromJSON(e,n.slice),!!n.structure)}}cn.jsonID("replace",_t);class ut extends cn{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(ef(e,this.from,this.gapFrom)||ef(e,this.gapTo,this.to)))return st.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return st.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?st.fromReplace(e,this.from,this.to,r):st.fail("Content does not fit in gap")}getMap(){return new Cn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new ut(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),s=e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new ut(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ut(n.from,n.to,n.gapFrom,n.gapTo,X.fromJSON(e,n.slice),n.insert,!!n.structure)}}cn.jsonID("replaceAround",ut);function ef(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function PA(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&u.type.allowsMarkType(r.type)){let d=Math.max(c,e),f=Math.min(c+l.nodeSize,n),p=r.addToSet(h);for(let g=0;g<h.length;g++)h[g].isInSet(p)||(o&&o.to==d&&o.mark.eq(h[g])?o.to=f:i.push(o=new or(d,f,h[g])));a&&a.to==d?a.to=f:s.push(a=new Ur(d,f,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function LA(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof Du){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let h=l[u],d;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&h.eq(i[f].style)&&(d=p)}d?(d.to=c,d.step=s):i.push({style:h,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new or(o.from,o.to,o.style)))}function BA(t,e,n,r=n.contentMatch){let i=t.doc.nodeAt(e),s=[],o=e+1;for(let a=0;a<i.childCount;a++){let l=i.child(a),c=o+l.nodeSize,u=r.matchType(l.type);if(!u)s.push(new _t(o,c,X.empty));else{r=u;for(let h=0;h<l.marks.length;h++)n.allowsMarkType(l.marks[h].type)||t.step(new or(o,c,l.marks[h]))}o=c}if(!r.validEnd){let a=r.fillBefore(z.empty,!0);t.replace(o,o,new X(a,0,0))}for(let a=s.length-1;a>=0;a--)t.step(s[a])}function FA(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Oo(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!FA(i,s,o))break}return null}function VA(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=z.empty,h=0;for(let p=s,g=!1;p>n;p--)g||r.index(p)>0?(g=!0,u=z.from(r.node(p).copy(u)),h++):l--;let d=z.empty,f=0;for(let p=s,g=!1;p>n;p--)g||i.after(p+1)<i.end(p)?(g=!0,d=z.from(i.node(p).copy(d)),f++):c++;t.step(new ut(l,c,o,a,new X(u.append(d),h,f),u.size-h,!0))}function Mp(t,e,n=null,r=t){let i=$A(t,e),s=i&&UA(r,e);return s?i.map(ay).concat({type:e,attrs:n}).concat(s.map(ay)):null}function ay(t){return{type:t,attrs:null}}function $A(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function UA(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function zA(t,e,n){let r=z.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=z.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new ut(i,s,i,s,new X(r,0,0),n.length,!0))}function HA(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{if(o.isTextblock&&!o.hasMarkup(r,i)&&jA(t.doc,t.mapping.slice(s).map(a),r)){t.clearIncompatible(t.mapping.slice(s).map(a,1),r);let l=t.mapping.slice(s),c=l.map(a,1),u=l.map(a+o.nodeSize,1);return t.step(new ut(c,u,c+1,u-1,new X(z.from(r.create(i,null,o.marks)),0,0),1,!0)),!1}})}function jA(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function KA(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new ut(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new X(z.from(o),0,0),1,!0))}function Zs(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let h=i.node(c),d=i.index(c);if(h.type.spec.isolating)return!1;let f=h.content.cutByIndex(d,h.childCount),p=r&&r[u]||h;if(p!=h&&(f=f.replaceChild(0,p.type.create(p.attrs))),!h.canReplace(d+1,h.childCount)||!p.type.validContent(f))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function qA(t,e,n=1,r){let i=t.doc.resolve(e),s=z.empty,o=z.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=z.from(i.node(a).copy(s));let u=r&&r[c];o=z.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new _t(e,e,new X(s.append(o),n,n),!0))}function No(t,e){let n=t.resolve(e),r=n.index();return WA(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function WA(t,e){return!!(t&&e&&!t.isLeaf&&t.canAppend(e))}function GA(t,e,n){let r=new _t(e-n,e+n,X.empty,!0);t.step(r)}function JA(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function V0(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let h=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=h&&c.canReplaceWith(l,l,h[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Op(t,e,n=e,r=X.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return $0(i,s,r)?new _t(e,n,r):new XA(i,s,r).fit()}function $0(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class XA{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=z.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=z.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new X(s,o,a);return e>-1?new ut(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new _t(r.pos,i.pos,l):null}findFittable(){for(let e=1;e<=2;e++)for(let n=this.unplaced.openStart;n>=0;n--){let r,i=null;n?(i=qh(this.unplaced.content,n-1).firstChild,r=i.content):r=this.unplaced.content;let s=r.firstChild;for(let o=this.depth;o>=0;o--){let{type:a,match:l}=this.frontier[o],c,u=null;if(e==1&&(s?l.matchType(s.type)||(u=l.fillBefore(z.from(s),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:o,parent:i,inject:u};if(e==2&&s&&(c=l.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:i,wrap:c};if(i&&l.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=qh(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new X(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=qh(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new X(Zo(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new X(Zo(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let g=0;g<s.length;g++)this.openFrontierNode(s[g]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:h,type:d}=this.frontier[n];if(i){for(let g=0;g<i.childCount;g++)u.push(i.child(g));h=h.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let g=a.child(c),m=h.matchType(g.type);if(!m)break;c++,(c>1||l==0||g.content.size)&&(h=m,u.push(U0(g.mark(d.allowedMarks(g.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=ea(this.placed,n,z.from(u)),this.frontier[n].match=h,p&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,m=a;g<f;g++){let w=m.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),m=w.content}this.unplaced=p?e==0?X.empty:new X(Zo(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new X(Zo(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Wh(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=Wh(e,n,i,r,s);if(!!o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Wh(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=ea(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=ea(this.placed,this.depth,z.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(z.empty,!0);n.childCount&&(this.placed=ea(this.placed,this.frontier.length,n))}}function Zo(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Zo(t.firstChild.content,e-1,n)))}function ea(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(ea(t.lastChild.content,e-1,n)))}function qh(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function U0(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,U0(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(z.empty,!0)))),t.copy(r)}function Wh(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!YA(n,s.content,o)?a:null}function YA(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function QA(t){return t.spec.defining||t.spec.definingForContent}function ZA(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if($0(i,s,r))return t.step(new _t(e,n,r));let o=H0(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let d=i.depth,f=i.pos-1;d>0;d--,f--){let p=i.node(d).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(d)>-1?a=d:i.before(d)==f&&o.splice(1,0,-d)}let l=o.indexOf(a),c=[],u=r.openStart;for(let d=r.content,f=0;;f++){let p=d.firstChild;if(c.push(p),f==r.openStart)break;d=p.content}for(let d=u-1;d>=0;d--){let f=c[d].type,p=QA(f);if(p&&i.node(l).type!=f)u=d;else if(p||!f.isTextblock)break}for(let d=r.openStart;d>=0;d--){let f=(d+u+1)%(r.openStart+1),p=c[f];if(!!p)for(let g=0;g<o.length;g++){let m=o[(g+l)%o.length],w=!0;m<0&&(w=!1,m=-m);let _=i.node(m-1),M=i.index(m-1);if(_.canReplaceWith(M,M,p.type,p.marks))return t.replace(i.before(m),w?s.after(m):n,new X(z0(r.content,0,r.openStart,f),f,r.openEnd))}}let h=t.steps.length;for(let d=o.length-1;d>=0&&(t.replace(e,n,r),!(t.steps.length>h));d--){let f=o[d];f<0||(e=i.before(f),n=s.after(f))}}function z0(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(z0(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(z.empty,!0))}return t}function e_(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=JA(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new X(z.from(r),0,0))}function t_(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=H0(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o)return t.delete(r.before(o),n);t.delete(e,n)}function H0(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class eo extends cn{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return st.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return st.fromReplace(e,this.pos,this.pos+1,new X(z.from(i),0,n.isLeaf?0:1))}getMap(){return Cn.empty}invert(e){return new eo(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new eo(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new eo(n.pos,n.attr,n.value)}}cn.jsonID("attr",eo);let lo=class extends Error{};lo=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};lo.prototype=Object.create(Error.prototype);lo.prototype.constructor=lo;lo.prototype.name="TransformError";class j0{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Qs}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new lo(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=X.empty){let i=Op(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new X(z.from(r),0,0))}delete(e,n){return this.replace(e,n,X.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return ZA(this,e,n,r),this}replaceRangeWith(e,n,r){return e_(this,e,n,r),this}deleteRange(e,n){return t_(this,e,n),this}lift(e,n){return VA(this,e,n),this}join(e,n=1){return GA(this,e,n),this}wrap(e,n){return zA(this,e,n),this}setBlockType(e,n=e,r,i=null){return HA(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i=[]){return KA(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new eo(e,n,r)),this}addNodeMark(e,n){return this.step(new zr(e,n)),this}removeNodeMark(e,n){if(!(n instanceof Fe)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n=n.isInSet(r.marks),!n)return this}return this.step(new ao(e,n)),this}split(e,n=1,r){return qA(this,e,n,r),this}addMark(e,n,r){return PA(this,e,n,r),this}removeMark(e,n,r){return LA(this,e,n,r),this}clearIncompatible(e,n,r){return BA(this,e,n,r),this}}const Gh=Object.create(null);class ue{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new K0(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=X.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?X.empty:n),a==0&&uy(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),uy(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new pe(e):Bs(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?Bs(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):Bs(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Hn(e.node(0))}static atStart(e){return Bs(e,e,0,0,1)||new Hn(e)}static atEnd(e){return Bs(e,e,e.content.size,e.childCount,-1)||new Hn(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Gh[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Gh)throw new RangeError("Duplicate use of selection JSON ID "+e);return Gh[e]=n,n.prototype.jsonID=e,n}getBookmark(){return pe.between(this.$anchor,this.$head).getBookmark()}}ue.prototype.visible=!0;class K0{constructor(e,n){this.$from=e,this.$to=n}}let ly=!1;function cy(t){!ly&&!t.parent.inlineContent&&(ly=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class pe extends ue{constructor(e,n=e){cy(e),cy(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return ue.near(r);let i=e.resolve(n.map(this.anchor));return new pe(i.parent.inlineContent?i:r,r)}replace(e,n=X.empty){if(super.replace(e,n),n==X.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof pe&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Ru(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new pe(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=ue.findFrom(n,r,!0)||ue.findFrom(n,-r,!0);if(s)n=s.$head;else return ue.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(ue.findFrom(e,-r,!0)||ue.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new pe(e,n)}}ue.jsonID("text",pe);class Ru{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Ru(e.map(this.anchor),e.map(this.head))}resolve(e){return pe.between(e.resolve(this.anchor),e.resolve(this.head))}}class fe extends ue{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?ue.near(s):new fe(s)}content(){return new X(z.from(this.node),0,0)}eq(e){return e instanceof fe&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Np(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new fe(e.resolve(n.anchor))}static create(e,n){return new fe(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}fe.prototype.visible=!1;ue.jsonID("node",fe);class Np{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Ru(r,r):new Np(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&fe.isSelectable(r)?new fe(n):ue.near(n)}}class Hn extends ue{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=X.empty){if(n==X.empty){e.delete(0,e.doc.content.size);let r=ue.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Hn(e)}map(e){return new Hn(e)}eq(e){return e instanceof Hn}getBookmark(){return n_}}ue.jsonID("all",Hn);const n_={map(){return this},resolve(t){return new Hn(t)}};function Bs(t,e,n,r,i,s=!1){if(e.inlineContent)return pe.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&fe.isSelectable(a))return fe.create(t,n-(i<0?a.nodeSize:0))}else{let l=Bs(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function uy(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof _t||i instanceof ut))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(ue.near(t.doc.resolve(o),n))}const hy=1,Ul=2,dy=4;class r_ extends j0{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|hy)&~Ul,this.storedMarks=null,this}get selectionSet(){return(this.updated&hy)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ul,this}ensureMarks(e){return Fe.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ul)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Ul,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Fe.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r==null?n:r,!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),this.selection.empty||this.setSelection(ue.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=dy,this}get scrolledIntoView(){return(this.updated&dy)>0}}function fy(t,e){return!e||!t?t:t.bind(e)}class ta{constructor(e,n,r){this.name=e,this.init=fy(n.init,r),this.apply=fy(n.apply,r)}}const i_=[new ta("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new ta("selection",{init(t,e){return t.selection||ue.atStart(e.doc)},apply(t){return t.selection}}),new ta("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new ta("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Jh{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=i_.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new ta(r.key,r.spec.state,r))})}}class zs{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let h=0;h<this.config.plugins.length;h++)i.push(h<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new zs(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new r_(this)}static create(e){let n=new Jh(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new zs(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new Jh(this.schema,e.plugins),r=n.fields,i=new zs(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new Jh(e.schema,e.plugins),s=new zs(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=ur.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=ue.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function q0(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=q0(i,e,{})),n[r]=i}return n}class Tt{constructor(e){this.spec=e,this.props={},e.props&&q0(e.props,this,this.props),this.key=e.key?e.key.key:W0("plugin")}getState(e){return e[this.key]}}const Xh=Object.create(null);function W0(t){return t in Xh?t+"$"+ ++Xh[t]:(Xh[t]=0,t+"$")}class un{constructor(e="key"){this.key=W0(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const dn=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Ra=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let py=null;const br=function(t,e,n){let r=py||(py=document.createRange());return r.setEnd(t,n==null?t.nodeValue.length:n),r.setStart(t,e||0),r},is=function(t,e,n,r){return n&&(gy(t,e,n,r,-1)||gy(t,e,n,r,1))},s_=/^(img|br|input|textarea|hr)$/i;function gy(t,e,n,r,i){for(;;){if(t==n&&e==r)return!0;if(e==(i<0?0:nr(t))){let s=t.parentNode;if(!s||s.nodeType!=1||a_(t)||s_.test(t.nodeName)||t.contentEditable=="false")return!1;e=dn(t)+(i<0?0:1),t=s}else if(t.nodeType==1){if(t=t.childNodes[e+(i<0?-1:0)],t.contentEditable=="false")return!1;e=i<0?nr(t):0}else return!1}}function nr(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function o_(t,e,n){for(let r=e==0,i=e==nr(t);r||i;){if(t==n)return!0;let s=dn(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==nr(t)}}function a_(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Pu=function(t){return t.focusNode&&is(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Hs(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function l_(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}const si=typeof navigator<"u"?navigator:null,my=typeof document<"u"?document:null,hi=si&&si.userAgent||"",tf=/Edge\/(\d+)/.exec(hi),G0=/MSIE \d/.exec(hi),nf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(hi),sn=!!(G0||nf||tf),Jr=G0?document.documentMode:nf?+nf[1]:tf?+tf[1]:0,qn=!sn&&/gecko\/(\d+)/i.test(hi);qn&&+(/Firefox\/(\d+)/.exec(hi)||[0,0])[1];const rf=!sn&&/Chrome\/(\d+)/.exec(hi),rn=!!rf,c_=rf?+rf[1]:0,Gt=!sn&&!!si&&/Apple Computer/.test(si.vendor),co=Gt&&(/Mobile\/\w+/.test(hi)||!!si&&si.maxTouchPoints>2),Sn=co||(si?/Mac/.test(si.platform):!1),rr=/Android \d/.test(hi),Lu=!!my&&"webkitFontSmoothing"in my.documentElement.style,u_=Lu?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function h_(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Nr(t,e){return typeof t=="number"?t:t[e]}function d_(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function yy(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;o=Ra(o)){if(o.nodeType!=1)continue;let a=o,l=a==s.body,c=l?h_(s):d_(a),u=0,h=0;if(e.top<c.top+Nr(r,"top")?h=-(c.top-e.top+Nr(i,"top")):e.bottom>c.bottom-Nr(r,"bottom")&&(h=e.bottom-c.bottom+Nr(i,"bottom")),e.left<c.left+Nr(r,"left")?u=-(c.left-e.left+Nr(i,"left")):e.right>c.right-Nr(r,"right")&&(u=e.right-c.right+Nr(i,"right")),u||h)if(l)s.defaultView.scrollBy(u,h);else{let d=a.scrollLeft,f=a.scrollTop;h&&(a.scrollTop+=h),u&&(a.scrollLeft+=u);let p=a.scrollLeft-d,g=a.scrollTop-f;e={left:e.left-p,top:e.top-g,right:e.right-p,bottom:e.bottom-g}}if(l)break}}function f_(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:J0(t.dom)}}function J0(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Ra(r));return e}function p_({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;X0(n,r==0?0:r-e)}function X0(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let Ms=null;function g_(t){if(t.setActive)return t.setActive();if(Ms)return t.focus(Ms);let e=J0(t);t.focus(Ms==null?{get preventScroll(){return Ms={preventScroll:!0},!0}}:void 0),Ms||(Ms=!1,X0(e,0))}function Y0(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top;for(let l=t.firstChild,c=0;l;l=l.nextSibling,c++){let u;if(l.nodeType==1)u=l.getClientRects();else if(l.nodeType==3)u=br(l).getClientRects();else continue;for(let h=0;h<u.length;h++){let d=u[h];if(d.top<=o&&d.bottom>=a){o=Math.max(d.bottom,o),a=Math.min(d.top,a);let f=d.left>e.left?d.left-e.left:d.right<e.left?e.left-d.right:0;if(f<r){n=l,r=f,i=f&&n.nodeType==3?{left:d.right<e.left?d.right:d.left,top:e.top}:e,l.nodeType==1&&f&&(s=c+(e.left>=(d.left+d.right)/2?1:0));continue}}!n&&(e.left>=d.right&&e.top>=d.top||e.left>=d.left&&e.top>=d.bottom)&&(s=c+1)}}return n&&n.nodeType==3?m_(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:Y0(n,i)}function m_(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=Rr(r,1);if(s.top!=s.bottom&&Dp(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function Dp(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function y_(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function b_(t,e,n){let{node:r,offset:i}=Y0(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function w_(t,e,n,r){let i=-1;for(let s=e;s!=t.dom;){let o=t.docView.nearestDesc(s,!0);if(!o)return null;if(o.node.isBlock&&o.parent){let a=o.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)i=o.posBefore;else if(a.right<r.left||a.bottom<r.top)i=o.posAfter;else break}s=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,1)}function Q0(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Dp(e,c))return Q0(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function v_(t,e){let n=t.dom.ownerDocument,r,i=0;if(n.caretPositionFromPoint)try{let l=n.caretPositionFromPoint(e.left,e.top);l&&({offsetNode:r,offset:i}=l)}catch{}if(!r&&n.caretRangeFromPoint){let l=n.caretRangeFromPoint(e.left,e.top);l&&({startContainer:r,startOffset:i}=l)}let s=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let l=t.dom.getBoundingClientRect();if(!Dp(e,l)||(s=Q0(t.dom,e,l),!s))return null}if(Gt)for(let l=s;r&&l;l=Ra(l))l.draggable&&(r=void 0);if(s=y_(s,e),r){if(qn&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let l=r.childNodes[i],c;l.nodeName=="IMG"&&(c=l.getBoundingClientRect()).right<=e.left&&c.bottom>e.top&&i++}r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(o=w_(t,r,i,e))}o==null&&(o=b_(t,s,e));let a=t.docView.nearestDesc(s,!0);return{pos:o,inside:a?a.posAtStart-a.border:-1}}function Rr(t,e){let n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}const E_=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Z0(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=Lu||qn;if(r.nodeType==3)if(o&&(E_.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=Rr(br(r,i,i),n);if(qn&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=Rr(br(r,i-1,i-1),-1);if(c.top==l.top){let u=Rr(br(r,i,i+1),-1);if(u.top!=l.top)return Uo(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,Uo(Rr(br(r,l,c),1),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==nr(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return Yh(l.getBoundingClientRect(),!1)}if(s==null&&i<nr(r)){let l=r.childNodes[i];if(l.nodeType==1)return Yh(l.getBoundingClientRect(),!0)}return Yh(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==nr(r))){let l=r.childNodes[i-1],c=l.nodeType==3?br(l,nr(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Uo(Rr(c,1),!1)}if(s==null&&i<nr(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?br(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Uo(Rr(c,-1),!0)}return Uo(Rr(r.nodeType==3?br(r):r,-n),n>=0)}function Uo(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Yh(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function eE(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function x_(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return eE(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}let o=Z0(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=br(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const S_=/[\u0590-\u08ac]/;function T_(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return!S_.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:eE(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:h}=t.domSelectionRange(),d=a.caretBidiLevel;a.modify("move",n,"character");let f=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:g}=t.domSelectionRange(),m=p&&!f.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==g;try{a.collapse(u,h),l&&(l!=u||c!=h)&&a.extend&&a.extend(l,c)}catch{}return d!=null&&(a.caretBidiLevel=d),m})}let by=null,wy=null,vy=!1;function C_(t,e,n){return by==e&&wy==n?vy:(by=e,wy=n,vy=n=="up"||n=="down"?x_(t,e,n):T_(t,e,n))}const jn=0,Ey=1,js=2,fr=3;class hl{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=jn,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>dn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return(i==null?r>0:i)?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof nE){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof tE&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?dn(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?dn(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let h=a;h>0;h--){let d=this.children[h-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){i=dn(d.dom)+1;break}e-=d.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){s=dn(h.dom);break}n+=h.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let d=0,f=0;d<this.children.length;d++){let p=this.children[d],g=f+p.size;if(s>f&&o<g)return p.setSelection(e-f-p.border,n-f-p.border,r,i);f=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.getSelection(),u=!1;if((qn||Gt)&&e==n){let{node:d,offset:f}=a;if(d.nodeType==3){if(u=!!(f&&d.nodeValue[f-1]==`
`),u&&f==d.nodeValue.length)for(let p=d,g;p;p=p.parentNode){if(g=p.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:dn(g)+1});break}let m=p.pmViewDesc;if(m&&m.node&&m.node.isBlock)break}}else{let p=d.childNodes[f-1];u=p&&(p.nodeName=="BR"||p.contentEditable=="false")}}if(qn&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let d=c.focusNode.childNodes[c.focusOffset];d&&d.contentEditable=="false"&&(i=!0)}if(!(i||u&&Gt)&&is(a.node,a.offset,c.anchorNode,c.anchorOffset)&&is(l.node,l.offset,c.focusNode,c.focusOffset))return;let h=!1;if((c.extend||e==n)&&!u){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let f=a;a=l,l=f}let d=document.createRange();d.setEnd(l.node,l.offset),d.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(d)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?js:Ey,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=fr:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?js:fr}r=o}this.dirty=js}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?js:Ey;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class tE extends hl{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==jn&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class k_ extends hl{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class ss extends hl{constructor(e,n,r,i){super(e,[],r,i),this.mark=n}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=sr.renderSpec(document,n.type.spec.toDOM(n,r))),new ss(e,n,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&fr||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return this.dirty!=fr&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=jn){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=jn}}slice(e,n,r){let i=ss.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=af(s,n,o,r)),e>0&&(s=af(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}}class as extends hl{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a,o&&this.updateChildren(l,c)}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,h=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=sr.renderSpec(document,n.type.spec.toDOM(n)));!h&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let d=u;return u=sE(u,r,n),c?l=new I_(e,n,r,i,u,h||null,d,c,s,o+1):n.isText?new Bu(e,n,r,i,u,d,s):new as(e,n,r,i,u,h||null,d,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>z.empty)}return e}matchesNode(e,n,r){return this.dirty==jn&&e.eq(this.node)&&of(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new __(this,o&&o.node,e);N_(this.node,this.innerDeco,(c,u,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(u==this.node.childCount?Fe.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,h,d)=>{l.syncToMarks(c.marks,r,e);let f;l.findNodeMatch(c,u,h,d)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(f=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,h,f,e)||l.updateNextNode(c,u,h,e,d)||l.addNode(c,u,h,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==js)&&(o&&this.protectLocalComposition(e,o),rE(this.contentDOM,this.children,e),co&&D_(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof pe)||r<n||i>n+this.node.content.size)return null;let s=e.domSelectionRange(),o=R_(s.focusNode,s.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let a=o.nodeValue,l=P_(this.node.content,a,r-n,i-n);return l<0?null:{node:o,pos:l,text:a}}else return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new k_(this,s,n,i);e.input.compositionNodes.push(o),this.children=af(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==fr||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=jn}updateOuterDeco(e){if(of(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=iE(this.dom,this.nodeDOM,sf(this.outerDeco,this.node,n),sf(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function xy(t,e,n,r,i){return sE(r,e,t),new as(void 0,t,e,n,r,r,r,i,0)}class Bu extends as{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==fr||this.dirty!=jn&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=jn||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=jn,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new Bu(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=fr)}get domAtom(){return!1}}class nE extends hl{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==jn&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class I_ extends as{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==fr)return!1;if(this.spec.update){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function rE(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=Sy(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof ss){let l=r?r.previousSibling:t.lastChild;rE(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=Sy(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const da=function(t){t&&(this.nodeName=t)};da.prototype=Object.create(null);const Ui=[new da];function sf(t,e,n){if(t.length==0)return Ui;let r=n?Ui[0]:new da,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(!!o){o.nodeName&&i.push(r=new da(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new da(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function iE(t,e,n,r){if(n==Ui&&r==Ui)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Ui[0]),i=l}A_(i,a||Ui[0],o)}return i}function A_(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function sE(t,e,n){return iE(t,t,Ui,sf(e,n,t.nodeType!=1))}function of(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Sy(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class __{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=M_(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=jn,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++)if(this.top.children[l].matchesMark(e[s])){a=l;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=ss.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==fr&&o.dom==o.contentDOM&&(o.dirty=js),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s){for(let o=this.index;o<this.top.children.length;o++){let a=this.top.children[o];if(a instanceof as){let l=this.preMatch.matched.get(a);if(l!=null&&l!=s)return!1;let c=a.dom;if(!(this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=fr&&of(n,a.outerDeco)))&&a.update(e,n,r,i))return this.destroyBetween(this.index,o),a.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,n,r,i,s){this.top.children.splice(this.index++,0,as.create(this.top,e,n,r,i,s)),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new tE(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof ss;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Bu)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Gt||rn)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new nE(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}}function M_(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof ss)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(!!l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function O_(t,e){return t.type.side-e.type.side}function N_(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){if(o<i.length&&i[o].to==s){let p=i[o++],g;for(;o<i.length&&i[o].to==s;)(g||(g=[p])).push(i[o++]);if(g){g.sort(O_);for(let m=0;m<g.length;m++)n(g[m],c,!!l)}else n(p,c,!!l)}let u,h;if(l)h=-1,u=l,l=null;else if(c<t.childCount)h=c,u=t.child(c++);else break;for(let p=0;p<a.length;p++)a[p].to<=s&&a.splice(p--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let d=s+u.nodeSize;if(u.isText){let p=d;o<i.length&&i[o].from<p&&(p=i[o].from);for(let g=0;g<a.length;g++)a[g].to<p&&(p=a[g].to);p<d&&(l=u.cut(p-s),u=u.cut(0,p-s),d=p,h=-1)}let f=u.isInline&&!u.isLeaf?a.filter(p=>!p.inline):a.slice();r(u,f,e.forChild(s,u),h),s=d}}function D_(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function R_(t,e){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0){if(t.childNodes.length>e&&t.childNodes[e].nodeType==3)return t.childNodes[e];t=t.childNodes[e-1],e=nr(t)}else if(t.nodeType==1&&e<t.childNodes.length)t=t.childNodes[e],e=0;else return null}}function P_(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function af(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function Rp(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(Pu(n)){for(l=a;i&&!i.node;)i=i.parent;let u=i.node;if(i&&u.isAtom&&fe.isSelectable(u)&&i.parent&&!(u.isInline&&o_(n.focusNode,n.focusOffset,i.dom))){let h=i.posBefore;c=new fe(o==h?a:r.resolve(h))}}else{let u=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(u<0)return null;l=r.resolve(u)}if(!c){let u=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=Pp(t,l,a,u)}return c}function oE(t){return t.editable?t.hasFocus():lE(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function xr(t,e=!1){let n=t.state.selection;if(aE(t,n),!!oE(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&rn){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&is(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)B_(t);else{let{anchor:r,head:i}=n,s,o;Ty&&!(n instanceof pe)&&(n.$from.parent.inlineContent||(s=Cy(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=Cy(t,n.to))),t.docView.setSelection(r,i,t.root,e),Ty&&(s&&ky(s),o&&ky(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&L_(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Ty=Gt||rn&&c_<63;function Cy(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Gt&&i&&i.contentEditable=="false")return Qh(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Qh(i);if(s)return Qh(s)}}function Qh(t){return t.contentEditable="true",Gt&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function ky(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function L_(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!oE(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function B_(t){let e=t.domSelection(),n=document.createRange(),r=t.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setEnd(r.parentNode,dn(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&sn&&Jr<=11&&(r.disabled=!0,r.disabled=!1)}function aE(t,e){if(e instanceof fe){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Iy(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Iy(t)}function Iy(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Pp(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||pe.between(e,n,r)}function Ay(t){return t.editable&&!t.hasFocus()?!1:lE(t)}function lE(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function F_(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return is(e.node,e.offset,n.anchorNode,n.anchorOffset)}function lf(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&ue.findFrom(s,e)}function Pi(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function _y(t,e,n){let r=t.state.selection;if(r instanceof pe){if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){let i=lf(t.state,e);return i&&i instanceof fe?Pi(t,i):!1}else if(!(Sn&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?fe.isSelectable(s)?Pi(t,new fe(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):Lu?Pi(t,new pe(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else{if(r instanceof fe&&r.node.isInline)return Pi(t,new pe(e>0?r.$to:r.$from));{let i=lf(t.state,e);return i?Pi(t,i):!1}}}function $c(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function fa(t){let e=t.pmViewDesc;return e&&e.size==0&&(t.nextSibling||t.nodeName!="BR")}function Zh(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(qn&&n.nodeType==1&&r<$c(n)&&fa(n.childNodes[r])&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(fa(a))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(cE(n))break;{let a=n.previousSibling;for(;a&&fa(a);)i=n.parentNode,s=dn(a),a=a.previousSibling;if(a)n=a,r=$c(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?cf(t,n,r):i&&cf(t,i,s)}function ed(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=$c(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(fa(a))s=n,o=++r;else break}else{if(cE(n))break;{let a=n.nextSibling;for(;a&&fa(a);)s=a.parentNode,o=dn(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=$c(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&cf(t,s,o)}function cE(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function cf(t,e,n){let r=t.domSelection();if(Pu(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&xr(t)},50)}function My(t,e,n){let r=t.state.selection;if(r instanceof pe&&!r.empty||n.indexOf("s")>-1||Sn&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=lf(t.state,e);if(o&&o instanceof fe)return Pi(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof Hn?ue.near(o,e):ue.findFrom(o,e);return a?Pi(t,a):!1}return!1}function Oy(t,e){if(!(t.state.selection instanceof pe))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function Ny(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function V_(t){if(!Gt||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Ny(t,r,"true"),setTimeout(()=>Ny(t,r,"false"),20)}return!1}function $_(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function U_(t,e){let n=e.keyCode,r=$_(e);return n==8||Sn&&n==72&&r=="c"?Oy(t,-1)||Zh(t):n==46||Sn&&n==68&&r=="c"?Oy(t,1)||ed(t):n==13||n==27?!0:n==37||Sn&&n==66&&r=="c"?_y(t,-1,r)||Zh(t):n==39||Sn&&n==70&&r=="c"?_y(t,1,r)||ed(t):n==38||Sn&&n==80&&r=="c"?My(t,-1,r)||Zh(t):n==40||Sn&&n==78&&r=="c"?V_(t)||My(t,1,r)||ed(t):r==(Sn?"m":"c")&&(n==66||n==73||n==89||n==90)}function uE(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let f=r.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),r=f.content}let o=t.someProp("clipboardSerializer")||sr.fromSchema(t.state.schema),a=mE(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,h=0;for(;c&&c.nodeType==1&&(u=gE[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${h?` -${h}`:""} ${JSON.stringify(n)}`);let d=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:d}}function hE(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",d=>{e=d(e,s||r,t)}),s)return e?new X(z.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):X.empty;let h=t.someProp("clipboardTextParser",d=>d(e,i,r,t));if(h)a=h;else{let d=i.marks(),{schema:f}=t.state,p=sr.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let m=o.appendChild(document.createElement("p"));g&&m.appendChild(p.serializeNode(f.text(g,d)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),o=j_(n),Lu&&K_(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let d=o.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;o=d}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||oo.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!z_.test(d.parentNode.nodeName)?{ignore:!0}:null}})),u)a=q_(Dy(a,+u[1],+u[2]),u[4]);else if(a=X.maxOpen(H_(a.content,i),!0),a.openStart||a.openEnd){let h=0,d=0;for(let f=a.content.firstChild;h<a.openStart&&!f.type.spec.isolating;h++,f=f.firstChild);for(let f=a.content.lastChild;d<a.openEnd&&!f.type.spec.isolating;d++,f=f.lastChild);a=Dy(a,h,d)}return t.someProp("transformPasted",h=>{a=h(a,t)}),a}const z_=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function H_(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&fE(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=pE(o[o.length-1],s.length));let u=dE(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return z.from(o)}return t}function dE(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,z.from(t));return t}function fE(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=fE(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(z.from(dE(n,t,i+1))))}}function pE(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,pE(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(z.empty,!0);return t.copy(n.append(r))}function uf(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return i<r-1&&(a=uf(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,t.childCount>1||s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(z.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function Dy(t,e,n){return e<t.openStart&&(t=new X(uf(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new X(uf(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const gE={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ry=null;function mE(){return Ry||(Ry=document.implementation.createHTMLDocument("title"))}function j_(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=mE().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&gE[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=t,i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function K_(t){let e=t.querySelectorAll(rn?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent=="\xA0"&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function q_(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=z.from(l.create(r[a+1],i)),s++,o++}return new X(i,s,o)}const Jt={},Xt={},W_={touchstart:!0,touchmove:!0};class G_{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function J_(t){for(let e in Jt){let n=Jt[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{Y_(t,r)&&!Lp(t,r)&&(t.editable||!(r.type in Xt))&&n(t,r)},W_[e]?{passive:!0}:void 0)}Gt&&t.dom.addEventListener("input",()=>null),hf(t)}function Hr(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function X_(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function hf(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>Lp(t,r))})}function Lp(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function Y_(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Q_(t,e){!Lp(t,e)&&Jt[e.type]&&(t.editable||!(e.type in Xt))&&Jt[e.type](t,e)}Xt.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!bE(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(rr&&rn&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),co&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,Hs(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||U_(t,n)?n.preventDefault():Hr(t,"key")};Xt.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Xt.keypress=(t,e)=>{let n=e;if(bE(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Sn&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof pe)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode);t.someProp("handleTextInput",s=>s(t,r.$from.pos,r.$to.pos,i))||t.dispatch(t.state.tr.insertText(i).scrollIntoView()),n.preventDefault()}};function Fu(t){return{left:t.clientX,top:t.clientY}}function Z_(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Bp(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function to(t,e,n){t.focused||t.focus();let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function eM(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&fe.isSelectable(r)?(to(t,new fe(n),"pointer"),!0):!1}function tM(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof fe&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(fe.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(to(t,fe.create(t.state.doc,i),"pointer"),!0):!1}function nM(t,e,n,r,i){return Bp(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?tM(t,n):eM(t,n))}function rM(t,e,n,r){return Bp(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function iM(t,e,n,r){return Bp(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||sM(t,n,r)}function sM(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(to(t,pe.create(r,0,r.content.size),"pointer"),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)to(t,pe.create(r,a+1,a+1+o.content.size),"pointer");else if(fe.isSelectable(o))to(t,fe.create(r,a),"pointer");else continue;return!0}}function Fp(t){return Uc(t)}const yE=Sn?"metaKey":"ctrlKey";Jt.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Fp(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&Z_(n,t.input.lastClick)&&!n[yE]&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s};let o=t.posAtCoords(Fu(n));!o||(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new oM(t,o,n,!!r)):(s=="doubleClick"?rM:iM)(t,o.pos,o.inside,n)?n.preventDefault():Hr(t,"pointer"))};class oM{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[yE],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l?l.dom:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof fe&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&qn&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Hr(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>xr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Fu(e))),this.updateAllowDefault(e),this.allowDefault||!n?Hr(this.view,"pointer"):nM(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Gt&&this.mightDrag&&!this.mightDrag.node.isAtom||rn&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(to(this.view,ue.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):Hr(this.view,"pointer")}move(e){this.updateAllowDefault(e),Hr(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Jt.touchstart=t=>{t.input.lastTouch=Date.now(),Fp(t),Hr(t,"pointer")};Jt.touchmove=t=>{t.input.lastTouch=Date.now(),Hr(t,"pointer")};Jt.contextmenu=t=>Fp(t);function bE(t,e){return t.composing?!0:Gt&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const aM=rr?5e3:-1;Xt.compositionstart=Xt.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),Uc(t,!0),t.markCursor=null;else if(Uc(t),qn&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){t.domSelection().collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}wE(t,aM)};Xt.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,wE(t,20))};function wE(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Uc(t),e))}function vE(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=lM());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function lM(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Uc(t,e=!1){if(!(rr&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),vE(t),e||t.docView&&t.docView.dirty){let n=Rp(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}}function cM(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const uo=sn&&Jr<15||co&&u_<604;Jt.copy=Xt.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=uo?null:n.clipboardData,o=r.content(),{dom:a,text:l}=uE(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):cM(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function uM(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function hM(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?df(t,r.value,null,e):df(t,r.textContent,r.innerHTML,e)},50)}function df(t,e,n,r){let i=hE(t,e,n,t.input.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",a=>a(t,r,i||X.empty)))return!0;if(!i)return!1;let s=uM(i),o=s?t.state.tr.replaceSelectionWith(s,t.input.shiftKey):t.state.tr.replaceSelection(i);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Xt.paste=(t,e)=>{let n=e;if(t.composing&&!rr)return;let r=uo?null:n.clipboardData;r&&df(t,r.getData("text/plain"),r.getData("text/html"),n)?n.preventDefault():hM(t,n)};class dM{constructor(e,n){this.slice=e,this.move=n}}const EE=Sn?"altKey":"ctrlKey";Jt.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(Fu(n));if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof fe?i.to-1:i.to))){if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(fe.create(t.state.doc,r.mightDrag.pos)));else if(n.target&&n.target.nodeType==1){let c=t.docView.nearestDesc(n.target,!0);c&&c.node.type.spec.draggable&&c!=t.docView&&t.dispatch(t.state.tr.setSelection(fe.create(t.state.doc,c.posBefore)))}}let o=t.state.selection.content(),{dom:a,text:l}=uE(t,o);n.dataTransfer.clearData(),n.dataTransfer.setData(uo?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",uo||n.dataTransfer.setData("text/plain",l),t.dragging=new dM(o,!n[EE])};Jt.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Xt.dragover=Xt.dragenter=(t,e)=>e.preventDefault();Xt.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(Fu(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",p=>{o=p(o,t)}):o=hE(t,n.dataTransfer.getData(uo?"Text":"text/plain"),uo?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&!n[EE]);if(t.someProp("handleDrop",p=>p(t,n,o||X.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?V0(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;a&&c.deleteSelection();let u=c.mapping.map(l),h=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,d=c.doc;if(h?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(d))return;let f=c.doc.resolve(u);if(h&&fe.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new fe(f));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((g,m,w,_)=>p=_),c.setSelection(Pp(t,f,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};Jt.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&xr(t)},20))};Jt.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Jt.beforeinput=(t,e)=>{if(rn&&rr&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,Hs(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Xt)Jt[t]=Xt[t];function Pa(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Vp{constructor(e,n){this.toDOM=e,this.spec=n||Ji,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new Kt(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Vp&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Pa(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Xr{constructor(e,n){this.attrs=e,this.spec=n||Ji}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new Kt(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Xr&&Pa(this.attrs,e.attrs)&&Pa(this.spec,e.spec)}static is(e){return e.type instanceof Xr}destroy(){}}class $p{constructor(e,n){this.attrs=e,this.spec=n||Ji}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new Kt(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof $p&&Pa(this.attrs,e.attrs)&&Pa(this.spec,e.spec)}destroy(){}}class Kt{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Kt(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Kt(e,e,new Vp(n,r))}static inline(e,n,r,i){return new Kt(e,n,new Xr(r,i))}static node(e,n,r,i){return new Kt(e,n,new $p(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Xr}}const Fs=[],Ji={};class et{constructor(e,n){this.local=e.length?e:Fs,this.children=n.length?n:Fs}static create(e,n){return n.length?zc(n,e,0,Ji):At}find(e,n,r){let i=[];return this.findInner(e==null?0:e,n==null?1e9:n,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==At||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Ji)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?fM(this.children,o||[],e,n,r,i,s):o?new et(o.sort(Xi),Fs):At}add(e,n){return n.length?this==At?et.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(!!(u=SE(n,a,c))){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,zc(u,a,c+1,Ji)),s+=3}});let o=xE(s?TE(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new et(o.length?this.local.concat(o).sort(Xi):this.local,i||this.children)}remove(e){return e.length==0||this==At?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>a&&h.to<l&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=At?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new et(i,r):At}forChild(e,n){if(this==At)return this;if(n.isLeaf)return et.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof Xr){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new et(i.sort(Xi),Fs);return r?new Br([a,r]):a}return r||At}eq(e){if(this==e)return!0;if(!(e instanceof et)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Up(this.localsInner(e))}localsInner(e){if(this==At)return Fs;if(e.inlineContent||!this.local.some(Xr.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Xr||n.push(this.local[r]);return n}}et.empty=new et([],[]);et.removeOverlap=Up;const At=et.empty;class Br{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,Ji));return Br.from(r)}forChild(e,n){if(n.isLeaf)return et.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=At&&(s instanceof Br?r=r.concat(s.members):r.push(s))}return Br.from(r)}eq(e){if(!(e instanceof Br)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(!!s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?Up(r?n:n.sort(Xi)):Fs}static from(e){switch(e.length){case 0:return At;case 1:return e[0];default:return new Br(e)}}}function fM(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let h=0;n.maps[c].forEach((d,f,p,g)=>{let m=g-p-(f-d);for(let w=0;w<a.length;w+=3){let _=a[w+1];if(_<0||d>_+u-h)continue;let M=a[w]+u-h;f>=M?a[w+1]=d<=M?-2:-1:p>=i&&m&&(a[w]+=m,a[w+1]+=m)}h+=m}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),h=u-i;if(h<0||h>=r.content.size){l=!0;continue}let d=n.map(t[c+1]+s,-1),f=d-i,{index:p,offset:g}=r.content.findIndex(h),m=r.maybeChild(p);if(m&&g==h&&g+m.nodeSize==f){let w=a[c+2].mapInner(n,m,u+1,t[c]+s+1,o);w!=At?(a[c]=h,a[c+1]=f,a[c+2]=w):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=pM(a,t,e,n,i,s,o),u=zc(c,r,0,o);e=u.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,d=0;h<u.children.length;h+=3){let f=u.children[h];for(;d<a.length&&a[d]<f;)d+=3;a.splice(d,0,u.children[h],u.children[h+1],u.children[h+2])}}return new et(e.sort(Xi),a)}function xE(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new Kt(i.from+e,i.to+e,i.type))}return n}function pM(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let h=l.local[u].map(r,i,c);h?n.push(h):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function SE(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function TE(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function zc(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=SE(t,a,l+n);if(c){s=!0;let u=zc(c,a,n+l+1,r);u!=At&&i.push(l,l+a.nodeSize,u)}});let o=xE(s?TE(t):t,-n).sort(Xi);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new et(o,i):At}function Xi(t,e){return t.from-e.from||t.to-e.to}function Up(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),Py(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),Py(e,i,r.copy(s.from,r.to)));break}}}return e}function Py(t,e,n){for(;e<t.length&&Xi(n,t[e])>0;)e++;t.splice(e,0,n)}function td(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=At&&e.push(r)}),t.cursorWrapper&&e.push(et.create(t.state.doc,[t.cursorWrapper.deco])),Br.from(e)}const gM={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},mM=sn&&Jr<=11;class yM{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class bM{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new yM,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);sn&&Jr<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),mM&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,gM)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(!!Ay(this.view)){if(this.suppressingSelectionUpdates)return xr(this.view);if(sn&&Jr<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&is(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=Ra(s))n.add(s);for(let s=e.anchorNode;s;s=Ra(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.observer?this.observer.takeRecords():[];this.queue.length&&(n=this.queue.concat(n),this.queue.length=0);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Ay(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let h=this.registerMutation(n[u],l);h&&(s=s<0?h.from:Math.min(h.from,s),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if(qn&&l.length>1){let u=l.filter(h=>h.nodeName=="BR");if(u.length==2){let h=u[0],d=u[1];h.parentNode&&h.parentNode.parentNode==d.parentNode?d.remove():h.remove()}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&e.input.lastTouch<Date.now()-300&&Pu(r)&&(c=Rp(e))&&c.eq(ue.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,xr(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),wM(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||xr(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++)n.push(e.addedNodes[u]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(sn&&Jr<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:d}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h),(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(s=d)}let o=i&&i.parentNode==e.target?dn(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?dn(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let Ly=new WeakMap,By=!1;function wM(t){if(!Ly.has(t)&&(Ly.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=qn,By)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),By=!0}}function vM(t){let e;function n(l){l.preventDefault(),l.stopImmediatePropagation(),e=l.getTargetRanges()[0]}t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0);let r=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return is(a.node,a.offset,s,o)&&([r,i,s,o]=[s,o,r,i]),{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}}function EM(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Pu(l)||c.push({node:l.focusNode,offset:l.focusOffset})),rn&&t.input.lastKeyCode===8)for(let m=s;m>i;m--){let w=r.childNodes[m-1],_=w.pmViewDesc;if(w.nodeName=="BR"&&!_){s=m;break}if(!_||_.size)break}let h=t.state.doc,d=t.someProp("domParser")||oo.fromSchema(t.state.schema),f=h.resolve(o),p=null,g=d.parse(r,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:i,to:s,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:xM,context:f});if(c&&c[0].pos!=null){let m=c[0].pos,w=c[1]&&c[1].pos;w==null&&(w=m),p={anchor:m+o,head:w+o}}return{doc:g,sel:p,from:o,to:a}}function xM(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Gt&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Gt&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}function SM(t,e,n,r,i){if(e<0){let N=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,J=Rp(t,N);if(J&&!t.state.selection.eq(J)){let ie=t.state.tr.setSelection(J);N=="pointer"?ie.setMeta("pointer",!0):N=="key"&&ie.scrollIntoView(),t.dispatch(ie)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(n);e=s.before(o+1),n=t.state.doc.resolve(n).after(o+1);let a=t.state.selection,l=EM(t,e,n),c=t.state.doc,u=c.slice(l.from,l.to),h,d;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,d="end"):(h=t.state.selection.from,d="start"),t.input.lastKeyCode=null;let f=kM(u.content,l.doc.content,l.from,h,d);if((co&&t.input.lastIOSEnter>Date.now()-225||rr)&&i.some(N=>N.nodeName=="DIV"||N.nodeName=="P"||N.nodeName=="LI")&&(!f||f.endA>=f.endB)&&t.someProp("handleKeyDown",N=>N(t,Hs(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!f)if(r&&a instanceof pe&&!a.empty&&a.$head.sameParent(a.$anchor)&&!t.composing&&!(l.sel&&l.sel.anchor!=l.sel.head))f={start:a.from,endA:a.to,endB:a.to};else{if(l.sel){let N=Fy(t,t.state.doc,l.sel);N&&!N.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(N))}return}if(rn&&t.cursorWrapper&&l.sel&&l.sel.anchor==t.cursorWrapper.deco.from&&l.sel.head==l.sel.anchor){let N=f.endB-f.start;l.sel={anchor:l.sel.anchor+N,head:l.sel.anchor+N}}t.input.domChangeCount++,t.state.selection.from<t.state.selection.to&&f.start==f.endB&&t.state.selection instanceof pe&&(f.start>t.state.selection.from&&f.start<=t.state.selection.from+2&&t.state.selection.from>=l.from?f.start=t.state.selection.from:f.endA<t.state.selection.to&&f.endA>=t.state.selection.to-2&&t.state.selection.to<=l.to&&(f.endB+=t.state.selection.to-f.endA,f.endA=t.state.selection.to)),sn&&Jr<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>l.from&&l.doc.textBetween(f.start-l.from-1,f.start-l.from+1)==" \xA0"&&(f.start--,f.endA--,f.endB--);let p=l.doc.resolveNoCache(f.start-l.from),g=l.doc.resolveNoCache(f.endB-l.from),m=c.resolve(f.start),w=p.sameParent(g)&&p.parent.inlineContent&&m.end()>=f.endA,_;if((co&&t.input.lastIOSEnter>Date.now()-225&&(!w||i.some(N=>N.nodeName=="DIV"||N.nodeName=="P"))||!w&&p.pos<l.doc.content.size&&(_=ue.findFrom(l.doc.resolve(p.pos+1),1,!0))&&_.head==g.pos)&&t.someProp("handleKeyDown",N=>N(t,Hs(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>f.start&&CM(c,f.start,f.endA,p,g)&&t.someProp("handleKeyDown",N=>N(t,Hs(8,"Backspace")))){rr&&rn&&t.domObserver.suppressSelectionUpdates();return}rn&&rr&&f.endB==f.start&&(t.input.lastAndroidDelete=Date.now()),rr&&!w&&p.start()!=g.start()&&g.parentOffset==0&&p.depth==g.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==f.endA&&(f.endB-=2,g=l.doc.resolveNoCache(f.endB-l.from),setTimeout(()=>{t.someProp("handleKeyDown",function(N){return N(t,Hs(13,"Enter"))})},20));let M=f.start,y=f.endA,L,R,j;if(w){if(p.pos==g.pos)sn&&Jr<=11&&p.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>xr(t),20)),L=t.state.tr.delete(M,y),R=c.resolve(f.start).marksAcross(c.resolve(f.endA));else if(f.endA==f.endB&&(j=TM(p.parent.content.cut(p.parentOffset,g.parentOffset),m.parent.content.cut(m.parentOffset,f.endA-m.start()))))L=t.state.tr,j.type=="add"?L.addMark(M,y,j.mark):L.removeMark(M,y,j.mark);else if(p.parent.child(p.index()).isText&&p.index()==g.index()-(g.textOffset?0:1)){let N=p.parent.textBetween(p.parentOffset,g.parentOffset);if(t.someProp("handleTextInput",J=>J(t,M,y,N)))return;L=t.state.tr.insertText(N,M,y)}}if(L||(L=t.state.tr.replace(M,y,l.doc.slice(f.start-l.from,f.endB-l.from))),l.sel){let N=Fy(t,L.doc,l.sel);N&&!(rn&&rr&&t.composing&&N.empty&&(f.start!=f.endB||t.input.lastAndroidDelete<Date.now()-100)&&(N.head==M||N.head==L.mapping.map(y)-1)||sn&&N.empty&&N.head==M)&&L.setSelection(N)}R&&L.ensureMarks(R),t.dispatch(L.scrollIntoView())}function Fy(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Pp(t,e.resolve(n.anchor),e.resolve(n.head))}function TM(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(z.from(c).eq(t))return{mark:a,type:o}}function CM(t,e,n,r,i){if(!r.parent.isTextblock||n-e<=i.pos-r.pos||nd(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(nd(s,!0,!0));return!o.parent.isTextblock||o.pos>n||nd(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function nd(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function kM(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}return o<s&&t.size<e.size?(s-=r<=s&&r>=o?s-r:0,a=s+(a-o),o=s):a<s&&(s-=r<=s&&r>=a?s-r:0,o=s+(o-a),a=s),{start:s,endA:o,endB:a}}class IM{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new G_,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Hy),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Uy(this),$y(this),this.nodeViews=zy(this),this.docView=xy(this.state.doc,Vy(this),td(this),this.dom,this),this.domObserver=new bM(this,(r,i,s,o)=>SM(this,r,i,s,o)),this.domObserver.start(),J_(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&hf(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Hy),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){let r=this.state,i=!1,s=!1;e.storedMarks&&this.composing&&(vE(this),s=!0),this.state=e;let o=r.plugins!=e.plugins||this._props.plugins!=n.plugins;if(o||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let d=zy(this);_M(d,this.nodeViews)&&(this.nodeViews=d,i=!0)}(o||n.handleDOMEvents!=this._props.handleDOMEvents)&&hf(this),this.editable=Uy(this),$y(this);let a=td(this),l=Vy(this),c=r.plugins!=e.plugins&&!r.doc.eq(e.doc)?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",u=i||!this.docView.matchesNode(e.doc,l,a);(u||!e.selection.eq(r.selection))&&(s=!0);let h=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&f_(this);if(s){this.domObserver.stop();let d=u&&(sn||rn)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&AM(r.selection,e.selection);if(u){let f=rn?this.trackWrites=this.domSelectionRange().focusNode:null;(i||!this.docView.update(e.doc,l,a,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=xy(e.doc,l,a,this.dom,this)),f&&!this.trackWrites&&(d=!0)}d||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&F_(this))?xr(this,d):(aE(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():h&&p_(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof fe){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&yy(this,n.getBoundingClientRect(),e)}else yy(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(sn){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&g_(this.dom),xr(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}posAtCoords(e){return v_(this,e)}coordsAtPos(e,n=1){return Z0(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return C_(this,n||this.state,e)}destroy(){!this.docView||(X_(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],td(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Q_(this,e)}dispatch(e){let n=this._props.dispatchTransaction;n?n.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return Gt&&this.root.nodeType===11&&l_(this.dom.ownerDocument)==this.dom?vM(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function Vy(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"&&(e.class+=" "+n[r]),r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),[Kt.node(0,t.state.doc.content.size,e)]}function $y(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Kt.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function Uy(t){return!t.someProp("editable",e=>e(t.state)===!1)}function AM(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function zy(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function _M(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function Hy(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var oi={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Hc={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},jy=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent);typeof navigator<"u"&&/Gecko\/\d+/.test(navigator.userAgent);var MM=typeof navigator<"u"&&/Mac/.test(navigator.platform),OM=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),NM=MM||jy&&+jy[1]<57;for(var Et=0;Et<10;Et++)oi[48+Et]=oi[96+Et]=String(Et);for(var Et=1;Et<=24;Et++)oi[Et+111]="F"+Et;for(var Et=65;Et<=90;Et++)oi[Et]=String.fromCharCode(Et+32),Hc[Et]=String.fromCharCode(Et);for(var rd in oi)Hc.hasOwnProperty(rd)||(Hc[rd]=oi[rd]);function DM(t){var e=NM&&(t.ctrlKey||t.altKey||t.metaKey)||OM&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Hc:oi)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const RM=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function PM(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))RM?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function LM(t){let e=Object.create(null);for(let n in t)e[PM(n)]=t[n];return e}function id(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n!==!1&&e.shiftKey&&(t="Shift-"+t),t}function BM(t){return new Tt({props:{handleKeyDown:zp(t)}})}function zp(t){let e=LM(t);return function(n,r){let i=DM(r),s=i.length==1&&i!=" ",o,a=e[id(i,r,!s)];if(a&&a(n.state,n.dispatch,n))return!0;if(s&&(r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(o=oi[r.keyCode])&&o!=i){let l=e[id(o,r,!0)];if(l&&l(n.state,n.dispatch,n))return!0}else if(s&&r.shiftKey){let l=e[id(i,r,!0)];if(l&&l(n.state,n.dispatch,n))return!0}return!1}}const FM=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0),VM=(t,e,n)=>{let{$cursor:r}=t.selection;if(!r||(n?!n.endOfTextblock("backward",t):r.parentOffset>0))return!1;let i=CE(r);if(!i){let o=r.blockRange(),a=o&&Oo(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(!s.type.spec.isolating&&AE(t,i,e))return!0;if(r.parent.content.size==0&&(ho(s,"end")||fe.isSelectable(s))){let o=Op(t.doc,r.before(),r.after(),X.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(ho(s,"end")?ue.findFrom(a.doc.resolve(a.mapping.map(i.pos,-1)),-1):fe.create(a.doc,i.pos-s.nodeSize)),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1};function ho(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const $M=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=CE(r)}let o=s&&s.nodeBefore;return!o||!fe.isSelectable(o)?!1:(e&&e(t.tr.setSelection(fe.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function CE(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}const UM=(t,e,n)=>{let{$cursor:r}=t.selection;if(!r||(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size))return!1;let i=kE(r);if(!i)return!1;let s=i.nodeAfter;if(AE(t,i,e))return!0;if(r.parent.content.size==0&&(ho(s,"start")||fe.isSelectable(s))){let o=Op(t.doc,r.before(),r.after(),X.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(ho(s,"start")?ue.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):fe.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},zM=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=kE(r)}let o=s&&s.nodeAfter;return!o||!fe.isSelectable(o)?!1:(e&&e(t.tr.setSelection(fe.create(t.doc,s.pos)).scrollIntoView()),!0)};function kE(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const HM=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&Oo(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},jM=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function IE(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const KM=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=IE(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(ue.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},qM=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof Hn||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=IE(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(pe.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},WM=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(Zs(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&Oo(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)},GM=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(fe.create(t.doc,i))),!0)};function JM(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||No(t.doc,e.pos))?!1:(n&&n(t.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0)}function AE(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s,o;if(r.type.spec.isolating||i.type.spec.isolating)return!1;if(JM(t,e,n))return!0;let a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(s=(o=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&o.matchType(s[0]||i.type).validEnd){if(n){let h=e.pos+i.nodeSize,d=z.empty;for(let g=s.length-1;g>=0;g--)d=z.from(s[g].create(null,d));d=z.from(r.copy(d));let f=t.tr.step(new ut(e.pos-1,h,e.pos,h,new X(d,1,0),s.length,!0)),p=h+2*s.length;No(f.doc,p)&&f.join(p),n(f.scrollIntoView())}return!0}let l=ue.findFrom(e,1),c=l&&l.$from.blockRange(l.$to),u=c&&Oo(c);if(u!=null&&u>=e.depth)return n&&n(t.tr.lift(c,u).scrollIntoView()),!0;if(a&&ho(i,"start",!0)&&ho(r,"end")){let h=r,d=[];for(;d.push(h),!h.isTextblock;)h=h.lastChild;let f=i,p=1;for(;!f.isTextblock;f=f.firstChild)p++;if(h.canReplace(h.childCount,h.childCount,f.content)){if(n){let g=z.empty;for(let w=d.length-1;w>=0;w--)g=z.from(d[w].copy(g));let m=t.tr.step(new ut(e.pos-d.length,e.pos+i.nodeSize,e.pos+p,e.pos+i.nodeSize-p,new X(g,d.length,0),0,!0));n(m.scrollIntoView())}return!0}}return!1}function _E(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(pe.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const XM=_E(-1),YM=_E(1);function QM(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&Mp(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function Ky(t,e=null){return function(n,r){let{from:i,to:s}=n.selection,o=!1;return n.doc.nodesBetween(i,s,(a,l)=>{if(o)return!1;if(!(!a.isTextblock||a.hasMarkup(t,e)))if(a.type==t)o=!0;else{let c=n.doc.resolve(l),u=c.index();o=c.parent.canReplaceWith(u,u+1,t)}}),o?(r&&r(n.tr.setBlockType(i,s,t,e).scrollIntoView()),!0):!1}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function ZM(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=!1,l=o;if(!o)return!1;if(o.depth>=2&&i.node(o.depth-1).type.compatibleContent(t)&&o.startIndex==0){if(i.index(o.depth-1)==0)return!1;let u=n.doc.resolve(o.start-2);l=new Pc(u,u,o.depth),o.endIndex<o.parent.childCount&&(o=new Pc(i,n.doc.resolve(s.end(o.depth)),o.depth)),a=!0}let c=Mp(l,t,e,o);return c?(r&&r(eO(n.tr,o,c,a,t).scrollIntoView()),!0):!1}}function eO(t,e,n,r,i){let s=z.empty;for(let u=n.length-1;u>=0;u--)s=z.from(n[u].type.create(n[u].attrs,s));t.step(new ut(e.start-(r?2:0),e.end,e.start,e.end,new X(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,h=e.endIndex,d=!0;u<h;u++,d=!1)!d&&Zs(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function tO(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?nO(e,n,t,s):rO(e,n,s):!0:!1}}function nO(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new ut(s-1,o,s,o,new X(z.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Pc(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=Oo(r);if(a==null)return!1;i.lift(r,a);let l=i.mapping.map(s,-1)-1;return No(i.doc,l)&&i.join(l),e(i.scrollIntoView()),!0}function rO(t,e,n){let r=t.tr,i=n.parent;for(let f=n.end,p=n.endIndex-1,g=n.startIndex;p>g;p--)f-=i.child(p).nodeSize,r.delete(f-1,f+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?z.empty:z.from(i))))return!1;let h=s.pos,d=h+o.nodeSize;return r.step(new ut(h-(a?1:0),d+(l?1:0),h+1,d-1,new X((a?z.empty:z.from(i.copy(z.empty))).append(l?z.empty:z.from(i.copy(z.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function iO(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=z.from(c?t.create():null),h=new X(z.from(t.create(null,z.from(a.type.create(null,u)))),c?3:1,0),d=s.start,f=s.end;n(e.tr.step(new ut(d-(c?3:1),f,d,f,h,1,!0)).scrollIntoView())}return!0}}function Vu(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),filterTransaction:e.filterTransaction,plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}class $u{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:i}=n,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const h=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(d=>d===!0)),h={...Object.fromEntries(Object.entries(r).map(([d,f])=>[d,(...g)=>{const m=this.buildProps(c,n),w=f(...g)(m);return a.push(w),h}])),run:u};return h}createCan(e){const{rawCommands:n,state:r}=this,i=!1,s=e||r.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i;s.storedMarks&&e.setStoredMarks(s.storedMarks);const a={tr:e,editor:i,view:o,state:Vu({state:s,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class sO{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(i=>i!==n):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function re(t,e,n){return t.config[e]===void 0&&t.parent?re(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?re(t.parent,e,n):null}):t.config[e]}function Uu(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function ME(t){const e=[],{nodeExtensions:n,markExtensions:r}=Uu(t),i=[...n,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=re(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([d,f])=>{e.push({type:h,name:d,attribute:{...s,...f}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=re(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,h])=>{const d={...s,...h};(h==null?void 0:h.isRequired)&&(h==null?void 0:h.default)===void 0&&delete d.default,e.push({type:o.name,name:u,attribute:d})})}),e}function dt(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function nt(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}i==="class"?r[i]=[r[i],s].join(" "):i==="style"?r[i]=[r[i],s].join("; "):r[i]=s}),r},{})}function ff(t,e){return e.filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>nt(n,r),{})}function OE(t){return typeof t=="function"}function Se(t,e=void 0,...n){return OE(t)?e?t.bind(e)(...n):t(...n):t}function oO(t={}){return Object.keys(t).length===0&&t.constructor===Object}function aO(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function qy(t,e){return t.style?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):aO(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function Wy(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&oO(n)?!1:n!=null))}function lO(t){var e;const n=ME(t),{nodeExtensions:r,markExtensions:i}=Uu(t),s=(e=r.find(l=>re(l,"topNode")))===null||e===void 0?void 0:e.name,o=Object.fromEntries(r.map(l=>{const c=n.filter(m=>m.type===l.name),u={name:l.name,options:l.options,storage:l.storage},h=t.reduce((m,w)=>{const _=re(w,"extendNodeSchema",u);return{...m,..._?_(l):{}}},{}),d=Wy({...h,content:Se(re(l,"content",u)),marks:Se(re(l,"marks",u)),group:Se(re(l,"group",u)),inline:Se(re(l,"inline",u)),atom:Se(re(l,"atom",u)),selectable:Se(re(l,"selectable",u)),draggable:Se(re(l,"draggable",u)),code:Se(re(l,"code",u)),defining:Se(re(l,"defining",u)),isolating:Se(re(l,"isolating",u)),attrs:Object.fromEntries(c.map(m=>{var w;return[m.name,{default:(w=m==null?void 0:m.attribute)===null||w===void 0?void 0:w.default}]}))}),f=Se(re(l,"parseHTML",u));f&&(d.parseDOM=f.map(m=>qy(m,c)));const p=re(l,"renderHTML",u);p&&(d.toDOM=m=>p({node:m,HTMLAttributes:ff(m,c)}));const g=re(l,"renderText",u);return g&&(d.toText=g),[l.name,d]})),a=Object.fromEntries(i.map(l=>{const c=n.filter(g=>g.type===l.name),u={name:l.name,options:l.options,storage:l.storage},h=t.reduce((g,m)=>{const w=re(m,"extendMarkSchema",u);return{...g,...w?w(l):{}}},{}),d=Wy({...h,inclusive:Se(re(l,"inclusive",u)),excludes:Se(re(l,"excludes",u)),group:Se(re(l,"group",u)),spanning:Se(re(l,"spanning",u)),code:Se(re(l,"code",u)),attrs:Object.fromEntries(c.map(g=>{var m;return[g.name,{default:(m=g==null?void 0:g.attribute)===null||m===void 0?void 0:m.default}]}))}),f=Se(re(l,"parseHTML",u));f&&(d.parseDOM=f.map(g=>qy(g,c)));const p=re(l,"renderHTML",u);return p&&(d.toDOM=g=>p({mark:g,HTMLAttributes:ff(g,c)})),[l.name,d]}));return new kA({topNode:s,nodes:o,marks:a})}function sd(t,e){return e.nodes[t]||e.marks[t]||null}function Gy(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}const cO=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;n+=(((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%").slice(0,Math.max(0,r-s))}),n};function Hp(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class zu{constructor(e){this.find=e.find,this.handler=e.handler}}const uO=(t,e)=>{if(Hp(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[];return r.push(n.text),r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function od(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!!(!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(d=>d.type.spec.code)))return!1;let u=!1;const h=cO(c)+s;return o.forEach(d=>{if(u)return;const f=uO(h,d.find);if(!f)return;const p=l.state.tr,g=Vu({state:l.state,transaction:p}),m={from:r-(f[0].length-s.length),to:i},{commands:w,chain:_,can:M}=new $u({editor:n,state:g});d.handler({state:g,range:m,match:f,commands:w,chain:_,can:M})===null||!p.steps.length||(p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function hO(t){const{editor:e,rules:n}=t,r=new Tt({state:{init(){return null},apply(i,s){const o=i.getMeta(r);return o||(i.selectionSet||i.docChanged?null:s)}},props:{handleTextInput(i,s,o,a){return od({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&od({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?od({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function dO(t){return typeof t=="number"}class fO{constructor(e){this.find=e.find,this.handler=e.handler}}const pO=(t,e)=>{if(Hp(e))return[...t.matchAll(e)];const n=e(t);return n?n.map(r=>{const i=[];return i.push(r.text),i.index=r.index,i.input=t,i.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(r.replaceWith)),i}):[]};function gO(t){const{editor:e,state:n,from:r,to:i,rule:s}=t,{commands:o,chain:a,can:l}=new $u({editor:e,state:n}),c=[];return n.doc.nodesBetween(r,i,(h,d)=>{if(!h.isTextblock||h.type.spec.code)return;const f=Math.max(r,d),p=Math.min(i,d+h.content.size),g=h.textBetween(f-d,p-d,void 0,"\uFFFC");pO(g,s.find).forEach(w=>{if(w.index===void 0)return;const _=f+w.index+1,M=_+w[0].length,y={from:n.tr.mapping.map(_),to:n.tr.mapping.map(M)},L=s.handler({state:n,range:y,match:w,commands:o,chain:a,can:l});c.push(L)})}),c.every(h=>h!==null)}function mO(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1;return n.map(a=>new Tt({view(l){const c=u=>{var h;r=!((h=l.dom.parentElement)===null||h===void 0)&&h.contains(u.target)?l.dom.parentElement:null};return window.addEventListener("dragstart",c),{destroy(){window.removeEventListener("dragstart",c)}}},props:{handleDOMEvents:{drop:l=>(s=r===l.dom.parentElement,!1),paste:(l,c)=>{var u;const h=(u=c.clipboardData)===null||u===void 0?void 0:u.getData("text/html");return i=!!(h!=null&&h.includes("data-pm-slice")),!1}}},appendTransaction:(l,c,u)=>{const h=l[0],d=h.getMeta("uiEvent")==="paste"&&!i,f=h.getMeta("uiEvent")==="drop"&&!s;if(!d&&!f)return;const p=c.doc.content.findDiffStart(u.doc.content),g=c.doc.content.findDiffEnd(u.doc.content);if(!dO(p)||!g||p===g.b)return;const m=u.tr,w=Vu({state:u,transaction:m});if(!(!gO({editor:e,state:w,from:Math.max(p-1,0),to:g.b-1,rule:a})||!m.steps.length))return m}}))}function yO(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return[...new Set(e)]}class Ks{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Ks.resolve(e),this.schema=lO(this.extensions),this.extensions.forEach(r=>{var i;this.editor.extensionStorage[r.name]=r.storage;const s={name:r.name,options:r.options,storage:r.storage,editor:this.editor,type:sd(r.name,this.schema)};r.type==="mark"&&((i=Se(re(r,"keepOnSplit",s)))!==null&&i!==void 0?i:!0)&&this.splittableMarks.push(r.name);const o=re(r,"onBeforeCreate",s);o&&this.editor.on("beforeCreate",o);const a=re(r,"onCreate",s);a&&this.editor.on("create",a);const l=re(r,"onUpdate",s);l&&this.editor.on("update",l);const c=re(r,"onSelectionUpdate",s);c&&this.editor.on("selectionUpdate",c);const u=re(r,"onTransaction",s);u&&this.editor.on("transaction",u);const h=re(r,"onFocus",s);h&&this.editor.on("focus",h);const d=re(r,"onBlur",s);d&&this.editor.on("blur",d);const f=re(r,"onDestroy",s);f&&this.editor.on("destroy",f)})}static resolve(e){const n=Ks.sort(Ks.flatten(e)),r=yO(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=re(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(e){return e.sort((r,i)=>{const s=re(r,"priority")||100,o=re(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:sd(n.name,this.schema)},i=re(n,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,n=Ks.sort([...this.extensions].reverse()),r=[],i=[],s=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:sd(o.name,this.schema)},l=[],c=re(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&o.config.exitable&&(u.ArrowRight=()=>ai.handleExit({editor:e,mark:o})),c){const g=Object.fromEntries(Object.entries(c()).map(([m,w])=>[m,()=>w({editor:e})]));u={...u,...g}}const h=BM(u);l.push(h);const d=re(o,"addInputRules",a);Gy(o,e.options.enableInputRules)&&d&&r.push(...d());const f=re(o,"addPasteRules",a);Gy(o,e.options.enablePasteRules)&&f&&i.push(...f());const p=re(o,"addProseMirrorPlugins",a);if(p){const g=p();l.push(...g)}return l}).flat();return[hO({editor:e,rules:r}),...mO({editor:e,rules:i}),...s]}get attributes(){return ME(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=Uu(this.extensions);return Object.fromEntries(n.filter(r=>!!re(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),s={name:r.name,options:r.options,storage:r.storage,editor:e,type:dt(r.name,this.schema)},o=re(r,"addNodeView",s);if(!o)return[];const a=(l,c,u,h)=>{const d=ff(l,i);return o()({editor:e,node:l,getPos:u,decorations:h,HTMLAttributes:d,extension:r})};return[r.name,a]}))}}function bO(t){return Object.prototype.toString.call(t).slice(8,-1)}function ad(t){return bO(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Hu(t,e){const n={...t};return ad(t)&&ad(e)&&Object.keys(e).forEach(r=>{ad(e[r])?r in t?n[r]=Hu(t[r],e[r]):Object.assign(n,{[r]:e[r]}):Object.assign(n,{[r]:e[r]})}),n}class Yt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Se(re(this,"addOptions",{name:this.name}))),this.storage=Se(re(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Yt(e)}configure(e={}){const n=this.extend();return n.options=Hu(this.options,e),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new Yt(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Se(re(n,"addOptions",{name:n.name})),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}}function NE(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="",l=!0;return t.nodesBetween(r,i,(c,u,h,d)=>{var f;const p=o==null?void 0:o[c.type.name];p?(c.isBlock&&!l&&(a+=s,l=!0),h&&(a+=p({node:c,pos:u,parent:h,index:d,range:e}))):c.isText?(a+=(f=c==null?void 0:c.text)===null||f===void 0?void 0:f.slice(Math.max(r,u)-u,i-u),l=!1):c.isBlock&&!l&&(a+=s,l=!0)}),a}function DE(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const wO=Yt.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new Tt({key:new un("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=DE(n);return NE(r,{from:o,to:a},{textSerializers:l})}}})]}}),vO=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),EO=(t=!1)=>({commands:e})=>e.setContent("",t),xO=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,h=c.resolve(u.map(l)),d=c.resolve(u.map(l+a.nodeSize)),f=h.blockRange(d);if(!f)return;const p=Oo(f);if(a.type.isTextblock){const{defaultType:g}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(f.start,g)}(p||p===0)&&e.lift(f,p)})}),!0},SO=t=>e=>t(e),TO=()=>({state:t,dispatch:e})=>qM(t,e),CO=t=>({tr:e,state:n,dispatch:r})=>{const i=dt(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},kO=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},IO=()=>({state:t,dispatch:e})=>FM(t,e),AO=()=>({commands:t})=>t.keyboardShortcut("Enter"),_O=()=>({state:t,dispatch:e})=>KM(t,e);function jc(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:Hp(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function pf(t,e,n={}){return t.find(r=>r.type===e&&jc(r.attrs,n))}function MO(t,e,n={}){return!!pf(t,e,n)}function jp(t,e,n={}){if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if(t.parentOffset===r.offset&&r.offset!==0&&(r=t.parent.childBefore(t.parentOffset)),!r.node)return;const i=pf([...r.node.marks],e,n);if(!i)return;let s=r.index,o=t.start()+r.offset,a=s+1,l=o+r.node.nodeSize;for(pf([...r.node.marks],e,n);s>0&&i.isInSet(t.parent.child(s-1).marks);)s-=1,o-=t.parent.child(s).nodeSize;for(;a<t.parent.childCount&&MO([...t.parent.child(a).marks],e,n);)l+=t.parent.child(a).nodeSize,a+=1;return{from:o,to:l}}function di(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const OO=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=di(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const h=jp(l,s,e);if(h&&h.from<=c&&h.to>=u){const d=pe.create(o,h.from,h.to);n.setSelection(d)}}return!0},NO=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function Kp(t){return t instanceof pe}function wr(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function RE(t,e=null){if(!e)return null;const n=ue.atStart(t),r=ue.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?pe.create(t,wr(0,i,s),wr(t.content.size,i,s)):pe.create(t,wr(e,i,s),wr(e,i,s))}function qp(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const DO=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{qp()&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!Kp(n.state.selection))return o(),!0;const a=RE(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},RO=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),PO=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e);function Jy(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function Kc(t,e,n){if(n={slice:!0,parseOptions:{},...n},typeof t=="object"&&t!==null)try{return Array.isArray(t)?z.fromArray(t.map(r=>e.nodeFromJSON(r))):e.nodeFromJSON(t)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",r),Kc("",e,n)}if(typeof t=="string"){const r=oo.fromSchema(e);return n.slice?r.parseSlice(Jy(t),n.parseOptions).content:r.parse(Jy(t),n.parseOptions)}return Kc("",e,n)}function LO(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof _t||i instanceof ut))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(ue.near(t.doc.resolve(o),n))}const BO=t=>t.toString().startsWith("<"),FO=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{if(i){n={parseOptions:{},updateSelection:!0,...n};const o=Kc(e,s.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if(o.toString()==="<>")return!0;let{from:a,to:l}=typeof t=="number"?{from:t,to:t}:t,c=!0,u=!0;if((BO(o)?o:[o]).forEach(d=>{d.check(),c=c?d.isText&&d.marks.length===0:!1,u=u?d.isBlock:!1}),a===l&&u){const{parent:d}=r.doc.resolve(a);d.isTextblock&&!d.type.spec.code&&!d.childCount&&(a-=1,l+=1)}c?r.insertText(e,a,l):r.replaceWith(a,l,o),n.updateSelection&&LO(r,r.steps.length-1,-1)}return!0},VO=()=>({state:t,dispatch:e})=>VM(t,e),$O=()=>({state:t,dispatch:e})=>UM(t,e);function PE(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function UO(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))qp()||PE()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}const zO=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=UO(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function La(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?dt(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(h,d)=>{if(h.isText)return;const f=Math.max(r,d),p=Math.min(i,d+h.nodeSize);a.push({node:h,from:f,to:p})});const l=i-r,c=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>jc(h.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((h,d)=>h+d.to-d.from,0)>=l}const HO=(t,e={})=>({state:n,dispatch:r})=>{const i=dt(t,n.schema);return La(n,i,e)?HM(n,r):!1},jO=()=>({state:t,dispatch:e})=>WM(t,e),KO=t=>({state:e,dispatch:n})=>{const r=dt(t,e.schema);return tO(r)(e,n)},qO=()=>({state:t,dispatch:e})=>jM(t,e);function ju(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Xy(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}const WO=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=ju(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=dt(t,r.schema)),a==="mark"&&(o=di(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,Xy(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(h=>{o===h.type&&n.addMark(u,u+c.nodeSize,o.create(Xy(h.attrs,e)))})})}),!0):!1},GO=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),JO=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),XO=()=>({state:t,dispatch:e})=>$M(t,e),YO=()=>({state:t,dispatch:e})=>zM(t,e),QO=()=>({state:t,dispatch:e})=>GM(t,e),ZO=()=>({state:t,dispatch:e})=>YM(t,e),eN=()=>({state:t,dispatch:e})=>XM(t,e);function LE(t,e,n={}){return Kc(t,e,{slice:!1,parseOptions:n})}const tN=(t,e=!1,n={})=>({tr:r,editor:i,dispatch:s})=>{const{doc:o}=r,a=LE(t,i.schema,n);return s&&r.replaceWith(0,o.content.size,a).setMeta("preventUpdate",!e),!0};function nN(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function gf(t,e){const n=[];return t.descendants((r,i)=>{e(r)&&n.push({node:r,pos:i})}),n}function BE(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Wp(t){return e=>BE(e.$from,t)}function rN(t,e){const n=sr.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function iN(t,e){const n={from:0,to:t.content.size};return NE(t,n,e)}function FE(t,e){const n=di(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function sN(t,e){const n=dt(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function oN(t,e){const n=ju(typeof e=="string"?e:e.name,t.schema);return n==="node"?sN(t,e):n==="mark"?FE(t,e):{}}function VE(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t-1),o=jp(s,i.type);!o||r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}function mf(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?di(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>s?s.name===h.type.name:!0).find(h=>jc(h.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:h,$to:d})=>{const f=h.pos,p=d.pos;t.doc.nodesBetween(f,p,(g,m)=>{if(!g.isText&&!g.marks.length)return;const w=Math.max(f,m),_=Math.min(p,m+g.nodeSize);o+=_-w,a.push(...g.marks.map(y=>({mark:y,from:w,to:_})))})}),o===0)return!1;const l=a.filter(h=>s?s.name===h.mark.type.name:!0).filter(h=>jc(h.mark.attrs,n,{strict:!1})).reduce((h,d)=>h+d.to-d.from,0),c=a.filter(h=>s?h.mark.type!==s&&h.mark.type.excludes(s):!0).reduce((h,d)=>h+d.to-d.from,0);return(l>0?l+c:l)>=o}function aN(t,e,n={}){if(!e)return La(t,null,n)||mf(t,null,n);const r=ju(e,t.schema);return r==="node"?La(t,e,n):r==="mark"?mf(t,e,n):!1}function Yy(t,e){const{nodeExtensions:n}=Uu(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=Se(re(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function lN(t){var e;const n=(e=t.type.createAndFill())===null||e===void 0?void 0:e.toJSON(),r=t.toJSON();return JSON.stringify(n)===JSON.stringify(r)}function cN(t){return t instanceof fe}function $E(t,e,n){const i=t.state.doc.content.size,s=wr(e,0,i),o=wr(n,0,i),a=t.coordsAtPos(s),l=t.coordsAtPos(o,-1),c=Math.min(a.top,l.top),u=Math.max(a.bottom,l.bottom),h=Math.min(a.left,l.left),d=Math.max(a.right,l.right),f=d-h,p=u-c,w={top:c,bottom:u,left:h,right:d,width:f,height:p,x:h,y:c};return{...w,toJSON:()=>w}}function uN(t,e,n){var r;const{selection:i}=e;let s=null;if(Kp(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!==null&&r!==void 0?r:s.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,h,d)=>{if(c)return!1;if(u.isInline){const f=!d||d.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(n));c=f&&p}return!c}),c})}const hN=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=di(t,r.schema);if(i)if(o){const c=FE(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(u,h,(d,f)=>{const p=Math.max(f,u),g=Math.min(f+d.nodeSize,h);d.marks.find(w=>w.type===l)?d.marks.forEach(w=>{l===w.type&&n.addMark(p,g,l.create({...w.attrs,...e}))}):n.addMark(p,g,l.create(e))})});return uN(r,n,l)},dN=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),fN=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=dt(t,n.schema);return s.isTextblock?i().command(({commands:o})=>Ky(s,e)(n)?!0:o.clearNodes()).command(({state:o})=>Ky(s,e)(o,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},pN=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=wr(t,0,r.content.size),s=fe.create(r,i);e.setSelection(s)}return!0},gN=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=pe.atStart(r).from,a=pe.atEnd(r).to,l=wr(i,o,a),c=wr(s,o,a),u=pe.create(r,l,c);e.setSelection(u)}return!0},mN=t=>({state:e,dispatch:n})=>{const r=dt(t,e.schema);return iO(r)(e,n)};function gc(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}function Qy(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e==null?void 0:e.includes(i.type.name));t.tr.ensureMarks(r)}}const yN=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=gc(c,a.node().type.name,a.node().attrs);if(s instanceof fe&&s.node.isBlock)return!a.parentOffset||!Zs(o,a.pos)?!1:(r&&(t&&Qy(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){const h=l.parentOffset===l.parent.content.size;s instanceof pe&&e.deleteSelection();const d=a.depth===0?void 0:nN(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=h&&d?[{type:d,attrs:u}]:void 0,p=Zs(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&Zs(e.doc,e.mapping.map(a.pos),1,d?[{type:d}]:void 0)&&(p=!0,f=d?[{type:d,attrs:u}]:void 0),p&&(e.split(e.mapping.map(a.pos),1,f),d&&!h&&!a.parentOffset&&a.parent.type!==d)){const g=e.mapping.map(a.before()),m=e.doc.resolve(g);a.node(-1).canReplaceWith(m.index(),m.index()+1,d)&&e.setNodeMarkup(e.mapping.map(a.before()),d)}t&&Qy(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return!0},bN=t=>({tr:e,state:n,dispatch:r,editor:i})=>{var s;const o=dt(t,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const u=a.node(-1);if(u.type!==o)return!1;const h=i.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==o||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let m=z.empty;const w=a.index(-1)?1:a.index(-2)?2:3;for(let j=a.depth-w;j>=a.depth-3;j-=1)m=z.from(a.node(j).copy(m));const _=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,M=gc(h,a.node().type.name,a.node().attrs),y=((s=o.contentMatch.defaultType)===null||s===void 0?void 0:s.createAndFill(M))||void 0;m=m.append(z.from(o.createAndFill(null,y)||void 0));const L=a.before(a.depth-(w-1));e.replace(L,a.after(-_),new X(m,4-w,0));let R=-1;e.doc.nodesBetween(L,e.doc.content.size,(j,N)=>{if(R>-1)return!1;j.isTextblock&&j.content.size===0&&(R=N+1)}),R>-1&&e.setSelection(pe.near(e.doc.resolve(R))),e.scrollIntoView()}return!0}const d=l.pos===a.end()?u.contentMatchAt(0).defaultType:null,f=gc(h,u.type.name,u.attrs),p=gc(h,a.node().type.name,a.node().attrs);e.delete(a.pos,l.pos);const g=d?[{type:o,attrs:f},{type:d,attrs:p}]:[{type:o,attrs:f}];return Zs(e.doc,a.pos,2)?(r&&e.split(a.pos,2,g).scrollIntoView(),!0):!1},Zy=(t,e)=>{const n=Wp(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&No(t.doc,n.pos)&&t.join(n.pos),!0},eb=(t,e)=>{const n=Wp(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&No(t.doc,r)&&t.join(r),!0},wN=(t,e)=>({editor:n,tr:r,state:i,dispatch:s,chain:o,commands:a,can:l})=>{const{extensions:c}=n.extensionManager,u=dt(t,i.schema),h=dt(e,i.schema),{selection:d}=i,{$from:f,$to:p}=d,g=f.blockRange(p);if(!g)return!1;const m=Wp(w=>Yy(w.type.name,c))(d);if(g.depth>=1&&m&&g.depth-m.depth<=1){if(m.node.type===u)return a.liftListItem(h);if(Yy(m.node.type.name,c)&&u.validContent(m.node.content)&&s)return o().command(()=>(r.setNodeMarkup(m.pos,u),!0)).command(()=>Zy(r,u)).command(()=>eb(r,u)).run()}return o().command(()=>l().wrapInList(u)?!0:a.clearNodes()).wrapInList(u).command(()=>Zy(r,u)).command(()=>eb(r,u)).run()},vN=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=di(t,r.schema);return mf(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},EN=(t,e,n={})=>({state:r,commands:i})=>{const s=dt(t,r.schema),o=dt(e,r.schema);return La(r,s,n)?i.setNode(o):i.setNode(s,n)},xN=(t,e={})=>({state:n,commands:r})=>{const i=dt(t,n.schema);return La(n,i,e)?r.lift(i):r.wrapIn(i,e)},SN=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},TN=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},CN=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=di(t,r.schema),{$from:c,empty:u,ranges:h}=a;if(!i)return!0;if(u&&o){let{from:d,to:f}=a;const p=(s=c.marks().find(m=>m.type===l))===null||s===void 0?void 0:s.attrs,g=jp(c,l,p);g&&(d=g.from,f=g.to),n.removeMark(d,f,l)}else h.forEach(d=>{n.removeMark(d.$from.pos,d.$to.pos,l)});return n.removeStoredMark(l),!0},kN=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=ju(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=dt(t,r.schema)),a==="mark"&&(o=di(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;r.doc.nodesBetween(c,u,(h,d)=>{s&&s===h.type&&n.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(f=>{if(o===f.type){const p=Math.max(d,c),g=Math.min(d+h.nodeSize,u);n.addMark(p,g,o.create({...f.attrs,...e}))}})})}),!0):!1},IN=(t,e={})=>({state:n,dispatch:r})=>{const i=dt(t,n.schema);return QM(i,e)(n,r)},AN=(t,e={})=>({state:n,dispatch:r})=>{const i=dt(t,n.schema);return ZM(i,e)(n,r)};var _N=Object.freeze({__proto__:null,blur:vO,clearContent:EO,clearNodes:xO,command:SO,createParagraphNear:TO,deleteNode:CO,deleteRange:kO,deleteSelection:IO,enter:AO,exitCode:_O,extendMarkRange:OO,first:NO,focus:DO,forEach:RO,insertContent:PO,insertContentAt:FO,joinBackward:VO,joinForward:$O,keyboardShortcut:zO,lift:HO,liftEmptyBlock:jO,liftListItem:KO,newlineInCode:qO,resetAttributes:WO,scrollIntoView:GO,selectAll:JO,selectNodeBackward:XO,selectNodeForward:YO,selectParentNode:QO,selectTextblockEnd:ZO,selectTextblockStart:eN,setContent:tN,setMark:hN,setMeta:dN,setNode:fN,setNodeSelection:pN,setTextSelection:gN,sinkListItem:mN,splitBlock:yN,splitListItem:bN,toggleList:wN,toggleMark:vN,toggleNode:EN,toggleWrap:xN,undoInputRule:SN,unsetAllMarks:TN,unsetMark:CN,updateAttributes:kN,wrapIn:IN,wrapInList:AN});const MN=Yt.create({name:"commands",addCommands(){return{..._N}}}),ON=Yt.create({name:"editable",addProseMirrorPlugins(){return[new Tt({key:new un("editable"),props:{editable:()=>this.editor.options.editable}})]}}),NN=Yt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Tt({key:new un("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),DN=Yt.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:h}=l,{pos:d,parent:f}=h,p=ue.atStart(c).from===d;return!u||!p||!f.type.isTextblock||f.textContent.length?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return qp()||PE()?s:i},addProseMirrorPlugins(){return[new Tt({key:new un("clearDocument"),appendTransaction:(t,e,n)=>{if(!(t.some(p=>p.docChanged)&&!e.doc.eq(n.doc)))return;const{empty:i,from:s,to:o}=e.selection,a=ue.atStart(e.doc).from,l=ue.atEnd(e.doc).to,c=s===a&&o===l,u=n.doc.textBetween(0,n.doc.content.size," "," ").length===0;if(i||!c||!u)return;const h=n.tr,d=Vu({state:n,transaction:h}),{commands:f}=new $u({editor:this.editor,state:d});if(f.clearNodes(),!!h.steps.length)return h}})]}}),RN=Yt.create({name:"tabindex",addProseMirrorPlugins(){return[new Tt({key:new un("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var PN=Object.freeze({__proto__:null,ClipboardTextSerializer:wO,Commands:MN,Editable:ON,FocusEvents:NN,Keymap:DN,Tabindex:RN});const LN=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function BN(t,e){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}class FN extends sO{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=BN(LN,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e}),this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=OE(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});this.view.updateState(i)}unregisterPlugin(e){if(this.isDestroyed)return;const n=typeof e=="string"?`${e}$`:e.key,r=this.state.reconfigure({plugins:this.state.plugins.filter(i=>!i.key.startsWith(n))});this.view.updateState(r)}createExtensionManager(){const n=[...this.options.enableCoreExtensions?Object.values(PN):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new Ks(n,this)}createCommandManager(){this.commandManager=new $u({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=LE(this.options.content,this.schema,this.options.parseOptions),n=RE(e,this.options.autofocus);this.view=new IM(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:zs.create({doc:e,selection:n||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return oN(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return aN(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return rN(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return iN(this.state.doc,{blockSeparator:n,textSerializers:{...r,...DE(this.schema)}})}get isEmpty(){return lN(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}}function fo(t){return new zu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];let l=n.to;if(o){const c=a.search(/\S/),u=n.from+a.indexOf(o),h=u+o.length;if(VE(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(g=>g===t.type&&g!==f.mark.type)).filter(f=>f.to>u).length)return null;h<n.to&&s.delete(h,n.to),u>n.from&&s.delete(n.from+c,u),l=n.from+c+o.length,s.addMark(n.from+c,l,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function UE(t){return new zu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;if(r[1]){const l=r[0].lastIndexOf(r[1]);let c=o+l;c>a?c=a:a=c+r[1].length;const u=r[0][r[0].length-1];s.insertText(u,o+r[0].length-1),s.replaceWith(c,a,t.type.create(i))}else r[0]&&s.replaceWith(o,a,t.type.create(i))}})}function yf(t){return new zu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=Se(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)}})}function Gp(t){return new zu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r)||{},s=e.tr.delete(n.from,n.to),a=s.doc.resolve(n.from).blockRange(),l=a&&Mp(a,t.type,i);if(!l)return null;s.wrap(a,l);const c=s.doc.resolve(n.from-1).nodeBefore;c&&c.type===t.type&&No(s.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,c))&&s.join(n.from-1)}})}class ai{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Se(re(this,"addOptions",{name:this.name}))),this.storage=Se(re(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ai(e)}configure(e={}){const n=this.extend();return n.options=Hu(this.options,e),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new ai(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Se(re(n,"addOptions",{name:n.name})),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}class at{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Se(re(this,"addOptions",{name:this.name}))),this.storage=Se(re(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new at(e)}configure(e={}){const n=this.extend();return n.options=Hu(this.options,e),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new at(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Se(re(n,"addOptions",{name:n.name})),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}}function po(t){return new fO({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];let l=n.to;if(o){const c=a.search(/\S/),u=n.from+a.indexOf(o),h=u+o.length;if(VE(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(g=>g===t.type&&g!==f.mark.type)).filter(f=>f.to>u).length)return null;h<n.to&&s.delete(h,n.to),u>n.from&&s.delete(n.from+c,u),l=n.from+c+o.length,s.addMark(n.from+c,l,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}var on="top",On="bottom",Nn="right",an="left",Jp="auto",dl=[on,On,Nn,an],go="start",Ba="end",VN="clippingParents",zE="viewport",zo="popper",$N="reference",tb=dl.reduce(function(t,e){return t.concat([e+"-"+go,e+"-"+Ba])},[]),HE=[].concat(dl,[Jp]).reduce(function(t,e){return t.concat([e,e+"-"+go,e+"-"+Ba])},[]),UN="beforeRead",zN="read",HN="afterRead",jN="beforeMain",KN="main",qN="afterMain",WN="beforeWrite",GN="write",JN="afterWrite",XN=[UN,zN,HN,jN,KN,qN,WN,GN,JN];function pr(t){return t?(t.nodeName||"").toLowerCase():null}function Pn(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function ls(t){var e=Pn(t).Element;return t instanceof e||t instanceof Element}function Mn(t){var e=Pn(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Xp(t){if(typeof ShadowRoot>"u")return!1;var e=Pn(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function YN(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var r=e.styles[n]||{},i=e.attributes[n]||{},s=e.elements[n];!Mn(s)||!pr(s)||(Object.assign(s.style,r),Object.keys(i).forEach(function(o){var a=i[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function QN(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(r){var i=e.elements[r],s=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:n[r]),a=o.reduce(function(l,c){return l[c]="",l},{});!Mn(i)||!pr(i)||(Object.assign(i.style,a),Object.keys(s).forEach(function(l){i.removeAttribute(l)}))})}}const jE={name:"applyStyles",enabled:!0,phase:"write",fn:YN,effect:QN,requires:["computeStyles"]};function hr(t){return t.split("-")[0]}var Yi=Math.max,qc=Math.min,mo=Math.round;function bf(){var t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function KE(){return!/^((?!chrome|android).)*safari/i.test(bf())}function yo(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r=t.getBoundingClientRect(),i=1,s=1;e&&Mn(t)&&(i=t.offsetWidth>0&&mo(r.width)/t.offsetWidth||1,s=t.offsetHeight>0&&mo(r.height)/t.offsetHeight||1);var o=ls(t)?Pn(t):window,a=o.visualViewport,l=!KE()&&n,c=(r.left+(l&&a?a.offsetLeft:0))/i,u=(r.top+(l&&a?a.offsetTop:0))/s,h=r.width/i,d=r.height/s;return{width:h,height:d,top:u,right:c+h,bottom:u+d,left:c,x:c,y:u}}function Yp(t){var e=yo(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function qE(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&Xp(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Cr(t){return Pn(t).getComputedStyle(t)}function ZN(t){return["table","td","th"].indexOf(pr(t))>=0}function fi(t){return((ls(t)?t.ownerDocument:t.document)||window.document).documentElement}function Ku(t){return pr(t)==="html"?t:t.assignedSlot||t.parentNode||(Xp(t)?t.host:null)||fi(t)}function nb(t){return!Mn(t)||Cr(t).position==="fixed"?null:t.offsetParent}function eD(t){var e=/firefox/i.test(bf()),n=/Trident/i.test(bf());if(n&&Mn(t)){var r=Cr(t);if(r.position==="fixed")return null}var i=Ku(t);for(Xp(i)&&(i=i.host);Mn(i)&&["html","body"].indexOf(pr(i))<0;){var s=Cr(i);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return i;i=i.parentNode}return null}function fl(t){for(var e=Pn(t),n=nb(t);n&&ZN(n)&&Cr(n).position==="static";)n=nb(n);return n&&(pr(n)==="html"||pr(n)==="body"&&Cr(n).position==="static")?e:n||eD(t)||e}function Qp(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function pa(t,e,n){return Yi(t,qc(e,n))}function tD(t,e,n){var r=pa(t,e,n);return r>n?n:r}function WE(){return{top:0,right:0,bottom:0,left:0}}function GE(t){return Object.assign({},WE(),t)}function JE(t,e){return e.reduce(function(n,r){return n[r]=t,n},{})}var nD=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,GE(typeof e!="number"?e:JE(e,dl))};function rD(t){var e,n=t.state,r=t.name,i=t.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=hr(n.placement),l=Qp(a),c=[an,Nn].indexOf(a)>=0,u=c?"height":"width";if(!(!s||!o)){var h=nD(i.padding,n),d=Yp(s),f=l==="y"?on:an,p=l==="y"?On:Nn,g=n.rects.reference[u]+n.rects.reference[l]-o[l]-n.rects.popper[u],m=o[l]-n.rects.reference[l],w=fl(s),_=w?l==="y"?w.clientHeight||0:w.clientWidth||0:0,M=g/2-m/2,y=h[f],L=_-d[u]-h[p],R=_/2-d[u]/2+M,j=pa(y,R,L),N=l;n.modifiersData[r]=(e={},e[N]=j,e.centerOffset=j-R,e)}}function iD(t){var e=t.state,n=t.options,r=n.element,i=r===void 0?"[data-popper-arrow]":r;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||!qE(e.elements.popper,i)||(e.elements.arrow=i))}const sD={name:"arrow",enabled:!0,phase:"main",fn:rD,effect:iD,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function bo(t){return t.split("-")[1]}var oD={top:"auto",right:"auto",bottom:"auto",left:"auto"};function aD(t){var e=t.x,n=t.y,r=window,i=r.devicePixelRatio||1;return{x:mo(e*i)/i||0,y:mo(n*i)/i||0}}function rb(t){var e,n=t.popper,r=t.popperRect,i=t.placement,s=t.variation,o=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,h=t.isFixed,d=o.x,f=d===void 0?0:d,p=o.y,g=p===void 0?0:p,m=typeof u=="function"?u({x:f,y:g}):{x:f,y:g};f=m.x,g=m.y;var w=o.hasOwnProperty("x"),_=o.hasOwnProperty("y"),M=an,y=on,L=window;if(c){var R=fl(n),j="clientHeight",N="clientWidth";if(R===Pn(n)&&(R=fi(n),Cr(R).position!=="static"&&a==="absolute"&&(j="scrollHeight",N="scrollWidth")),R=R,i===on||(i===an||i===Nn)&&s===Ba){y=On;var J=h&&R===L&&L.visualViewport?L.visualViewport.height:R[j];g-=J-r.height,g*=l?1:-1}if(i===an||(i===on||i===On)&&s===Ba){M=Nn;var ie=h&&R===L&&L.visualViewport?L.visualViewport.width:R[N];f-=ie-r.width,f*=l?1:-1}}var he=Object.assign({position:a},c&&oD),ve=u===!0?aD({x:f,y:g}):{x:f,y:g};if(f=ve.x,g=ve.y,l){var Ee;return Object.assign({},he,(Ee={},Ee[y]=_?"0":"",Ee[M]=w?"0":"",Ee.transform=(L.devicePixelRatio||1)<=1?"translate("+f+"px, "+g+"px)":"translate3d("+f+"px, "+g+"px, 0)",Ee))}return Object.assign({},he,(e={},e[y]=_?g+"px":"",e[M]=w?f+"px":"",e.transform="",e))}function lD(t){var e=t.state,n=t.options,r=n.gpuAcceleration,i=r===void 0?!0:r,s=n.adaptive,o=s===void 0?!0:s,a=n.roundOffsets,l=a===void 0?!0:a,c={placement:hr(e.placement),variation:bo(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,rb(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,rb(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const cD={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:lD,data:{}};var zl={passive:!0};function uD(t){var e=t.state,n=t.instance,r=t.options,i=r.scroll,s=i===void 0?!0:i,o=r.resize,a=o===void 0?!0:o,l=Pn(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&c.forEach(function(u){u.addEventListener("scroll",n.update,zl)}),a&&l.addEventListener("resize",n.update,zl),function(){s&&c.forEach(function(u){u.removeEventListener("scroll",n.update,zl)}),a&&l.removeEventListener("resize",n.update,zl)}}const hD={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:uD,data:{}};var dD={left:"right",right:"left",bottom:"top",top:"bottom"};function mc(t){return t.replace(/left|right|bottom|top/g,function(e){return dD[e]})}var fD={start:"end",end:"start"};function ib(t){return t.replace(/start|end/g,function(e){return fD[e]})}function Zp(t){var e=Pn(t),n=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:n,scrollTop:r}}function eg(t){return yo(fi(t)).left+Zp(t).scrollLeft}function pD(t,e){var n=Pn(t),r=fi(t),i=n.visualViewport,s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;var c=KE();(c||!c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a+eg(t),y:l}}function gD(t){var e,n=fi(t),r=Zp(t),i=(e=t.ownerDocument)==null?void 0:e.body,s=Yi(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=Yi(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+eg(t),l=-r.scrollTop;return Cr(i||n).direction==="rtl"&&(a+=Yi(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function tg(t){var e=Cr(t),n=e.overflow,r=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function XE(t){return["html","body","#document"].indexOf(pr(t))>=0?t.ownerDocument.body:Mn(t)&&tg(t)?t:XE(Ku(t))}function ga(t,e){var n;e===void 0&&(e=[]);var r=XE(t),i=r===((n=t.ownerDocument)==null?void 0:n.body),s=Pn(r),o=i?[s].concat(s.visualViewport||[],tg(r)?r:[]):r,a=e.concat(o);return i?a:a.concat(ga(Ku(o)))}function wf(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function mD(t,e){var n=yo(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function sb(t,e,n){return e===zE?wf(pD(t,n)):ls(e)?mD(e,n):wf(gD(fi(t)))}function yD(t){var e=ga(Ku(t)),n=["absolute","fixed"].indexOf(Cr(t).position)>=0,r=n&&Mn(t)?fl(t):t;return ls(r)?e.filter(function(i){return ls(i)&&qE(i,r)&&pr(i)!=="body"}):[]}function bD(t,e,n,r){var i=e==="clippingParents"?yD(t):[].concat(e),s=[].concat(i,[n]),o=s[0],a=s.reduce(function(l,c){var u=sb(t,c,r);return l.top=Yi(u.top,l.top),l.right=qc(u.right,l.right),l.bottom=qc(u.bottom,l.bottom),l.left=Yi(u.left,l.left),l},sb(t,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function YE(t){var e=t.reference,n=t.element,r=t.placement,i=r?hr(r):null,s=r?bo(r):null,o=e.x+e.width/2-n.width/2,a=e.y+e.height/2-n.height/2,l;switch(i){case on:l={x:o,y:e.y-n.height};break;case On:l={x:o,y:e.y+e.height};break;case Nn:l={x:e.x+e.width,y:a};break;case an:l={x:e.x-n.width,y:a};break;default:l={x:e.x,y:e.y}}var c=i?Qp(i):null;if(c!=null){var u=c==="y"?"height":"width";switch(s){case go:l[c]=l[c]-(e[u]/2-n[u]/2);break;case Ba:l[c]=l[c]+(e[u]/2-n[u]/2);break}}return l}function Fa(t,e){e===void 0&&(e={});var n=e,r=n.placement,i=r===void 0?t.placement:r,s=n.strategy,o=s===void 0?t.strategy:s,a=n.boundary,l=a===void 0?VN:a,c=n.rootBoundary,u=c===void 0?zE:c,h=n.elementContext,d=h===void 0?zo:h,f=n.altBoundary,p=f===void 0?!1:f,g=n.padding,m=g===void 0?0:g,w=GE(typeof m!="number"?m:JE(m,dl)),_=d===zo?$N:zo,M=t.rects.popper,y=t.elements[p?_:d],L=bD(ls(y)?y:y.contextElement||fi(t.elements.popper),l,u,o),R=yo(t.elements.reference),j=YE({reference:R,element:M,strategy:"absolute",placement:i}),N=wf(Object.assign({},M,j)),J=d===zo?N:R,ie={top:L.top-J.top+w.top,bottom:J.bottom-L.bottom+w.bottom,left:L.left-J.left+w.left,right:J.right-L.right+w.right},he=t.modifiersData.offset;if(d===zo&&he){var ve=he[i];Object.keys(ie).forEach(function(Ee){var Oe=[Nn,On].indexOf(Ee)>=0?1:-1,ze=[on,On].indexOf(Ee)>=0?"y":"x";ie[Ee]+=ve[ze]*Oe})}return ie}function wD(t,e){e===void 0&&(e={});var n=e,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=l===void 0?HE:l,u=bo(r),h=u?a?tb:tb.filter(function(p){return bo(p)===u}):dl,d=h.filter(function(p){return c.indexOf(p)>=0});d.length===0&&(d=h);var f=d.reduce(function(p,g){return p[g]=Fa(t,{placement:g,boundary:i,rootBoundary:s,padding:o})[hr(g)],p},{});return Object.keys(f).sort(function(p,g){return f[p]-f[g]})}function vD(t){if(hr(t)===Jp)return[];var e=mc(t);return[ib(t),e,ib(e)]}function ED(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var i=n.mainAxis,s=i===void 0?!0:i,o=n.altAxis,a=o===void 0?!0:o,l=n.fallbackPlacements,c=n.padding,u=n.boundary,h=n.rootBoundary,d=n.altBoundary,f=n.flipVariations,p=f===void 0?!0:f,g=n.allowedAutoPlacements,m=e.options.placement,w=hr(m),_=w===m,M=l||(_||!p?[mc(m)]:vD(m)),y=[m].concat(M).reduce(function(ke,Pe){return ke.concat(hr(Pe)===Jp?wD(e,{placement:Pe,boundary:u,rootBoundary:h,padding:c,flipVariations:p,allowedAutoPlacements:g}):Pe)},[]),L=e.rects.reference,R=e.rects.popper,j=new Map,N=!0,J=y[0],ie=0;ie<y.length;ie++){var he=y[ie],ve=hr(he),Ee=bo(he)===go,Oe=[on,On].indexOf(ve)>=0,ze=Oe?"width":"height",v=Fa(e,{placement:he,boundary:u,rootBoundary:h,altBoundary:d,padding:c}),T=Oe?Ee?Nn:an:Ee?On:on;L[ze]>R[ze]&&(T=mc(T));var O=mc(T),W=[];if(s&&W.push(v[ve]<=0),a&&W.push(v[T]<=0,v[O]<=0),W.every(function(ke){return ke})){J=he,N=!1;break}j.set(he,W)}if(N)for(var ne=p?3:1,me=function(Pe){var je=y.find(function(mt){var kt=j.get(mt);if(kt)return kt.slice(0,Pe).every(function(yt){return yt})});if(je)return J=je,"break"},xe=ne;xe>0;xe--){var Qe=me(xe);if(Qe==="break")break}e.placement!==J&&(e.modifiersData[r]._skip=!0,e.placement=J,e.reset=!0)}}const xD={name:"flip",enabled:!0,phase:"main",fn:ED,requiresIfExists:["offset"],data:{_skip:!1}};function ob(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function ab(t){return[on,Nn,On,an].some(function(e){return t[e]>=0})}function SD(t){var e=t.state,n=t.name,r=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,o=Fa(e,{elementContext:"reference"}),a=Fa(e,{altBoundary:!0}),l=ob(o,r),c=ob(a,i,s),u=ab(l),h=ab(c);e.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}const TD={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:SD};function CD(t,e,n){var r=hr(t),i=[an,on].indexOf(r)>=0?-1:1,s=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[an,Nn].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function kD(t){var e=t.state,n=t.options,r=t.name,i=n.offset,s=i===void 0?[0,0]:i,o=HE.reduce(function(u,h){return u[h]=CD(h,e.rects,s),u},{}),a=o[e.placement],l=a.x,c=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=o}const ID={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:kD};function AD(t){var e=t.state,n=t.name;e.modifiersData[n]=YE({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const _D={name:"popperOffsets",enabled:!0,phase:"read",fn:AD,data:{}};function MD(t){return t==="x"?"y":"x"}function OD(t){var e=t.state,n=t.options,r=t.name,i=n.mainAxis,s=i===void 0?!0:i,o=n.altAxis,a=o===void 0?!1:o,l=n.boundary,c=n.rootBoundary,u=n.altBoundary,h=n.padding,d=n.tether,f=d===void 0?!0:d,p=n.tetherOffset,g=p===void 0?0:p,m=Fa(e,{boundary:l,rootBoundary:c,padding:h,altBoundary:u}),w=hr(e.placement),_=bo(e.placement),M=!_,y=Qp(w),L=MD(y),R=e.modifiersData.popperOffsets,j=e.rects.reference,N=e.rects.popper,J=typeof g=="function"?g(Object.assign({},e.rects,{placement:e.placement})):g,ie=typeof J=="number"?{mainAxis:J,altAxis:J}:Object.assign({mainAxis:0,altAxis:0},J),he=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ve={x:0,y:0};if(!!R){if(s){var Ee,Oe=y==="y"?on:an,ze=y==="y"?On:Nn,v=y==="y"?"height":"width",T=R[y],O=T+m[Oe],W=T-m[ze],ne=f?-N[v]/2:0,me=_===go?j[v]:N[v],xe=_===go?-N[v]:-j[v],Qe=e.elements.arrow,ke=f&&Qe?Yp(Qe):{width:0,height:0},Pe=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:WE(),je=Pe[Oe],mt=Pe[ze],kt=pa(0,j[v],ke[v]),yt=M?j[v]/2-ne-kt-je-ie.mainAxis:me-kt-je-ie.mainAxis,It=M?-j[v]/2+ne+kt+mt+ie.mainAxis:xe+kt+mt+ie.mainAxis,Qt=e.elements.arrow&&fl(e.elements.arrow),b=Qt?y==="y"?Qt.clientTop||0:Qt.clientLeft||0:0,E=(Ee=he==null?void 0:he[y])!=null?Ee:0,I=T+yt-E-b,$=T+It-E,B=pa(f?qc(O,I):O,T,f?Yi(W,$):W);R[y]=B,ve[y]=B-T}if(a){var S,G=y==="x"?on:an,D=y==="x"?On:Nn,A=R[L],F=L==="y"?"height":"width",Q=A+m[G],Y=A-m[D],te=[on,an].indexOf(w)!==-1,x=(S=he==null?void 0:he[L])!=null?S:0,C=te?Q:A-j[F]-N[F]-x+ie.altAxis,V=te?A+j[F]+N[F]-x-ie.altAxis:Y,H=f&&te?tD(C,A,V):pa(f?C:Q,A,f?V:Y);R[L]=H,ve[L]=H-A}e.modifiersData[r]=ve}}const ND={name:"preventOverflow",enabled:!0,phase:"main",fn:OD,requiresIfExists:["offset"]};function DD(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function RD(t){return t===Pn(t)||!Mn(t)?Zp(t):DD(t)}function PD(t){var e=t.getBoundingClientRect(),n=mo(e.width)/t.offsetWidth||1,r=mo(e.height)/t.offsetHeight||1;return n!==1||r!==1}function LD(t,e,n){n===void 0&&(n=!1);var r=Mn(e),i=Mn(e)&&PD(e),s=fi(e),o=yo(t,i,n),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!n)&&((pr(e)!=="body"||tg(s))&&(a=RD(e)),Mn(e)?(l=yo(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=eg(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function BD(t){var e=new Map,n=new Set,r=[];t.forEach(function(s){e.set(s.name,s)});function i(s){n.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!n.has(a)){var l=e.get(a);l&&i(l)}}),r.push(s)}return t.forEach(function(s){n.has(s.name)||i(s)}),r}function FD(t){var e=BD(t);return XN.reduce(function(n,r){return n.concat(e.filter(function(i){return i.phase===r}))},[])}function VD(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function $D(t){var e=t.reduce(function(n,r){var i=n[r.name];return n[r.name]=i?Object.assign({},i,r,{options:Object.assign({},i.options,r.options),data:Object.assign({},i.data,r.data)}):r,n},{});return Object.keys(e).map(function(n){return e[n]})}var lb={placement:"bottom",modifiers:[],strategy:"absolute"};function cb(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function UD(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,r=n===void 0?[]:n,i=e.defaultOptions,s=i===void 0?lb:i;return function(a,l,c){c===void 0&&(c=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},lb,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},h=[],d=!1,f={state:u,setOptions:function(w){var _=typeof w=="function"?w(u.options):w;g(),u.options=Object.assign({},s,u.options,_),u.scrollParents={reference:ls(a)?ga(a):a.contextElement?ga(a.contextElement):[],popper:ga(l)};var M=FD($D([].concat(r,u.options.modifiers)));return u.orderedModifiers=M.filter(function(y){return y.enabled}),p(),f.update()},forceUpdate:function(){if(!d){var w=u.elements,_=w.reference,M=w.popper;if(!!cb(_,M)){u.rects={reference:LD(_,fl(M),u.options.strategy==="fixed"),popper:Yp(M)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(ie){return u.modifiersData[ie.name]=Object.assign({},ie.data)});for(var y=0;y<u.orderedModifiers.length;y++){if(u.reset===!0){u.reset=!1,y=-1;continue}var L=u.orderedModifiers[y],R=L.fn,j=L.options,N=j===void 0?{}:j,J=L.name;typeof R=="function"&&(u=R({state:u,options:N,name:J,instance:f})||u)}}}},update:VD(function(){return new Promise(function(m){f.forceUpdate(),m(u)})}),destroy:function(){g(),d=!0}};if(!cb(a,l))return f;f.setOptions(c).then(function(m){!d&&c.onFirstUpdate&&c.onFirstUpdate(m)});function p(){u.orderedModifiers.forEach(function(m){var w=m.name,_=m.options,M=_===void 0?{}:_,y=m.effect;if(typeof y=="function"){var L=y({state:u,name:w,instance:f,options:M}),R=function(){};h.push(L||R)}})}function g(){h.forEach(function(m){return m()}),h=[]}return f}}var zD=[hD,_D,cD,jE,ID,xD,ND,sD,TD],HD=UD({defaultModifiers:zD}),jD="tippy-box",QE="tippy-content",KD="tippy-backdrop",ZE="tippy-arrow",ex="tippy-svg-arrow",Ai={passive:!0,capture:!0},tx=function(){return document.body};function ld(t,e,n){if(Array.isArray(t)){var r=t[e];return r==null?Array.isArray(n)?n[e]:n:r}return t}function ng(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function nx(t,e){return typeof t=="function"?t.apply(void 0,e):t}function ub(t,e){if(e===0)return t;var n;return function(r){clearTimeout(n),n=setTimeout(function(){t(r)},e)}}function qD(t){return t.split(/\s+/).filter(Boolean)}function Vs(t){return[].concat(t)}function hb(t,e){t.indexOf(e)===-1&&t.push(e)}function WD(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function GD(t){return t.split("-")[0]}function Wc(t){return[].slice.call(t)}function db(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function ma(){return document.createElement("div")}function qu(t){return["Element","Fragment"].some(function(e){return ng(t,e)})}function JD(t){return ng(t,"NodeList")}function XD(t){return ng(t,"MouseEvent")}function YD(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function QD(t){return qu(t)?[t]:JD(t)?Wc(t):Array.isArray(t)?t:Wc(document.querySelectorAll(t))}function cd(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function fb(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function ZD(t){var e,n=Vs(t),r=n[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function eR(t,e){var n=e.clientX,r=e.clientY;return t.every(function(i){var s=i.popperRect,o=i.popperState,a=i.props,l=a.interactiveBorder,c=GD(o.placement),u=o.modifiersData.offset;if(!u)return!0;var h=c==="bottom"?u.top.y:0,d=c==="top"?u.bottom.y:0,f=c==="right"?u.left.x:0,p=c==="left"?u.right.x:0,g=s.top-r+h>l,m=r-s.bottom-d>l,w=s.left-n+f>l,_=n-s.right-p>l;return g||m||w||_})}function ud(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[r](i,n)})}function pb(t,e){for(var n=e;n;){var r;if(t.contains(n))return!0;n=n.getRootNode==null||(r=n.getRootNode())==null?void 0:r.host}return!1}var er={isTouch:!1},gb=0;function tR(){er.isTouch||(er.isTouch=!0,window.performance&&document.addEventListener("mousemove",rx))}function rx(){var t=performance.now();t-gb<20&&(er.isTouch=!1,document.removeEventListener("mousemove",rx)),gb=t}function nR(){var t=document.activeElement;if(YD(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function rR(){document.addEventListener("touchstart",tR,Ai),window.addEventListener("blur",nR)}var iR=typeof window<"u"&&typeof document<"u",sR=iR?!!window.msCrypto:!1,oR={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},aR={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Vn=Object.assign({appendTo:tx,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},oR,aR),lR=Object.keys(Vn),cR=function(e){var n=Object.keys(e);n.forEach(function(r){Vn[r]=e[r]})};function ix(t){var e=t.plugins||[],n=e.reduce(function(r,i){var s=i.name,o=i.defaultValue;if(s){var a;r[s]=t[s]!==void 0?t[s]:(a=Vn[s])!=null?a:o}return r},{});return Object.assign({},t,n)}function uR(t,e){var n=e?Object.keys(ix(Object.assign({},Vn,{plugins:e}))):lR,r=n.reduce(function(i,s){var o=(t.getAttribute("data-tippy-"+s)||"").trim();if(!o)return i;if(s==="content")i[s]=o;else try{i[s]=JSON.parse(o)}catch{i[s]=o}return i},{});return r}function mb(t,e){var n=Object.assign({},e,{content:nx(e.content,[t])},e.ignoreAttributes?{}:uR(t,e.plugins));return n.aria=Object.assign({},Vn.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var hR=function(){return"innerHTML"};function vf(t,e){t[hR()]=e}function yb(t){var e=ma();return t===!0?e.className=ZE:(e.className=ex,qu(t)?e.appendChild(t):vf(e,t)),e}function bb(t,e){qu(e.content)?(vf(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?vf(t,e.content):t.textContent=e.content)}function Ef(t){var e=t.firstElementChild,n=Wc(e.children);return{box:e,content:n.find(function(r){return r.classList.contains(QE)}),arrow:n.find(function(r){return r.classList.contains(ZE)||r.classList.contains(ex)}),backdrop:n.find(function(r){return r.classList.contains(KD)})}}function sx(t){var e=ma(),n=ma();n.className=jD,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=ma();r.className=QE,r.setAttribute("data-state","hidden"),bb(r,t.props),e.appendChild(n),n.appendChild(r),i(t.props,t.props);function i(s,o){var a=Ef(e),l=a.box,c=a.content,u=a.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(s.content!==o.content||s.allowHTML!==o.allowHTML)&&bb(c,t.props),o.arrow?u?s.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(yb(o.arrow))):l.appendChild(yb(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:i}}sx.$$tippy=!0;var dR=1,Hl=[],hd=[];function fR(t,e){var n=mb(t,Object.assign({},Vn,ix(db(e)))),r,i,s,o=!1,a=!1,l=!1,c=!1,u,h,d,f=[],p=ub(I,n.interactiveDebounce),g,m=dR++,w=null,_=WD(n.plugins),M={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:m,reference:t,popper:ma(),popperInstance:w,props:n,state:M,plugins:_,clearDelayTimeouts:C,setProps:V,setContent:H,show:ce,hide:Ne,hideWithInteractivity:vn,enable:te,disable:x,unmount:_r,destroy:wi};if(!n.render)return y;var L=n.render(y),R=L.popper,j=L.onUpdate;R.setAttribute("data-tippy-root",""),R.id="tippy-"+y.id,y.popper=R,t._tippy=y,R._tippy=y;var N=_.map(function(P){return P.fn(y)}),J=t.hasAttribute("aria-expanded");return Qt(),ne(),T(),O("onCreate",[y]),n.showOnCreate&&Q(),R.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),R.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&Oe().addEventListener("mousemove",p)}),y;function ie(){var P=y.props.touch;return Array.isArray(P)?P:[P,0]}function he(){return ie()[0]==="hold"}function ve(){var P;return!!((P=y.props.render)!=null&&P.$$tippy)}function Ee(){return g||t}function Oe(){var P=Ee().parentNode;return P?ZD(P):document}function ze(){return Ef(R)}function v(P){return y.state.isMounted&&!y.state.isVisible||er.isTouch||u&&u.type==="focus"?0:ld(y.props.delay,P?0:1,Vn.delay)}function T(P){P===void 0&&(P=!1),R.style.pointerEvents=y.props.interactive&&!P?"":"none",R.style.zIndex=""+y.props.zIndex}function O(P,Z,le){if(le===void 0&&(le=!0),N.forEach(function(De){De[P]&&De[P].apply(De,Z)}),le){var Re;(Re=y.props)[P].apply(Re,Z)}}function W(){var P=y.props.aria;if(!!P.content){var Z="aria-"+P.content,le=R.id,Re=Vs(y.props.triggerTarget||t);Re.forEach(function(De){var $t=De.getAttribute(Z);if(y.state.isVisible)De.setAttribute(Z,$t?$t+" "+le:le);else{var En=$t&&$t.replace(le,"").trim();En?De.setAttribute(Z,En):De.removeAttribute(Z)}})}}function ne(){if(!(J||!y.props.aria.expanded)){var P=Vs(y.props.triggerTarget||t);P.forEach(function(Z){y.props.interactive?Z.setAttribute("aria-expanded",y.state.isVisible&&Z===Ee()?"true":"false"):Z.removeAttribute("aria-expanded")})}}function me(){Oe().removeEventListener("mousemove",p),Hl=Hl.filter(function(P){return P!==p})}function xe(P){if(!(er.isTouch&&(l||P.type==="mousedown"))){var Z=P.composedPath&&P.composedPath()[0]||P.target;if(!(y.props.interactive&&pb(R,Z))){if(Vs(y.props.triggerTarget||t).some(function(le){return pb(le,Z)})){if(er.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[y,P]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),a=!0,setTimeout(function(){a=!1}),y.state.isMounted||je())}}}function Qe(){l=!0}function ke(){l=!1}function Pe(){var P=Oe();P.addEventListener("mousedown",xe,!0),P.addEventListener("touchend",xe,Ai),P.addEventListener("touchstart",ke,Ai),P.addEventListener("touchmove",Qe,Ai)}function je(){var P=Oe();P.removeEventListener("mousedown",xe,!0),P.removeEventListener("touchend",xe,Ai),P.removeEventListener("touchstart",ke,Ai),P.removeEventListener("touchmove",Qe,Ai)}function mt(P,Z){yt(P,function(){!y.state.isVisible&&R.parentNode&&R.parentNode.contains(R)&&Z()})}function kt(P,Z){yt(P,Z)}function yt(P,Z){var le=ze().box;function Re(De){De.target===le&&(ud(le,"remove",Re),Z())}if(P===0)return Z();ud(le,"remove",h),ud(le,"add",Re),h=Re}function It(P,Z,le){le===void 0&&(le=!1);var Re=Vs(y.props.triggerTarget||t);Re.forEach(function(De){De.addEventListener(P,Z,le),f.push({node:De,eventType:P,handler:Z,options:le})})}function Qt(){he()&&(It("touchstart",E,{passive:!0}),It("touchend",$,{passive:!0})),qD(y.props.trigger).forEach(function(P){if(P!=="manual")switch(It(P,E),P){case"mouseenter":It("mouseleave",$);break;case"focus":It(sR?"focusout":"blur",B);break;case"focusin":It("focusout",B);break}})}function b(){f.forEach(function(P){var Z=P.node,le=P.eventType,Re=P.handler,De=P.options;Z.removeEventListener(le,Re,De)}),f=[]}function E(P){var Z,le=!1;if(!(!y.state.isEnabled||S(P)||a)){var Re=((Z=u)==null?void 0:Z.type)==="focus";u=P,g=P.currentTarget,ne(),!y.state.isVisible&&XD(P)&&Hl.forEach(function(De){return De(P)}),P.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||o)&&y.props.hideOnClick!==!1&&y.state.isVisible?le=!0:Q(P),P.type==="click"&&(o=!le),le&&!Re&&Y(P)}}function I(P){var Z=P.target,le=Ee().contains(Z)||R.contains(Z);if(!(P.type==="mousemove"&&le)){var Re=F().concat(R).map(function(De){var $t,En=De._tippy,Is=($t=En.popperInstance)==null?void 0:$t.state;return Is?{popperRect:De.getBoundingClientRect(),popperState:Is,props:n}:null}).filter(Boolean);eR(Re,P)&&(me(),Y(P))}}function $(P){var Z=S(P)||y.props.trigger.indexOf("click")>=0&&o;if(!Z){if(y.props.interactive){y.hideWithInteractivity(P);return}Y(P)}}function B(P){y.props.trigger.indexOf("focusin")<0&&P.target!==Ee()||y.props.interactive&&P.relatedTarget&&R.contains(P.relatedTarget)||Y(P)}function S(P){return er.isTouch?he()!==P.type.indexOf("touch")>=0:!1}function G(){D();var P=y.props,Z=P.popperOptions,le=P.placement,Re=P.offset,De=P.getReferenceClientRect,$t=P.moveTransition,En=ve()?Ef(R).arrow:null,Is=De?{getBoundingClientRect:De,contextElement:De.contextElement||Ee()}:t,bm={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Ol){var As=Ol.state;if(ve()){var AC=ze(),Rh=AC.box;["placement","reference-hidden","escaped"].forEach(function(Nl){Nl==="placement"?Rh.setAttribute("data-placement",As.placement):As.attributes.popper["data-popper-"+Nl]?Rh.setAttribute("data-"+Nl,""):Rh.removeAttribute("data-"+Nl)}),As.attributes.popper={}}}},vi=[{name:"offset",options:{offset:Re}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!$t}},bm];ve()&&En&&vi.push({name:"arrow",options:{element:En,padding:3}}),vi.push.apply(vi,(Z==null?void 0:Z.modifiers)||[]),y.popperInstance=HD(Is,R,Object.assign({},Z,{placement:le,onFirstUpdate:d,modifiers:vi}))}function D(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function A(){var P=y.props.appendTo,Z,le=Ee();y.props.interactive&&P===tx||P==="parent"?Z=le.parentNode:Z=nx(P,[le]),Z.contains(R)||Z.appendChild(R),y.state.isMounted=!0,G()}function F(){return Wc(R.querySelectorAll("[data-tippy-root]"))}function Q(P){y.clearDelayTimeouts(),P&&O("onTrigger",[y,P]),Pe();var Z=v(!0),le=ie(),Re=le[0],De=le[1];er.isTouch&&Re==="hold"&&De&&(Z=De),Z?r=setTimeout(function(){y.show()},Z):y.show()}function Y(P){if(y.clearDelayTimeouts(),O("onUntrigger",[y,P]),!y.state.isVisible){je();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(P.type)>=0&&o)){var Z=v(!1);Z?i=setTimeout(function(){y.state.isVisible&&y.hide()},Z):s=requestAnimationFrame(function(){y.hide()})}}function te(){y.state.isEnabled=!0}function x(){y.hide(),y.state.isEnabled=!1}function C(){clearTimeout(r),clearTimeout(i),cancelAnimationFrame(s)}function V(P){if(!y.state.isDestroyed){O("onBeforeUpdate",[y,P]),b();var Z=y.props,le=mb(t,Object.assign({},Z,db(P),{ignoreAttributes:!0}));y.props=le,Qt(),Z.interactiveDebounce!==le.interactiveDebounce&&(me(),p=ub(I,le.interactiveDebounce)),Z.triggerTarget&&!le.triggerTarget?Vs(Z.triggerTarget).forEach(function(Re){Re.removeAttribute("aria-expanded")}):le.triggerTarget&&t.removeAttribute("aria-expanded"),ne(),T(),j&&j(Z,le),y.popperInstance&&(G(),F().forEach(function(Re){requestAnimationFrame(Re._tippy.popperInstance.forceUpdate)})),O("onAfterUpdate",[y,P])}}function H(P){y.setProps({content:P})}function ce(){var P=y.state.isVisible,Z=y.state.isDestroyed,le=!y.state.isEnabled,Re=er.isTouch&&!y.props.touch,De=ld(y.props.duration,0,Vn.duration);if(!(P||Z||le||Re)&&!Ee().hasAttribute("disabled")&&(O("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,ve()&&(R.style.visibility="visible"),T(),Pe(),y.state.isMounted||(R.style.transition="none"),ve()){var $t=ze(),En=$t.box,Is=$t.content;cd([En,Is],0)}d=function(){var vi;if(!(!y.state.isVisible||c)){if(c=!0,R.offsetHeight,R.style.transition=y.props.moveTransition,ve()&&y.props.animation){var Dh=ze(),Ol=Dh.box,As=Dh.content;cd([Ol,As],De),fb([Ol,As],"visible")}W(),ne(),hb(hd,y),(vi=y.popperInstance)==null||vi.forceUpdate(),O("onMount",[y]),y.props.animation&&ve()&&kt(De,function(){y.state.isShown=!0,O("onShown",[y])})}},A()}}function Ne(){var P=!y.state.isVisible,Z=y.state.isDestroyed,le=!y.state.isEnabled,Re=ld(y.props.duration,1,Vn.duration);if(!(P||Z||le)&&(O("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,c=!1,o=!1,ve()&&(R.style.visibility="hidden"),me(),je(),T(!0),ve()){var De=ze(),$t=De.box,En=De.content;y.props.animation&&(cd([$t,En],Re),fb([$t,En],"hidden"))}W(),ne(),y.props.animation?ve()&&mt(Re,y.unmount):y.unmount()}}function vn(P){Oe().addEventListener("mousemove",p),hb(Hl,p),p(P)}function _r(){y.state.isVisible&&y.hide(),y.state.isMounted&&(D(),F().forEach(function(P){P._tippy.unmount()}),R.parentNode&&R.parentNode.removeChild(R),hd=hd.filter(function(P){return P!==y}),y.state.isMounted=!1,O("onHidden",[y]))}function wi(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),b(),delete t._tippy,y.state.isDestroyed=!0,O("onDestroy",[y]))}}function Do(t,e){e===void 0&&(e={});var n=Vn.plugins.concat(e.plugins||[]);rR();var r=Object.assign({},e,{plugins:n}),i=QD(t),s=i.reduce(function(o,a){var l=a&&fR(a,r);return l&&o.push(l),o},[]);return qu(t)?s[0]:s}Do.defaultProps=Vn;Do.setDefaultProps=cR;Do.currentInput=er;Object.assign({},jE,{effect:function(e){var n=e.state,r={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,r.popper),n.styles=r,n.elements.arrow&&Object.assign(n.elements.arrow.style,r.arrow)}});Do.setDefaultProps({render:sx});class pR{constructor({editor:e,element:n,view:r,tippyOptions:i={},shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:o,state:a,from:l,to:c})=>{const{doc:u,selection:h}=a,{empty:d}=h,f=!u.textBetween(l,c).length&&Kp(a.selection),p=this.element.contains(document.activeElement);return!(!(o.hasFocus()||p)||d||f||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:o})=>{var a;if(this.preventHide){this.preventHide=!1;return}(o==null?void 0:o.relatedTarget)&&((a=this.element.parentNode)===null||a===void 0?void 0:a.contains(o.relatedTarget))||this.hide()},this.editor=e,this.element=n,this.view=r,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,n=!!e.parentElement;this.tippy||!n||(this.tippy=Do(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",r=>{this.blurHandler({event:r})}))}update(e,n){var r,i,s;const{state:o,composing:a}=e,{doc:l,selection:c}=o,u=n&&n.doc.eq(l)&&n.selection.eq(c);if(a||u)return;this.createTooltip();const{ranges:h}=c,d=Math.min(...h.map(g=>g.$from.pos)),f=Math.max(...h.map(g=>g.$to.pos));if(!((r=this.shouldShow)===null||r===void 0?void 0:r.call(this,{editor:this.editor,view:e,state:o,oldState:n,from:d,to:f}))){this.hide();return}(i=this.tippy)===null||i===void 0||i.setProps({getReferenceClientRect:((s=this.tippyOptions)===null||s===void 0?void 0:s.getReferenceClientRect)||(()=>{if(cN(o.selection)){const g=e.nodeDOM(d);if(g)return g.getBoundingClientRect()}return $E(e,d,f)})}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const ox=t=>new Tt({key:typeof t.pluginKey=="string"?new un(t.pluginKey):t.pluginKey,view:e=>new pR({view:e,...t})});Yt.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[ox({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class gR{constructor({editor:e,element:n,view:r,tippyOptions:i={},shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:o,state:a})=>{const{selection:l}=a,{$anchor:c,empty:u}=l,h=c.depth===1,d=c.parent.isTextblock&&!c.parent.type.spec.code&&!c.parent.textContent;return!(!o.hasFocus()||!u||!h||!d||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:o})=>{var a;if(this.preventHide){this.preventHide=!1;return}(o==null?void 0:o.relatedTarget)&&((a=this.element.parentNode)===null||a===void 0?void 0:a.contains(o.relatedTarget))||this.hide()},this.editor=e,this.element=n,this.view=r,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,n=!!e.parentElement;this.tippy||!n||(this.tippy=Do(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",r=>{this.blurHandler({event:r})}))}update(e,n){var r,i,s;const{state:o}=e,{doc:a,selection:l}=o,{from:c,to:u}=l;if(n&&n.doc.eq(a)&&n.selection.eq(l))return;if(this.createTooltip(),!((r=this.shouldShow)===null||r===void 0?void 0:r.call(this,{editor:this.editor,view:e,state:o,oldState:n}))){this.hide();return}(i=this.tippy)===null||i===void 0||i.setProps({getReferenceClientRect:((s=this.tippyOptions)===null||s===void 0?void 0:s.getReferenceClientRect)||(()=>$E(e,c,u))}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const ax=t=>new Tt({key:typeof t.pluginKey=="string"?new un(t.pluginKey):t.pluginKey,view:e=>new gR({view:e,...t})});Yt.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[ax({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});const mR=cl({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const n=vp(null);return Mu(()=>{const{pluginKey:r,editor:i,tippyOptions:s,shouldShow:o}=t;i.registerPlugin(ox({pluginKey:r,editor:i,element:n.value,tippyOptions:s,shouldShow:o}))}),ul(()=>{const{pluginKey:r,editor:i}=t;i.unregisterPlugin(r)}),()=>{var r;return qi("div",{ref:n},(r=e.default)===null||r===void 0?void 0:r.call(e))}}});function wb(t){return vk((e,n)=>({get(){return e(),t},set(r){t=r,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}class yR extends FN{constructor(e={}){return super(e),this.vueRenderers=Cu(new Map),this.contentComponent=null,this.reactiveState=wb(this.view.state),this.reactiveExtensionStorage=wb(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),mp(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,n){super.registerPlugin(e,n),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const bR=cl({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=vp(),n=p0();return Lk(()=>{const r=t.editor;r&&r.options.element&&e.value&&Kv(()=>{if(!e.value||!r.options.element.firstChild)return;const i=Uv(e.value);e.value.append(...r.options.element.childNodes),r.contentComponent=n.ctx._,r.setOptions({element:i}),r.createNodeViews()})}),ul(()=>{const r=t.editor;if(!r||(r.isDestroyed||r.view.setProps({nodeViews:{}}),r.contentComponent=null,!r.options.element.firstChild))return;const i=document.createElement("div");i.append(...r.options.element.childNodes),r.setOptions({element:i})}),{rootEl:e}},render(){const t=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const n=qi(wI,{to:e.teleportElement,key:e.id},qi(e.component,{ref:e.id,...e.props}));t.push(n)}),qi("div",{ref:e=>{this.rootEl=e}},...t)}});cl({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const n=vp(null);return Mu(()=>{const{pluginKey:r,editor:i,tippyOptions:s,shouldShow:o}=t;i.registerPlugin(ax({pluginKey:r,editor:i,element:n.value,tippyOptions:s,shouldShow:o}))}),ul(()=>{const{pluginKey:r,editor:i}=t;i.unregisterPlugin(r)}),()=>{var r;return qi("div",{ref:n},(r=e.default)===null||r===void 0?void 0:r.call(e))}}});cl({props:{as:{type:String,default:"div"}},render(){return qi(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});cl({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return qi(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(t=this.$slots).default)===null||e===void 0?void 0:e.call(t))}});const wR=/^\s*>\s$/,vR=at.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Gp({find:wR,type:this.type})]}}),ER=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,xR=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,SR=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,TR=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,CR=ai.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[fo({find:ER,type:this.type}),fo({find:SR,type:this.type})]},addPasteRules(){return[po({find:xR,type:this.type}),po({find:TR,type:this.type})]}}),kR=/^\s*([-+*])\s$/,IR=at.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Gp({find:kR,type:this.type})]}}),AR=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,_R=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,MR=ai.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[fo({find:AR,type:this.type})]},addPasteRules(){return[po({find:_R,type:this.type})]}}),OR=/^```([a-z]+)?[\s\n]$/,NR=/^~~~([a-z]+)?[\s\n]$/,lx=at.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,s=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",nt(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0||r.nodeAt(a)?!1:t.commands.exitCode()}}},addInputRules(){return[yf({find:OR,type:this.type,getAttributes:t=>({language:t[1]})}),yf({find:NR,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Tt({key:new un("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i==null?void 0:i.mode;if(!n||!s)return!1;const{tr:o}=t.state;return o.replaceSelectionWith(this.type.create({language:s})),o.setSelection(pe.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,`
`)),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),DR=at.create({name:"doc",topNode:!0,content:"block+"});function RR(t={}){return new Tt({view(e){return new PR(e,t)}})}class PR{constructor(e,n){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=n.width||1,this.color=n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let i=s=>{this[r](s)};return e.dom.addEventListener(r,i),{name:r,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n;if(!e.parent.inlineContent){let o=e.nodeBefore,a=e.nodeAfter;if(o||a){let l=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0)).getBoundingClientRect(),c=o?l.bottom:l.top;o&&a&&(c=(c+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:l.left,right:l.right,top:c-this.width/2,bottom:c+this.width/2}}}if(!n){let o=this.editorView.coordsAtPos(this.cursorPos);n={left:o.left-this.width/2,right:o.left+this.width/2,top:o.top,bottom:o.bottom}}let r=this.editorView.dom.offsetParent;this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);let i,s;if(!r||r==document.body&&getComputedStyle(r).position=="static")i=-pageXOffset,s=-pageYOffset;else{let o=r.getBoundingClientRect();i=o.left-r.scrollLeft,s=o.top-r.scrollTop}this.element.style.left=n.left-i+"px",this.element.style.top=n.top-s+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(o=V0(this.editorView.state.doc,o,this.editorView.dragging.slice),o==null))return this.setCursor(null);this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const LR=Yt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[RR(this.options)]}});class Je extends ue{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Je.valid(r)?new Je(r):ue.near(r)}content(){return X.empty}eq(e){return e instanceof Je&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Je(e.resolve(n.pos))}getBookmark(){return new rg(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!BR(e)||!FR(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Je.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(Je.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!fe.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(Je.valid(a))return a}return null}}}Je.prototype.visible=!1;Je.findFrom=Je.findGapCursorFrom;ue.jsonID("gapcursor",Je);class rg{constructor(e){this.pos=e}map(e){return new rg(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Je.valid(n)?new Je(n):ue.near(n)}}function BR(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function FR(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function VR(){return new Tt({props:{decorations:HR,createSelectionBetween(t,e,n){return e.pos==n.pos&&Je.valid(n)?new Je(n):null},handleClick:UR,handleKeyDown:$R,handleDOMEvents:{beforeinput:zR}}})}const $R=zp({ArrowLeft:jl("horiz",-1),ArrowRight:jl("horiz",1),ArrowUp:jl("vert",-1),ArrowDown:jl("vert",1)});function jl(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof pe){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Je.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new Je(c))),!0):!1}}function UR(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Je.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&fe.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Je(r))),!0)}function zR(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Je))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=z.empty;for(let o=r.length-1;o>=0;o--)i=z.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new X(i,0,0));return s.setSelection(pe.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function HR(t){if(!(t.selection instanceof Je))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",et.create(t.doc,[Kt.widget(t.selection.head,e,{key:"gapcursor"})])}const jR=Yt.create({name:"gapCursor",addProseMirrorPlugins(){return[VR()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Se(re(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),KR=at.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",nt(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const h=l.filter(d=>a.includes(d.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),qR=at.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,nt(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>yf({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Gc=200,xt=function(){};xt.prototype.append=function(e){return e.length?(e=xt.from(e),!this.length&&e||e.length<Gc&&this.leafAppend(e)||this.length<Gc&&e.leafPrepend(this)||this.appendInner(e)):this};xt.prototype.prepend=function(e){return e.length?xt.from(e).append(this):this};xt.prototype.appendInner=function(e){return new WR(this,e)};xt.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?xt.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};xt.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};xt.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};xt.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};xt.from=function(e){return e instanceof xt?e:e&&e.length?new cx(e):xt.empty};var cx=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Gc)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Gc)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(xt);xt.empty=new cx([]);var WR=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(xt),ux=xt;const GR=500;class Bn{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((h,d)=>{if(!h.step){i||(i=this.remapping(r,d+1),s=i.maps.length),s--,u.push(h);return}if(i){u.push(new Qn(h.map));let f=h.step.map(i.slice(s)),p;f&&o.maybeStep(f).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Qn(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(h.step);if(h.selection)return a=i?h.selection.map(i.slice(s)):h.selection,l=new Bn(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),d=new Qn(e.mapping.maps[u],h,n),f;(f=l&&l.merge(d))&&(d=f,u?s.pop():a=a.slice(0,a.length-1)),s.push(d),n&&(o++,n=void 0),i||(l=d)}let c=o-r.depth;return c>XR&&(a=JR(a,c),o-=c),new Bn(a.append(s),o)}remapping(e,n){let r=new Qs;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Bn(this.items.append(e.map(n=>new Qn(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(d=>{d.selection&&a--},i);let l=n;this.items.forEach(d=>{let f=s.getMirror(--l);if(f==null)return;o=Math.min(o,f);let p=s.maps[f];if(d.step){let g=e.steps[f].invert(e.docs[f]),m=d.selection&&d.selection.map(s.slice(l+1,f));m&&a++,r.push(new Qn(p,g,m))}else r.push(new Qn(p))},i);let c=[];for(let d=n;d<o;d++)c.push(new Qn(s.maps[d]));let u=this.items.slice(0,i).append(c).append(r),h=new Bn(u,a);return h.emptyItemCount()>GR&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let h=new Qn(c.invert(),l,u),d,f=i.length-1;(d=i.length&&i[f].merge(h))?i[f]=d:i.push(h)}}else o.map&&r--},this.items.length,0),new Bn(ux.from(i.reverse()),s)}}Bn.empty=new Bn(ux.empty,0);function JR(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Qn{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Qn(n.getMap().invert(),n,this.selection)}}}class Lr{constructor(e,n,r,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i}}const XR=20;function YR(t,e,n,r){let i=n.getMeta(Yr),s;if(i)return i.historyState;n.getMeta(ZR)&&(t=new Lr(t.done,t.undone,null,0));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Yr))return o.getMeta(Yr).redo?new Lr(t.done.addTransform(n,void 0,r,yc(e)),t.undone,vb(n.mapping.maps[n.steps.length-1]),t.prevTime):new Lr(t.done,t.undone.addTransform(n,void 0,r,yc(e)),null,t.prevTime);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.prevTime==0||!o&&(t.prevTime<(n.time||0)-r.newGroupDelay||!QR(n,t.prevRanges)),l=o?dd(t.prevRanges,n.mapping):vb(n.mapping.maps[n.steps.length-1]);return new Lr(t.done.addTransform(n,a?e.selection.getBookmark():void 0,r,yc(e)),Bn.empty,l,n.time)}else return(s=n.getMeta("rebased"))?new Lr(t.done.rebased(n,s),t.undone.rebased(n,s),dd(t.prevRanges,n.mapping),t.prevTime):new Lr(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),dd(t.prevRanges,n.mapping),t.prevTime)}function QR(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function vb(t){let e=[];return t.forEach((n,r,i,s)=>e.push(i,s)),e}function dd(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function hx(t,e,n,r){let i=yc(e),s=Yr.get(e).spec.config,o=(r?t.undone:t.done).popEvent(e,i);if(!o)return;let a=o.selection.resolve(o.transform.doc),l=(r?t.done:t.undone).addTransform(o.transform,e.selection.getBookmark(),s,i),c=new Lr(r?l:o.remaining,r?o.remaining:l,null,0);n(o.transform.setSelection(a).setMeta(Yr,{redo:r,historyState:c}).scrollIntoView())}let fd=!1,Eb=null;function yc(t){let e=t.plugins;if(Eb!=e){fd=!1,Eb=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){fd=!0;break}}return fd}const Yr=new un("history"),ZR=new un("closeHistory");function eP(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Tt({key:Yr,state:{init(){return new Lr(Bn.empty,Bn.empty,null,0)},apply(e,n,r){return YR(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?dx:r=="historyRedo"?fx:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}const dx=(t,e)=>{let n=Yr.getState(t);return!n||n.done.eventCount==0?!1:(e&&hx(n,t,e,!1),!0)},fx=(t,e)=>{let n=Yr.getState(t);return!n||n.undone.eventCount==0?!1:(e&&hx(n,t,e,!0),!0)},tP=Yt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>dx(t,e),redo:()=>({state:t,dispatch:e})=>fx(t,e)}},addProseMirrorPlugins(){return[eP(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),nP=at.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",nt(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t})=>t().insertContent({type:this.name}).command(({tr:e,dispatch:n})=>{var r;if(n){const{$to:i}=e.selection,s=i.end();if(i.nodeAfter)e.setSelection(pe.create(e.doc,i.pos));else{const o=(r=i.parent.type.contentMatch.defaultType)===null||r===void 0?void 0:r.create();o&&(e.insert(s,o),e.setSelection(pe.create(e.doc,s)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[UE({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),rP=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,iP=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,sP=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,oP=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,aP=ai.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[fo({find:rP,type:this.type}),fo({find:sP,type:this.type})]},addPasteRules(){return[po({find:iP,type:this.type}),po({find:oP,type:this.type})]}}),lP=at.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",nt(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),cP=/^(\d+)\.\s$/,uP=at.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",nt(this.options.HTMLAttributes,n),0]:["ol",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Gp({find:cP,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]})]}}),hP=at.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),dP=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,fP=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,pP=ai.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",nt(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[fo({find:dP,type:this.type})]},addPasteRules(){return[po({find:fP,type:this.type})]}}),gP=at.create({name:"text",group:"inline"}),mP=Yt.create({name:"starterKit",addExtensions(){var t,e,n,r,i,s,o,a,l,c,u,h,d,f,p,g,m,w;const _=[];return this.options.blockquote!==!1&&_.push(vR.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&_.push(CR.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&_.push(IR.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&_.push(MR.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&_.push(lx.configure((i=this.options)===null||i===void 0?void 0:i.codeBlock)),this.options.document!==!1&&_.push(DR.configure((s=this.options)===null||s===void 0?void 0:s.document)),this.options.dropcursor!==!1&&_.push(LR.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&_.push(jR.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&_.push(KR.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&_.push(qR.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&_.push(tP.configure((u=this.options)===null||u===void 0?void 0:u.history)),this.options.horizontalRule!==!1&&_.push(nP.configure((h=this.options)===null||h===void 0?void 0:h.horizontalRule)),this.options.italic!==!1&&_.push(aP.configure((d=this.options)===null||d===void 0?void 0:d.italic)),this.options.listItem!==!1&&_.push(lP.configure((f=this.options)===null||f===void 0?void 0:f.listItem)),this.options.orderedList!==!1&&_.push(uP.configure((p=this.options)===null||p===void 0?void 0:p.orderedList)),this.options.paragraph!==!1&&_.push(hP.configure((g=this.options)===null||g===void 0?void 0:g.paragraph)),this.options.strike!==!1&&_.push(pP.configure((m=this.options)===null||m===void 0?void 0:m.strike)),this.options.text!==!1&&_.push(gP.configure((w=this.options)===null||w===void 0?void 0:w.text)),_}});var ig={exports:{}};function sg(t){return t instanceof Map?t.clear=t.delete=t.set=function(){throw new Error("map is read-only")}:t instanceof Set&&(t.add=t.clear=t.delete=function(){throw new Error("set is read-only")}),Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];typeof n=="object"&&!Object.isFrozen(n)&&sg(n)}),t}ig.exports=sg;ig.exports.default=sg;class xb{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function px(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function jr(t,...e){const n=Object.create(null);for(const r in t)n[r]=t[r];return e.forEach(function(r){for(const i in r)n[i]=r[i]}),n}const yP="</span>",Sb=t=>!!t.scope||t.sublanguage&&t.language,bP=(t,{prefix:e})=>{if(t.includes(".")){const n=t.split(".");return[`${e}${n.shift()}`,...n.map((r,i)=>`${r}${"_".repeat(i+1)}`)].join(" ")}return`${e}${t}`};class wP{constructor(e,n){this.buffer="",this.classPrefix=n.classPrefix,e.walk(this)}addText(e){this.buffer+=px(e)}openNode(e){if(!Sb(e))return;let n="";e.sublanguage?n=`language-${e.language}`:n=bP(e.scope,{prefix:this.classPrefix}),this.span(n)}closeNode(e){!Sb(e)||(this.buffer+=yP)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}const Tb=(t={})=>{const e={children:[]};return Object.assign(e,t),e};class og{constructor(){this.rootNode=Tb(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const n=Tb({scope:e});this.add(n),this.stack.push(n)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,n){return typeof n=="string"?e.addText(n):n.children&&(e.openNode(n),n.children.forEach(r=>this._walk(e,r)),e.closeNode(n)),e}static _collapse(e){typeof e!="string"&&(!e.children||(e.children.every(n=>typeof n=="string")?e.children=[e.children.join("")]:e.children.forEach(n=>{og._collapse(n)})))}}class vP extends og{constructor(e){super(),this.options=e}addKeyword(e,n){e!==""&&(this.openNode(n),this.addText(e),this.closeNode())}addText(e){e!==""&&this.add(e)}addSublanguage(e,n){const r=e.root;r.sublanguage=!0,r.language=n,this.add(r)}toHTML(){return new wP(this,this.options).value()}finalize(){return!0}}function Va(t){return t?typeof t=="string"?t:t.source:null}function gx(t){return vs("(?=",t,")")}function EP(t){return vs("(?:",t,")*")}function xP(t){return vs("(?:",t,")?")}function vs(...t){return t.map(n=>Va(n)).join("")}function SP(t){const e=t[t.length-1];return typeof e=="object"&&e.constructor===Object?(t.splice(t.length-1,1),e):{}}function ag(...t){const e=SP(t);return"("+(e.capture?"":"?:")+t.map(r=>Va(r)).join("|")+")"}function mx(t){return new RegExp(t.toString()+"|").exec("").length-1}function TP(t,e){const n=t&&t.exec(e);return n&&n.index===0}const CP=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function lg(t,{joinWith:e}){let n=0;return t.map(r=>{n+=1;const i=n;let s=Va(r),o="";for(;s.length>0;){const a=CP.exec(s);if(!a){o+=s;break}o+=s.substring(0,a.index),s=s.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?o+="\\"+String(Number(a[1])+i):(o+=a[0],a[0]==="("&&n++)}return o}).map(r=>`(${r})`).join(e)}const kP=/\b\B/,yx="[a-zA-Z]\\w*",cg="[a-zA-Z_]\\w*",bx="\\b\\d+(\\.\\d+)?",wx="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",vx="\\b(0b[01]+)",IP="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",AP=(t={})=>{const e=/^#![ ]*\//;return t.binary&&(t.begin=vs(e,/.*\b/,t.binary,/\b.*/)),jr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(n,r)=>{n.index!==0&&r.ignoreMatch()}},t)},$a={begin:"\\\\[\\s\\S]",relevance:0},_P={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[$a]},MP={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[$a]},OP={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},Wu=function(t,e,n={}){const r=jr({scope:"comment",begin:t,end:e,contains:[]},n);r.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const i=ag("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return r.contains.push({begin:vs(/[ ]+/,"(",i,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),r},NP=Wu("//","$"),DP=Wu("/\\*","\\*/"),RP=Wu("#","$"),PP={scope:"number",begin:bx,relevance:0},LP={scope:"number",begin:wx,relevance:0},BP={scope:"number",begin:vx,relevance:0},FP={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[$a,{begin:/\[/,end:/\]/,relevance:0,contains:[$a]}]}]},VP={scope:"title",begin:yx,relevance:0},$P={scope:"title",begin:cg,relevance:0},UP={begin:"\\.\\s*"+cg,relevance:0},zP=function(t){return Object.assign(t,{"on:begin":(e,n)=>{n.data._beginMatch=e[1]},"on:end":(e,n)=>{n.data._beginMatch!==e[1]&&n.ignoreMatch()}})};var Kl=Object.freeze({__proto__:null,MATCH_NOTHING_RE:kP,IDENT_RE:yx,UNDERSCORE_IDENT_RE:cg,NUMBER_RE:bx,C_NUMBER_RE:wx,BINARY_NUMBER_RE:vx,RE_STARTERS_RE:IP,SHEBANG:AP,BACKSLASH_ESCAPE:$a,APOS_STRING_MODE:_P,QUOTE_STRING_MODE:MP,PHRASAL_WORDS_MODE:OP,COMMENT:Wu,C_LINE_COMMENT_MODE:NP,C_BLOCK_COMMENT_MODE:DP,HASH_COMMENT_MODE:RP,NUMBER_MODE:PP,C_NUMBER_MODE:LP,BINARY_NUMBER_MODE:BP,REGEXP_MODE:FP,TITLE_MODE:VP,UNDERSCORE_TITLE_MODE:$P,METHOD_GUARD:UP,END_SAME_AS_BEGIN:zP});function HP(t,e){t.input[t.index-1]==="."&&e.ignoreMatch()}function jP(t,e){t.className!==void 0&&(t.scope=t.className,delete t.className)}function KP(t,e){!e||!t.beginKeywords||(t.begin="\\b("+t.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",t.__beforeBegin=HP,t.keywords=t.keywords||t.beginKeywords,delete t.beginKeywords,t.relevance===void 0&&(t.relevance=0))}function qP(t,e){!Array.isArray(t.illegal)||(t.illegal=ag(...t.illegal))}function WP(t,e){if(!!t.match){if(t.begin||t.end)throw new Error("begin & end are not supported with match");t.begin=t.match,delete t.match}}function GP(t,e){t.relevance===void 0&&(t.relevance=1)}const JP=(t,e)=>{if(!t.beforeMatch)return;if(t.starts)throw new Error("beforeMatch cannot be used with starts");const n=Object.assign({},t);Object.keys(t).forEach(r=>{delete t[r]}),t.keywords=n.keywords,t.begin=vs(n.beforeMatch,gx(n.begin)),t.starts={relevance:0,contains:[Object.assign(n,{endsParent:!0})]},t.relevance=0,delete n.beforeMatch},XP=["of","and","for","in","not","or","if","then","parent","list","value"],YP="keyword";function Ex(t,e,n=YP){const r=Object.create(null);return typeof t=="string"?i(n,t.split(" ")):Array.isArray(t)?i(n,t):Object.keys(t).forEach(function(s){Object.assign(r,Ex(t[s],e,s))}),r;function i(s,o){e&&(o=o.map(a=>a.toLowerCase())),o.forEach(function(a){const l=a.split("|");r[l[0]]=[s,QP(l[0],l[1])]})}}function QP(t,e){return e?Number(e):ZP(t)?0:1}function ZP(t){return XP.includes(t.toLowerCase())}const Cb={},Qi=t=>{console.error(t)},kb=(t,...e)=>{console.log(`WARN: ${t}`,...e)},Os=(t,e)=>{Cb[`${t}/${e}`]||(console.log(`Deprecated as of ${t}. ${e}`),Cb[`${t}/${e}`]=!0)},Jc=new Error;function xx(t,e,{key:n}){let r=0;const i=t[n],s={},o={};for(let a=1;a<=e.length;a++)o[a+r]=i[a],s[a+r]=!0,r+=mx(e[a-1]);t[n]=o,t[n]._emit=s,t[n]._multi=!0}function eL(t){if(!!Array.isArray(t.begin)){if(t.skip||t.excludeBegin||t.returnBegin)throw Qi("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Jc;if(typeof t.beginScope!="object"||t.beginScope===null)throw Qi("beginScope must be object"),Jc;xx(t,t.begin,{key:"beginScope"}),t.begin=lg(t.begin,{joinWith:""})}}function tL(t){if(!!Array.isArray(t.end)){if(t.skip||t.excludeEnd||t.returnEnd)throw Qi("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Jc;if(typeof t.endScope!="object"||t.endScope===null)throw Qi("endScope must be object"),Jc;xx(t,t.end,{key:"endScope"}),t.end=lg(t.end,{joinWith:""})}}function nL(t){t.scope&&typeof t.scope=="object"&&t.scope!==null&&(t.beginScope=t.scope,delete t.scope)}function rL(t){nL(t),typeof t.beginScope=="string"&&(t.beginScope={_wrap:t.beginScope}),typeof t.endScope=="string"&&(t.endScope={_wrap:t.endScope}),eL(t),tL(t)}function iL(t){function e(o,a){return new RegExp(Va(o),"m"+(t.case_insensitive?"i":"")+(t.unicodeRegex?"u":"")+(a?"g":""))}class n{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=mx(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const a=this.regexes.map(l=>l[1]);this.matcherRe=e(lg(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;const l=this.matcherRe.exec(a);if(!l)return null;const c=l.findIndex((h,d)=>d>0&&h!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class r{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];const l=new n;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){const l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function i(o){const a=new r;return o.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),o.terminatorEnd&&a.addRule(o.terminatorEnd,{type:"end"}),o.illegal&&a.addRule(o.illegal,{type:"illegal"}),a}function s(o,a){const l=o;if(o.isCompiled)return l;[jP,WP,rL,JP].forEach(u=>u(o,a)),t.compilerExtensions.forEach(u=>u(o,a)),o.__beforeBegin=null,[KP,qP,GP].forEach(u=>u(o,a)),o.isCompiled=!0;let c=null;return typeof o.keywords=="object"&&o.keywords.$pattern&&(o.keywords=Object.assign({},o.keywords),c=o.keywords.$pattern,delete o.keywords.$pattern),c=c||/\w+/,o.keywords&&(o.keywords=Ex(o.keywords,t.case_insensitive)),l.keywordPatternRe=e(c,!0),a&&(o.begin||(o.begin=/\B|\b/),l.beginRe=e(l.begin),!o.end&&!o.endsWithParent&&(o.end=/\B|\b/),o.end&&(l.endRe=e(l.end)),l.terminatorEnd=Va(l.end)||"",o.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(o.end?"|":"")+a.terminatorEnd)),o.illegal&&(l.illegalRe=e(o.illegal)),o.contains||(o.contains=[]),o.contains=[].concat(...o.contains.map(function(u){return sL(u==="self"?o:u)})),o.contains.forEach(function(u){s(u,l)}),o.starts&&s(o.starts,a),l.matcher=i(l),l}if(t.compilerExtensions||(t.compilerExtensions=[]),t.contains&&t.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return t.classNameAliases=jr(t.classNameAliases||{}),s(t)}function Sx(t){return t?t.endsWithParent||Sx(t.starts):!1}function sL(t){return t.variants&&!t.cachedVariants&&(t.cachedVariants=t.variants.map(function(e){return jr(t,{variants:null},e)})),t.cachedVariants?t.cachedVariants:Sx(t)?jr(t,{starts:t.starts?jr(t.starts):null}):Object.isFrozen(t)?jr(t):t}var oL="11.6.0";class aL extends Error{constructor(e,n){super(e),this.name="HTMLInjectionError",this.html=n}}const pd=px,Ib=jr,Ab=Symbol("nomatch"),lL=7,cL=function(t){const e=Object.create(null),n=Object.create(null),r=[];let i=!0;const s="Could not find the language '{}', did you forget to load/include a language module?",o={disableAutodetect:!0,name:"Plain text",contains:[]};let a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:vP};function l(v){return a.noHighlightRe.test(v)}function c(v){let T=v.className+" ";T+=v.parentNode?v.parentNode.className:"";const O=a.languageDetectRe.exec(T);if(O){const W=J(O[1]);return W||(kb(s.replace("{}",O[1])),kb("Falling back to no-highlight mode for this block.",v)),W?O[1]:"no-highlight"}return T.split(/\s+/).find(W=>l(W)||J(W))}function u(v,T,O){let W="",ne="";typeof T=="object"?(W=v,O=T.ignoreIllegals,ne=T.language):(Os("10.7.0","highlight(lang, code, ...args) has been deprecated."),Os("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),ne=v,W=T),O===void 0&&(O=!0);const me={code:W,language:ne};Oe("before:highlight",me);const xe=me.result?me.result:h(me.language,me.code,O);return xe.code=me.code,Oe("after:highlight",xe),xe}function h(v,T,O,W){const ne=Object.create(null);function me(x,C){return x.keywords[C]}function xe(){if(!S.keywords){D.addText(A);return}let x=0;S.keywordPatternRe.lastIndex=0;let C=S.keywordPatternRe.exec(A),V="";for(;C;){V+=A.substring(x,C.index);const H=I.case_insensitive?C[0].toLowerCase():C[0],ce=me(S,H);if(ce){const[Ne,vn]=ce;if(D.addText(V),V="",ne[H]=(ne[H]||0)+1,ne[H]<=lL&&(F+=vn),Ne.startsWith("_"))V+=C[0];else{const _r=I.classNameAliases[Ne]||Ne;D.addKeyword(C[0],_r)}}else V+=C[0];x=S.keywordPatternRe.lastIndex,C=S.keywordPatternRe.exec(A)}V+=A.substring(x),D.addText(V)}function Qe(){if(A==="")return;let x=null;if(typeof S.subLanguage=="string"){if(!e[S.subLanguage]){D.addText(A);return}x=h(S.subLanguage,A,!0,G[S.subLanguage]),G[S.subLanguage]=x._top}else x=f(A,S.subLanguage.length?S.subLanguage:null);S.relevance>0&&(F+=x.relevance),D.addSublanguage(x._emitter,x.language)}function ke(){S.subLanguage!=null?Qe():xe(),A=""}function Pe(x,C){let V=1;const H=C.length-1;for(;V<=H;){if(!x._emit[V]){V++;continue}const ce=I.classNameAliases[x[V]]||x[V],Ne=C[V];ce?D.addKeyword(Ne,ce):(A=Ne,xe(),A=""),V++}}function je(x,C){return x.scope&&typeof x.scope=="string"&&D.openNode(I.classNameAliases[x.scope]||x.scope),x.beginScope&&(x.beginScope._wrap?(D.addKeyword(A,I.classNameAliases[x.beginScope._wrap]||x.beginScope._wrap),A=""):x.beginScope._multi&&(Pe(x.beginScope,C),A="")),S=Object.create(x,{parent:{value:S}}),S}function mt(x,C,V){let H=TP(x.endRe,V);if(H){if(x["on:end"]){const ce=new xb(x);x["on:end"](C,ce),ce.isMatchIgnored&&(H=!1)}if(H){for(;x.endsParent&&x.parent;)x=x.parent;return x}}if(x.endsWithParent)return mt(x.parent,C,V)}function kt(x){return S.matcher.regexIndex===0?(A+=x[0],1):(te=!0,0)}function yt(x){const C=x[0],V=x.rule,H=new xb(V),ce=[V.__beforeBegin,V["on:begin"]];for(const Ne of ce)if(!!Ne&&(Ne(x,H),H.isMatchIgnored))return kt(C);return V.skip?A+=C:(V.excludeBegin&&(A+=C),ke(),!V.returnBegin&&!V.excludeBegin&&(A=C)),je(V,x),V.returnBegin?0:C.length}function It(x){const C=x[0],V=T.substring(x.index),H=mt(S,x,V);if(!H)return Ab;const ce=S;S.endScope&&S.endScope._wrap?(ke(),D.addKeyword(C,S.endScope._wrap)):S.endScope&&S.endScope._multi?(ke(),Pe(S.endScope,x)):ce.skip?A+=C:(ce.returnEnd||ce.excludeEnd||(A+=C),ke(),ce.excludeEnd&&(A=C));do S.scope&&D.closeNode(),!S.skip&&!S.subLanguage&&(F+=S.relevance),S=S.parent;while(S!==H.parent);return H.starts&&je(H.starts,x),ce.returnEnd?0:C.length}function Qt(){const x=[];for(let C=S;C!==I;C=C.parent)C.scope&&x.unshift(C.scope);x.forEach(C=>D.openNode(C))}let b={};function E(x,C){const V=C&&C[0];if(A+=x,V==null)return ke(),0;if(b.type==="begin"&&C.type==="end"&&b.index===C.index&&V===""){if(A+=T.slice(C.index,C.index+1),!i){const H=new Error(`0 width match regex (${v})`);throw H.languageName=v,H.badRule=b.rule,H}return 1}if(b=C,C.type==="begin")return yt(C);if(C.type==="illegal"&&!O){const H=new Error('Illegal lexeme "'+V+'" for mode "'+(S.scope||"<unnamed>")+'"');throw H.mode=S,H}else if(C.type==="end"){const H=It(C);if(H!==Ab)return H}if(C.type==="illegal"&&V==="")return 1;if(Y>1e5&&Y>C.index*3)throw new Error("potential infinite loop, way more iterations than matches");return A+=V,V.length}const I=J(v);if(!I)throw Qi(s.replace("{}",v)),new Error('Unknown language: "'+v+'"');const $=iL(I);let B="",S=W||$;const G={},D=new a.__emitter(a);Qt();let A="",F=0,Q=0,Y=0,te=!1;try{for(S.matcher.considerAll();;){Y++,te?te=!1:S.matcher.considerAll(),S.matcher.lastIndex=Q;const x=S.matcher.exec(T);if(!x)break;const C=T.substring(Q,x.index),V=E(C,x);Q=x.index+V}return E(T.substring(Q)),D.closeAllNodes(),D.finalize(),B=D.toHTML(),{language:v,value:B,relevance:F,illegal:!1,_emitter:D,_top:S}}catch(x){if(x.message&&x.message.includes("Illegal"))return{language:v,value:pd(T),illegal:!0,relevance:0,_illegalBy:{message:x.message,index:Q,context:T.slice(Q-100,Q+100),mode:x.mode,resultSoFar:B},_emitter:D};if(i)return{language:v,value:pd(T),illegal:!1,relevance:0,errorRaised:x,_emitter:D,_top:S};throw x}}function d(v){const T={value:pd(v),illegal:!1,relevance:0,_top:o,_emitter:new a.__emitter(a)};return T._emitter.addText(v),T}function f(v,T){T=T||a.languages||Object.keys(e);const O=d(v),W=T.filter(J).filter(he).map(ke=>h(ke,v,!1));W.unshift(O);const ne=W.sort((ke,Pe)=>{if(ke.relevance!==Pe.relevance)return Pe.relevance-ke.relevance;if(ke.language&&Pe.language){if(J(ke.language).supersetOf===Pe.language)return 1;if(J(Pe.language).supersetOf===ke.language)return-1}return 0}),[me,xe]=ne,Qe=me;return Qe.secondBest=xe,Qe}function p(v,T,O){const W=T&&n[T]||O;v.classList.add("hljs"),v.classList.add(`language-${W}`)}function g(v){let T=null;const O=c(v);if(l(O))return;if(Oe("before:highlightElement",{el:v,language:O}),v.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(v)),a.throwUnescapedHTML))throw new aL("One of your code blocks includes unescaped HTML.",v.innerHTML);T=v;const W=T.textContent,ne=O?u(W,{language:O,ignoreIllegals:!0}):f(W);v.innerHTML=ne.value,p(v,O,ne.language),v.result={language:ne.language,re:ne.relevance,relevance:ne.relevance},ne.secondBest&&(v.secondBest={language:ne.secondBest.language,relevance:ne.secondBest.relevance}),Oe("after:highlightElement",{el:v,result:ne,text:W})}function m(v){a=Ib(a,v)}const w=()=>{y(),Os("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function _(){y(),Os("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let M=!1;function y(){if(document.readyState==="loading"){M=!0;return}document.querySelectorAll(a.cssSelector).forEach(g)}function L(){M&&y()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",L,!1);function R(v,T){let O=null;try{O=T(t)}catch(W){if(Qi("Language definition for '{}' could not be registered.".replace("{}",v)),i)Qi(W);else throw W;O=o}O.name||(O.name=v),e[v]=O,O.rawDefinition=T.bind(null,t),O.aliases&&ie(O.aliases,{languageName:v})}function j(v){delete e[v];for(const T of Object.keys(n))n[T]===v&&delete n[T]}function N(){return Object.keys(e)}function J(v){return v=(v||"").toLowerCase(),e[v]||e[n[v]]}function ie(v,{languageName:T}){typeof v=="string"&&(v=[v]),v.forEach(O=>{n[O.toLowerCase()]=T})}function he(v){const T=J(v);return T&&!T.disableAutodetect}function ve(v){v["before:highlightBlock"]&&!v["before:highlightElement"]&&(v["before:highlightElement"]=T=>{v["before:highlightBlock"](Object.assign({block:T.el},T))}),v["after:highlightBlock"]&&!v["after:highlightElement"]&&(v["after:highlightElement"]=T=>{v["after:highlightBlock"](Object.assign({block:T.el},T))})}function Ee(v){ve(v),r.push(v)}function Oe(v,T){const O=v;r.forEach(function(W){W[O]&&W[O](T)})}function ze(v){return Os("10.7.0","highlightBlock will be removed entirely in v12.0"),Os("10.7.0","Please use highlightElement now."),g(v)}Object.assign(t,{highlight:u,highlightAuto:f,highlightAll:y,highlightElement:g,highlightBlock:ze,configure:m,initHighlighting:w,initHighlightingOnLoad:_,registerLanguage:R,unregisterLanguage:j,listLanguages:N,getLanguage:J,registerAliases:ie,autoDetection:he,inherit:Ib,addPlugin:Ee}),t.debugMode=function(){i=!1},t.safeMode=function(){i=!0},t.versionString=oL,t.regex={concat:vs,lookahead:gx,either:ag,optional:xP,anyNumberOfTimes:EP};for(const v in Kl)typeof Kl[v]=="object"&&ig.exports(Kl[v]);return Object.assign(t,Kl),t};var Ua=cL({}),uL=Ua;Ua.HighlightJS=Ua;Ua.default=Ua;var hL=uL;function Tx(t,e=[]){return t.map(n=>{const r=[...e,...n.properties?n.properties.className:[]];return n.children?Tx(n.children,r):{text:n.value,classes:r}}).flat()}function _b(t){return t.value||t.children||[]}function dL(t){return Boolean(hL.getLanguage(t))}function Mb({doc:t,name:e,lowlight:n,defaultLanguage:r}){const i=[];return gf(t,s=>s.type.name===e).forEach(s=>{let o=s.pos+1;const a=s.node.attrs.language||r,l=n.listLanguages(),c=a&&(l.includes(a)||dL(a))?_b(n.highlight(a,s.node.textContent)):_b(n.highlightAuto(s.node.textContent));Tx(c).forEach(u=>{const h=o+u.text.length;if(u.classes.length){const d=Kt.inline(o,h,{class:u.classes.join(" ")});i.push(d)}o=h})}),et.create(t,i)}function fL(t){return typeof t=="function"}function pL({name:t,lowlight:e,defaultLanguage:n}){if(!["highlight","highlightAuto","listLanguages"].every(i=>fL(e[i])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");const r=new Tt({key:new un("lowlight"),state:{init:(i,{doc:s})=>Mb({doc:s,name:t,lowlight:e,defaultLanguage:n}),apply:(i,s,o,a)=>{const l=o.selection.$head.parent.type.name,c=a.selection.$head.parent.type.name,u=gf(o.doc,d=>d.type.name===t),h=gf(a.doc,d=>d.type.name===t);return i.docChanged&&([l,c].includes(t)||h.length!==u.length||i.steps.some(d=>d.from!==void 0&&d.to!==void 0&&u.some(f=>f.pos>=d.from&&f.pos+f.node.nodeSize<=d.to)))?Mb({doc:i.doc,name:t,lowlight:e,defaultLanguage:n}):s.map(i.mapping,i.doc)}},props:{decorations(i){return r.getState(i)}}});return r}const gL=lx.extend({addOptions(){var t;return{...(t=this.parent)===null||t===void 0?void 0:t.call(this),lowlight:{},defaultLanguage:null}},addProseMirrorPlugins(){var t;return[...((t=this.parent)===null||t===void 0?void 0:t.call(this))||[],pL({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),mL=t=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:t.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:t.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),yL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],bL=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],wL=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],vL=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],EL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function xL(t){const e=t.regex,n=mL(t),r={begin:/-(webkit|moz|ms|o)-(?=[a-z])/},i="and or not only",s=/@-?\w[\w]*(-\w+)*/,o="[a-zA-Z-][a-zA-Z0-9_-]*",a=[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE];return{name:"CSS",case_insensitive:!0,illegal:/[=|'\$]/,keywords:{keyframePosition:"from to"},classNameAliases:{keyframePosition:"selector-tag"},contains:[n.BLOCK_COMMENT,r,n.CSS_NUMBER_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/,relevance:0},{className:"selector-class",begin:"\\."+o,relevance:0},n.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",variants:[{begin:":("+wL.join("|")+")"},{begin:":(:)?("+vL.join("|")+")"}]},n.CSS_VARIABLE,{className:"attribute",begin:"\\b("+EL.join("|")+")\\b"},{begin:/:/,end:/[;}{]/,contains:[n.BLOCK_COMMENT,n.HEXCOLOR,n.IMPORTANT,n.CSS_NUMBER_MODE,...a,{begin:/(url|data-uri)\(/,end:/\)/,relevance:0,keywords:{built_in:"url data-uri"},contains:[...a,{className:"string",begin:/[^)]/,endsWithParent:!0,excludeEnd:!0}]},n.FUNCTION_DISPATCH]},{begin:e.lookahead(/@/),end:"[{;]",relevance:0,illegal:/:/,contains:[{className:"keyword",begin:s},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:{$pattern:/[a-z-]+/,keyword:i,attribute:bL.join(" ")},contains:[{begin:/[a-z-]+(?=:)/,className:"attribute"},...a,n.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"\\b("+yL.join("|")+")\\b"}]}}const Ob="[A-Za-z$_][0-9A-Za-z$_]*",SL=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],TL=["true","false","null","undefined","NaN","Infinity"],Cx=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],kx=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Ix=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],CL=["arguments","this","super","console","window","document","localStorage","module","global"],kL=[].concat(Ix,Cx,kx);function IL(t){const e=t.regex,n=(T,{after:O})=>{const W="</"+T[0].slice(1);return T.input.indexOf(W,O)!==-1},r=Ob,i={begin:"<>",end:"</>"},s=/<[A-Za-z0-9\\._:-]+\s*\/>/,o={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(T,O)=>{const W=T[0].length+T.index,ne=T.input[W];if(ne==="<"||ne===","){O.ignoreMatch();return}ne===">"&&(n(T,{after:W})||O.ignoreMatch());let me;if((me=T.input.substring(W).match(/^\s+extends\s+/))&&me.index===0){O.ignoreMatch();return}}},a={$pattern:Ob,keyword:SL,literal:TL,built_in:kL,"variable.language":CL},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",h={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},d={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},f={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"xml"}},p={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"css"}},g={className:"string",begin:"`",end:"`",contains:[t.BACKSLASH_ESCAPE,d]},m=t.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:r+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),w={className:"comment",variants:[m,t.C_BLOCK_COMMENT_MODE,t.C_LINE_COMMENT_MODE]},_=[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,h];d.contains=_.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(_)});const M=[].concat(w,d.contains),y=M.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(M)}]),L={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y},R={variants:[{match:[/class/,/\s+/,r,/\s+/,/extends/,/\s+/,e.concat(r,"(",e.concat(/\./,r),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,r],scope:{1:"keyword",3:"title.class"}}]},j={relevance:0,match:e.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...Cx,...kx]}},N={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},J={variants:[{match:[/function/,/\s+/,r,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[L],illegal:/%/},ie={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function he(T){return e.concat("(?!",T.join("|"),")")}const ve={match:e.concat(/\b/,he([...Ix,"super"]),r,e.lookahead(/\(/)),className:"title.function",relevance:0},Ee={begin:e.concat(/\./,e.lookahead(e.concat(r,/(?![0-9A-Za-z$_(])/))),end:r,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},Oe={match:[/get|set/,/\s+/,r,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},L]},ze="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+t.UNDERSCORE_IDENT_RE+")\\s*=>",v={match:[/const|var|let/,/\s+/,r,/\s*/,/=\s*/,/(async\s*)?/,e.lookahead(ze)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[L]};return{name:"Javascript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:y,CLASS_REFERENCE:j},illegal:/#(?![$_A-z])/,contains:[t.SHEBANG({label:"shebang",binary:"node",relevance:5}),N,t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,w,h,j,{className:"attr",begin:r+e.lookahead(":"),relevance:0},v,{begin:"("+t.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[w,t.REGEXP_MODE,{className:"function",begin:ze,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:t.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:i.begin,end:i.end},{match:s},{begin:o.begin,"on:begin":o.isTrulyOpeningTag,end:o.end}],subLanguage:"xml",contains:[{begin:o.begin,end:o.end,skip:!0,contains:["self"]}]}]},J,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+t.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[L,t.inherit(t.TITLE_MODE,{begin:r,className:"title.function"})]},{match:/\.\.\./,relevance:0},Ee,{match:"\\$"+r,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[L]},ve,ie,R,Oe,{match:/\$[(.]/}]}}const Xc="[A-Za-z$_][0-9A-Za-z$_]*",Ax=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],_x=["true","false","null","undefined","NaN","Infinity"],Mx=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],Ox=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],Nx=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],Dx=["arguments","this","super","console","window","document","localStorage","module","global"],Rx=[].concat(Nx,Mx,Ox);function AL(t){const e=t.regex,n=(T,{after:O})=>{const W="</"+T[0].slice(1);return T.input.indexOf(W,O)!==-1},r=Xc,i={begin:"<>",end:"</>"},s=/<[A-Za-z0-9\\._:-]+\s*\/>/,o={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(T,O)=>{const W=T[0].length+T.index,ne=T.input[W];if(ne==="<"||ne===","){O.ignoreMatch();return}ne===">"&&(n(T,{after:W})||O.ignoreMatch());let me;if((me=T.input.substring(W).match(/^\s+extends\s+/))&&me.index===0){O.ignoreMatch();return}}},a={$pattern:Xc,keyword:Ax,literal:_x,built_in:Rx,"variable.language":Dx},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",h={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},d={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},f={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"xml"}},p={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"css"}},g={className:"string",begin:"`",end:"`",contains:[t.BACKSLASH_ESCAPE,d]},m=t.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:r+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),w={className:"comment",variants:[m,t.C_BLOCK_COMMENT_MODE,t.C_LINE_COMMENT_MODE]},_=[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,h];d.contains=_.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(_)});const M=[].concat(w,d.contains),y=M.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(M)}]),L={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y},R={variants:[{match:[/class/,/\s+/,r,/\s+/,/extends/,/\s+/,e.concat(r,"(",e.concat(/\./,r),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,r],scope:{1:"keyword",3:"title.class"}}]},j={relevance:0,match:e.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...Mx,...Ox]}},N={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},J={variants:[{match:[/function/,/\s+/,r,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[L],illegal:/%/},ie={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function he(T){return e.concat("(?!",T.join("|"),")")}const ve={match:e.concat(/\b/,he([...Nx,"super"]),r,e.lookahead(/\(/)),className:"title.function",relevance:0},Ee={begin:e.concat(/\./,e.lookahead(e.concat(r,/(?![0-9A-Za-z$_(])/))),end:r,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},Oe={match:[/get|set/,/\s+/,r,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},L]},ze="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+t.UNDERSCORE_IDENT_RE+")\\s*=>",v={match:[/const|var|let/,/\s+/,r,/\s*/,/=\s*/,/(async\s*)?/,e.lookahead(ze)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[L]};return{name:"Javascript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:y,CLASS_REFERENCE:j},illegal:/#(?![$_A-z])/,contains:[t.SHEBANG({label:"shebang",binary:"node",relevance:5}),N,t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,w,h,j,{className:"attr",begin:r+e.lookahead(":"),relevance:0},v,{begin:"("+t.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[w,t.REGEXP_MODE,{className:"function",begin:ze,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:t.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:i.begin,end:i.end},{match:s},{begin:o.begin,"on:begin":o.isTrulyOpeningTag,end:o.end}],subLanguage:"xml",contains:[{begin:o.begin,end:o.end,skip:!0,contains:["self"]}]}]},J,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+t.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[L,t.inherit(t.TITLE_MODE,{begin:r,className:"title.function"})]},{match:/\.\.\./,relevance:0},Ee,{match:"\\$"+r,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[L]},ve,ie,R,Oe,{match:/\$[(.]/}]}}function _L(t){const e=AL(t),n=Xc,r=["any","void","number","boolean","string","object","never","symbol","bigint","unknown"],i={beginKeywords:"namespace",end:/\{/,excludeEnd:!0,contains:[e.exports.CLASS_REFERENCE]},s={beginKeywords:"interface",end:/\{/,excludeEnd:!0,keywords:{keyword:"interface extends",built_in:r},contains:[e.exports.CLASS_REFERENCE]},o={className:"meta",relevance:10,begin:/^\s*['"]use strict['"]/},a=["type","namespace","interface","public","private","protected","implements","declare","abstract","readonly","enum","override"],l={$pattern:Xc,keyword:Ax.concat(a),literal:_x,built_in:Rx.concat(r),"variable.language":Dx},c={className:"meta",begin:"@"+n},u=(d,f,p)=>{const g=d.contains.findIndex(m=>m.label===f);if(g===-1)throw new Error("can not find mode to replace");d.contains.splice(g,1,p)};Object.assign(e.keywords,l),e.exports.PARAMS_CONTAINS.push(c),e.contains=e.contains.concat([c,i,s]),u(e,"shebang",t.SHEBANG()),u(e,"use_strict",o);const h=e.contains.find(d=>d.label==="func.def");return h.relevance=0,Object.assign(e,{name:"TypeScript",aliases:["ts","tsx"]}),e}function ML(t){const e=t.regex,n=e.concat(/[\p{L}_]/u,e.optional(/[\p{L}0-9_.-]*:/u),/[\p{L}0-9_.-]*/u),r=/[\p{L}0-9._:-]+/u,i={className:"symbol",begin:/&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;/},s={begin:/\s/,contains:[{className:"keyword",begin:/#?[a-z_][a-z1-9_-]+/,illegal:/\n/}]},o=t.inherit(s,{begin:/\(/,end:/\)/}),a=t.inherit(t.APOS_STRING_MODE,{className:"string"}),l=t.inherit(t.QUOTE_STRING_MODE,{className:"string"}),c={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:r,relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[i]},{begin:/'/,end:/'/,contains:[i]},{begin:/[^\s"'=<>`]+/}]}]}]};return{name:"HTML, XML",aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,unicodeRegex:!0,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,relevance:10,contains:[s,l,a,o,{begin:/\[/,end:/\]/,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,contains:[s,o,l,a]}]}]},t.COMMENT(/<!--/,/-->/,{relevance:10}),{begin:/<!\[CDATA\[/,end:/\]\]>/,relevance:10},i,{className:"meta",end:/\?>/,variants:[{begin:/<\?xml/,relevance:10,contains:[l]},{begin:/<\?[a-z][a-z0-9]+/}]},{className:"tag",begin:/<style(?=\s|>)/,end:/>/,keywords:{name:"style"},contains:[c],starts:{end:/<\/style>/,returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:/<script(?=\s|>)/,end:/>/,keywords:{name:"script"},contains:[c],starts:{end:/<\/script>/,returnEnd:!0,subLanguage:["javascript","handlebars","xml"]}},{className:"tag",begin:/<>|<\/>/},{className:"tag",begin:e.concat(/</,e.lookahead(e.concat(n,e.either(/\/>/,/>/,/\s/)))),end:/\/?>/,contains:[{className:"name",begin:n,relevance:0,starts:c}]},{className:"tag",begin:e.concat(/<\//,e.lookahead(e.concat(n,/>/))),contains:[{className:"name",begin:n,relevance:0},{begin:/>/,relevance:0,endsParent:!0}]}]}}var ug={exports:{}};function hg(t){return t instanceof Map?t.clear=t.delete=t.set=function(){throw new Error("map is read-only")}:t instanceof Set&&(t.add=t.clear=t.delete=function(){throw new Error("set is read-only")}),Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];typeof n=="object"&&!Object.isFrozen(n)&&hg(n)}),t}ug.exports=hg;ug.exports.default=hg;class Nb{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function Px(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function Kr(t,...e){const n=Object.create(null);for(const r in t)n[r]=t[r];return e.forEach(function(r){for(const i in r)n[i]=r[i]}),n}const OL="</span>",Db=t=>!!t.scope||t.sublanguage&&t.language,NL=(t,{prefix:e})=>{if(t.includes(".")){const n=t.split(".");return[`${e}${n.shift()}`,...n.map((r,i)=>`${r}${"_".repeat(i+1)}`)].join(" ")}return`${e}${t}`};class DL{constructor(e,n){this.buffer="",this.classPrefix=n.classPrefix,e.walk(this)}addText(e){this.buffer+=Px(e)}openNode(e){if(!Db(e))return;let n="";e.sublanguage?n=`language-${e.language}`:n=NL(e.scope,{prefix:this.classPrefix}),this.span(n)}closeNode(e){!Db(e)||(this.buffer+=OL)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}const Rb=(t={})=>{const e={children:[]};return Object.assign(e,t),e};class dg{constructor(){this.rootNode=Rb(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const n=Rb({scope:e});this.add(n),this.stack.push(n)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,n){return typeof n=="string"?e.addText(n):n.children&&(e.openNode(n),n.children.forEach(r=>this._walk(e,r)),e.closeNode(n)),e}static _collapse(e){typeof e!="string"&&(!e.children||(e.children.every(n=>typeof n=="string")?e.children=[e.children.join("")]:e.children.forEach(n=>{dg._collapse(n)})))}}class RL extends dg{constructor(e){super(),this.options=e}addKeyword(e,n){e!==""&&(this.openNode(n),this.addText(e),this.closeNode())}addText(e){e!==""&&this.add(e)}addSublanguage(e,n){const r=e.root;r.sublanguage=!0,r.language=n,this.add(r)}toHTML(){return new DL(this,this.options).value()}finalize(){return!0}}function za(t){return t?typeof t=="string"?t:t.source:null}function Lx(t){return Es("(?=",t,")")}function PL(t){return Es("(?:",t,")*")}function LL(t){return Es("(?:",t,")?")}function Es(...t){return t.map(n=>za(n)).join("")}function BL(t){const e=t[t.length-1];return typeof e=="object"&&e.constructor===Object?(t.splice(t.length-1,1),e):{}}function fg(...t){const e=BL(t);return"("+(e.capture?"":"?:")+t.map(r=>za(r)).join("|")+")"}function Bx(t){return new RegExp(t.toString()+"|").exec("").length-1}function FL(t,e){const n=t&&t.exec(e);return n&&n.index===0}const VL=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function pg(t,{joinWith:e}){let n=0;return t.map(r=>{n+=1;const i=n;let s=za(r),o="";for(;s.length>0;){const a=VL.exec(s);if(!a){o+=s;break}o+=s.substring(0,a.index),s=s.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?o+="\\"+String(Number(a[1])+i):(o+=a[0],a[0]==="("&&n++)}return o}).map(r=>`(${r})`).join(e)}const $L=/\b\B/,Fx="[a-zA-Z]\\w*",gg="[a-zA-Z_]\\w*",Vx="\\b\\d+(\\.\\d+)?",$x="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",Ux="\\b(0b[01]+)",UL="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",zL=(t={})=>{const e=/^#![ ]*\//;return t.binary&&(t.begin=Es(e,/.*\b/,t.binary,/\b.*/)),Kr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(n,r)=>{n.index!==0&&r.ignoreMatch()}},t)},Ha={begin:"\\\\[\\s\\S]",relevance:0},HL={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Ha]},jL={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Ha]},KL={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},Gu=function(t,e,n={}){const r=Kr({scope:"comment",begin:t,end:e,contains:[]},n);r.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const i=fg("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return r.contains.push({begin:Es(/[ ]+/,"(",i,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),r},qL=Gu("//","$"),WL=Gu("/\\*","\\*/"),GL=Gu("#","$"),JL={scope:"number",begin:Vx,relevance:0},XL={scope:"number",begin:$x,relevance:0},YL={scope:"number",begin:Ux,relevance:0},QL={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[Ha,{begin:/\[/,end:/\]/,relevance:0,contains:[Ha]}]}]},ZL={scope:"title",begin:Fx,relevance:0},eB={scope:"title",begin:gg,relevance:0},tB={begin:"\\.\\s*"+gg,relevance:0},nB=function(t){return Object.assign(t,{"on:begin":(e,n)=>{n.data._beginMatch=e[1]},"on:end":(e,n)=>{n.data._beginMatch!==e[1]&&n.ignoreMatch()}})};var ql=Object.freeze({__proto__:null,MATCH_NOTHING_RE:$L,IDENT_RE:Fx,UNDERSCORE_IDENT_RE:gg,NUMBER_RE:Vx,C_NUMBER_RE:$x,BINARY_NUMBER_RE:Ux,RE_STARTERS_RE:UL,SHEBANG:zL,BACKSLASH_ESCAPE:Ha,APOS_STRING_MODE:HL,QUOTE_STRING_MODE:jL,PHRASAL_WORDS_MODE:KL,COMMENT:Gu,C_LINE_COMMENT_MODE:qL,C_BLOCK_COMMENT_MODE:WL,HASH_COMMENT_MODE:GL,NUMBER_MODE:JL,C_NUMBER_MODE:XL,BINARY_NUMBER_MODE:YL,REGEXP_MODE:QL,TITLE_MODE:ZL,UNDERSCORE_TITLE_MODE:eB,METHOD_GUARD:tB,END_SAME_AS_BEGIN:nB});function rB(t,e){t.input[t.index-1]==="."&&e.ignoreMatch()}function iB(t,e){t.className!==void 0&&(t.scope=t.className,delete t.className)}function sB(t,e){!e||!t.beginKeywords||(t.begin="\\b("+t.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",t.__beforeBegin=rB,t.keywords=t.keywords||t.beginKeywords,delete t.beginKeywords,t.relevance===void 0&&(t.relevance=0))}function oB(t,e){!Array.isArray(t.illegal)||(t.illegal=fg(...t.illegal))}function aB(t,e){if(!!t.match){if(t.begin||t.end)throw new Error("begin & end are not supported with match");t.begin=t.match,delete t.match}}function lB(t,e){t.relevance===void 0&&(t.relevance=1)}const cB=(t,e)=>{if(!t.beforeMatch)return;if(t.starts)throw new Error("beforeMatch cannot be used with starts");const n=Object.assign({},t);Object.keys(t).forEach(r=>{delete t[r]}),t.keywords=n.keywords,t.begin=Es(n.beforeMatch,Lx(n.begin)),t.starts={relevance:0,contains:[Object.assign(n,{endsParent:!0})]},t.relevance=0,delete n.beforeMatch},uB=["of","and","for","in","not","or","if","then","parent","list","value"],hB="keyword";function zx(t,e,n=hB){const r=Object.create(null);return typeof t=="string"?i(n,t.split(" ")):Array.isArray(t)?i(n,t):Object.keys(t).forEach(function(s){Object.assign(r,zx(t[s],e,s))}),r;function i(s,o){e&&(o=o.map(a=>a.toLowerCase())),o.forEach(function(a){const l=a.split("|");r[l[0]]=[s,dB(l[0],l[1])]})}}function dB(t,e){return e?Number(e):fB(t)?0:1}function fB(t){return uB.includes(t.toLowerCase())}const Pb={},Zi=t=>{console.error(t)},Lb=(t,...e)=>{console.log(`WARN: ${t}`,...e)},Ns=(t,e)=>{Pb[`${t}/${e}`]||(console.log(`Deprecated as of ${t}. ${e}`),Pb[`${t}/${e}`]=!0)},Yc=new Error;function Hx(t,e,{key:n}){let r=0;const i=t[n],s={},o={};for(let a=1;a<=e.length;a++)o[a+r]=i[a],s[a+r]=!0,r+=Bx(e[a-1]);t[n]=o,t[n]._emit=s,t[n]._multi=!0}function pB(t){if(!!Array.isArray(t.begin)){if(t.skip||t.excludeBegin||t.returnBegin)throw Zi("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Yc;if(typeof t.beginScope!="object"||t.beginScope===null)throw Zi("beginScope must be object"),Yc;Hx(t,t.begin,{key:"beginScope"}),t.begin=pg(t.begin,{joinWith:""})}}function gB(t){if(!!Array.isArray(t.end)){if(t.skip||t.excludeEnd||t.returnEnd)throw Zi("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Yc;if(typeof t.endScope!="object"||t.endScope===null)throw Zi("endScope must be object"),Yc;Hx(t,t.end,{key:"endScope"}),t.end=pg(t.end,{joinWith:""})}}function mB(t){t.scope&&typeof t.scope=="object"&&t.scope!==null&&(t.beginScope=t.scope,delete t.scope)}function yB(t){mB(t),typeof t.beginScope=="string"&&(t.beginScope={_wrap:t.beginScope}),typeof t.endScope=="string"&&(t.endScope={_wrap:t.endScope}),pB(t),gB(t)}function bB(t){function e(o,a){return new RegExp(za(o),"m"+(t.case_insensitive?"i":"")+(t.unicodeRegex?"u":"")+(a?"g":""))}class n{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=Bx(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const a=this.regexes.map(l=>l[1]);this.matcherRe=e(pg(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;const l=this.matcherRe.exec(a);if(!l)return null;const c=l.findIndex((h,d)=>d>0&&h!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class r{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];const l=new n;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){const l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function i(o){const a=new r;return o.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),o.terminatorEnd&&a.addRule(o.terminatorEnd,{type:"end"}),o.illegal&&a.addRule(o.illegal,{type:"illegal"}),a}function s(o,a){const l=o;if(o.isCompiled)return l;[iB,aB,yB,cB].forEach(u=>u(o,a)),t.compilerExtensions.forEach(u=>u(o,a)),o.__beforeBegin=null,[sB,oB,lB].forEach(u=>u(o,a)),o.isCompiled=!0;let c=null;return typeof o.keywords=="object"&&o.keywords.$pattern&&(o.keywords=Object.assign({},o.keywords),c=o.keywords.$pattern,delete o.keywords.$pattern),c=c||/\w+/,o.keywords&&(o.keywords=zx(o.keywords,t.case_insensitive)),l.keywordPatternRe=e(c,!0),a&&(o.begin||(o.begin=/\B|\b/),l.beginRe=e(l.begin),!o.end&&!o.endsWithParent&&(o.end=/\B|\b/),o.end&&(l.endRe=e(l.end)),l.terminatorEnd=za(l.end)||"",o.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(o.end?"|":"")+a.terminatorEnd)),o.illegal&&(l.illegalRe=e(o.illegal)),o.contains||(o.contains=[]),o.contains=[].concat(...o.contains.map(function(u){return wB(u==="self"?o:u)})),o.contains.forEach(function(u){s(u,l)}),o.starts&&s(o.starts,a),l.matcher=i(l),l}if(t.compilerExtensions||(t.compilerExtensions=[]),t.contains&&t.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return t.classNameAliases=Kr(t.classNameAliases||{}),s(t)}function jx(t){return t?t.endsWithParent||jx(t.starts):!1}function wB(t){return t.variants&&!t.cachedVariants&&(t.cachedVariants=t.variants.map(function(e){return Kr(t,{variants:null},e)})),t.cachedVariants?t.cachedVariants:jx(t)?Kr(t,{starts:t.starts?Kr(t.starts):null}):Object.isFrozen(t)?Kr(t):t}var vB="11.6.0";class EB extends Error{constructor(e,n){super(e),this.name="HTMLInjectionError",this.html=n}}const gd=Px,Bb=Kr,Fb=Symbol("nomatch"),xB=7,SB=function(t){const e=Object.create(null),n=Object.create(null),r=[];let i=!0;const s="Could not find the language '{}', did you forget to load/include a language module?",o={disableAutodetect:!0,name:"Plain text",contains:[]};let a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:RL};function l(v){return a.noHighlightRe.test(v)}function c(v){let T=v.className+" ";T+=v.parentNode?v.parentNode.className:"";const O=a.languageDetectRe.exec(T);if(O){const W=J(O[1]);return W||(Lb(s.replace("{}",O[1])),Lb("Falling back to no-highlight mode for this block.",v)),W?O[1]:"no-highlight"}return T.split(/\s+/).find(W=>l(W)||J(W))}function u(v,T,O){let W="",ne="";typeof T=="object"?(W=v,O=T.ignoreIllegals,ne=T.language):(Ns("10.7.0","highlight(lang, code, ...args) has been deprecated."),Ns("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),ne=v,W=T),O===void 0&&(O=!0);const me={code:W,language:ne};Oe("before:highlight",me);const xe=me.result?me.result:h(me.language,me.code,O);return xe.code=me.code,Oe("after:highlight",xe),xe}function h(v,T,O,W){const ne=Object.create(null);function me(x,C){return x.keywords[C]}function xe(){if(!S.keywords){D.addText(A);return}let x=0;S.keywordPatternRe.lastIndex=0;let C=S.keywordPatternRe.exec(A),V="";for(;C;){V+=A.substring(x,C.index);const H=I.case_insensitive?C[0].toLowerCase():C[0],ce=me(S,H);if(ce){const[Ne,vn]=ce;if(D.addText(V),V="",ne[H]=(ne[H]||0)+1,ne[H]<=xB&&(F+=vn),Ne.startsWith("_"))V+=C[0];else{const _r=I.classNameAliases[Ne]||Ne;D.addKeyword(C[0],_r)}}else V+=C[0];x=S.keywordPatternRe.lastIndex,C=S.keywordPatternRe.exec(A)}V+=A.substring(x),D.addText(V)}function Qe(){if(A==="")return;let x=null;if(typeof S.subLanguage=="string"){if(!e[S.subLanguage]){D.addText(A);return}x=h(S.subLanguage,A,!0,G[S.subLanguage]),G[S.subLanguage]=x._top}else x=f(A,S.subLanguage.length?S.subLanguage:null);S.relevance>0&&(F+=x.relevance),D.addSublanguage(x._emitter,x.language)}function ke(){S.subLanguage!=null?Qe():xe(),A=""}function Pe(x,C){let V=1;const H=C.length-1;for(;V<=H;){if(!x._emit[V]){V++;continue}const ce=I.classNameAliases[x[V]]||x[V],Ne=C[V];ce?D.addKeyword(Ne,ce):(A=Ne,xe(),A=""),V++}}function je(x,C){return x.scope&&typeof x.scope=="string"&&D.openNode(I.classNameAliases[x.scope]||x.scope),x.beginScope&&(x.beginScope._wrap?(D.addKeyword(A,I.classNameAliases[x.beginScope._wrap]||x.beginScope._wrap),A=""):x.beginScope._multi&&(Pe(x.beginScope,C),A="")),S=Object.create(x,{parent:{value:S}}),S}function mt(x,C,V){let H=FL(x.endRe,V);if(H){if(x["on:end"]){const ce=new Nb(x);x["on:end"](C,ce),ce.isMatchIgnored&&(H=!1)}if(H){for(;x.endsParent&&x.parent;)x=x.parent;return x}}if(x.endsWithParent)return mt(x.parent,C,V)}function kt(x){return S.matcher.regexIndex===0?(A+=x[0],1):(te=!0,0)}function yt(x){const C=x[0],V=x.rule,H=new Nb(V),ce=[V.__beforeBegin,V["on:begin"]];for(const Ne of ce)if(!!Ne&&(Ne(x,H),H.isMatchIgnored))return kt(C);return V.skip?A+=C:(V.excludeBegin&&(A+=C),ke(),!V.returnBegin&&!V.excludeBegin&&(A=C)),je(V,x),V.returnBegin?0:C.length}function It(x){const C=x[0],V=T.substring(x.index),H=mt(S,x,V);if(!H)return Fb;const ce=S;S.endScope&&S.endScope._wrap?(ke(),D.addKeyword(C,S.endScope._wrap)):S.endScope&&S.endScope._multi?(ke(),Pe(S.endScope,x)):ce.skip?A+=C:(ce.returnEnd||ce.excludeEnd||(A+=C),ke(),ce.excludeEnd&&(A=C));do S.scope&&D.closeNode(),!S.skip&&!S.subLanguage&&(F+=S.relevance),S=S.parent;while(S!==H.parent);return H.starts&&je(H.starts,x),ce.returnEnd?0:C.length}function Qt(){const x=[];for(let C=S;C!==I;C=C.parent)C.scope&&x.unshift(C.scope);x.forEach(C=>D.openNode(C))}let b={};function E(x,C){const V=C&&C[0];if(A+=x,V==null)return ke(),0;if(b.type==="begin"&&C.type==="end"&&b.index===C.index&&V===""){if(A+=T.slice(C.index,C.index+1),!i){const H=new Error(`0 width match regex (${v})`);throw H.languageName=v,H.badRule=b.rule,H}return 1}if(b=C,C.type==="begin")return yt(C);if(C.type==="illegal"&&!O){const H=new Error('Illegal lexeme "'+V+'" for mode "'+(S.scope||"<unnamed>")+'"');throw H.mode=S,H}else if(C.type==="end"){const H=It(C);if(H!==Fb)return H}if(C.type==="illegal"&&V==="")return 1;if(Y>1e5&&Y>C.index*3)throw new Error("potential infinite loop, way more iterations than matches");return A+=V,V.length}const I=J(v);if(!I)throw Zi(s.replace("{}",v)),new Error('Unknown language: "'+v+'"');const $=bB(I);let B="",S=W||$;const G={},D=new a.__emitter(a);Qt();let A="",F=0,Q=0,Y=0,te=!1;try{for(S.matcher.considerAll();;){Y++,te?te=!1:S.matcher.considerAll(),S.matcher.lastIndex=Q;const x=S.matcher.exec(T);if(!x)break;const C=T.substring(Q,x.index),V=E(C,x);Q=x.index+V}return E(T.substring(Q)),D.closeAllNodes(),D.finalize(),B=D.toHTML(),{language:v,value:B,relevance:F,illegal:!1,_emitter:D,_top:S}}catch(x){if(x.message&&x.message.includes("Illegal"))return{language:v,value:gd(T),illegal:!0,relevance:0,_illegalBy:{message:x.message,index:Q,context:T.slice(Q-100,Q+100),mode:x.mode,resultSoFar:B},_emitter:D};if(i)return{language:v,value:gd(T),illegal:!1,relevance:0,errorRaised:x,_emitter:D,_top:S};throw x}}function d(v){const T={value:gd(v),illegal:!1,relevance:0,_top:o,_emitter:new a.__emitter(a)};return T._emitter.addText(v),T}function f(v,T){T=T||a.languages||Object.keys(e);const O=d(v),W=T.filter(J).filter(he).map(ke=>h(ke,v,!1));W.unshift(O);const ne=W.sort((ke,Pe)=>{if(ke.relevance!==Pe.relevance)return Pe.relevance-ke.relevance;if(ke.language&&Pe.language){if(J(ke.language).supersetOf===Pe.language)return 1;if(J(Pe.language).supersetOf===ke.language)return-1}return 0}),[me,xe]=ne,Qe=me;return Qe.secondBest=xe,Qe}function p(v,T,O){const W=T&&n[T]||O;v.classList.add("hljs"),v.classList.add(`language-${W}`)}function g(v){let T=null;const O=c(v);if(l(O))return;if(Oe("before:highlightElement",{el:v,language:O}),v.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(v)),a.throwUnescapedHTML))throw new EB("One of your code blocks includes unescaped HTML.",v.innerHTML);T=v;const W=T.textContent,ne=O?u(W,{language:O,ignoreIllegals:!0}):f(W);v.innerHTML=ne.value,p(v,O,ne.language),v.result={language:ne.language,re:ne.relevance,relevance:ne.relevance},ne.secondBest&&(v.secondBest={language:ne.secondBest.language,relevance:ne.secondBest.relevance}),Oe("after:highlightElement",{el:v,result:ne,text:W})}function m(v){a=Bb(a,v)}const w=()=>{y(),Ns("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function _(){y(),Ns("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let M=!1;function y(){if(document.readyState==="loading"){M=!0;return}document.querySelectorAll(a.cssSelector).forEach(g)}function L(){M&&y()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",L,!1);function R(v,T){let O=null;try{O=T(t)}catch(W){if(Zi("Language definition for '{}' could not be registered.".replace("{}",v)),i)Zi(W);else throw W;O=o}O.name||(O.name=v),e[v]=O,O.rawDefinition=T.bind(null,t),O.aliases&&ie(O.aliases,{languageName:v})}function j(v){delete e[v];for(const T of Object.keys(n))n[T]===v&&delete n[T]}function N(){return Object.keys(e)}function J(v){return v=(v||"").toLowerCase(),e[v]||e[n[v]]}function ie(v,{languageName:T}){typeof v=="string"&&(v=[v]),v.forEach(O=>{n[O.toLowerCase()]=T})}function he(v){const T=J(v);return T&&!T.disableAutodetect}function ve(v){v["before:highlightBlock"]&&!v["before:highlightElement"]&&(v["before:highlightElement"]=T=>{v["before:highlightBlock"](Object.assign({block:T.el},T))}),v["after:highlightBlock"]&&!v["after:highlightElement"]&&(v["after:highlightElement"]=T=>{v["after:highlightBlock"](Object.assign({block:T.el},T))})}function Ee(v){ve(v),r.push(v)}function Oe(v,T){const O=v;r.forEach(function(W){W[O]&&W[O](T)})}function ze(v){return Ns("10.7.0","highlightBlock will be removed entirely in v12.0"),Ns("10.7.0","Please use highlightElement now."),g(v)}Object.assign(t,{highlight:u,highlightAuto:f,highlightAll:y,highlightElement:g,highlightBlock:ze,configure:m,initHighlighting:w,initHighlightingOnLoad:_,registerLanguage:R,unregisterLanguage:j,listLanguages:N,getLanguage:J,registerAliases:ie,autoDetection:he,inherit:Bb,addPlugin:Ee}),t.debugMode=function(){i=!1},t.safeMode=function(){i=!0},t.versionString=vB,t.regex={concat:Es,lookahead:Lx,either:fg,optional:LL,anyNumberOfTimes:PL};for(const v in ql)typeof ql[v]=="object"&&ug.exports(ql[v]);return Object.assign(t,ql),t};var ja=SB({}),TB=ja;ja.HighlightJS=ja;ja.default=ja;const $n=TB;var Kx={exports:{}};(function(t){(function(){var e;e=t.exports=i,e.format=i,e.vsprintf=r,typeof console<"u"&&typeof console.log=="function"&&(e.printf=n);function n(){console.log(i.apply(null,arguments))}function r(s,o){return i.apply(null,[s].concat(o))}function i(s){for(var o=1,a=[].slice.call(arguments),l=0,c=s.length,u="",h,d=!1,f,p,g=!1,m,w=function(){return a[o++]},_=function(){for(var M="";/\d/.test(s[l]);)M+=s[l++],h=s[l];return M.length>0?parseInt(M):null};l<c;++l)if(h=s[l],d)switch(d=!1,h=="."?(g=!1,h=s[++l]):h=="0"&&s[l+1]=="."?(g=!0,l+=2,h=s[l]):g=!0,m=_(),h){case"b":u+=parseInt(w(),10).toString(2);break;case"c":f=w(),typeof f=="string"||f instanceof String?u+=f:u+=String.fromCharCode(parseInt(f,10));break;case"d":u+=parseInt(w(),10);break;case"f":p=String(parseFloat(w()).toFixed(m||6)),u+=g?p:p.replace(/^0/,"");break;case"j":u+=JSON.stringify(w());break;case"o":u+="0"+parseInt(w(),10).toString(8);break;case"s":u+=w();break;case"x":u+="0x"+parseInt(w(),10).toString(16);break;case"X":u+="0x"+parseInt(w(),10).toString(16).toUpperCase();break;default:u+=h;break}else h==="%"?d=!0:u+=h;return u}})()})(Kx);const CB=Kx.exports,bc=Object.assign(Si(Error),{eval:Si(EvalError),range:Si(RangeError),reference:Si(ReferenceError),syntax:Si(SyntaxError),type:Si(TypeError),uri:Si(URIError)});function Si(t){return e.displayName=t.displayName||t.name,e;function e(n,...r){const i=n&&CB(n,...r);return new t(i)}}const kB={}.hasOwnProperty,IB="hljs-";function qx(t,e,n={}){let r=n.prefix;if(typeof t!="string")throw bc("Expected `string` for name, got `%s`",t);if(!$n.getLanguage(t))throw bc("Unknown language: `%s` is not registered",t);if(typeof e!="string")throw bc("Expected `string` for value, got `%s`",e);r==null&&(r=IB),$n.configure({__emitter:DB,classPrefix:r});const i=$n.highlight(e,{language:t,ignoreIllegals:!0});if($n.configure({}),i.errorRaised)throw i.errorRaised;return i._emitter.root.data.language=i.language,i._emitter.root.data.relevance=i.relevance,i._emitter.root}function AB(t,e={}){const n=e.subset||$n.listLanguages();e.prefix;let r=-1,i={type:"root",data:{language:null,relevance:0},children:[]};if(typeof t!="string")throw bc("Expected `string` for value, got `%s`",t);for(;++r<n.length;){const s=n[r];if(!$n.getLanguage(s))continue;const o=qx(s,t,e);o.data.relevance>i.data.relevance&&(i=o)}return i}function _B(t,e){$n.registerLanguage(t,e)}const MB=function(t,e){if(typeof t=="string")$n.registerAliases(e,{languageName:t});else{let n;for(n in t)kB.call(t,n)&&$n.registerAliases(t[n],{languageName:n})}};function OB(t){return Boolean($n.getLanguage(t))}function NB(){return $n.listLanguages()}class DB{constructor(e){this.options=e,this.root={type:"root",data:{language:null,relevance:0},children:[]},this.stack=[this.root]}addText(e){if(e==="")return;const n=this.stack[this.stack.length-1],r=n.children[n.children.length-1];r&&r.type==="text"?r.value+=e:n.children.push({type:"text",value:e})}addKeyword(e,n){this.openNode(n),this.addText(e),this.closeNode()}addSublanguage(e,n){const r=this.stack[this.stack.length-1],i=e.root.children;n?r.children.push({type:"element",tagName:"span",properties:{className:[n]},children:i}):r.children.push(...i)}openNode(e){const n=e.split(".").map((s,o)=>o?s+"_".repeat(o):this.options.classPrefix+s),r=this.stack[this.stack.length-1],i={type:"element",tagName:"span",properties:{className:n},children:[]};r.children.push(i),this.stack.push(i)}closeNode(){this.stack.pop()}closeAllNodes(){}finalize(){}toHTML(){return""}}const pl={highlight:qx,highlightAuto:AB,registerLanguage:_B,registered:OB,listLanguages:NB,registerAlias:MB};let xf,Sf;if(typeof WeakMap<"u"){let t=new WeakMap;xf=e=>t.get(e),Sf=(e,n)=>(t.set(e,n),n)}else{let t=[],e=10,n=0;xf=r=>{for(let i=0;i<t.length;i+=2)if(t[i]==r)return t[i+1]},Sf=(r,i)=>(n==e&&(n=0),t[n++]=r,t[n++]=i)}class wo{constructor(e,n,r,i){this.left=e,this.top=n,this.right=r,this.bottom=i}}class Xe{constructor(e,n,r,i){this.width=e,this.height=n,this.map=r,this.problems=i}findCell(e){for(let n=0;n<this.map.length;n++){let r=this.map[n];if(r!=e)continue;let i=n%this.width,s=n/this.width|0,o=i+1,a=s+1;for(let l=1;o<this.width&&this.map[n+l]==r;l++)o++;for(let l=1;a<this.height&&this.map[n+this.width*l]==r;l++)a++;return new wo(i,s,o,a)}throw new RangeError("No cell with offset "+e+" found")}colCount(e){for(let n=0;n<this.map.length;n++)if(this.map[n]==e)return n%this.width;throw new RangeError("No cell with offset "+e+" found")}nextCell(e,n,r){let{left:i,right:s,top:o,bottom:a}=this.findCell(e);return n=="horiz"?(r<0?i==0:s==this.width)?null:this.map[o*this.width+(r<0?i-1:s)]:(r<0?o==0:a==this.height)?null:this.map[i+this.width*(r<0?o-1:a)]}rectBetween(e,n){let{left:r,right:i,top:s,bottom:o}=this.findCell(e),{left:a,right:l,top:c,bottom:u}=this.findCell(n);return new wo(Math.min(r,a),Math.min(s,c),Math.max(i,l),Math.max(o,u))}cellsInRect(e){let n=[],r={};for(let i=e.top;i<e.bottom;i++)for(let s=e.left;s<e.right;s++){let o=i*this.width+s,a=this.map[o];r[a]||(r[a]=!0,(s!=e.left||!s||this.map[o-1]!=a)&&(i!=e.top||!i||this.map[o-this.width]!=a)&&n.push(a))}return n}positionAt(e,n,r){for(let i=0,s=0;;i++){let o=s+r.child(i).nodeSize;if(i==e){let a=n+e*this.width,l=(e+1)*this.width;for(;a<l&&this.map[a]<s;)a++;return a==l?o-1:this.map[a]}s=o}}static get(e){return xf(e)||Sf(e,RB(e))}}function RB(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);let e=PB(t),n=t.childCount,r=[],i=0,s=null,o=[];for(let c=0,u=e*n;c<u;c++)r[c]=0;for(let c=0,u=0;c<n;c++){let h=t.child(c);u++;for(let p=0;;p++){for(;i<r.length&&r[i]!=0;)i++;if(p==h.childCount)break;let g=h.child(p),{colspan:m,rowspan:w,colwidth:_}=g.attrs;for(let M=0;M<w;M++){if(M+c>=n){(s||(s=[])).push({type:"overlong_rowspan",pos:u,n:w-M});break}let y=i+M*e;for(let L=0;L<m;L++){r[y+L]==0?r[y+L]=u:(s||(s=[])).push({type:"collision",row:c,pos:u,n:m-L});let R=_&&_[L];if(R){let j=(y+L)%e*2,N=o[j];N==null||N!=R&&o[j+1]==1?(o[j]=R,o[j+1]=1):N==R&&o[j+1]++}}}i+=m,u+=g.nodeSize}let d=(c+1)*e,f=0;for(;i<d;)r[i++]==0&&f++;f&&(s||(s=[])).push({type:"missing",row:c,n:f}),u++}let a=new Xe(e,n,r,s),l=!1;for(let c=0;!l&&c<o.length;c+=2)o[c]!=null&&o[c+1]<n&&(l=!0);return l&&LB(a,o,t),a}function PB(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){let i=t.child(r),s=0;if(n)for(let o=0;o<r;o++){let a=t.child(o);for(let l=0;l<a.childCount;l++){let c=a.child(l);o+c.attrs.rowspan>r&&(s+=c.attrs.colspan)}}for(let o=0;o<i.childCount;o++){let a=i.child(o);s+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}e==-1?e=s:e!=s&&(e=Math.max(e,s))}return e}function LB(t,e,n){t.problems||(t.problems=[]);for(let r=0,i={};r<t.map.length;r++){let s=t.map[r];if(i[s])continue;i[s]=!0;let o=n.nodeAt(s),a=null;for(let l=0;l<o.attrs.colspan;l++){let c=(r+l)%t.width,u=e[c*2];u!=null&&(!o.attrs.colwidth||o.attrs.colwidth[l]!=u)&&((a||(a=BB(o.attrs)))[l]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:s,colwidth:a})}}function BB(t){if(t.colwidth)return t.colwidth.slice();let e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function Vt(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(let n in t.nodes){let r=t.nodes[n],i=r.spec.tableRole;i&&(e[i]=r)}}return e}const Fr=new un("selectingCells");function Ro(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function FB(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function Gn(t){let e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function Ju(t){let e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&e.node.type.spec.tableRole=="cell"?e.$anchor:Ro(e.$head)||VB(e.$head)}function VB(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){let r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){let r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function Tf(t){return t.parent.type.spec.tableRole=="row"&&t.nodeAfter}function $B(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function mg(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Wx(t,e,n){let r=t.start(-1),s=Xe.get(t.node(-1)).nextCell(t.pos-r,e,n);return s==null?null:t.node(0).resolve(r+s)}function ht(t,e,n){let r={};for(let i in t)r[i]=t[i];return r[e]=n,r}function cs(t,e,n=1){let r=ht(t,"colspan",t.colspan-n);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(i=>i>0)||(r.colwidth=null)),r}function Gx(t,e,n=1){let r=ht(t,"colspan",t.colspan+n);if(r.colwidth){r.colwidth=r.colwidth.slice();for(let i=0;i<n;i++)r.colwidth.splice(e,0,0)}return r}function UB(t,e,n){let r=Vt(e.type.schema).header_cell;for(let i=0;i<t.height;i++)if(e.nodeAt(t.map[n+i*t.width]).type!=r)return!1;return!0}class Ae extends ue{constructor(e,n=e){let r=e.node(-1),i=Xe.get(r),s=e.start(-1),o=i.rectBetween(e.pos-s,n.pos-s),a=e.node(0),l=i.cellsInRect(o).filter(u=>u!=n.pos-s);l.unshift(n.pos-s);let c=l.map(u=>{let h=r.nodeAt(u),d=u+s+1;return new K0(a.resolve(d),a.resolve(d+h.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){let r=e.resolve(n.map(this.$anchorCell.pos)),i=e.resolve(n.map(this.$headCell.pos));if(Tf(r)&&Tf(i)&&mg(r,i)){let s=this.$anchorCell.node(-1)!=r.node(-1);return s&&this.isRowSelection()?Ae.rowSelection(r,i):s&&this.isColSelection()?Ae.colSelection(r,i):new Ae(r,i)}return pe.between(r,i)}content(){let e=this.$anchorCell.node(-1),n=Xe.get(e),r=this.$anchorCell.start(-1),i=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),s={},o=[];for(let l=i.top;l<i.bottom;l++){let c=[];for(let u=l*n.width+i.left,h=i.left;h<i.right;h++,u++){let d=n.map[u];if(!s[d]){s[d]=!0;let f=n.findCell(d),p=e.nodeAt(d),g=i.left-f.left,m=f.right-i.right;if(g>0||m>0){let w=p.attrs;g>0&&(w=cs(w,0,g)),m>0&&(w=cs(w,w.colspan-m,m)),f.left<i.left?p=p.type.createAndFill(w):p=p.type.create(w,p.content)}if(f.top<i.top||f.bottom>i.bottom){let w=ht(p.attrs,"rowspan",Math.min(f.bottom,i.bottom)-Math.max(f.top,i.top));f.top<i.top?p=p.type.createAndFill(w):p=p.type.create(w,p.content)}c.push(p)}}o.push(e.child(l).copy(z.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:o;return new X(z.from(a),1,1)}replace(e,n=X.empty){let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:a,$to:l}=i[o],c=e.mapping.slice(r);e.replace(c.map(a.pos),c.map(l.pos),o?X.empty:n)}let s=ue.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);s&&e.setSelection(s)}replaceWith(e,n){this.replace(e,new X(z.from(n),0,0))}forEachCell(e){let n=this.$anchorCell.node(-1),r=Xe.get(n),i=this.$anchorCell.start(-1),s=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i));for(let o=0;o<s.length;o++)e(n.nodeAt(s[o]),i+s[o])}isColSelection(){let e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;let r=e+this.$anchorCell.nodeAfter.attrs.rowspan,i=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,i)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){let r=Xe.get(e.node(-1)),i=e.start(-1),s=r.findCell(e.pos-i),o=r.findCell(n.pos-i),a=e.node(0);return s.top<=o.top?(s.top>0&&(e=a.resolve(i+r.map[s.left])),o.bottom<r.height&&(n=a.resolve(i+r.map[r.width*(r.height-1)+o.right-1]))):(o.top>0&&(n=a.resolve(i+r.map[o.left])),s.bottom<r.height&&(e=a.resolve(i+r.map[r.width*(r.height-1)+s.right-1]))),new Ae(e,n)}isRowSelection(){let e=Xe.get(this.$anchorCell.node(-1)),n=this.$anchorCell.start(-1),r=e.colCount(this.$anchorCell.pos-n),i=e.colCount(this.$headCell.pos-n);if(Math.min(r,i)>0)return!1;let s=r+this.$anchorCell.nodeAfter.attrs.colspan,o=i+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,o)==e.width}eq(e){return e instanceof Ae&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){let r=Xe.get(e.node(-1)),i=e.start(-1),s=r.findCell(e.pos-i),o=r.findCell(n.pos-i),a=e.node(0);return s.left<=o.left?(s.left>0&&(e=a.resolve(i+r.map[s.top*r.width])),o.right<r.width&&(n=a.resolve(i+r.map[r.width*(o.top+1)-1]))):(o.left>0&&(n=a.resolve(i+r.map[o.top*r.width])),s.right<r.width&&(e=a.resolve(i+r.map[r.width*(s.top+1)-1]))),new Ae(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new Ae(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new Ae(e.resolve(n),e.resolve(r))}getBookmark(){return new yg(this.$anchorCell.pos,this.$headCell.pos)}}Ae.prototype.visible=!1;ue.jsonID("cell",Ae);class yg{constructor(e,n){this.anchor=e,this.head=n}map(e){return new yg(e.map(this.anchor),e.map(this.head))}resolve(e){let n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&mg(n,r)?new Ae(n,r):ue.near(r,1)}}function zB(t){if(!(t.selection instanceof Ae))return null;let e=[];return t.selection.forEachCell((n,r)=>{e.push(Kt.node(r,r+n.nodeSize,{class:"selectedCell"}))}),et.create(t.doc,e)}function HB({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let n=t.pos,r=e.pos,i=t.depth;for(;i>=0&&!(t.after(i+1)<t.end(i));i--,n++);for(let s=e.depth;s>=0&&!(e.before(s+1)>e.start(s));s--,r--);return n==r&&/row|table/.test(t.node(i).type.spec.tableRole)}function jB({$from:t,$to:e}){let n,r;for(let i=t.depth;i>0;i--){let s=t.node(i);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){n=s;break}}for(let i=e.depth;i>0;i--){let s=e.node(i);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){r=s;break}}return n!==r&&e.parentOffset===0}function KB(t,e,n){let r=(e||t).selection,i=(e||t).doc,s,o;if(r instanceof fe&&(o=r.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")s=Ae.create(i,r.from);else if(o=="row"){let a=i.resolve(r.from+1);s=Ae.rowSelection(a,a)}else if(!n){let a=Xe.get(r.node),l=r.from+1,c=l+a.map[a.width*a.height-1];s=Ae.create(i,l+1,c)}}else r instanceof pe&&HB(r)?s=pe.create(i,r.from):r instanceof pe&&jB(r)&&(s=pe.create(i,r.$from.start(),r.$from.end()));return s&&(e||(e=t.tr)).setSelection(s),e}function qB(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:r}=t;for(;e.childCount==1&&(n>0&&r>0||e.firstChild.type.spec.tableRole=="table");)n--,r--,e=e.firstChild.content;let i=e.firstChild,s=i.type.spec.tableRole,o=i.type.schema,a=[];if(s=="row")for(let l=0;l<e.childCount;l++){let c=e.child(l).content,u=l?0:Math.max(0,n-1),h=l<e.childCount-1?0:Math.max(0,r-1);(u||h)&&(c=Cf(Vt(o).row,new X(c,u,h)).content),a.push(c)}else if(s=="cell"||s=="header_cell")a.push(n||r?Cf(Vt(o).row,new X(e,n,r)).content:e);else return null;return WB(o,a)}function WB(t,e){let n=[];for(let i=0;i<e.length;i++){let s=e[i];for(let o=s.childCount-1;o>=0;o--){let{rowspan:a,colspan:l}=s.child(o).attrs;for(let c=i;c<i+a;c++)n[c]=(n[c]||0)+l}}let r=0;for(let i=0;i<n.length;i++)r=Math.max(r,n[i]);for(let i=0;i<n.length;i++)if(i>=e.length&&e.push(z.empty),n[i]<r){let s=Vt(t).cell.createAndFill(),o=[];for(let a=n[i];a<r;a++)o.push(s);e[i]=e[i].append(z.from(o))}return{height:e.length,width:r,rows:e}}function Cf(t,e){let n=t.createAndFill();return new j0(n).replace(0,n.content.size,e).doc}function GB({width:t,height:e,rows:n},r,i){if(t!=r){let s=[],o=[];for(let a=0;a<n.length;a++){let l=n[a],c=[];for(let u=s[a]||0,h=0;u<r;h++){let d=l.child(h%l.childCount);u+d.attrs.colspan>r&&(d=d.type.create(cs(d.attrs,d.attrs.colspan,u+d.attrs.colspan-r),d.content)),c.push(d),u+=d.attrs.colspan;for(let f=1;f<d.attrs.rowspan;f++)s[a+f]=(s[a+f]||0)+d.attrs.colspan}o.push(z.from(c))}n=o,t=r}if(e!=i){let s=[];for(let o=0,a=0;o<i;o++,a++){let l=[],c=n[a%e];for(let u=0;u<c.childCount;u++){let h=c.child(u);o+h.attrs.rowspan>i&&(h=h.type.create(ht(h.attrs,"rowspan",Math.max(1,i-h.attrs.rowspan)),h.content)),l.push(h)}s.push(z.from(l))}n=s,e=i}return{width:t,height:e,rows:n}}function JB(t,e,n,r,i,s,o){let a=t.doc.type.schema,l=Vt(a),c,u;if(i>e.width)for(let h=0,d=0;h<e.height;h++){let f=n.child(h);d+=f.nodeSize;let p=[],g;f.lastChild==null||f.lastChild.type==l.cell?g=c||(c=l.cell.createAndFill()):g=u||(u=l.header_cell.createAndFill());for(let m=e.width;m<i;m++)p.push(g);t.insert(t.mapping.slice(o).map(d-1+r),p)}if(s>e.height){let h=[];for(let p=0,g=(e.height-1)*e.width;p<Math.max(e.width,i);p++){let m=p>=e.width?!1:n.nodeAt(e.map[g+p]).type==l.header_cell;h.push(m?u||(u=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}let d=l.row.create(null,z.from(h)),f=[];for(let p=e.height;p<s;p++)f.push(d);t.insert(t.mapping.slice(o).map(r+n.nodeSize-2),f)}return!!(c||u)}function Vb(t,e,n,r,i,s,o,a){if(o==0||o==e.height)return!1;let l=!1;for(let c=i;c<s;c++){let u=o*e.width+c,h=e.map[u];if(e.map[u-e.width]==h){l=!0;let d=n.nodeAt(h),{top:f,left:p}=e.findCell(h);t.setNodeMarkup(t.mapping.slice(a).map(h+r),null,ht(d.attrs,"rowspan",o-f)),t.insert(t.mapping.slice(a).map(e.positionAt(o,p,n)),d.type.createAndFill(ht(d.attrs,"rowspan",f+d.attrs.rowspan-o))),c+=d.attrs.colspan-1}}return l}function $b(t,e,n,r,i,s,o,a){if(o==0||o==e.width)return!1;let l=!1;for(let c=i;c<s;c++){let u=c*e.width+o,h=e.map[u];if(e.map[u-1]==h){l=!0;let d=n.nodeAt(h),f=e.colCount(h),p=t.mapping.slice(a).map(h+r);t.setNodeMarkup(p,null,cs(d.attrs,o-f,d.attrs.colspan-(o-f))),t.insert(p+d.nodeSize,d.type.createAndFill(cs(d.attrs,0,o-f))),c+=d.attrs.rowspan-1}}return l}function Ub(t,e,n,r,i){let s=n?t.doc.nodeAt(n-1):t.doc,o=Xe.get(s),{top:a,left:l}=r,c=l+i.width,u=a+i.height,h=t.tr,d=0;function f(){s=n?h.doc.nodeAt(n-1):h.doc,o=Xe.get(s),d=h.mapping.maps.length}JB(h,o,s,n,c,u,d)&&f(),Vb(h,o,s,n,l,c,a,d)&&f(),Vb(h,o,s,n,l,c,u,d)&&f(),$b(h,o,s,n,a,u,l,d)&&f(),$b(h,o,s,n,a,u,c,d)&&f();for(let p=a;p<u;p++){let g=o.positionAt(p,l,s),m=o.positionAt(p,c,s);h.replace(h.mapping.slice(d).map(g+n),h.mapping.slice(d).map(m+n),new X(i.rows[p-a],0,0))}f(),h.setSelection(new Ae(h.doc.resolve(n+o.positionAt(a,l,s)),h.doc.resolve(n+o.positionAt(u-1,c-1,s)))),e(h)}const XB=zp({ArrowLeft:Wl("horiz",-1),ArrowRight:Wl("horiz",1),ArrowUp:Wl("vert",-1),ArrowDown:Wl("vert",1),"Shift-ArrowLeft":Gl("horiz",-1),"Shift-ArrowRight":Gl("horiz",1),"Shift-ArrowUp":Gl("vert",-1),"Shift-ArrowDown":Gl("vert",1),Backspace:Jl,"Mod-Backspace":Jl,Delete:Jl,"Mod-Delete":Jl});function wc(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Wl(t,e){return(n,r,i)=>{let s=n.selection;if(s instanceof Ae)return wc(n,r,ue.near(s.$headCell,e));if(t!="horiz"&&!s.empty)return!1;let o=Jx(i,t,e);if(o==null)return!1;if(t=="horiz")return wc(n,r,ue.near(n.doc.resolve(s.head+e),e));{let a=n.doc.resolve(o),l=Wx(a,t,e),c;return l?c=ue.near(l,1):e<0?c=ue.near(n.doc.resolve(a.before(-1)),-1):c=ue.near(n.doc.resolve(a.after(-1)),1),wc(n,r,c)}}}function Gl(t,e){return(n,r,i)=>{let s=n.selection;if(!(s instanceof Ae)){let a=Jx(i,t,e);if(a==null)return!1;s=new Ae(n.doc.resolve(a))}let o=Wx(s.$headCell,t,e);return o?wc(n,r,new Ae(s.$anchorCell,o)):!1}}function Jl(t,e){let n=t.selection;if(!(n instanceof Ae))return!1;if(e){let r=t.tr,i=Vt(t.schema).cell.createAndFill().content;n.forEachCell((s,o)=>{s.content.eq(i)||r.replace(r.mapping.map(o+1),r.mapping.map(o+s.nodeSize-1),new X(i,0,0))}),r.docChanged&&e(r)}return!0}function YB(t,e){let n=t.state.doc,r=Ro(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new Ae(r))),!0):!1}function QB(t,e,n){if(!Gn(t.state))return!1;let r=qB(n),i=t.state.selection;if(i instanceof Ae){r||(r={width:1,height:1,rows:[z.from(Cf(Vt(t.state.schema).cell,n))]});let s=i.$anchorCell.node(-1),o=i.$anchorCell.start(-1),a=Xe.get(s).rectBetween(i.$anchorCell.pos-o,i.$headCell.pos-o);return r=GB(r,a.right-a.left,a.bottom-a.top),Ub(t.state,t.dispatch,o,a,r),!0}else if(r){let s=Ju(t.state),o=s.start(-1);return Ub(t.state,t.dispatch,o,Xe.get(s.node(-1)).findCell(s.pos-o),r),!0}else return!1}function ZB(t,e){if(e.ctrlKey||e.metaKey)return;let n=zb(t,e.target),r;if(e.shiftKey&&t.state.selection instanceof Ae)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&(r=Ro(t.state.selection.$anchor))!=null&&md(t,e).pos!=r.pos)i(r,e),e.preventDefault();else if(!n)return;function i(a,l){let c=md(t,l),u=Fr.getState(t.state)==null;if(!c||!mg(a,c))if(u)c=a;else return;let h=new Ae(a,c);if(u||!t.state.selection.eq(h)){let d=t.state.tr.setSelection(h);u&&d.setMeta(Fr,a.pos),t.dispatch(d)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",o),Fr.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(Fr,-1))}function o(a){let l=Fr.getState(t.state),c;if(l!=null)c=t.state.doc.resolve(l);else if(zb(t,a.target)!=n&&(c=md(t,e),!c))return s();c&&i(c,a)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",o)}function Jx(t,e,n){if(!(t.state.selection instanceof pe))return null;let{$head:r}=t.state.selection;for(let i=r.depth-1;i>=0;i--){let s=r.node(i);if((n<0?r.index(i):r.indexAfter(i))!=(n<0?0:s.childCount))return null;if(s.type.spec.tableRole=="cell"||s.type.spec.tableRole=="header_cell"){let a=r.before(i),l=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(l)?a:null}}return null}function zb(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e}function md(t,e){let n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?Ro(t.state.doc.resolve(n.pos)):null}const eF=new un("fix-tables");function Xx(t,e,n,r){let i=t.childCount,s=e.childCount;e:for(let o=0,a=0;o<s;o++){let l=e.child(o);for(let c=a,u=Math.min(i,o+3);c<u;c++)if(t.child(c)==l){a=c+1,n+=l.nodeSize;continue e}r(l,n),a<i&&t.child(a).sameMarkup(l)?Xx(t.child(a),l,n+1,r):l.nodesBetween(0,l.content.size,r,n+1),n+=l.nodeSize}}function Yx(t,e){let n,r=(i,s)=>{i.type.spec.tableRole=="table"&&(n=tF(t,i,s,n))};return e?e.doc!=t.doc&&Xx(e.doc,t.doc,0,r):t.doc.descendants(r),n}function tF(t,e,n,r){let i=Xe.get(e);if(!i.problems)return r;r||(r=t.tr);let s=[];for(let l=0;l<i.height;l++)s.push(0);for(let l=0;l<i.problems.length;l++){let c=i.problems[l];if(c.type=="collision"){let u=e.nodeAt(c.pos);for(let h=0;h<u.attrs.rowspan;h++)s[c.row+h]+=c.n;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,cs(u.attrs,u.attrs.colspan-c.n,c.n))}else if(c.type=="missing")s[c.row]+=c.n;else if(c.type=="overlong_rowspan"){let u=e.nodeAt(c.pos);r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,ht(u.attrs,"rowspan",u.attrs.rowspan-c.n))}else if(c.type=="colwidth mismatch"){let u=e.nodeAt(c.pos);r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,ht(u.attrs,"colwidth",c.colwidth))}}let o,a;for(let l=0;l<s.length;l++)s[l]&&(o==null&&(o=l),a=l);for(let l=0,c=n+1;l<i.height;l++){let u=e.child(l),h=c+u.nodeSize,d=s[l];if(d>0){let f="cell";u.firstChild&&(f=u.firstChild.type.spec.tableRole);let p=[];for(let m=0;m<d;m++)p.push(Vt(t.schema)[f].createAndFill());let g=(l==0||o==l-1)&&a==l?c+1:h-1;r.insert(r.mapping.map(g),p)}c=h}return r.setMeta(eF,{fixTables:!0})}function mr(t){let e=t.selection,n=Ju(t),r=n.node(-1),i=n.start(-1),s=Xe.get(r),o;return e instanceof Ae?o=s.rectBetween(e.$anchorCell.pos-i,e.$headCell.pos-i):o=s.findCell(n.pos-i),o.tableStart=i,o.map=s,o.table=r,o}function Qx(t,{map:e,tableStart:n,table:r},i){let s=i>0?-1:0;UB(e,r,i+s)&&(s=i==0||i==e.width?null:0);for(let o=0;o<e.height;o++){let a=o*e.width+i;if(i>0&&i<e.width&&e.map[a-1]==e.map[a]){let l=e.map[a],c=r.nodeAt(l);t.setNodeMarkup(t.mapping.map(n+l),null,Gx(c.attrs,i-e.colCount(l))),o+=c.attrs.rowspan-1}else{let l=s==null?Vt(r.type.schema).cell:r.nodeAt(e.map[a+s]).type,c=e.positionAt(o,i,r);t.insert(t.mapping.map(n+c),l.createAndFill())}}return t}function nF(t,e){if(!Gn(t))return!1;if(e){let n=mr(t);e(Qx(t.tr,n,n.left))}return!0}function rF(t,e){if(!Gn(t))return!1;if(e){let n=mr(t);e(Qx(t.tr,n,n.right))}return!0}function iF(t,{map:e,table:n,tableStart:r},i){let s=t.mapping.maps.length;for(let o=0;o<e.height;){let a=o*e.width+i,l=e.map[a],c=n.nodeAt(l);if(i>0&&e.map[a-1]==l||i<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(s).map(r+l),null,cs(c.attrs,i-e.colCount(l)));else{let u=t.mapping.slice(s).map(r+l);t.delete(u,u+c.nodeSize)}o+=c.attrs.rowspan}}function sF(t,e){if(!Gn(t))return!1;if(e){let n=mr(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let i=n.right-1;iF(r,n,i),i!=n.left;i--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Xe.get(n.table);e(r)}return!0}function oF(t,e,n){let r=Vt(e.type.schema).header_cell;for(let i=0;i<t.width;i++)if(e.nodeAt(t.map[i+n*t.width]).type!=r)return!1;return!0}function Zx(t,{map:e,tableStart:n,table:r},i){let s=n;for(let l=0;l<i;l++)s+=r.child(l).nodeSize;let o=[],a=i>0?-1:0;oF(e,r,i+a)&&(a=i==0||i==e.height?null:0);for(let l=0,c=e.width*i;l<e.width;l++,c++)if(i>0&&i<e.height&&e.map[c]==e.map[c-e.width]){let u=e.map[c],h=r.nodeAt(u).attrs;t.setNodeMarkup(n+u,null,ht(h,"rowspan",h.rowspan+1)),l+=h.colspan-1}else{let u=a==null?Vt(r.type.schema).cell:r.nodeAt(e.map[c+a*e.width]).type;o.push(u.createAndFill())}return t.insert(s,Vt(r.type.schema).row.create(null,o)),t}function aF(t,e){if(!Gn(t))return!1;if(e){let n=mr(t);e(Zx(t.tr,n,n.top))}return!0}function lF(t,e){if(!Gn(t))return!1;if(e){let n=mr(t);e(Zx(t.tr,n,n.bottom))}return!0}function cF(t,{map:e,table:n,tableStart:r},i){let s=0;for(let l=0;l<i;l++)s+=n.child(l).nodeSize;let o=s+n.child(i).nodeSize,a=t.mapping.maps.length;t.delete(s+r,o+r);for(let l=0,c=i*e.width;l<e.width;l++,c++){let u=e.map[c];if(i>0&&u==e.map[c-e.width]){let h=n.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(a).map(u+r),null,ht(h,"rowspan",h.rowspan-1)),l+=h.colspan-1}else if(i<e.width&&u==e.map[c+e.width]){let h=n.nodeAt(u),d=h.type.create(ht(h.attrs,"rowspan",h.attrs.rowspan-1),h.content),f=e.positionAt(i+1,l,n);t.insert(t.mapping.slice(a).map(r+f),d),l+=h.attrs.colspan-1}}}function uF(t,e){if(!Gn(t))return!1;if(e){let n=mr(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let i=n.bottom-1;cF(r,n,i),i!=n.top;i--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Xe.get(n.table);e(r)}return!0}function Hb(t){let e=t.content;return e.childCount==1&&e.firstChild.isTextblock&&e.firstChild.childCount==0}function hF({width:t,height:e,map:n},r){let i=r.top*t+r.left,s=i,o=(r.bottom-1)*t+r.left,a=i+(r.right-r.left-1);for(let l=r.top;l<r.bottom;l++){if(r.left>0&&n[s]==n[s-1]||r.right<t&&n[a]==n[a+1])return!0;s+=t,a+=t}for(let l=r.left;l<r.right;l++){if(r.top>0&&n[i]==n[i-t]||r.bottom<e&&n[o]==n[o+t])return!0;i++,o++}return!1}function jb(t,e){let n=t.selection;if(!(n instanceof Ae)||n.$anchorCell.pos==n.$headCell.pos)return!1;let r=mr(t),{map:i}=r;if(hF(i,r))return!1;if(e){let s=t.tr,o={},a=z.empty,l,c;for(let u=r.top;u<r.bottom;u++)for(let h=r.left;h<r.right;h++){let d=i.map[u*i.width+h],f=r.table.nodeAt(d);if(!o[d])if(o[d]=!0,l==null)l=d,c=f;else{Hb(f)||(a=a.append(f.content));let p=s.mapping.map(d+r.tableStart);s.delete(p,p+f.nodeSize)}}if(s.setNodeMarkup(l+r.tableStart,null,ht(Gx(c.attrs,c.attrs.colspan,r.right-r.left-c.attrs.colspan),"rowspan",r.bottom-r.top)),a.size){let u=l+1+c.content.size,h=Hb(c)?l+1:u;s.replaceWith(h+r.tableStart,u+r.tableStart,a)}s.setSelection(new Ae(s.doc.resolve(l+r.tableStart))),e(s)}return!0}function Kb(t,e){const n=Vt(t.schema);return dF(({node:r})=>n[r.type.spec.tableRole])(t,e)}function dF(t){return(e,n)=>{let r=e.selection,i,s;if(r instanceof Ae){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;i=r.$anchorCell.nodeAfter,s=r.$anchorCell.pos}else{if(i=FB(r.$from),!i)return!1;s=Ro(r.$from).pos}if(i.attrs.colspan==1&&i.attrs.rowspan==1)return!1;if(n){let o=i.attrs,a=[],l=o.colwidth;o.rowspan>1&&(o=ht(o,"rowspan",1)),o.colspan>1&&(o=ht(o,"colspan",1));let c=mr(e),u=e.tr;for(let d=0;d<c.right-c.left;d++)a.push(l?ht(o,"colwidth",l&&l[d]?[l[d]]:null):o);let h;for(let d=c.top;d<c.bottom;d++){let f=c.map.positionAt(d,c.left,c.table);d==c.top&&(f+=i.nodeSize);for(let p=c.left,g=0;p<c.right;p++,g++)p==c.left&&d==c.top||u.insert(h=u.mapping.map(f+c.tableStart,1),t({node:i,row:d,col:p}).createAndFill(a[g]))}u.setNodeMarkup(s,t({node:i,row:c.top,col:c.left}),a[0]),r instanceof Ae&&u.setSelection(new Ae(u.doc.resolve(r.$anchorCell.pos),h&&u.doc.resolve(h))),n(u)}return!0}}function fF(t,e){return function(n,r){if(!Gn(n))return!1;let i=Ju(n);if(i.nodeAfter.attrs[t]===e)return!1;if(r){let s=n.tr;n.selection instanceof Ae?n.selection.forEachCell((o,a)=>{o.attrs[t]!==e&&s.setNodeMarkup(a,null,ht(o.attrs,t,e))}):s.setNodeMarkup(i.pos,null,ht(i.nodeAfter.attrs,t,e)),r(s)}return!0}}function pF(t){return function(e,n){if(!Gn(e))return!1;if(n){let r=Vt(e.schema),i=mr(e),s=e.tr,o=i.map.cellsInRect(t=="column"?new wo(i.left,0,i.right,i.map.height):t=="row"?new wo(0,i.top,i.map.width,i.bottom):i),a=o.map(l=>i.table.nodeAt(l));for(let l=0;l<o.length;l++)a[l].type==r.header_cell&&s.setNodeMarkup(i.tableStart+o[l],r.cell,a[l].attrs);if(s.steps.length==0)for(let l=0;l<o.length;l++)s.setNodeMarkup(i.tableStart+o[l],r.header_cell,a[l].attrs);n(s)}return!0}}function qb(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let i=0;i<r.length;i++){const s=e.table.nodeAt(r[i]);if(s&&s.type!==n.header_cell)return!1}return!0}function Ka(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?pF(t):function(n,r){if(!Gn(n))return!1;if(r){let i=Vt(n.schema),s=mr(n),o=n.tr,a=qb("row",s,i),l=qb("column",s,i),u=(t==="column"?a:t==="row"?l:!1)?1:0,h=t=="column"?new wo(0,u,1,s.map.height):t=="row"?new wo(u,0,s.map.width,1):s,d=t=="column"?l?i.cell:i.header_cell:t=="row"?a?i.cell:i.header_cell:i.cell;s.map.cellsInRect(h).forEach(f=>{const p=f+s.tableStart,g=o.doc.nodeAt(p);g&&o.setNodeMarkup(p,d,g.attrs)}),r(o)}return!0}}Ka("row",{useDeprecatedLogic:!0});Ka("column",{useDeprecatedLogic:!0});let gF=Ka("cell",{useDeprecatedLogic:!0});function mF(t,e){if(e<0){let n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let r=t.index(-1)-1,i=t.before();r>=0;r--){let s=t.node(-1).child(r);if(s.childCount)return i-1-s.lastChild.nodeSize;i-=s.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;let n=t.node(-1);for(let r=t.indexAfter(-1),i=t.after();r<n.childCount;r++){let s=n.child(r);if(s.childCount)return i+1;i+=s.nodeSize}}}function Wb(t){return function(e,n){if(!Gn(e))return!1;let r=mF(Ju(e),t);if(r!=null){if(n){let i=e.doc.resolve(r);n(e.tr.setSelection(pe.between(i,$B(i))).scrollIntoView())}return!0}}}function yF(t,e){let n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}class bF{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),kf(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,kf(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}}function kf(t,e,n,r,i,s){let o=0,a=!0,l=e.firstChild,c=t.firstChild;for(let u=0,h=0;u<c.childCount;u++){let{colspan:d,colwidth:f}=c.child(u).attrs;for(let p=0;p<d;p++,h++){let g=i==h?s:f&&f[p],m=g?g+"px":"";o+=g||r,g||(a=!1),l?(l.style.width!=m&&(l.style.width=m),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=m}}for(;l;){let u=l.nextSibling;l.parentNode.removeChild(l),l=u}a?(n.style.width=o+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=o+"px")}const kn=new un("tableColumnResizing");function wF({handleWidth:t=5,cellMinWidth:e=25,View:n=bF,lastColumnResizable:r=!0}={}){return new Tt({key:kn,state:{init(s,o){return this.spec.props.nodeViews[Vt(o.schema).table.name]=(a,l)=>new n(a,e,l),new ya(-1,!1)},apply(s,o){return o.apply(s)}},props:{attributes(s){return kn.getState(s).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove(s,o){vF(s,o,t,e,r)},mouseleave(s){EF(s)},mousedown(s,o){xF(s,o,e)}},decorations(s){let o=kn.getState(s);if(o.activeHandle>-1)return AF(s,o.activeHandle)},nodeViews:{}}})}class ya{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){let n=this,r=e.getMeta(kn);if(r&&r.setHandle!=null)return new ya(r.setHandle,null);if(r&&r.setDragging!==void 0)return new ya(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let i=e.mapping.map(n.activeHandle,-1);Tf(e.doc.resolve(i))||(i=null),n=new ya(i,n.dragging)}return n}}function vF(t,e,n,r,i){let s=kn.getState(t.state);if(!s.dragging){let o=TF(e.target),a=-1;if(o){let{left:l,right:c}=o.getBoundingClientRect();e.clientX-l<=n?a=Gb(t,e,"left"):c-e.clientX<=n&&(a=Gb(t,e,"right"))}if(a!=s.activeHandle){if(!i&&a!==-1){let l=t.state.doc.resolve(a),c=l.node(-1),u=Xe.get(c),h=l.start(-1);if(u.colCount(l.pos-h)+l.nodeAfter.attrs.colspan-1==u.width-1)return}eS(t,a)}}}function EF(t){let e=kn.getState(t.state);e.activeHandle>-1&&!e.dragging&&eS(t,-1)}function xF(t,e,n){let r=kn.getState(t.state);if(r.activeHandle==-1||r.dragging)return!1;let i=t.state.doc.nodeAt(r.activeHandle),s=SF(t,r.activeHandle,i.attrs);t.dispatch(t.state.tr.setMeta(kn,{setDragging:{startX:e.clientX,startWidth:s}}));function o(l){window.removeEventListener("mouseup",o),window.removeEventListener("mousemove",a);let c=kn.getState(t.state);c.dragging&&(CF(t,c.activeHandle,Jb(c.dragging,l,n)),t.dispatch(t.state.tr.setMeta(kn,{setDragging:null})))}function a(l){if(!l.which)return o(l);let c=kn.getState(t.state),u=Jb(c.dragging,l,n);kF(t,c.activeHandle,u,n)}return window.addEventListener("mouseup",o),window.addEventListener("mousemove",a),e.preventDefault(),!0}function SF(t,e,{colspan:n,colwidth:r}){let i=r&&r[r.length-1];if(i)return i;let s=t.domAtPos(e),a=s.node.childNodes[s.offset].offsetWidth,l=n;if(r)for(let c=0;c<n;c++)r[c]&&(a-=r[c],l--);return a/l}function TF(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}function Gb(t,e,n){let r=t.posAtCoords({left:e.clientX,top:e.clientY});if(!r)return-1;let{pos:i}=r,s=Ro(t.state.doc.resolve(i));if(!s)return-1;if(n=="right")return s.pos;let o=Xe.get(s.node(-1)),a=s.start(-1),l=o.map.indexOf(s.pos-a);return l%o.width==0?-1:a+o.map[l-1]}function Jb(t,e,n){let r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function eS(t,e){t.dispatch(t.state.tr.setMeta(kn,{setHandle:e}))}function CF(t,e,n){let r=t.state.doc.resolve(e),i=r.node(-1),s=Xe.get(i),o=r.start(-1),a=s.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<s.height;c++){let u=c*s.width+a;if(c&&s.map[u]==s.map[u-s.width])continue;let h=s.map[u],{attrs:d}=i.nodeAt(h),f=d.colspan==1?0:a-s.colCount(h);if(d.colwidth&&d.colwidth[f]==n)continue;let p=d.colwidth?d.colwidth.slice():IF(d.colspan);p[f]=n,l.setNodeMarkup(o+h,null,ht(d,"colwidth",p))}l.docChanged&&t.dispatch(l)}function kF(t,e,n,r){let i=t.state.doc.resolve(e),s=i.node(-1),o=i.start(-1),a=Xe.get(s).colCount(i.pos-o)+i.nodeAfter.attrs.colspan-1,l=t.domAtPos(i.start(-1)).node;for(;l.nodeName!="TABLE";)l=l.parentNode;kf(s,l.firstChild,l,r,a,n)}function IF(t){let e=[];for(let n=0;n<t;n++)e.push(0);return e}function AF(t,e){let n=[],r=t.doc.resolve(e),i=r.node(-1),s=Xe.get(i),o=r.start(-1),a=s.colCount(r.pos-o)+r.nodeAfter.attrs.colspan;for(let l=0;l<s.height;l++){let c=a+l*s.width-1;if((a==s.width||s.map[c]!=s.map[c+1])&&(l==0||s.map[c-1]!=s.map[c-1-s.width])){let u=s.map[c],h=o+u+i.nodeAt(u).nodeSize-1,d=document.createElement("div");d.className="column-resize-handle",n.push(Kt.widget(h,d))}}return et.create(t.doc,n)}function _F({allowTableNodeSelection:t=!1}={}){return new Tt({key:Fr,state:{init(){return null},apply(e,n){let r=e.getMeta(Fr);if(r!=null)return r==-1?null:r;if(n==null||!e.docChanged)return n;let{deleted:i,pos:s}=e.mapping.mapResult(n);return i?null:s}},props:{decorations:zB,handleDOMEvents:{mousedown:ZB},createSelectionBetween(e){if(Fr.getState(e.state)!=null)return e.state.selection},handleTripleClick:YB,handleKeyDown:XB,handlePaste:QB},appendTransaction(e,n,r){return KB(r,Yx(r,n),t)}})}function Xb(t,e,n,r,i,s){let o=0,a=!0,l=e.firstChild;const c=t.firstChild;for(let u=0,h=0;u<c.childCount;u+=1){const{colspan:d,colwidth:f}=c.child(u).attrs;for(let p=0;p<d;p+=1,h+=1){const g=i===h?s:f&&f[p],m=g?`${g}px`:"";o+=g||r,g||(a=!1),l?(l.style.width!==m&&(l.style.width=m),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=m}}for(;l;){const u=l.nextSibling;l.parentNode.removeChild(l),l=u}a?(n.style.width=`${o}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${o}px`)}class MF{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Xb(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,Xb(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function Yb(t,e){return e?t.createChecked(null,e):t.createAndFill()}function OF(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function NF(t,e,n,r,i){const s=OF(t),o=[],a=[];for(let c=0;c<n;c+=1){const u=Yb(s.cell,i);if(u&&a.push(u),r){const h=Yb(s.header_cell,i);h&&o.push(h)}}const l=[];for(let c=0;c<e;c+=1)l.push(s.row.createChecked(null,r&&c===0?o:a));return s.table.createChecked(null,l)}function DF(t){return t instanceof Ae}const Xl=({editor:t})=>{const{selection:e}=t.state;if(!DF(e))return!1;let n=0;const r=BE(e.ranges[0].$from,s=>s.type.name==="table");return r==null||r.node.descendants(s=>{if(s.type.name==="table")return!1;["tableCell","tableHeader"].includes(s.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},RF=at.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:MF,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",nt(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:i,editor:s})=>{const o=NF(s.schema,t,e,n);if(i){const a=r.selection.anchor+1;r.replaceSelectionWith(o).scrollIntoView().setSelection(pe.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>nF(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>rF(t,e),deleteColumn:()=>({state:t,dispatch:e})=>sF(t,e),addRowBefore:()=>({state:t,dispatch:e})=>aF(t,e),addRowAfter:()=>({state:t,dispatch:e})=>lF(t,e),deleteRow:()=>({state:t,dispatch:e})=>uF(t,e),deleteTable:()=>({state:t,dispatch:e})=>yF(t,e),mergeCells:()=>({state:t,dispatch:e})=>jb(t,e),splitCell:()=>({state:t,dispatch:e})=>Kb(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>Ka("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>Ka("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>gF(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>jb(t,e)?!0:Kb(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>fF(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>Wb(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Wb(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Yx(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const r=Ae.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Xl,"Mod-Backspace":Xl,Delete:Xl,"Mod-Delete":Xl}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[wF({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],_F({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Se(re(t,"tableRole",e))}}}),PF=at.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",nt(this.options.HTMLAttributes,t),0]}}),LF=at.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",nt(this.options.HTMLAttributes,t),0]}}),BF=at.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",nt(this.options.HTMLAttributes,t),0]}}),FF=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,VF=at.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",nt(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[UE({find:FF,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},$F=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},nS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,c=l?t[i+2]:0,u=s>>2,h=(s&3)<<4|a>>4;let d=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(d=64)),r.push(n[u],n[h],n[d],n[f])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(tS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):$F(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const c=i<t.length?n[t.charAt(i)]:64;++i;const h=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||c==null||h==null)throw Error();const d=s<<2|a>>4;if(r.push(d),c!==64){const f=a<<4&240|c>>2;if(r.push(f),h!==64){const p=c<<6&192|h;r.push(p)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},UF=function(t){const e=tS(t);return nS.encodeByteArray(e,!0)},Qc=function(t){return UF(t).replace(/\./g,"")},zF=function(t){try{return nS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function HF(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function jF(){return!HF()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rS(){return typeof indexedDB=="object"}function KF(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}function qF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WF=()=>qF().__FIREBASE_DEFAULTS__,GF=()=>{if(typeof process>"u")return;const t=process.env.__FIREBASE_DEFAULTS__,e=process.env.__FIREBASE_DEFAULTS_PATH__;if(t)return e&&console.warn("Values were provided for both __FIREBASE_DEFAULTS__ and __FIREBASE_DEFAULTS_PATH__. __FIREBASE_DEFAULTS_PATH__ will be ignored."),JSON.parse(t);if(e&&typeof require<"u")try{return require(e)}catch{console.warn(`Unable to read defaults from file provided to __FIREBASE_DEFAULTS_PATH__: ${e}`)}},JF=()=>{if(typeof document>"u")return;const t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/),e=t&&zF(t[1]);return e&&JSON.parse(e)},iS=()=>WF()||GF()||JF(),sS=t=>{var e,n;return(n=(e=iS())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},XF=()=>{var t;return(t=iS())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YF{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Qc(JSON.stringify(n)),Qc(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QF="FirebaseError";class xs extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=QF,Object.setPrototypeOf(this,xs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,aS.prototype.create)}}class aS{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?ZF(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new xs(i,a,r)}}function ZF(t,e){return t.replace(eV,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const eV=/\{\$([^}]+)}/g;function Af(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(Qb(s)&&Qb(o)){if(!Af(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Qb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(t){return t&&t._delegate?t._delegate:t}class vo{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new YF;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rV(e))try{this.getOrInitializeService({instanceIdentifier:_i})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=_i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=_i){return this.instances.has(e)}getOptions(e=_i){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(!!r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:nV(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=_i){return this.component?this.component.multipleInstances?e:_i:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function nV(t){return t===_i?void 0:t}function rV(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iV{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new tV(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Le||(Le={}));const sV={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},oV=Le.INFO,aV={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},lV=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=aV[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class lS{constructor(e){this.name=e,this._logLevel=oV,this._logHandler=lV,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sV[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}}const cV=(t,e)=>e.some(n=>t instanceof n);let Zb,ew;function uV(){return Zb||(Zb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hV(){return ew||(ew=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cS=new WeakMap,_f=new WeakMap,uS=new WeakMap,yd=new WeakMap,bg=new WeakMap;function dV(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Qr(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&cS.set(n,t)}).catch(()=>{}),bg.set(e,t),e}function fV(t){if(_f.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});_f.set(t,e)}let Mf={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return _f.get(t);if(e==="objectStoreNames")return t.objectStoreNames||uS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Qr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function pV(t){Mf=t(Mf)}function gV(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(bd(this),e,...n);return uS.set(r,e.sort?e.sort():[e]),Qr(r)}:hV().includes(t)?function(...e){return t.apply(bd(this),e),Qr(cS.get(this))}:function(...e){return Qr(t.apply(bd(this),e))}}function mV(t){return typeof t=="function"?gV(t):(t instanceof IDBTransaction&&fV(t),cV(t,uV())?new Proxy(t,Mf):t)}function Qr(t){if(t instanceof IDBRequest)return dV(t);if(yd.has(t))return yd.get(t);const e=mV(t);return e!==t&&(yd.set(t,e),bg.set(e,t)),e}const bd=t=>bg.get(t);function yV(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Qr(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Qr(o.result),l.oldVersion,l.newVersion,Qr(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}const bV=["get","getKey","getAll","getAllKeys","count"],wV=["put","add","delete","clear"],wd=new Map;function tw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(wd.get(e))return wd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=wV.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||bV.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return wd.set(e,s),s}pV(t=>({...t,get:(e,n,r)=>tw(e,n)||t.get(e,n,r),has:(e,n)=>!!tw(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(EV(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function EV(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Of="@firebase/app",nw="0.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const us=new lS("@firebase/app"),xV="@firebase/app-compat",SV="@firebase/analytics-compat",TV="@firebase/analytics",CV="@firebase/app-check-compat",kV="@firebase/app-check",IV="@firebase/auth",AV="@firebase/auth-compat",_V="@firebase/database",MV="@firebase/database-compat",OV="@firebase/functions",NV="@firebase/functions-compat",DV="@firebase/installations",RV="@firebase/installations-compat",PV="@firebase/messaging",LV="@firebase/messaging-compat",BV="@firebase/performance",FV="@firebase/performance-compat",VV="@firebase/remote-config",$V="@firebase/remote-config-compat",UV="@firebase/storage",zV="@firebase/storage-compat",HV="@firebase/firestore",jV="@firebase/firestore-compat",KV="firebase",qV="9.11.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nf="[DEFAULT]",WV={[Of]:"fire-core",[xV]:"fire-core-compat",[TV]:"fire-analytics",[SV]:"fire-analytics-compat",[kV]:"fire-app-check",[CV]:"fire-app-check-compat",[IV]:"fire-auth",[AV]:"fire-auth-compat",[_V]:"fire-rtdb",[MV]:"fire-rtdb-compat",[OV]:"fire-fn",[NV]:"fire-fn-compat",[DV]:"fire-iid",[RV]:"fire-iid-compat",[PV]:"fire-fcm",[LV]:"fire-fcm-compat",[BV]:"fire-perf",[FV]:"fire-perf-compat",[VV]:"fire-rc",[$V]:"fire-rc-compat",[UV]:"fire-gcs",[zV]:"fire-gcs-compat",[HV]:"fire-fst",[jV]:"fire-fst-compat","fire-js":"fire-js",[KV]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new Map,Df=new Map;function GV(t,e){try{t.container.addComponent(e)}catch(n){us.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function qa(t){const e=t.name;if(Df.has(e))return us.debug(`There were multiple attempts to register component ${e}.`),!1;Df.set(e,t);for(const n of Zc.values())GV(n,t);return!0}function hS(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JV={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Zr=new aS("app","Firebase",JV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new vo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Zr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS=qV;function fS(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Nf,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Zr.create("bad-app-name",{appName:String(i)});if(n||(n=XF()),!n)throw Zr.create("no-options");const s=Zc.get(i);if(s){if(Af(n,s.options)&&Af(r,s.config))return s;throw Zr.create("duplicate-app",{appName:i})}const o=new iV(i);for(const l of Df.values())o.addComponent(l);const a=new XV(n,r,o);return Zc.set(i,a),a}function pS(t=Nf){const e=Zc.get(t);if(!e&&t===Nf)return fS();if(!e)throw Zr.create("no-app",{appName:t});return e}function ei(t,e,n){var r;let i=(r=WV[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),us.warn(a.join(" "));return}qa(new vo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV="firebase-heartbeat-database",QV=1,Wa="firebase-heartbeat-store";let vd=null;function gS(){return vd||(vd=yV(YV,QV,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Wa)}}}).catch(t=>{throw Zr.create("idb-open",{originalErrorMessage:t.message})})),vd}async function ZV(t){var e;try{return(await gS()).transaction(Wa).objectStore(Wa).get(mS(t))}catch(n){if(n instanceof xs)us.warn(n.message);else{const r=Zr.create("idb-get",{originalErrorMessage:(e=n)===null||e===void 0?void 0:e.message});us.warn(r.message)}}}async function rw(t,e){var n;try{const i=(await gS()).transaction(Wa,"readwrite");return await i.objectStore(Wa).put(e,mS(t)),i.done}catch(r){if(r instanceof xs)us.warn(r.message);else{const i=Zr.create("idb-set",{originalErrorMessage:(n=r)===null||n===void 0?void 0:n.message});us.warn(i.message)}}}function mS(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e$=1024,t$=30*24*60*60*1e3;class n${constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new i$(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=iw();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(i=>{const s=new Date(i.date).valueOf();return Date.now()-s<=t$}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=iw(),{heartbeatsToSend:n,unsentEntries:r}=r$(this._heartbeatsCache.heartbeats),i=Qc(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function iw(){return new Date().toISOString().substring(0,10)}function r$(t,e=e$){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),sw(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),sw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class i${constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rS()?KF().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await ZV(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return rw(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return rw(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function sw(t){return Qc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s$(t){qa(new vo("platform-logger",e=>new vV(e),"PRIVATE")),qa(new vo("heartbeat",e=>new n$(e),"PRIVATE")),ei(Of,nw,t),ei(Of,nw,"esm2017"),ei("fire-js","")}s$("");var o$="firebase",a$="9.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ei(o$,a$,"app");var l$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oe,wg=wg||{},ye=l$||self;function eu(){}function Xu(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function gl(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function c$(t){return Object.prototype.hasOwnProperty.call(t,Ed)&&t[Ed]||(t[Ed]=++u$)}var Ed="closure_uid_"+(1e9*Math.random()>>>0),u$=0;function h$(t,e,n){return t.call.apply(t.bind,arguments)}function d$(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Lt(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Lt=h$:Lt=d$,Lt.apply(null,arguments)}function Yl(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function Ct(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function pi(){this.s=this.s,this.o=this.o}var f$=0;pi.prototype.s=!1;pi.prototype.na=function(){!this.s&&(this.s=!0,this.M(),f$!=0)&&c$(this)};pi.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const yS=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function vg(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function ow(t,e){for(let n=1;n<arguments.length;n++){const r=arguments[n];if(Xu(r)){const i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function Bt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Bt.prototype.h=function(){this.defaultPrevented=!0};var p$=function(){if(!ye.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ye.addEventListener("test",eu,e),ye.removeEventListener("test",eu,e)}catch{}return t}();function tu(t){return/^[\s\xa0]*$/.test(t)}var aw=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function xd(t,e){return t<e?-1:t>e?1:0}function Yu(){var t=ye.navigator;return t&&(t=t.userAgent)?t:""}function ir(t){return Yu().indexOf(t)!=-1}function Eg(t){return Eg[" "](t),t}Eg[" "]=eu;function g$(t){var e=b$;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var m$=ir("Opera"),Eo=ir("Trident")||ir("MSIE"),bS=ir("Edge"),Rf=bS||Eo,wS=ir("Gecko")&&!(Yu().toLowerCase().indexOf("webkit")!=-1&&!ir("Edge"))&&!(ir("Trident")||ir("MSIE"))&&!ir("Edge"),y$=Yu().toLowerCase().indexOf("webkit")!=-1&&!ir("Edge");function vS(){var t=ye.document;return t?t.documentMode:void 0}var nu;e:{var Sd="",Td=function(){var t=Yu();if(wS)return/rv:([^\);]+)(\)|;)/.exec(t);if(bS)return/Edge\/([\d\.]+)/.exec(t);if(Eo)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(y$)return/WebKit\/(\S+)/.exec(t);if(m$)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(Td&&(Sd=Td?Td[1]:""),Eo){var Cd=vS();if(Cd!=null&&Cd>parseFloat(Sd)){nu=String(Cd);break e}}nu=Sd}var b$={};function w$(){return g$(function(){let t=0;const e=aw(String(nu)).split("."),n=aw("9").split("."),r=Math.max(e.length,n.length);for(let o=0;t==0&&o<r;o++){var i=e[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i[0].length==0&&s[0].length==0)break;t=xd(i[1].length==0?0:parseInt(i[1],10),s[1].length==0?0:parseInt(s[1],10))||xd(i[2].length==0,s[2].length==0)||xd(i[2],s[2]),i=i[3],s=s[3]}while(t==0)}return 0<=t})}var Pf;if(ye.document&&Eo){var lw=vS();Pf=lw||parseInt(nu,10)||void 0}else Pf=void 0;var v$=Pf;function Ga(t,e){if(Bt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(wS){e:{try{Eg(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:E$[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ga.X.h.call(this)}}Ct(Ga,Bt);var E$={2:"touch",3:"pen",4:"mouse"};Ga.prototype.h=function(){Ga.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ml="closure_listenable_"+(1e6*Math.random()|0),x$=0;function S$(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++x$,this.ba=this.ea=!1}function Qu(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function xg(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function ES(t){const e={};for(const n in t)e[n]=t[n];return e}const cw="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xS(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<cw.length;s++)n=cw[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Zu(t){this.src=t,this.g={},this.h=0}Zu.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=Bf(t,e,r,i);return-1<o?(e=t[o],n||(e.ea=!1)):(e=new S$(e,this.src,s,!!r,i),e.ea=n,t.push(e)),e};function Lf(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=yS(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Qu(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function Bf(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.ba&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}var Sg="closure_lm_"+(1e6*Math.random()|0),kd={};function SS(t,e,n,r,i){if(r&&r.once)return CS(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)SS(t,e[s],n,r,i);return null}return n=kg(n),t&&t[ml]?t.N(e,n,gl(r)?!!r.capture:!!r,i):TS(t,e,n,!1,r,i)}function TS(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=gl(i)?!!i.capture:!!i,a=Cg(t);if(a||(t[Sg]=a=new Zu(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=T$(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)p$||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(IS(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function T$(){function t(n){return e.call(t.src,t.listener,n)}const e=C$;return t}function CS(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)CS(t,e[s],n,r,i);return null}return n=kg(n),t&&t[ml]?t.O(e,n,gl(r)?!!r.capture:!!r,i):TS(t,e,n,!0,r,i)}function kS(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)kS(t,e[s],n,r,i);else r=gl(r)?!!r.capture:!!r,n=kg(n),t&&t[ml]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=Bf(s,n,r,i),-1<n&&(Qu(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=Cg(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Bf(e,n,r,i)),(n=-1<t?e[t]:null)&&Tg(n))}function Tg(t){if(typeof t!="number"&&t&&!t.ba){var e=t.src;if(e&&e[ml])Lf(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(IS(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Cg(e))?(Lf(n,t),n.h==0&&(n.src=null,e[Sg]=null)):Qu(t)}}}function IS(t){return t in kd?kd[t]:kd[t]="on"+t}function C$(t,e){if(t.ba)t=!0;else{e=new Ga(e,this);var n=t.listener,r=t.ha||t.src;t.ea&&Tg(t),t=n.call(r,e)}return t}function Cg(t){return t=t[Sg],t instanceof Zu?t:null}var Id="__closure_events_fn_"+(1e9*Math.random()>>>0);function kg(t){return typeof t=="function"?t:(t[Id]||(t[Id]=function(e){return t.handleEvent(e)}),t[Id])}function ft(){pi.call(this),this.i=new Zu(this),this.P=this,this.I=null}Ct(ft,pi);ft.prototype[ml]=!0;ft.prototype.removeEventListener=function(t,e,n,r){kS(this,t,e,n,r)};function St(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,typeof e=="string")e=new Bt(e,t);else if(e instanceof Bt)e.target=e.target||t;else{var i=e;e=new Bt(r,t),xS(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Ql(o,r,!0,e)&&i}if(o=e.g=t,i=Ql(o,r,!0,e)&&i,i=Ql(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=Ql(o,r,!1,e)&&i}ft.prototype.M=function(){if(ft.X.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Qu(n[r]);delete t.g[e],t.h--}}this.I=null};ft.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};ft.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function Ql(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.ea&&Lf(t.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var Ig=ye.JSON.stringify;function k$(){var t=MS;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class I${constructor(){this.h=this.g=null}add(e,n){const r=AS.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}}var AS=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new A$,t=>t.reset());class A${constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function _$(t){ye.setTimeout(()=>{throw t},0)}function _S(t,e){Ff||M$(),Vf||(Ff(),Vf=!0),MS.add(t,e)}var Ff;function M$(){var t=ye.Promise.resolve(void 0);Ff=function(){t.then(O$)}}var Vf=!1,MS=new I$;function O$(){for(var t;t=k$();){try{t.h.call(t.g)}catch(n){_$(n)}var e=AS;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Vf=!1}function eh(t,e){ft.call(this),this.h=t||1,this.g=e||ye,this.j=Lt(this.kb,this),this.l=Date.now()}Ct(eh,ft);oe=eh.prototype;oe.ca=!1;oe.R=null;oe.kb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),St(this,"tick"),this.ca&&(Ag(this),this.start()))}};oe.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ag(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}oe.M=function(){eh.X.M.call(this),Ag(this),delete this.g};function _g(t,e,n){if(typeof t=="function")n&&(t=Lt(t,n));else if(t&&typeof t.handleEvent=="function")t=Lt(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ye.setTimeout(t,e||0)}function OS(t){t.g=_g(()=>{t.g=null,t.i&&(t.i=!1,OS(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class N$ extends pi{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:OS(this)}M(){super.M(),this.g&&(ye.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ja(t){pi.call(this),this.h=t,this.g={}}Ct(Ja,pi);var uw=[];function NS(t,e,n,r){Array.isArray(n)||(n&&(uw[0]=n.toString()),n=uw);for(var i=0;i<n.length;i++){var s=SS(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function DS(t){xg(t.g,function(e,n){this.g.hasOwnProperty(n)&&Tg(e)},t),t.g={}}Ja.prototype.M=function(){Ja.X.M.call(this),DS(this)};Ja.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function th(){this.g=!0}th.prototype.Aa=function(){this.g=!1};function D$(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function R$(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function qs(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+L$(t,n)+(r?" "+r:"")})}function P$(t,e){t.info(function(){return"TIMEOUT: "+e})}th.prototype.info=function(){};function L$(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Ig(n)}catch{return e}}var Ss={},hw=null;function nh(){return hw=hw||new ft}Ss.Oa="serverreachability";function RS(t){Bt.call(this,Ss.Oa,t)}Ct(RS,Bt);function Xa(t){const e=nh();St(e,new RS(e))}Ss.STAT_EVENT="statevent";function PS(t,e){Bt.call(this,Ss.STAT_EVENT,t),this.stat=e}Ct(PS,Bt);function qt(t){const e=nh();St(e,new PS(e,t))}Ss.Pa="timingevent";function LS(t,e){Bt.call(this,Ss.Pa,t),this.size=e}Ct(LS,Bt);function yl(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return ye.setTimeout(function(){t()},e)}var rh={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,La:7,TIMEOUT:8,Cb:9},BS={qb:"complete",Mb:"success",Ma:"error",La:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Mg(){}Mg.prototype.h=null;function dw(t){return t.h||(t.h=t.i())}function FS(){}var bl={OPEN:"a",pb:"b",Ma:"c",Bb:"d"};function Og(){Bt.call(this,"d")}Ct(Og,Bt);function Ng(){Bt.call(this,"c")}Ct(Ng,Bt);var $f;function ih(){}Ct(ih,Mg);ih.prototype.g=function(){return new XMLHttpRequest};ih.prototype.i=function(){return{}};$f=new ih;function wl(t,e,n,r){this.l=t,this.j=e,this.m=n,this.U=r||1,this.S=new Ja(this),this.O=B$,t=Rf?125:void 0,this.T=new eh(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new VS}function VS(){this.i=null,this.g="",this.h=!1}var B$=45e3,Uf={},ru={};oe=wl.prototype;oe.setTimeout=function(t){this.O=t};function zf(t,e,n){t.K=1,t.v=oh(kr(e)),t.s=n,t.P=!0,$S(t,null)}function $S(t,e){t.F=Date.now(),vl(t),t.A=kr(t.v);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),GS(n.i,"t",r),t.C=0,n=t.l.H,t.h=new VS,t.g=g1(t.l,n?e:null,!t.s),0<t.N&&(t.L=new N$(Lt(t.Ka,t,t.g),t.N)),NS(t.S,t.g,"readystatechange",t.hb),e=t.H?ES(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),Xa(),D$(t.j,t.u,t.A,t.m,t.U,t.s)}oe.hb=function(t){t=t.target;const e=this.L;e&&vr(t)==3?e.l():this.Ka(t)};oe.Ka=function(t){try{if(t==this.g)e:{const u=vr(this.g);var e=this.g.Ea();const h=this.g.aa();if(!(3>u)&&(u!=3||Rf||this.g&&(this.h.h||this.g.fa()||mw(this.g)))){this.I||u!=4||e==7||(e==8||0>=h?Xa(3):Xa(2)),sh(this);var n=this.g.aa();this.Y=n;t:if(US(this)){var r=mw(this.g);t="";var i=r.length,s=vr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){zi(this),ba(this);var o="";break t}this.h.i=new ye.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=n==200,R$(this.j,this.u,this.A,this.m,this.U,u,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!tu(a)){var c=a;break t}}c=null}if(n=c)qs(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Hf(this,n);else{this.i=!1,this.o=3,qt(12),zi(this),ba(this);break e}}this.P?(zS(this,u,o),Rf&&this.i&&u==3&&(NS(this.S,this.T,"tick",this.gb),this.T.start())):(qs(this.j,this.m,o,null),Hf(this,o)),u==4&&zi(this),this.i&&!this.I&&(u==4?h1(this.l,this):(this.i=!1,vl(this)))}else n==400&&0<o.indexOf("Unknown SID")?(this.o=3,qt(12)):(this.o=0,qt(13)),zi(this),ba(this)}}}catch{}finally{}};function US(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Da:!1}function zS(t,e,n){let r=!0,i;for(;!t.I&&t.C<n.length;)if(i=F$(t,n),i==ru){e==4&&(t.o=4,qt(14),r=!1),qs(t.j,t.m,null,"[Incomplete Response]");break}else if(i==Uf){t.o=4,qt(15),qs(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else qs(t.j,t.m,i,null),Hf(t,i);US(t)&&i!=ru&&i!=Uf&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,qt(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.$&&(t.$=!0,e=t.l,e.g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Vg(e),e.K=!0,qt(11))):(qs(t.j,t.m,n,"[Invalid Chunked Response]"),zi(t),ba(t))}oe.gb=function(){if(this.g){var t=vr(this.g),e=this.g.fa();this.C<e.length&&(sh(this),zS(this,t,e),this.i&&t!=4&&vl(this))}};function F$(t,e){var n=t.C,r=e.indexOf(`
`,n);return r==-1?ru:(n=Number(e.substring(n,r)),isNaN(n)?Uf:(r+=1,r+n>e.length?ru:(e=e.substr(r,n),t.C=r+n,e)))}oe.cancel=function(){this.I=!0,zi(this)};function vl(t){t.V=Date.now()+t.O,HS(t,t.O)}function HS(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=yl(Lt(t.fb,t),e)}function sh(t){t.B&&(ye.clearTimeout(t.B),t.B=null)}oe.fb=function(){this.B=null;const t=Date.now();0<=t-this.V?(P$(this.j,this.A),this.K!=2&&(Xa(),qt(17)),zi(this),this.o=2,ba(this)):HS(this,this.V-t)};function ba(t){t.l.G==0||t.I||h1(t.l,t)}function zi(t){sh(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,Ag(t.T),DS(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Hf(t,e){try{var n=t.l;if(n.G!=0&&(n.g==t||jf(n.h,t))){if(!t.J&&jf(n.h,t)&&n.G==3){try{var r=n.Fa.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.F+3e3<t.F)ou(n),ch(n);else break e;Fg(n),qt(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&n.A==0&&!n.v&&(n.v=yl(Lt(n.bb,n),6e3));if(1>=YS(n.h)&&n.ja){try{n.ja()}catch{}n.ja=void 0}}else Hi(n,11)}else if((t.J||n.g==t)&&ou(n),!tu(e))for(i=n.Fa.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.T=c[0],c=c[1],n.G==2)if(c[0]=="c"){n.I=c[1],n.ka=c[2];const u=c[3];u!=null&&(n.ma=u,n.j.info("VER="+n.ma));const h=c[4];h!=null&&(n.Ca=h,n.j.info("SVER="+n.Ca));const d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=t.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var s=r.h;s.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Dg(s,s.h),s.h=null))}if(r.D){const g=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;g&&(r.za=g,Ke(r.F,r.D,g))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms")),r=n;var o=t;if(r.sa=p1(r,r.H?r.ka:null,r.V),o.J){QS(r.h,o);var a=o,l=r.J;l&&a.setTimeout(l),a.B&&(sh(a),vl(a)),r.g=o}else c1(r);0<n.i.length&&uh(n)}else c[0]!="stop"&&c[0]!="close"||Hi(n,7);else n.G==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Hi(n,7):Bg(n):c[0]!="noop"&&n.l&&n.l.wa(c),n.A=0)}}Xa(4)}catch{}}function V$(t){if(t.W&&typeof t.W=="function")return t.W();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(Xu(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function $$(t){if(t.oa&&typeof t.oa=="function")return t.oa();if(!t.W||typeof t.W!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(Xu(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}function jS(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Xu(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=$$(t),r=V$(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var KS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function U$(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function es(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof es){this.h=e!==void 0?e:t.h,iu(this,t.j),this.s=t.s,this.g=t.g,su(this,t.m),this.l=t.l,e=t.i;var n=new Ya;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),fw(this,n),this.o=t.o}else t&&(n=String(t).match(KS))?(this.h=!!e,iu(this,n[1]||"",!0),this.s=na(n[2]||""),this.g=na(n[3]||"",!0),su(this,n[4]),this.l=na(n[5]||"",!0),fw(this,n[6]||"",!0),this.o=na(n[7]||"")):(this.h=!!e,this.i=new Ya(null,this.h))}es.prototype.toString=function(){var t=[],e=this.j;e&&t.push(ra(e,pw,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(ra(e,pw,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(ra(n,n.charAt(0)=="/"?j$:H$,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",ra(n,q$)),t.join("")};function kr(t){return new es(t)}function iu(t,e,n){t.j=n?na(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function su(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function fw(t,e,n){e instanceof Ya?(t.i=e,W$(t.i,t.h)):(n||(e=ra(e,K$)),t.i=new Ya(e,t.h))}function Ke(t,e,n){t.i.set(e,n)}function oh(t){return Ke(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function na(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ra(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,z$),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function z$(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var pw=/[#\/\?@]/g,H$=/[#\?:]/g,j$=/[#\?]/g,K$=/[#\?@]/g,q$=/#/g;function Ya(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function gi(t){t.g||(t.g=new Map,t.h=0,t.i&&U$(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}oe=Ya.prototype;oe.add=function(t,e){gi(this),this.i=null,t=Po(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function qS(t,e){gi(t),e=Po(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function WS(t,e){return gi(t),e=Po(t,e),t.g.has(e)}oe.forEach=function(t,e){gi(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};oe.oa=function(){gi(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};oe.W=function(t){gi(this);let e=[];if(typeof t=="string")WS(this,t)&&(e=e.concat(this.g.get(Po(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};oe.set=function(t,e){return gi(this),this.i=null,t=Po(this,t),WS(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};oe.get=function(t,e){return t?(t=this.W(t),0<t.length?String(t[0]):e):e};function GS(t,e,n){qS(t,e),0<n.length&&(t.i=null,t.g.set(Po(t,e),vg(n)),t.h+=n.length)}oe.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function Po(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function W$(t,e){e&&!t.j&&(gi(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(qS(this,r),GS(this,i,n))},t)),t.j=e}var G$=class{constructor(t,e){this.h=t,this.g=e}};function JS(t){this.l=t||J$,ye.PerformanceNavigationTiming?(t=ye.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(ye.g&&ye.g.Ga&&ye.g.Ga()&&ye.g.Ga().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var J$=10;function XS(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function YS(t){return t.h?1:t.g?t.g.size:0}function jf(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Dg(t,e){t.g?t.g.add(e):t.h=e}function QS(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}JS.prototype.cancel=function(){if(this.i=ZS(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function ZS(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return vg(t.i)}function Rg(){}Rg.prototype.stringify=function(t){return ye.JSON.stringify(t,void 0)};Rg.prototype.parse=function(t){return ye.JSON.parse(t,void 0)};function X$(){this.g=new Rg}function Y$(t,e,n){const r=n||"";try{jS(t,function(i,s){let o=i;gl(i)&&(o=Ig(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Q$(t,e){const n=new th;if(ye.Image){const r=new Image;r.onload=Yl(Zl,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Yl(Zl,n,r,"TestLoadImage: error",!1,e),r.onabort=Yl(Zl,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Yl(Zl,n,r,"TestLoadImage: timeout",!1,e),ye.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Zl(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function El(t){this.l=t.$b||null,this.j=t.ib||!1}Ct(El,Mg);El.prototype.g=function(){return new ah(this.l,this.j)};El.prototype.i=function(t){return function(){return t}}({});function ah(t,e){ft.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Pg,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ct(ah,ft);var Pg=0;oe=ah.prototype;oe.open=function(t,e){if(this.readyState!=Pg)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Qa(this)};oe.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ye).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ga.bind(this))};oe.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,xl(this)),this.readyState=Pg};oe.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Qa(this)),this.g&&(this.readyState=3,Qa(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ta.bind(this),this.ga.bind(this));else if(typeof ye.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;e1(this)}else t.text().then(this.Ua.bind(this),this.ga.bind(this))};function e1(t){t.j.read().then(t.Sa.bind(t)).catch(t.ga.bind(t))}oe.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?xl(this):Qa(this),this.readyState==3&&e1(this)}};oe.Ua=function(t){this.g&&(this.response=this.responseText=t,xl(this))};oe.Ta=function(t){this.g&&(this.response=t,xl(this))};oe.ga=function(){this.g&&xl(this)};function xl(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Qa(t)}oe.setRequestHeader=function(t,e){this.v.append(t,e)};oe.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};oe.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Qa(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(ah.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var Z$=ye.JSON.parse;function rt(t){ft.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=t1,this.K=this.L=!1}Ct(rt,ft);var t1="",eU=/^https?$/i,tU=["POST","PUT"];oe=rt.prototype;oe.da=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():$f.g(),this.C=this.u?dw(this.u):dw($f),this.g.onreadystatechange=Lt(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(s){gw(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=ye.FormData&&t instanceof ye.FormData,!(0<=yS(tU,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of n)this.g.setRequestHeader(s,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{i1(this),0<this.B&&((this.K=nU(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Lt(this.qa,this)):this.A=_g(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){gw(this,s)}};function nU(t){return Eo&&w$()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}oe.qa=function(){typeof wg<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,St(this,"timeout"),this.abort(8))};function gw(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,n1(t),lh(t)}function n1(t){t.D||(t.D=!0,St(t,"complete"),St(t,"error"))}oe.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,St(this,"complete"),St(this,"abort"),lh(this))};oe.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),lh(this,!0)),rt.X.M.call(this)};oe.Ha=function(){this.s||(this.F||this.v||this.l?r1(this):this.eb())};oe.eb=function(){r1(this)};function r1(t){if(t.h&&typeof wg<"u"&&(!t.C[1]||vr(t)!=4||t.aa()!=2)){if(t.v&&vr(t)==4)_g(t.Ha,0,t);else if(St(t,"readystatechange"),vr(t)==4){t.h=!1;try{const a=t.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=a===0){var i=String(t.H).match(KS)[1]||null;if(!i&&ye.self&&ye.self.location){var s=ye.self.location.protocol;i=s.substr(0,s.length-1)}r=!eU.test(i?i.toLowerCase():"")}n=r}if(n)St(t,"complete"),St(t,"success");else{t.m=6;try{var o=2<vr(t)?t.g.statusText:""}catch{o=""}t.j=o+" ["+t.aa()+"]",n1(t)}}finally{lh(t)}}}}function lh(t,e){if(t.g){i1(t);const n=t.g,r=t.C[0]?eu:null;t.g=null,t.C=null,e||St(t,"ready");try{n.onreadystatechange=r}catch{}}}function i1(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ye.clearTimeout(t.A),t.A=null)}function vr(t){return t.g?t.g.readyState:0}oe.aa=function(){try{return 2<vr(this)?this.g.status:-1}catch{return-1}};oe.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};oe.Ra=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),Z$(e)}};function mw(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case t1:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}oe.Ea=function(){return this.m};oe.Na=function(){return typeof this.j=="string"?this.j:String(this.j)};function s1(t){let e="";return xg(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function Lg(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=s1(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):Ke(t,e,n))}function Ho(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function o1(t){this.Ca=0,this.i=[],this.j=new th,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.$a=this.U=0,this.Ya=Ho("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Wa=Ho("baseRetryDelayMs",5e3,t),this.ab=Ho("retryDelaySeedMs",1e4,t),this.Za=Ho("forwardChannelMaxRetries",2,t),this.ta=Ho("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Yb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new JS(t&&t.concurrentRequestLimit),this.Fa=new X$,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Xa=t&&t.Wb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}oe=o1.prototype;oe.ma=8;oe.G=1;function Bg(t){if(a1(t),t.G==3){var e=t.U++,n=kr(t.F);Ke(n,"SID",t.I),Ke(n,"RID",e),Ke(n,"TYPE","terminate"),Sl(t,n),e=new wl(t,t.j,e,void 0),e.K=2,e.v=oh(kr(n)),n=!1,ye.navigator&&ye.navigator.sendBeacon&&(n=ye.navigator.sendBeacon(e.v.toString(),"")),!n&&ye.Image&&(new Image().src=e.v,n=!0),n||(e.g=g1(e.l,null),e.g.da(e.v)),e.F=Date.now(),vl(e)}f1(t)}function ch(t){t.g&&(Vg(t),t.g.cancel(),t.g=null)}function a1(t){ch(t),t.u&&(ye.clearTimeout(t.u),t.u=null),ou(t),t.h.cancel(),t.m&&(typeof t.m=="number"&&ye.clearTimeout(t.m),t.m=null)}function uh(t){XS(t.h)||t.m||(t.m=!0,_S(t.Ja,t),t.C=0)}function rU(t,e){return YS(t.h)>=t.h.j-(t.m?1:0)?!1:t.m?(t.i=e.D.concat(t.i),!0):t.G==1||t.G==2||t.C>=(t.Ya?0:t.Za)?!1:(t.m=yl(Lt(t.Ja,t,e),d1(t,t.C)),t.C++,!0)}oe.Ja=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new wl(this,this.j,t,void 0);let s=this.s;if(this.S&&(s?(s=ES(s),xS(s,this.S)):s=this.S),this.o!==null||this.N||(i.H=s,s=null),this.O)e:{for(var e=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.g&&(r=r.g.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.i.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=l1(this,i,e),n=kr(this.F),Ke(n,"RID",t),Ke(n,"CVER",22),this.D&&Ke(n,"X-HTTP-Session-Id",this.D),Sl(this,n),s&&(this.N?e="headers="+encodeURIComponent(String(s1(s)))+"&"+e:this.o&&Lg(n,this.o,s)),Dg(this.h,i),this.Xa&&Ke(n,"TYPE","init"),this.O?(Ke(n,"$req",e),Ke(n,"SID","null"),i.Z=!0,zf(i,n,null)):zf(i,n,e),this.G=2}}else this.G==3&&(t?yw(this,t):this.i.length==0||XS(this.h)||yw(this))};function yw(t,e){var n;e?n=e.m:n=t.U++;const r=kr(t.F);Ke(r,"SID",t.I),Ke(r,"RID",n),Ke(r,"AID",t.T),Sl(t,r),t.o&&t.s&&Lg(r,t.o,t.s),n=new wl(t,t.j,n,t.C+1),t.o===null&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=l1(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),Dg(t.h,n),zf(n,r,e)}function Sl(t,e){t.ia&&xg(t.ia,function(n,r){Ke(e,r,n)}),t.l&&jS({},function(n,r){Ke(e,r,n)})}function l1(t,e,n){n=Math.min(t.i.length,n);var r=t.l?Lt(t.l.Qa,t.l,t):null;e:{var i=t.i;let s=-1;for(;;){const o=["count="+n];s==-1?0<n?(s=i[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<n;l++){let c=i[l].h;const u=i[l].g;if(c-=s,0>c)s=Math.max(0,i[l].h-100),a=!1;else try{Y$(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return t=t.i.splice(0,n),e.D=t,r}function c1(t){t.g||t.u||(t.Z=1,_S(t.Ia,t),t.A=0)}function Fg(t){return t.g||t.u||3<=t.A?!1:(t.Z++,t.u=yl(Lt(t.Ia,t),d1(t,t.A)),t.A++,!0)}oe.Ia=function(){if(this.u=null,u1(this),this.$&&!(this.K||this.g==null||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=yl(Lt(this.cb,this),t)}};oe.cb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,qt(10),ch(this),u1(this))};function Vg(t){t.B!=null&&(ye.clearTimeout(t.B),t.B=null)}function u1(t){t.g=new wl(t,t.j,"rpc",t.Z),t.o===null&&(t.g.H=t.s),t.g.N=0;var e=kr(t.sa);Ke(e,"RID","rpc"),Ke(e,"SID",t.I),Ke(e,"CI",t.L?"0":"1"),Ke(e,"AID",t.T),Ke(e,"TYPE","xmlhttp"),Sl(t,e),t.o&&t.s&&Lg(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=oh(kr(e)),n.s=null,n.P=!0,$S(n,t)}oe.bb=function(){this.v!=null&&(this.v=null,ch(this),Fg(this),qt(19))};function ou(t){t.v!=null&&(ye.clearTimeout(t.v),t.v=null)}function h1(t,e){var n=null;if(t.g==e){ou(t),Vg(t),t.g=null;var r=2}else if(jf(t.h,e))n=e.D,QS(t.h,e),r=1;else return;if(t.G!=0){if(t.pa=e.Y,e.i)if(r==1){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;r=nh(),St(r,new LS(r,n)),uh(t)}else c1(t);else if(i=e.o,i==3||i==0&&0<t.pa||!(r==1&&rU(t,e)||r==2&&Fg(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:Hi(t,5);break;case 4:Hi(t,10);break;case 3:Hi(t,6);break;default:Hi(t,2)}}}function d1(t,e){let n=t.Wa+Math.floor(Math.random()*t.ab);return t.l||(n*=2),n*e}function Hi(t,e){if(t.j.info("Error code "+e),e==2){var n=null;t.l&&(n=null);var r=Lt(t.jb,t);n||(n=new es("//www.google.com/images/cleardot.gif"),ye.location&&ye.location.protocol=="http"||iu(n,"https"),oh(n)),Q$(n.toString(),r)}else qt(2);t.G=0,t.l&&t.l.va(e),f1(t),a1(t)}oe.jb=function(t){t?(this.j.info("Successfully pinged google.com"),qt(2)):(this.j.info("Failed to ping google.com"),qt(1))};function f1(t){if(t.G=0,t.la=[],t.l){const e=ZS(t.h);(e.length!=0||t.i.length!=0)&&(ow(t.la,e),ow(t.la,t.i),t.h.i.length=0,vg(t.i),t.i.length=0),t.l.ua()}}function p1(t,e,n){var r=n instanceof es?kr(n):new es(n,void 0);if(r.g!="")e&&(r.g=e+"."+r.g),su(r,r.m);else{var i=ye.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new es(null,void 0);r&&iu(s,r),e&&(s.g=e),i&&su(s,i),n&&(s.l=n),r=s}return n=t.D,e=t.za,n&&e&&Ke(r,n,e),Ke(r,"VER",t.ma),Sl(t,r),r}function g1(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Da&&!t.ra?new rt(new El({ib:!0})):new rt(t.ra),e.L=t.H,e}function m1(){}oe=m1.prototype;oe.xa=function(){};oe.wa=function(){};oe.va=function(){};oe.ua=function(){};oe.Qa=function(){};function au(){if(Eo&&!(10<=Number(v$)))throw Error("Environmental error: no available transport.")}au.prototype.g=function(t,e){return new bn(t,e)};function bn(t,e){ft.call(this),this.g=new o1(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Xb)&&!tu(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!tu(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Lo(this)}Ct(bn,ft);bn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;qt(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=p1(t,null,t.V),uh(t)};bn.prototype.close=function(){Bg(this.g)};bn.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=Ig(t),t=n);e.i.push(new G$(e.$a++,t)),e.G==3&&uh(e)};bn.prototype.M=function(){this.g.l=null,delete this.j,Bg(this.g),delete this.g,bn.X.M.call(this)};function y1(t){Og.call(this);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Ct(y1,Og);function b1(){Ng.call(this),this.status=1}Ct(b1,Ng);function Lo(t){this.g=t}Ct(Lo,m1);Lo.prototype.xa=function(){St(this.g,"a")};Lo.prototype.wa=function(t){St(this.g,new y1(t))};Lo.prototype.va=function(t){St(this.g,new b1)};Lo.prototype.ua=function(){St(this.g,"b")};au.prototype.createWebChannel=au.prototype.g;bn.prototype.send=bn.prototype.u;bn.prototype.open=bn.prototype.m;bn.prototype.close=bn.prototype.close;rh.NO_ERROR=0;rh.TIMEOUT=8;rh.HTTP_ERROR=6;BS.COMPLETE="complete";FS.EventType=bl;bl.OPEN="a";bl.CLOSE="b";bl.ERROR="c";bl.MESSAGE="d";ft.prototype.listen=ft.prototype.N;rt.prototype.listenOnce=rt.prototype.O;rt.prototype.getLastError=rt.prototype.Na;rt.prototype.getLastErrorCode=rt.prototype.Ea;rt.prototype.getStatus=rt.prototype.aa;rt.prototype.getResponseJson=rt.prototype.Ra;rt.prototype.getResponseText=rt.prototype.fa;rt.prototype.send=rt.prototype.da;var iU=function(){return new au},sU=function(){return nh()},Ad=rh,oU=BS,aU=Ss,bw={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},lU=El,ec=FS,cU=rt;const ww="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}wt.UNAUTHENTICATED=new wt(null),wt.GOOGLE_CREDENTIALS=new wt("google-credentials-uid"),wt.FIRST_PARTY=new wt("first-party-uid"),wt.MOCK_USER=new wt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bo="9.11.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hs=new lS("@firebase/firestore");function Kf(){return hs.logLevel}function K(t,...e){if(hs.logLevel<=Le.DEBUG){const n=e.map($g);hs.debug(`Firestore (${Bo}): ${t}`,...n)}}function jt(t,...e){if(hs.logLevel<=Le.ERROR){const n=e.map($g);hs.error(`Firestore (${Bo}): ${t}`,...n)}}function lu(t,...e){if(hs.logLevel<=Le.WARN){const n=e.map($g);hs.warn(`Firestore (${Bo}): ${t}`,...n)}}function $g(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(t="Unexpected state"){const e=`FIRESTORE (${Bo}) INTERNAL ASSERTION FAILED: `+t;throw jt(e),new Error(e)}function be(t,e){t||ae()}function we(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends xs{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class uU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(wt.UNAUTHENTICATED))}shutdown(){}}class hU{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class dU{constructor(e){this.t=e,this.currentUser=wt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new Kn;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Kn,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{K("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(K("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Kn)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(K("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(be(typeof r.accessToken=="string"),new w1(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return be(e===null||typeof e=="string"),new wt(e)}}class fU{constructor(e,n,r,i){this.h=e,this.l=n,this.m=r,this.g=i,this.type="FirstParty",this.user=wt.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(be(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class pU{constructor(e,n,r,i){this.h=e,this.l=n,this.m=r,this.g=i}getToken(){return Promise.resolve(new fU(this.h,this.l,this.m,this.g))}start(e,n){e.enqueueRetryable(()=>n(wt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class gU{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class mU{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,n){const r=s=>{s.error!=null&&K("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.A;return this.A=s.token,K("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{K("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?i(s):K("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(be(typeof n.token=="string"),this.A=n.token,new gU(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yU(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=yU(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}}function Te(t,e){return t<e?-1:t>e?1:0}function xo(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function E1(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new se(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new se(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new se(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new We(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Te(this.nanoseconds,e.nanoseconds):Te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ge{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ge(e)}static min(){return new ge(new We(0,0))}static max(){return new ge(new We(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(e,n,r){n===void 0?n=0:n>e.length&&ae(),r===void 0?r=e.length-n:r>e.length-n&&ae(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Za.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Za?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Ve extends Za{construct(e,n,r){return new Ve(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new se(U.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new Ve(n)}static emptyPath(){return new Ve([])}}const bU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tt extends Za{construct(e,n,r){return new tt(e,n,r)}static isValidIdentifier(e){return bU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new tt(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new se(U.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new se(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new se(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new se(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tt(n)}static emptyPath(){return new tt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Ve.fromString(e))}static fromName(e){return new ee(Ve.fromString(e).popFirst(5))}static empty(){return new ee(Ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ve.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Ve(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}}function qf(t){return t.fields.find(e=>e.kind===2)}function Mi(t){return t.fields.filter(e=>e.kind!==2)}x1.UNKNOWN_ID=-1;class wU{constructor(e,n){this.fieldPath=e,this.kind=n}}class cu{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new cu(0,wn.min())}}function vU(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=ge.fromTimestamp(r===1e9?new We(n+1,0):new We(n,r));return new wn(i,ee.empty(),e)}function S1(t){return new wn(t.readTime,t.key,-1)}class wn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wn(ge.min(),ee.empty(),-1)}static max(){return new wn(ge.max(),ee.empty(),-1)}}function Ug(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ee.comparator(t.documentKey,e.documentKey),n!==0?n:Te(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class C1{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ts(t){if(t.code!==U.FAILED_PRECONDITION||t.message!==T1)throw t;K("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ae(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new k((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof k?n:k.resolve(n)}catch(n){return k.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):k.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):k.reject(n)}static resolve(e){return new k((n,r)=>{n(e)})}static reject(e){return new k((n,r)=>{r(e)})}static waitFor(e){return new k((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},l=>r(l))}),o=!0,s===i&&n()})}static or(e){let n=k.resolve(!1);for(const r of e)n=n.next(i=>i?k.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new k((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const c=l;n(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,n){return new k((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.P=new Kn,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{n.error?this.P.reject(new wa(e,n.error)):this.P.resolve()},this.transaction.onerror=r=>{const i=zg(r.target.error);this.P.reject(new wa(e,i))}}static open(e,n,r,i){try{return new hh(n,e.transaction(i,r))}catch(s){throw new wa(n,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(K("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new xU(n)}}class Er{constructor(e,n,r){this.name=e,this.version=n,this.S=r,Er.D(If())===12.2&&jt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return K("SimpleDb","Removing database:",e),Li(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!rS())return!1;if(Er.N())return!0;const e=If(),n=Er.D(e),r=0<n&&n<10,i=Er.k(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static N(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.O)==="YES"}static M(e,n){return e.store(n)}static D(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const n=e.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}async F(e){return this.db||(K("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const o=s.target.result;n(o)},i.onblocked=()=>{r(new wa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const o=s.target.error;o.name==="VersionError"?r(new se(U.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new se(U.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new wa(e,o))},i.onupgradeneeded=s=>{K("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.S.$(o,i.transaction,s.oldVersion,this.version).next(()=>{K("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=n=>this.B(n)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,i){const s=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.F(e);const a=hh.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.V(),c)).catch(c=>(a.abort(c),k.reject(c))).toPromise();return l.catch(()=>{}),await a.v,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(K("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}class EU{constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return Li(this.U.delete())}}class wa extends se{constructor(e,n){super(U.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function mi(t){return t.name==="IndexedDbTransactionError"}class xU{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(K("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(K("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Li(r)}add(e){return K("SimpleDb","ADD",this.store.name,e,e),Li(this.store.add(e))}get(e){return Li(this.store.get(e)).next(n=>(n===void 0&&(n=null),K("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return K("SimpleDb","DELETE",this.store.name,e),Li(this.store.delete(e))}count(){return K("SimpleDb","COUNT",this.store.name),Li(this.store.count())}W(e,n){const r=this.options(e,n);if(r.index||typeof this.store.getAll!="function"){const i=this.cursor(r),s=[];return this.H(i,(o,a)=>{s.push(a)}).next(()=>s)}{const i=this.store.getAll(r.range);return new k((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}J(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new k((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(e,n){K("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const i=this.cursor(r);return this.H(i,(s,o,a)=>a.delete())}Z(e,n){let r;n?r=e:(r={},n=e);const i=this.cursor(r);return this.H(i,n)}tt(e){const n=this.cursor({});return new k((r,i)=>{n.onerror=s=>{const o=zg(s.target.error);i(o)},n.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,n){const r=[];return new k((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const l=new EU(a),c=n(a.primaryKey,a.value,l);if(c instanceof k){const u=c.catch(h=>(l.done(),k.reject(h)));r.push(u)}l.isDone?i():l.G===null?a.continue():a.continue(l.G)}}).next(()=>k.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Li(t){return new k((e,n)=>{t.onsuccess=r=>{const i=r.target.result;e(i)},t.onerror=r=>{const i=zg(r.target.error);n(i)}})}let vw=!1;function zg(t){const e=Er.D(If());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new se("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return vw||(vw=!0,setTimeout(()=>{throw r},0)),r}}return t}class SU{constructor(e,n){this.asyncQueue=e,this.et=n,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}nt(e){K("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{K("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(n){mi(n)?K("IndexBackiller","Ignoring IndexedDB error during index backfill: ",n):await Ts(n)}await this.nt(6e4)})}}class TU{constructor(e,n){this.localStore=e,this.persistence=n}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.it(n,e))}it(e,n){const r=new Set;let i=n,s=!0;return k.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return K("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>n-i)}rt(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(i=>this.localStore.localDocuments.getNextDocuments(e,n,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(i,s)).next(a=>(K("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}ot(e,n){let r=e;return n.changes.forEach((i,s)=>{const o=S1(s);Ug(o,r)>0&&(r=o)}),new wn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>n.writeSequenceNumber(r))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ew(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Cs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function k1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */An.at=-1;class it{constructor(e,n){this.comparator=e,this.root=n||vt.EMPTY}insert(e,n){return new it(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,vt.BLACK,null,null))}remove(e){return new it(this.comparator,this.root.remove(e,this.comparator).copy(null,null,vt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tc(this.root,e,this.comparator,!1)}getReverseIterator(){return new tc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tc(this.root,e,this.comparator,!0)}}class tc{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class vt{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r!=null?r:vt.RED,this.left=i!=null?i:vt.EMPTY,this.right=s!=null?s:vt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new vt(e!=null?e:this.key,n!=null?n:this.value,r!=null?r:this.color,i!=null?i:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return vt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return vt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,vt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,vt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ae();const e=this.left.check();if(e!==this.right.check())throw ae();return e+(this.isRed()?0:1)}}vt.EMPTY=null,vt.RED=!0,vt.BLACK=!1;vt.EMPTY=new class{constructor(){this.size=0}get key(){throw ae()}get value(){throw ae()}get color(){throw ae()}get left(){throw ae()}get right(){throw ae()}copy(t,e,n,r,i){return this}insert(t,e,n){return new vt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.comparator=e,this.data=new it(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new xw(this.data.getIterator())}getIteratorFrom(e){return new xw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof $e)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new $e(this.comparator);return n.data=e,n}}class xw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ds(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e){this.fields=e,e.sort(tt.comparator)}static empty(){return new gn([])}unionWith(e){let n=new $e(tt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new gn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return xo(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=atob(e);return new pt(n)}static fromUint8Array(e){const n=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new pt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const CU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function li(t){if(be(!!t),typeof t=="string"){let e=0;const n=CU.exec(t);if(be(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ge(t.seconds),nanos:Ge(t.nanos)}}function Ge(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ds(t){return typeof t=="string"?pt.fromBase64String(t):pt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I1(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function A1(t){const e=t.mapValue.fields.__previous_value__;return I1(e)?A1(e):e}function el(t){const e=li(t.mapValue.fields.__local_write_time__.timestampValue);return new We(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kU{constructor(e,n,r,i,s,o,a,l){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=l}}class fs{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new fs("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof fs&&e.projectId===this.projectId&&e.database===this.database}}function dh(t){return t==null}function tl(t){return t===0&&1/t==-1/0}function IU(t){return typeof t=="number"&&Number.isInteger(t)&&!tl(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},vc={nullValue:"NULL_VALUE"};function ps(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?I1(t)?4:_1(t)?9007199254740991:10:ae()}function gr(t,e){if(t===e)return!0;const n=ps(t);if(n!==ps(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return el(t).isEqual(el(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=li(r.timestampValue),o=li(i.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,i){return ds(r.bytesValue).isEqual(ds(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,i){return Ge(r.geoPointValue.latitude)===Ge(i.geoPointValue.latitude)&&Ge(r.geoPointValue.longitude)===Ge(i.geoPointValue.longitude)}(t,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Ge(r.integerValue)===Ge(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Ge(r.doubleValue),o=Ge(i.doubleValue);return s===o?tl(s)===tl(o):isNaN(s)&&isNaN(o)}return!1}(t,e);case 9:return xo(t.arrayValue.values||[],e.arrayValue.values||[],gr);case 10:return function(r,i){const s=r.mapValue.fields||{},o=i.mapValue.fields||{};if(Ew(s)!==Ew(o))return!1;for(const a in s)if(s.hasOwnProperty(a)&&(o[a]===void 0||!gr(s[a],o[a])))return!1;return!0}(t,e);default:return ae()}}function nl(t,e){return(t.values||[]).find(n=>gr(n,e))!==void 0}function ci(t,e){if(t===e)return 0;const n=ps(t),r=ps(e);if(n!==r)return Te(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Te(t.booleanValue,e.booleanValue);case 2:return function(i,s){const o=Ge(i.integerValue||i.doubleValue),a=Ge(s.integerValue||s.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Sw(t.timestampValue,e.timestampValue);case 4:return Sw(el(t),el(e));case 5:return Te(t.stringValue,e.stringValue);case 6:return function(i,s){const o=ds(i),a=ds(s);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(i,s){const o=i.split("/"),a=s.split("/");for(let l=0;l<o.length&&l<a.length;l++){const c=Te(o[l],a[l]);if(c!==0)return c}return Te(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,s){const o=Te(Ge(i.latitude),Ge(s.latitude));return o!==0?o:Te(Ge(i.longitude),Ge(s.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(i,s){const o=i.values||[],a=s.values||[];for(let l=0;l<o.length&&l<a.length;++l){const c=ci(o[l],a[l]);if(c)return c}return Te(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===qr.mapValue&&s===qr.mapValue)return 0;if(i===qr.mapValue)return 1;if(s===qr.mapValue)return-1;const o=i.fields||{},a=Object.keys(o),l=s.fields||{},c=Object.keys(l);a.sort(),c.sort();for(let u=0;u<a.length&&u<c.length;++u){const h=Te(a[u],c[u]);if(h!==0)return h;const d=ci(o[a[u]],l[c[u]]);if(d!==0)return d}return Te(a.length,c.length)}(t.mapValue,e.mapValue);default:throw ae()}}function Sw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Te(t,e);const n=li(t),r=li(e),i=Te(n.seconds,r.seconds);return i!==0?i:Te(n.nanos,r.nanos)}function no(t){return Wf(t)}function Wf(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const i=li(r);return`time(${i.seconds},${i.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ds(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ee.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(r){let i="[",s=!0;for(const o of r.values||[])s?s=!1:i+=",",i+=Wf(o);return i+"]"}(t.arrayValue):"mapValue"in t?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",o=!0;for(const a of i)o?o=!1:s+=",",s+=`${a}:${Wf(r.fields[a])}`;return s+"}"}(t.mapValue):ae();var e,n}function Hg(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Gf(t){return!!t&&"integerValue"in t}function rl(t){return!!t&&"arrayValue"in t}function Tw(t){return!!t&&"nullValue"in t}function Cw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ec(t){return!!t&&"mapValue"in t}function va(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Cs(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=va(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=va(t.arrayValue.values[n]);return e}return Object.assign({},t)}function _1(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function AU(t){return"nullValue"in t?vc:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Hg(fs.empty(),ee.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:ae()}function _U(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Hg(fs.empty(),ee.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?qr:ae()}function kw(t,e){const n=ci(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Iw(t,e){const n=ci(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.value=e}static empty(){return new Ot({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Ec(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=va(n)}setAll(e){let n=tt.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=va(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());Ec(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return gr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Ec(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Cs(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Ot(va(this.value))}}function M1(t){const e=[];return Cs(t.fields,(n,r)=>{const i=new tt([n]);if(Ec(r)){const s=M1(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new gn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e,n,r,i,s,o){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new qe(e,0,ge.min(),ge.min(),Ot.empty(),0)}static newFoundDocument(e,n,r){return new qe(e,1,n,ge.min(),r,0)}static newNoDocument(e,n){return new qe(e,2,n,ge.min(),Ot.empty(),0)}static newUnknownDocument(e,n){return new qe(e,3,n,ge.min(),Ot.empty(),2)}convertToFoundDocument(e,n){return this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ge.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ht=null}}function Aw(t,e=null,n=[],r=[],i=null,s=null,o=null){return new MU(t,e,n,r,i,s,o)}function gs(t){const e=we(t);if(e.ht===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>{return(i=r).field.canonicalString()+i.op.toString()+no(i.value);var i}).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),dh(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>no(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>no(r)).join(",")),e.ht=n}return e.ht}function OU(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(n=>{return`${(r=n).field.canonicalString()} ${r.op} ${no(r.value)}`;var r}).join(", ")}]`),dh(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(n=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(n)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>no(n)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>no(n)).join(",")),`Target(${e})`}function Tl(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<t.orderBy.length;i++)if(!VU(t.orderBy[i],e.orderBy[i]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],r=e.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!gr(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Nw(t.startAt,e.startAt)&&Nw(t.endAt,e.endAt)}function uu(t){return ee.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function hu(t,e){return t.filters.filter(n=>n instanceof Rt&&n.field.isEqual(e))}function _w(t,e,n){let r=vc,i=!0;for(const s of hu(t,e)){let o=vc,a=!0;switch(s.op){case"<":case"<=":o=AU(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=vc}kw({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const o=n.position[s];kw({value:r,inclusive:i},{value:o,inclusive:n.inclusive})<0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}function Mw(t,e,n){let r=qr,i=!0;for(const s of hu(t,e)){let o=qr,a=!0;switch(s.op){case">=":case">":o=_U(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=qr}Iw({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const o=n.position[s];Iw({value:r,inclusive:i},{value:o,inclusive:n.inclusive})>0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}class Rt extends class{}{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.lt(e,n,r):new NU(e,n,r):n==="array-contains"?new PU(e,r):n==="in"?new LU(e,r):n==="not-in"?new BU(e,r):n==="array-contains-any"?new FU(e,r):new Rt(e,n,r)}static lt(e,n,r){return n==="in"?new DU(e,r):new RU(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.ft(ci(n,this.value)):n!==null&&ps(this.value)===ps(n)&&this.ft(ci(n,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ae()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class NU extends Rt{constructor(e,n,r){super(e,n,r),this.key=ee.fromName(r.referenceValue)}matches(e){const n=ee.comparator(e.key,this.key);return this.ft(n)}}class DU extends Rt{constructor(e,n){super(e,"in",n),this.keys=O1("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class RU extends Rt{constructor(e,n){super(e,"not-in",n),this.keys=O1("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function O1(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ee.fromName(r.referenceValue))}class PU extends Rt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return rl(n)&&nl(n.arrayValue,this.value)}}class LU extends Rt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&nl(this.value.arrayValue,n)}}class BU extends Rt{constructor(e,n){super(e,"not-in",n)}matches(e){if(nl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!nl(this.value.arrayValue,n)}}class FU extends Rt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!rl(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>nl(this.value.arrayValue,r))}}class So{constructor(e,n){this.position=e,this.inclusive=n}}class Ea{constructor(e,n="asc"){this.field=e,this.dir=n}}function VU(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ow(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=ee.comparator(ee.fromName(o.referenceValue),n.key):r=ci(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Nw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!gr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this._t=null,this.wt=null,this.startAt,this.endAt}}function $U(t,e,n,r,i,s,o,a){return new fh(t,e,n,r,i,s,o,a)}function ph(t){return new fh(t)}function Dw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function UU(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function zU(t){for(const e of t.filters)if(e.dt())return e.field;return null}function HU(t){return t.collectionGroup!==null}function il(t){const e=we(t);if(e._t===null){e._t=[];const n=zU(e),r=UU(e);if(n!==null&&r===null)n.isKeyField()||e._t.push(new Ea(n)),e._t.push(new Ea(tt.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e._t.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new Ea(tt.keyField(),s))}}}return e._t}function Wn(t){const e=we(t);if(!e.wt)if(e.limitType==="F")e.wt=Aw(e.path,e.collectionGroup,il(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const s of il(e)){const o=s.dir==="desc"?"asc":"desc";n.push(new Ea(s.field,o))}const r=e.endAt?new So(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new So(e.startAt.position,e.startAt.inclusive):null;e.wt=Aw(e.path,e.collectionGroup,n,e.filters,e.limit,r,i)}return e.wt}function Jf(t,e,n){return new fh(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function gh(t,e){return Tl(Wn(t),Wn(e))&&t.limitType===e.limitType}function N1(t){return`${gs(Wn(t))}|lt:${t.limitType}`}function Xf(t){return`Query(target=${OU(Wn(t))}; limitType=${t.limitType})`}function jg(t,e){return e.isFoundDocument()&&function(n,r){const i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):ee.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(t,e)&&function(n,r){for(const i of n.explicitOrderBy)if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(t,e)&&function(n,r){for(const i of n.filters)if(!i.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!function(i,s,o){const a=Ow(i,s,o);return i.inclusive?a<=0:a<0}(n.startAt,il(n),r)||n.endAt&&!function(i,s,o){const a=Ow(i,s,o);return i.inclusive?a>=0:a>0}(n.endAt,il(n),r))}(t,e)}function jU(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function D1(t){return(e,n)=>{let r=!1;for(const i of il(t)){const s=KU(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function KU(t,e,n){const r=t.field.isKeyField()?ee.comparator(e.key,n.key):function(i,s,o){const a=s.data.field(i),l=o.data.field(i);return a!==null&&l!==null?ci(a,l):ae()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ae()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R1(t,e){if(t.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tl(e)?"-0":e}}function P1(t){return{integerValue:""+t}}function qU(t,e){return IU(e)?P1(e):R1(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh{constructor(){this._=void 0}}function WU(t,e,n){return t instanceof sl?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(s.fields.__previous_value__=i),{mapValue:s}}(n,e):t instanceof To?B1(t,e):t instanceof Co?F1(t,e):function(r,i){const s=L1(r,i),o=Rw(s)+Rw(r.yt);return Gf(s)&&Gf(r.yt)?P1(o):R1(r.It,o)}(t,e)}function GU(t,e,n){return t instanceof To?B1(t,e):t instanceof Co?F1(t,e):n}function L1(t,e){return t instanceof ol?Gf(n=e)||function(r){return!!r&&"doubleValue"in r}(n)?e:{integerValue:0}:null;var n}class sl extends mh{}class To extends mh{constructor(e){super(),this.elements=e}}function B1(t,e){const n=V1(e);for(const r of t.elements)n.some(i=>gr(i,r))||n.push(r);return{arrayValue:{values:n}}}class Co extends mh{constructor(e){super(),this.elements=e}}function F1(t,e){let n=V1(e);for(const r of t.elements)n=n.filter(i=>!gr(i,r));return{arrayValue:{values:n}}}class ol extends mh{constructor(e,n){super(),this.It=e,this.yt=n}}function Rw(t){return Ge(t.integerValue||t.doubleValue)}function V1(t){return rl(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JU{constructor(e,n){this.field=e,this.transform=n}}function XU(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof To&&r instanceof To||n instanceof Co&&r instanceof Co?xo(n.elements,r.elements,gr):n instanceof ol&&r instanceof ol?gr(n.yt,r.yt):n instanceof sl&&r instanceof sl}(t.transform,e.transform)}class YU{constructor(e,n){this.version=e,this.transformResults=n}}class Pt{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Pt}static exists(e){return new Pt(void 0,e)}static updateTime(e){return new Pt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xc(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class yh{}function $1(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new bh(t.key,Pt.none()):new Fo(t.key,t.data,Pt.none());{const n=t.data,r=Ot.empty();let i=new $e(tt.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ar(t.key,r,new gn(i.toArray()),Pt.none())}}function QU(t,e,n){t instanceof Fo?function(r,i,s){const o=r.value.clone(),a=Lw(r.fieldTransforms,i,s.transformResults);o.setAll(a),i.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(t,e,n):t instanceof Ar?function(r,i,s){if(!xc(r.precondition,i))return void i.convertToUnknownDocument(s.version);const o=Lw(r.fieldTransforms,i,s.transformResults),a=i.data;a.setAll(U1(r)),a.setAll(o),i.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(t,e,n):function(r,i,s){i.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,n)}function xa(t,e,n,r){return t instanceof Fo?function(i,s,o,a){if(!xc(i.precondition,s))return o;const l=i.value.clone(),c=Bw(i.fieldTransforms,a,s);return l.setAll(c),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ar?function(i,s,o,a){if(!xc(i.precondition,s))return o;const l=Bw(i.fieldTransforms,a,s),c=s.data;return c.setAll(U1(i)),c.setAll(l),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),o===null?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(u=>u.field))}(t,e,n,r):function(i,s,o){return xc(i.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):o}(t,e,n)}function ZU(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=L1(r.transform,i||null);s!=null&&(n===null&&(n=Ot.empty()),n.set(r.field,s))}return n||null}function Pw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&xo(n,r,(i,s)=>XU(i,s))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Fo extends yh{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ar extends yh{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function U1(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Lw(t,e,n){const r=new Map;be(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,GU(o,a,n[i]))}return r}function Bw(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,WU(s,o,e))}return r}class bh extends yh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class z1 extends yh{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ez{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ze,_e;function tz(t){switch(t){default:return ae();case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0}}function H1(t){if(t===void 0)return jt("GRPC error has no .code"),U.UNKNOWN;switch(t){case Ze.OK:return U.OK;case Ze.CANCELLED:return U.CANCELLED;case Ze.UNKNOWN:return U.UNKNOWN;case Ze.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case Ze.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case Ze.INTERNAL:return U.INTERNAL;case Ze.UNAVAILABLE:return U.UNAVAILABLE;case Ze.UNAUTHENTICATED:return U.UNAUTHENTICATED;case Ze.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case Ze.NOT_FOUND:return U.NOT_FOUND;case Ze.ALREADY_EXISTS:return U.ALREADY_EXISTS;case Ze.PERMISSION_DENIED:return U.PERMISSION_DENIED;case Ze.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case Ze.ABORTED:return U.ABORTED;case Ze.OUT_OF_RANGE:return U.OUT_OF_RANGE;case Ze.UNIMPLEMENTED:return U.UNIMPLEMENTED;case Ze.DATA_LOSS:return U.DATA_LOSS;default:return ae()}}(_e=Ze||(Ze={}))[_e.OK=0]="OK",_e[_e.CANCELLED=1]="CANCELLED",_e[_e.UNKNOWN=2]="UNKNOWN",_e[_e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_e[_e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_e[_e.NOT_FOUND=5]="NOT_FOUND",_e[_e.ALREADY_EXISTS=6]="ALREADY_EXISTS",_e[_e.PERMISSION_DENIED=7]="PERMISSION_DENIED",_e[_e.UNAUTHENTICATED=16]="UNAUTHENTICATED",_e[_e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_e[_e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_e[_e.ABORTED=10]="ABORTED",_e[_e.OUT_OF_RANGE=11]="OUT_OF_RANGE",_e[_e.UNIMPLEMENTED=12]="UNIMPLEMENTED",_e[_e.INTERNAL=13]="INTERNAL",_e[_e.UNAVAILABLE=14]="UNAVAILABLE",_e[_e.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Cs(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return k1(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nz=new it(ee.comparator);function fn(){return nz}const j1=new it(ee.comparator);function ia(...t){let e=j1;for(const n of t)e=e.insert(n.key,n);return e}function K1(t){let e=j1;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ar(){return Sa()}function q1(){return Sa()}function Sa(){return new yi(t=>t.toString(),(t,e)=>t.isEqual(e))}const rz=new it(ee.comparator),iz=new $e(ee.comparator);function Ie(...t){let e=iz;for(const n of t)e=e.add(n);return e}const sz=new $e(Te);function W1(){return sz}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n){const r=new Map;return r.set(e,Cl.createSynthesizedTargetChangeForCurrentChange(e,n)),new wh(ge.min(),r,W1(),fn(),Ie())}}class Cl{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n){return new Cl(pt.EMPTY_BYTE_STRING,n,Ie(),Ie(),Ie())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e,n,r,i){this.Tt=e,this.removedTargetIds=n,this.key=r,this.Et=i}}class G1{constructor(e,n){this.targetId=e,this.At=n}}class J1{constructor(e,n,r=pt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class Fw{constructor(){this.Rt=0,this.bt=$w(),this.Pt=pt.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return this.Rt!==0}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=Ie(),n=Ie(),r=Ie();return this.bt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:ae()}}),new Cl(this.Pt,this.vt,e,n,r)}Nt(){this.Vt=!1,this.bt=$w()}kt(e,n){this.Vt=!0,this.bt=this.bt.insert(e,n)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class oz{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=fn(),this.qt=Vw(),this.Kt=new $e(Te)}Gt(e){for(const n of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(n,e.Et):this.jt(n,e.key,e.Et);for(const n of e.removedTargetIds)this.jt(n,e.key,e.Et)}Wt(e){this.forEachTarget(e,n=>{const r=this.zt(n);switch(e.state){case 0:this.Ht(n)&&r.Ct(e.resumeToken);break;case 1:r.Ft(),r.St||r.Nt(),r.Ct(e.resumeToken);break;case 2:r.Ft(),r.St||this.removeTarget(n);break;case 3:this.Ht(n)&&(r.$t(),r.Ct(e.resumeToken));break;case 4:this.Ht(n)&&(this.Jt(n),r.Ct(e.resumeToken));break;default:ae()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Lt.forEach((r,i)=>{this.Ht(i)&&n(i)})}Yt(e){const n=e.targetId,r=e.At.count,i=this.Xt(n);if(i){const s=i.target;if(uu(s))if(r===0){const o=new ee(s.path);this.jt(n,o,qe.newNoDocument(o,ge.min()))}else be(r===1);else this.Zt(n)!==r&&(this.Jt(n),this.Kt=this.Kt.add(n))}}te(e){const n=new Map;this.Lt.forEach((s,o)=>{const a=this.Xt(o);if(a){if(s.current&&uu(a.target)){const l=new ee(a.target.path);this.Ut.get(l)!==null||this.ee(o,l)||this.jt(o,l,qe.newNoDocument(l,e))}s.Dt&&(n.set(o,s.xt()),s.Nt())}});let r=Ie();this.qt.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Xt(l);return!c||c.purpose===2||(a=!1,!1)}),a&&(r=r.add(s))}),this.Ut.forEach((s,o)=>o.setReadTime(e));const i=new wh(e,n,this.Kt,this.Ut,r);return this.Ut=fn(),this.qt=Vw(),this.Kt=new $e(Te),i}Qt(e,n){if(!this.Ht(e))return;const r=this.ee(e,n.key)?2:0;this.zt(e).kt(n.key,r),this.Ut=this.Ut.insert(n.key,n),this.qt=this.qt.insert(n.key,this.ne(n.key).add(e))}jt(e,n,r){if(!this.Ht(e))return;const i=this.zt(e);this.ee(e,n)?i.kt(n,1):i.Ot(n),this.qt=this.qt.insert(n,this.ne(n).delete(e)),r&&(this.Ut=this.Ut.insert(n,r))}removeTarget(e){this.Lt.delete(e)}Zt(e){const n=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let n=this.Lt.get(e);return n||(n=new Fw,this.Lt.set(e,n)),n}ne(e){let n=this.qt.get(e);return n||(n=new $e(Te),this.qt=this.qt.insert(e,n)),n}Ht(e){const n=this.Xt(e)!==null;return n||K("WatchChangeAggregator","Detected inactive target",e),n}Xt(e){const n=this.Lt.get(e);return n&&n.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new Fw),this.Bt.getRemoteKeysForTarget(e).forEach(n=>{this.jt(e,n,null)})}ee(e,n){return this.Bt.getRemoteKeysForTarget(e).has(n)}}function Vw(){return new it(ee.comparator)}function $w(){return new it(ee.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const az=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),lz=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class cz{constructor(e,n){this.databaseId=e,this.gt=n}}function al(t,e){return t.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function X1(t,e){return t.gt?e.toBase64():e.toUint8Array()}function uz(t,e){return al(t,e.toTimestamp())}function mn(t){return be(!!t),ge.fromTimestamp(function(e){const n=li(e);return new We(n.seconds,n.nanos)}(t))}function Kg(t,e){return function(n){return new Ve(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function Y1(t){const e=Ve.fromString(t);return be(iT(e)),e}function du(t,e){return Kg(t.databaseId,e.path)}function ts(t,e){const n=Y1(e);if(n.get(1)!==t.databaseId.projectId)throw new se(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new se(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ee(Z1(n))}function Yf(t,e){return Kg(t.databaseId,e)}function Q1(t){const e=Y1(t);return e.length===4?Ve.emptyPath():Z1(e)}function Qf(t){return new Ve(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Z1(t){return be(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Uw(t,e,n){return{name:du(t,e),fields:n.value.mapValue.fields}}function hz(t,e,n){const r=ts(t,e.name),i=mn(e.updateTime),s=new Ot({mapValue:{fields:e.fields}}),o=qe.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function dz(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:ae()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,c){return l.gt?(be(c===void 0||typeof c=="string"),pt.fromBase64String(c||"")):(be(c===void 0||c instanceof Uint8Array),pt.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=l.code===void 0?U.UNKNOWN:H1(l.code);return new se(c,l.message||"")}(o);n=new J1(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=ts(t,r.document.name),s=mn(r.document.updateTime),o=new Ot({mapValue:{fields:r.document.fields}}),a=qe.newFoundDocument(i,s,o),l=r.targetIds||[],c=r.removedTargetIds||[];n=new Sc(l,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=ts(t,r.document),s=r.readTime?mn(r.readTime):ge.min(),o=qe.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Sc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=ts(t,r.document),s=r.removedTargetIds||[];n=new Sc([],s,i,null)}else{if(!("filter"in e))return ae();{e.filter;const r=e.filter;r.targetId;const i=r.count||0,s=new ez(i),o=r.targetId;n=new G1(o,s)}}return n}function fu(t,e){let n;if(e instanceof Fo)n={update:Uw(t,e.key,e.value)};else if(e instanceof bh)n={delete:du(t,e.key)};else if(e instanceof Ar)n={update:Uw(t,e.key,e.data),updateMask:wz(e.fieldMask)};else{if(!(e instanceof z1))return ae();n={verify:du(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const o=s.transform;if(o instanceof sl)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof To)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Co)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof ol)return{fieldPath:s.field.canonicalString(),increment:o.yt};throw ae()}(0,r))),e.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:uz(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ae()}(t,e.precondition)),n}function Zf(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?Pt.updateTime(mn(i.updateTime)):i.exists!==void 0?Pt.exists(i.exists):Pt.none()}(e.currentDocument):Pt.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,o){let a=null;if("setToServerValue"in o)be(o.setToServerValue==="REQUEST_TIME"),a=new sl;else if("appendMissingElements"in o){const c=o.appendMissingElements.values||[];a=new To(c)}else if("removeAllFromArray"in o){const c=o.removeAllFromArray.values||[];a=new Co(c)}else"increment"in o?a=new ol(s,o.increment):ae();const l=tt.fromServerFormat(o.fieldPath);return new JU(l,a)}(t,i)):[];if(e.update){e.update.name;const i=ts(t,e.update.name),s=new Ot({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(a){const l=a.fieldPaths||[];return new gn(l.map(c=>tt.fromServerFormat(c)))}(e.updateMask);return new Ar(i,s,o,n,r)}return new Fo(i,s,n,r)}if(e.delete){const i=ts(t,e.delete);return new bh(i,n)}if(e.verify){const i=ts(t,e.verify);return new z1(i,n)}return ae()}function fz(t,e){return t&&t.length>0?(be(e!==void 0),t.map(n=>function(r,i){let s=r.updateTime?mn(r.updateTime):mn(i);return s.isEqual(ge.min())&&(s=mn(i)),new YU(s,r.transformResults||[])}(n,e))):[]}function eT(t,e){return{documents:[Yf(t,e.path)]}}function tT(t,e){const n={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(n.parent=Yf(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Yf(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(l){if(l.length===0)return;const c=l.map(u=>function(h){if(h.op==="=="){if(Cw(h.value))return{unaryFilter:{field:Rs(h.field),op:"IS_NAN"}};if(Tw(h.value))return{unaryFilter:{field:Rs(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(Cw(h.value))return{unaryFilter:{field:Rs(h.field),op:"IS_NOT_NAN"}};if(Tw(h.value))return{unaryFilter:{field:Rs(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rs(h.field),op:mz(h.op),value:h.value}}}(u));return c.length===1?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);i&&(n.structuredQuery.where=i);const s=function(l){if(l.length!==0)return l.map(c=>function(u){return{field:Rs(u.field),direction:gz(u.dir)}}(c))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(l,c){return l.gt||dh(c)?c:{value:c}}(t,e.limit);var a;return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),n}function nT(t){let e=Q1(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){be(r===1);const u=n.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];n.where&&(s=rT(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(u=>function(h){return new Ea(Ws(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(u)));let a=null;n.limit&&(a=function(u){let h;return h=typeof u=="object"?u.value:u,dh(h)?null:h}(n.limit));let l=null;n.startAt&&(l=function(u){const h=!!u.before,d=u.values||[];return new So(d,h)}(n.startAt));let c=null;return n.endAt&&(c=function(u){const h=!u.before,d=u.values||[];return new So(d,h)}(n.endAt)),$U(e,i,o,s,a,"F",l,c)}function pz(t,e){const n=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ae()}}(0,e.purpose);return n==null?null:{"goog-listen-tags":n}}function rT(t){return t?t.unaryFilter!==void 0?[bz(t)]:t.fieldFilter!==void 0?[yz(t)]:t.compositeFilter!==void 0?t.compositeFilter.filters.map(e=>rT(e)).reduce((e,n)=>e.concat(n)):ae():[]}function gz(t){return az[t]}function mz(t){return lz[t]}function Rs(t){return{fieldPath:t.canonicalString()}}function Ws(t){return tt.fromServerFormat(t.fieldPath)}function yz(t){return Rt.create(Ws(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ae()}}(t.fieldFilter.op),t.fieldFilter.value)}function bz(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ws(t.unaryFilter.field);return Rt.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ws(t.unaryFilter.field);return Rt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ws(t.unaryFilter.field);return Rt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ws(t.unaryFilter.field);return Rt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ae()}}function wz(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function iT(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=zw(e)),e=vz(t.get(n),e);return zw(e)}function vz(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function zw(t){return t+""}function lr(t){const e=t.length;if(be(e>=2),e===2)return be(t.charAt(0)===""&&t.charAt(1)===""),Ve.emptyPath();const n=e-2,r=[];let i="";for(let s=0;s<e;){const o=t.indexOf("",s);switch((o<0||o>n)&&ae(),t.charAt(o+1)){case"":const a=t.substring(s,o);let l;i.length===0?l=a:(i+=a,l=i,i=""),r.push(l);break;case"":i+=t.substring(s,o),i+="\0";break;case"":i+=t.substring(s,o+1);break;default:ae()}s=o+2}return new Ve(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tc(t,e){return[t,Wt(e)]}function sT(t,e,n){return[t,Wt(e),n]}const Ez={},xz=["prefixPath","collectionGroup","readTime","documentId"],Sz=["prefixPath","collectionGroup","documentId"],Tz=["collectionGroup","readTime","prefixPath","documentId"],Cz=["canonicalId","targetId"],kz=["targetId","path"],Iz=["path","targetId"],Az=["collectionId","parent"],_z=["indexId","uid"],Mz=["uid","sequenceNumber"],Oz=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Nz=["indexId","uid","orderedDocumentKey"],Dz=["userId","collectionPath","documentId"],Rz=["userId","collectionPath","largestBatchId"],Pz=["userId","collectionGroup","largestBatchId"],oT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Lz=[...oT,"documentOverlays"],aT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],lT=aT,Bz=[...lT,"indexConfiguration","indexState","indexEntries"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep extends C1{constructor(e,n){super(),this.ie=e,this.currentSequenceNumber=n}}function gt(t,e){const n=we(t);return Er.M(n.ie,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&QU(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=xa(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=xa(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=q1();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const l=$1(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(ge.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ie())}isEqual(e){return this.batchId===e.batchId&&xo(this.mutations,e.mutations,(n,r)=>Pw(n,r))&&xo(this.baseMutations,e.baseMutations,(n,r)=>Pw(n,r))}}class Wg{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){be(e.mutations.length===r.length);let i=rz;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new Wg(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e,n,r,i,s=ge.min(),o=ge.min(),a=pt.EMPTY_BYTE_STRING){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new ti(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,n){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cT{constructor(e){this.re=e}}function Fz(t,e){let n;if(e.document)n=hz(t.re,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ee.fromSegments(e.noDocument.path),i=ys(e.noDocument.readTime);n=qe.newNoDocument(r,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return ae();{const r=ee.fromSegments(e.unknownDocument.path),i=ys(e.unknownDocument.version);n=qe.newUnknownDocument(r,i)}}return e.readTime&&n.setReadTime(function(r){const i=new We(r[0],r[1]);return ge.fromTimestamp(i)}(e.readTime)),n}function jw(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:pu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,s){return{name:du(i,s.key),fields:s.data.value.mapValue.fields,updateTime:al(i,s.version.toTimestamp())}}(t.re,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:ms(e.version)};else{if(!e.isUnknownDocument())return ae();r.unknownDocument={path:n.path.toArray(),version:ms(e.version)}}return r}function pu(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ms(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ys(t){const e=new We(t.seconds,t.nanoseconds);return ge.fromTimestamp(e)}function Bi(t,e){const n=(e.baseMutations||[]).map(s=>Zf(t.re,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>Zf(t.re,s)),i=We.fromMillis(e.localWriteTimeMs);return new qg(e.batchId,i,n,r)}function sa(t){const e=ys(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?ys(t.lastLimboFreeSnapshotVersion):ge.min();let r;var i;return t.query.documents!==void 0?(be((i=t.query).documents.length===1),r=Wn(ph(Q1(i.documents[0])))):r=function(s){return Wn(nT(s))}(t.query),new ti(r,t.targetId,0,t.lastListenSequenceNumber,e,n,pt.fromBase64String(t.resumeToken))}function uT(t,e){const n=ms(e.snapshotVersion),r=ms(e.lastLimboFreeSnapshotVersion);let i;i=uu(e.target)?eT(t.re,e.target):tT(t.re,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:gs(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function hT(t){const e=nT({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Jf(e,e.limit,"L"):e}function _d(t,e){return new Gg(e.largestBatchId,Zf(t.re,e.overlayMutation))}function Kw(t,e){const n=e.path.lastSegment();return[t,Wt(e.path.popLast()),n]}function qw(t,e,n,r){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:ms(r.readTime),documentKey:Wt(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vz{getBundleMetadata(e,n){return Ww(e).get(n).next(r=>{if(r)return{id:(i=r).bundleId,createTime:ys(i.createTime),version:i.version};var i})}saveBundleMetadata(e,n){return Ww(e).put({bundleId:(r=n).id,createTime:ms(mn(r.createTime)),version:r.version});var r}getNamedQuery(e,n){return Gw(e).get(n).next(r=>{if(r)return{name:(i=r).name,query:hT(i.bundledQuery),readTime:ys(i.readTime)};var i})}saveNamedQuery(e,n){return Gw(e).put(function(r){return{name:r.name,readTime:ms(mn(r.readTime)),bundledQuery:r.bundledQuery}}(n))}}function Ww(t){return gt(t,"bundles")}function Gw(t){return gt(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e,n){this.It=e,this.userId=n}static oe(e,n){const r=n.uid||"";return new vh(e,r)}getOverlay(e,n){return jo(e).get(Kw(this.userId,n)).next(r=>r?_d(this.It,r):null)}getOverlays(e,n){const r=ar();return k.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){const i=[];return r.forEach((s,o)=>{const a=new Gg(n,o);i.push(this.ue(e,a))}),k.waitFor(i)}removeOverlaysForBatchId(e,n,r){const i=new Set;n.forEach(o=>i.add(Wt(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(jo(e).Y("collectionPathOverlayIndex",a))}),k.waitFor(s)}getOverlaysForCollection(e,n,r){const i=ar(),s=Wt(n),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return jo(e).W("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=_d(this.It,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,n,r,i){const s=ar();let o;const a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return jo(e).Z({index:"collectionGroupOverlayIndex",range:a},(l,c,u)=>{const h=_d(this.It,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}ue(e,n){return jo(e).put(function(r,i,s){const[o,a,l]=Kw(i,s.mutation.key);return{userId:i,collectionPath:a,documentId:l,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:fu(r.re,s.mutation)}}(this.It,this.userId,n))}}function jo(t){return gt(t,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(){}ce(e,n){this.ae(e,n),n.he()}ae(e,n){if("nullValue"in e)this.le(n,5);else if("booleanValue"in e)this.le(n,10),n.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(n,15),n.fe(Ge(e.integerValue));else if("doubleValue"in e){const r=Ge(e.doubleValue);isNaN(r)?this.le(n,13):(this.le(n,15),tl(r)?n.fe(0):n.fe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.le(n,20),typeof r=="string"?n.de(r):(n.de(`${r.seconds||""}`),n.fe(r.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,n),this.we(n);else if("bytesValue"in e)this.le(n,30),n.me(ds(e.bytesValue)),this.we(n);else if("referenceValue"in e)this.ge(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.le(n,45),n.fe(r.latitude||0),n.fe(r.longitude||0)}else"mapValue"in e?_1(e)?this.le(n,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,n),this.we(n)):"arrayValue"in e?(this.pe(e.arrayValue,n),this.we(n)):ae()}_e(e,n){this.le(n,25),this.Ie(e,n)}Ie(e,n){n.de(e)}ye(e,n){const r=e.fields||{};this.le(n,55);for(const i of Object.keys(r))this._e(i,n),this.ae(r[i],n)}pe(e,n){const r=e.values||[];this.le(n,50);for(const i of r)this.ae(i,n)}ge(e,n){this.le(n,37),ee.fromName(e).path.forEach(r=>{this.le(n,60),this.Ie(r,n)})}le(e,n){e.fe(n)}we(e){e.fe(2)}}Fi.Te=new Fi;function $z(t){if(t===0)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function Jw(t){const e=64-function(n){let r=0;for(let i=0;i<8;++i){const s=$z(255&n[i]);if(r+=s,s!==8)break}return r}(t);return Math.ceil(e/8)}class Uz{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ae(r.value),r=n.next();this.Re()}be(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Pe(r.value),r=n.next();this.ve()}Ve(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ae(r);else if(r<2048)this.Ae(960|r>>>6),this.Ae(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ae(480|r>>>12),this.Ae(128|63&r>>>6),this.Ae(128|63&r);else{const i=n.codePointAt(0);this.Ae(240|i>>>18),this.Ae(128|63&i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i)}}this.Re()}Se(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Pe(r);else if(r<2048)this.Pe(960|r>>>6),this.Pe(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Pe(480|r>>>12),this.Pe(128|63&r>>>6),this.Pe(128|63&r);else{const i=n.codePointAt(0);this.Pe(240|i>>>18),this.Pe(128|63&i>>>12),this.Pe(128|63&i>>>6),this.Pe(128|63&i)}}this.ve()}De(e){const n=this.Ce(e),r=Jw(n);this.xe(1+r),this.buffer[this.position++]=255&r;for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=255&n[i]}Ne(e){const n=this.Ce(e),r=Jw(n);this.xe(1+r),this.buffer[this.position++]=~(255&r);for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=~(255&n[i])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const n=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let i=1;i<n.length;++i)n[i]^=r?255:0;return n}Ae(e){const n=255&e;n===0?(this.Oe(0),this.Oe(255)):n===255?(this.Oe(255),this.Oe(0)):this.Oe(n)}Pe(e){const n=255&e;n===0?(this.Fe(0),this.Fe(255)):n===255?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class zz{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class Hz{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Me()}}class Ko{constructor(){this.Be=new Uz,this.Le=new zz(this.Be),this.Ue=new Hz(this.Be)}seed(e){this.Be.seed(e)}qe(e){return e===0?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,n,r,i){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}Ke(){const e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Vi(this.indexId,this.documentKey,this.arrayValue,r)}}function Ti(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=Xw(t.arrayValue,e.arrayValue),n!==0?n:(n=Xw(t.directionalValue,e.directionalValue),n!==0?n:ee.comparator(t.documentKey,e.documentKey)))}function Xw(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jz{constructor(e){this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const n of e.filters){const r=n;r.dt()?this.je=r:this.Qe.push(r)}}We(e){const n=qf(e);if(n!==void 0&&!this.ze(n))return!1;const r=Mi(e);let i=0,s=0;for(;i<r.length&&this.ze(r[i]);++i);if(i===r.length)return!0;if(this.je!==void 0){const o=r[i];if(!this.He(this.je,o)||!this.Je(this.Ge[s++],o))return!1;++i}for(;i<r.length;++i){const o=r[i];if(s>=this.Ge.length||!this.Je(this.Ge[s++],o))return!1}return!0}ze(e){for(const n of this.Qe)if(this.He(n,e))return!0;return!1}He(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}Je(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kz{constructor(){this.Ye=new Jg}addToCollectionParentIndex(e,n){return this.Ye.add(n),k.resolve()}getCollectionParents(e,n){return k.resolve(this.Ye.getEntries(n))}addFieldIndex(e,n){return k.resolve()}deleteFieldIndex(e,n){return k.resolve()}getDocumentsMatchingTarget(e,n){return k.resolve(null)}getIndexType(e,n){return k.resolve(0)}getFieldIndexes(e,n){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,n){return k.resolve(wn.min())}getMinOffsetFromCollectionGroup(e,n){return k.resolve(wn.min())}updateCollectionGroup(e,n,r){return k.resolve()}updateIndexEntries(e,n){return k.resolve()}}class Jg{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new $e(Ve.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new $e(Ve.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc=new Uint8Array(0);class qz{constructor(e,n){this.user=e,this.databaseId=n,this.Xe=new Jg,this.Ze=new yi(r=>gs(r),(r,i)=>Tl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.Xe.has(n)){const r=n.lastSegment(),i=n.popLast();e.addOnCommittedListener(()=>{this.Xe.add(n)});const s={collectionId:r,parent:Wt(i)};return Yw(e).put(s)}return k.resolve()}getCollectionParents(e,n){const r=[],i=IDBKeyRange.bound([n,""],[E1(n),""],!1,!0);return Yw(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==n)break;r.push(lr(o.parent))}return r})}addFieldIndex(e,n){const r=rc(e),i=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(n);delete i.indexId;const s=r.add(i);if(n.indexState){const o=Wo(e);return s.next(a=>{o.put(qw(a,this.user,n.indexState.sequenceNumber,n.indexState.offset))})}return s.next()}deleteFieldIndex(e,n){const r=rc(e),i=Wo(e),s=qo(e);return r.delete(n.indexId).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,n){const r=qo(e);let i=!0;const s=new Map;return k.forEach(this.tn(n),o=>this.en(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Ie();const a=[];return k.forEach(s,(l,c)=>{var u;K("IndexedDbIndexManager",`Using index ${u=l,`id=${u.indexId}|cg=${u.collectionGroup}|f=${u.fields.map(M=>`${M.fieldPath}:${M.kind}`).join(",")}`} to execute ${gs(n)}`);const h=function(M,y){const L=qf(y);if(L===void 0)return null;for(const R of hu(M,L.fieldPath))switch(R.op){case"array-contains-any":return R.value.arrayValue.values||[];case"array-contains":return[R.value]}return null}(c,l),d=function(M,y){const L=new Map;for(const R of Mi(y))for(const j of hu(M,R.fieldPath))switch(j.op){case"==":case"in":L.set(R.fieldPath.canonicalString(),j.value);break;case"not-in":case"!=":return L.set(R.fieldPath.canonicalString(),j.value),Array.from(L.values())}return null}(c,l),f=function(M,y){const L=[];let R=!0;for(const j of Mi(y)){const N=j.kind===0?_w(M,j.fieldPath,M.startAt):Mw(M,j.fieldPath,M.startAt);L.push(N.value),R&&(R=N.inclusive)}return new So(L,R)}(c,l),p=function(M,y){const L=[];let R=!0;for(const j of Mi(y)){const N=j.kind===0?Mw(M,j.fieldPath,M.endAt):_w(M,j.fieldPath,M.endAt);L.push(N.value),R&&(R=N.inclusive)}return new So(L,R)}(c,l),g=this.nn(l,c,f),m=this.nn(l,c,p),w=this.sn(l,c,d),_=this.rn(l.indexId,h,g,f.inclusive,m,p.inclusive,w);return k.forEach(_,M=>r.J(M,n.limit).next(y=>{y.forEach(L=>{const R=ee.fromSegments(L.documentKey);o.has(R)||(o=o.add(R),a.push(R))})}))}).next(()=>a)}return k.resolve(null)})}tn(e){let n=this.Ze.get(e);return n||(n=[e],this.Ze.set(e,n),n)}rn(e,n,r,i,s,o,a){const l=(n!=null?n.length:1)*Math.max(r.length,s.length),c=l/(n!=null?n.length:1),u=[];for(let h=0;h<l;++h){const d=n?this.on(n[h/c]):nc,f=this.un(e,d,r[h%c],i),p=this.cn(e,d,s[h%c],o),g=a.map(m=>this.un(e,d,m,!0));u.push(...this.createRange(f,p,g))}return u}un(e,n,r,i){const s=new Vi(e,ee.empty(),n,r);return i?s:s.Ke()}cn(e,n,r,i){const s=new Vi(e,ee.empty(),n,r);return i?s.Ke():s}en(e,n){const r=new jz(n),i=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.We(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2;return k.forEach(this.tn(n),i=>this.en(e,i).next(s=>{s?r!==0&&s.fields.length<function(o){let a=new $e(tt.comparator),l=!1;for(const c of o.filters){const u=c;u.field.isKeyField()||(u.op==="array-contains"||u.op==="array-contains-any"?l=!0:a=a.add(u.field))}for(const c of o.orderBy)c.field.isKeyField()||(a=a.add(c.field));return a.size+(l?1:0)}(i)&&(r=1):r=0})).next(()=>r)}an(e,n){const r=new Ko;for(const i of Mi(e)){const s=n.data.field(i.fieldPath);if(s==null)return null;const o=r.qe(i.kind);Fi.Te.ce(s,o)}return r.$e()}on(e){const n=new Ko;return Fi.Te.ce(e,n.qe(0)),n.$e()}hn(e,n){const r=new Ko;return Fi.Te.ce(Hg(this.databaseId,n),r.qe(function(i){const s=Mi(i);return s.length===0?0:s[s.length-1].kind}(e))),r.$e()}sn(e,n,r){if(r===null)return[];let i=[];i.push(new Ko);let s=0;for(const o of Mi(e)){const a=r[s++];for(const l of i)if(this.ln(n,o.fieldPath)&&rl(a))i=this.fn(i,o,a);else{const c=l.qe(o.kind);Fi.Te.ce(a,c)}}return this.dn(i)}nn(e,n,r){return this.sn(e,n,r.position)}dn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].$e();return n}fn(e,n,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const l=new Ko;l.seed(a.$e()),Fi.Te.ce(o,l.qe(n.kind)),s.push(l)}return s}ln(e,n){return!!e.filters.find(r=>r instanceof Rt&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=rc(e),i=Wo(e);return(n?r.W("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.W()).next(s=>{const o=[];return k.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(function(c,u){const h=u?new cu(u.sequenceNumber,new wn(ys(u.readTime),new ee(lr(u.documentKey)),u.largestBatchId)):cu.empty(),d=c.fields.map(([f,p])=>new wU(tt.fromServerFormat(f),p));return new x1(c.indexId,c.collectionGroup,d,h)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Te(r.collectionGroup,i.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=rc(e),s=Wo(e);return this._n(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(a=>k.forEach(a,l=>s.put(qw(l.indexId,this.user,o,r)))))}updateIndexEntries(e,n){const r=new Map;return k.forEach(n,(i,s)=>{const o=r.get(i.collectionGroup);return(o?k.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),k.forEach(a,l=>this.wn(e,i,l).next(c=>{const u=this.mn(s,l);return c.isEqual(u)?k.resolve():this.gn(e,s,l,c,u)}))))})}yn(e,n,r,i){return qo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.hn(r,n.key),documentKey:n.key.path.toArray()})}pn(e,n,r,i){return qo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.hn(r,n.key),n.key.path.toArray()])}wn(e,n,r){const i=qo(e);let s=new $e(Ti);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.hn(r,n)])},(o,a)=>{s=s.add(new Vi(r.indexId,n,a.arrayValue,a.directionalValue))}).next(()=>s)}mn(e,n){let r=new $e(Ti);const i=this.an(n,e);if(i==null)return r;const s=qf(n);if(s!=null){const o=e.data.field(s.fieldPath);if(rl(o))for(const a of o.arrayValue.values||[])r=r.add(new Vi(n.indexId,e.key,this.on(a),i))}else r=r.add(new Vi(n.indexId,e.key,nc,i));return r}gn(e,n,r,i,s){K("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const o=[];return function(a,l,c,u,h){const d=a.getIterator(),f=l.getIterator();let p=Ds(d),g=Ds(f);for(;p||g;){let m=!1,w=!1;if(p&&g){const _=c(p,g);_<0?w=!0:_>0&&(m=!0)}else p!=null?w=!0:m=!0;m?(u(g),g=Ds(f)):w?(h(p),p=Ds(d)):(p=Ds(d),g=Ds(f))}}(i,s,Ti,a=>{o.push(this.yn(e,n,r,a))},a=>{o.push(this.pn(e,n,r,a))}),k.waitFor(o)}_n(e){let n=1;return Wo(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),n=i.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>Ti(o,a)).filter((o,a,l)=>!a||Ti(o,l[a-1])!==0);const i=[];i.push(e);for(const o of r){const a=Ti(o,e),l=Ti(o,n);if(a===0)i[0]=e.Ke();else if(a>0&&l<0)i.push(o),i.push(o.Ke());else if(l>0)break}i.push(n);const s=[];for(let o=0;o<i.length;o+=2)s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,nc,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,nc,[]]));return s}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(Qw)}getMinOffset(e,n){return k.mapArray(this.tn(n),r=>this.en(e,r).next(i=>i||ae())).next(Qw)}}function Yw(t){return gt(t,"collectionParents")}function qo(t){return gt(t,"indexEntries")}function rc(t){return gt(t,"indexConfiguration")}function Wo(t){return gt(t,"indexState")}function Qw(t){be(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const i=t[r].indexState.offset;Ug(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new wn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class tn{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new tn(e,tn.DEFAULT_COLLECTION_PERCENTILE,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dT(t,e,n){const r=t.store("mutations"),i=t.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const l=r.Z({range:o},(u,h,d)=>(a++,d.delete()));s.push(l.next(()=>{be(a===1)}));const c=[];for(const u of n.mutations){const h=sT(e,u.key.path,n.batchId);s.push(i.delete(h)),c.push(u.key)}return k.waitFor(s).next(()=>c)}function gu(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ae();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tn.DEFAULT_COLLECTION_PERCENTILE=10,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tn.DEFAULT=new tn(41943040,tn.DEFAULT_COLLECTION_PERCENTILE,tn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tn.DISABLED=new tn(-1,0,0);class Eh{constructor(e,n,r,i){this.userId=e,this.It=n,this.indexManager=r,this.referenceDelegate=i,this.In={}}static oe(e,n,r,i){be(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new Eh(s,n,r,i)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Dr(e).Z({index:"userMutationsIndex",range:r},(i,s,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,i){const s=$s(e),o=Dr(e);return o.add({}).next(a=>{be(typeof a=="number");const l=new qg(a,n,r,i),c=function(d,f,p){const g=p.baseMutations.map(w=>fu(d.re,w)),m=p.mutations.map(w=>fu(d.re,w));return{userId:f,batchId:p.batchId,localWriteTimeMs:p.localWriteTime.toMillis(),baseMutations:g,mutations:m}}(this.It,this.userId,l),u=[];let h=new $e((d,f)=>Te(d.canonicalString(),f.canonicalString()));for(const d of i){const f=sT(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(c)),u.push(s.put(f,Ez))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=l.keys()}),k.waitFor(u).next(()=>l)})}lookupMutationBatch(e,n){return Dr(e).get(n).next(r=>r?(be(r.userId===this.userId),Bi(this.It,r)):null)}Tn(e,n){return this.In[n]?k.resolve(this.In[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const i=r.keys();return this.In[n]=i,i}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Dr(e).Z({index:"userMutationsIndex",range:i},(o,a,l)=>{a.userId===this.userId&&(be(a.batchId>=r),s=Bi(this.It,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Dr(e).Z({index:"userMutationsIndex",range:n,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Dr(e).W("userMutationsIndex",n).next(r=>r.map(i=>Bi(this.It,i)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=Tc(this.userId,n.path),i=IDBKeyRange.lowerBound(r),s=[];return $s(e).Z({range:i},(o,a,l)=>{const[c,u,h]=o,d=lr(u);if(c===this.userId&&n.path.isEqual(d))return Dr(e).get(h).next(f=>{if(!f)throw ae();be(f.userId===this.userId),s.push(Bi(this.It,f))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new $e(Te);const i=[];return n.forEach(s=>{const o=Tc(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=$s(e).Z({range:a},(c,u,h)=>{const[d,f,p]=c,g=lr(f);d===this.userId&&s.path.isEqual(g)?r=r.add(p):h.done()});i.push(l)}),k.waitFor(i).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1,s=Tc(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new $e(Te);return $s(e).Z({range:o},(l,c,u)=>{const[h,d,f]=l,p=lr(d);h===this.userId&&r.isPrefixOf(p)?p.length===i&&(a=a.add(f)):u.done()}).next(()=>this.En(e,a))}En(e,n){const r=[],i=[];return n.forEach(s=>{i.push(Dr(e).get(s).next(o=>{if(o===null)throw ae();be(o.userId===this.userId),r.push(Bi(this.It,o))}))}),k.waitFor(i).next(()=>r)}removeMutationBatch(e,n){return dT(e.ie,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.An(n.batchId)}),k.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return k.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return $s(e).Z({range:r},(s,o,a)=>{if(s[0]===this.userId){const l=lr(s[1]);i.push(l)}else a.done()}).next(()=>{be(i.length===0)})})}containsKey(e,n){return fT(e,this.userId,n)}Rn(e){return pT(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function fT(t,e,n){const r=Tc(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return $s(t).Z({range:s,X:!0},(a,l,c)=>{const[u,h,d]=a;u===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Dr(t){return gt(t,"mutations")}function $s(t){return gt(t,"documentMutations")}function pT(t){return gt(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new bs(0)}static vn(){return new bs(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wz{constructor(e,n){this.referenceDelegate=e,this.It=n}allocateTargetId(e){return this.Vn(e).next(n=>{const r=new bs(n.highestTargetId);return n.highestTargetId=r.next(),this.Sn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(n=>ge.fromTimestamp(new We(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=n,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),n>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=n),this.Sn(e,i)))}addTargetData(e,n){return this.Dn(e,n).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(n,r),this.Sn(e,r))))}updateTargetData(e,n){return this.Dn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Ps(e).delete(n.targetId)).next(()=>this.Vn(e)).next(r=>(be(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,n,r){let i=0;const s=[];return Ps(e).Z((o,a)=>{const l=sa(a);l.sequenceNumber<=n&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>k.waitFor(s)).next(()=>i)}forEachTarget(e,n){return Ps(e).Z((r,i)=>{const s=sa(i);n(s)})}Vn(e){return ev(e).get("targetGlobalKey").next(n=>(be(n!==null),n))}Sn(e,n){return ev(e).put("targetGlobalKey",n)}Dn(e,n){return Ps(e).put(uT(this.It,n))}Cn(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(n=>n.targetCount)}getTargetData(e,n){const r=gs(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Ps(e).Z({range:i,index:"queryTargetsIndex"},(o,a,l)=>{const c=sa(a);Tl(n,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,n,r){const i=[],s=Vr(e);return n.forEach(o=>{const a=Wt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),k.waitFor(i)}removeMatchingKeys(e,n,r){const i=Vr(e);return k.forEach(n,s=>{const o=Wt(s.path);return k.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,n){const r=Vr(e),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),i=Vr(e);let s=Ie();return i.Z({range:r,X:!0},(o,a,l)=>{const c=lr(o[1]),u=new ee(c);s=s.add(u)}).next(()=>s)}containsKey(e,n){const r=Wt(n.path),i=IDBKeyRange.bound([r],[E1(r)],!1,!0);let s=0;return Vr(e).Z({index:"documentTargetsIndex",X:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}se(e,n){return Ps(e).get(n).next(r=>r?sa(r):null)}}function Ps(t){return gt(t,"targets")}function ev(t){return gt(t,"targetGlobal")}function Vr(t){return gt(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv([t,e],[n,r]){const i=Te(t,n);return i===0?Te(e,r):i}class Gz{constructor(e){this.xn=e,this.buffer=new $e(tv),this.Nn=0}kn(){return++this.Nn}On(e){const n=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();tv(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class Jz{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Mn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return this.Mn!==null}Fn(e){K("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){mi(n)?K("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await Ts(n)}await this.Fn(3e5)})}}class Xz{constructor(e,n){this.$n=e,this.params=n}calculateTargetCount(e,n){return this.$n.Bn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return k.resolve(An.at);const r=new Gz(n);return this.$n.forEachTarget(e,i=>r.On(i.sequenceNumber)).next(()=>this.$n.Ln(e,i=>r.On(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.$n.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.$n.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(K("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Zw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(K("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Zw):this.Un(e,n))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(e,n){let r,i,s,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(K("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,n))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Kf()<=Le.DEBUG&&K("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yz{constructor(e,n){this.db=e,this.garbageCollector=function(r,i){return new Xz(r,i)}(this,n)}Bn(e){const n=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}qn(e){let n=0;return this.Ln(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Ln(e,n){return this.Kn(e,(r,i)=>n(i))}addReference(e,n,r){return ic(e,r)}removeReference(e,n,r){return ic(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return ic(e,n)}Gn(e,n){return function(r,i){let s=!1;return pT(r).tt(o=>fT(r,o,i).next(a=>(a&&(s=!0),k.resolve(!a)))).next(()=>s)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Kn(e,(o,a)=>{if(a<=n){const l=this.Gn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ge.min()),Vr(e).delete([0,Wt(o.path)])))});i.push(l)}}).next(()=>k.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return ic(e,n)}Kn(e,n){const r=Vr(e);let i,s=An.at;return r.Z({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(s!==An.at&&n(new ee(lr(i)),s),s=c,i=l):s=An.at}).next(()=>{s!==An.at&&n(new ee(lr(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ic(t,e){return Vr(t).put(function(n,r){return{targetId:0,path:Wt(n.path),sequenceNumber:r}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gT{constructor(){this.changes=new yi(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?k.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qz{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Ci(e).put(r)}removeEntry(e,n,r){return Ci(e).delete(function(i,s){const o=i.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],pu(s),o[o.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Qn(e,r)))}getEntry(e,n){let r=qe.newInvalidDocument(n);return Ci(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Go(n))},(i,s)=>{r=this.jn(n,s)}).next(()=>r)}Wn(e,n){let r={size:0,document:qe.newInvalidDocument(n)};return Ci(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Go(n))},(i,s)=>{r={document:this.jn(n,s),size:gu(s)}}).next(()=>r)}getEntries(e,n){let r=fn();return this.zn(e,n,(i,s)=>{const o=this.jn(i,s);r=r.insert(i,o)}).next(()=>r)}Hn(e,n){let r=fn(),i=new it(ee.comparator);return this.zn(e,n,(s,o)=>{const a=this.jn(s,o);r=r.insert(s,a),i=i.insert(s,gu(o))}).next(()=>({documents:r,Jn:i}))}zn(e,n,r){if(n.isEmpty())return k.resolve();let i=new $e(iv);n.forEach(l=>i=i.add(l));const s=IDBKeyRange.bound(Go(i.first()),Go(i.last())),o=i.getIterator();let a=o.getNext();return Ci(e).Z({index:"documentKeyIndex",range:s},(l,c,u)=>{const h=ee.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&iv(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.j(Go(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,n,r){const i=[n.popLast().toArray(),n.lastSegment(),pu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ci(e).W(IDBKeyRange.bound(i,s,!0)).next(o=>{let a=fn();for(const l of o){const c=this.jn(ee.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);a=a.insert(c.key,c)}return a})}getAllFromCollectionGroup(e,n,r,i){let s=fn();const o=rv(n,r),a=rv(n,wn.max());return Ci(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{const h=this.jn(ee.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Zz(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return nv(e).get("remoteDocumentGlobalKey").next(n=>(be(!!n),n))}Qn(e,n){return nv(e).put("remoteDocumentGlobalKey",n)}jn(e,n){if(n){const r=Fz(this.It,n);if(!(r.isNoDocument()&&r.version.isEqual(ge.min())))return r}return qe.newInvalidDocument(e)}}function mT(t){return new Qz(t)}class Zz extends gT{constructor(e,n){super(),this.Yn=e,this.trackRemovals=n,this.Xn=new yi(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const n=[];let r=0,i=new $e((s,o)=>Te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.Xn.get(s);if(n.push(this.Yn.removeEntry(e,s,a.readTime)),o.isValidDocument()){const l=jw(this.Yn.It,o);i=i.add(s.path.popLast()),r+=gu(l)-a.size,n.push(this.Yn.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){const l=jw(this.Yn.It,o.convertToNoDocument(ge.min()));n.push(this.Yn.addEntry(e,s,l))}}),i.forEach(s=>{n.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),n.push(this.Yn.updateMetadata(e,r)),k.waitFor(n)}getFromCache(e,n){return this.Yn.Wn(e,n).next(r=>(this.Xn.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Yn.Hn(e,n).next(({documents:r,Jn:i})=>(i.forEach((s,o)=>{this.Xn.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function nv(t){return gt(t,"remoteDocumentGlobal")}function Ci(t){return gt(t,"remoteDocumentsV14")}function Go(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function rv(t,e){const n=e.documentKey.path.toArray();return[t,pu(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function iv(t,e){const n=t.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=Te(n[s],r[s]),i)return i;return i=Te(n.length,r.length),i||(i=Te(n[n.length-2],r[r.length-2]),i||Te(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eH{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.getBaseDocument(e,n,r))).next(i=>(r!==null&&xa(r.mutation,i,gn.empty(),We.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ie()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ie()){const i=ar();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=ia();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=ar();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ie()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=fn();const o=Sa(),a=Sa();return n.forEach((l,c)=>{const u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Ar)?s=s.insert(c.key,c):u!==void 0&&(o.set(c.key,u.mutation.getFieldMask()),xa(u.mutation,c,u.mutation.getFieldMask(),We.now()))}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),n.forEach((c,u)=>{var h;return a.set(c,new eH(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,n){const r=Sa();let i=new it((o,a)=>o-a),s=Ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let u=r.get(l)||gn.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(i.get(a.batchId)||Ie()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=q1();u.forEach(d=>{if(!s.has(d)){const f=$1(n.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return k.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r){return function(i){return ee.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):HU(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r):this.getDocumentsMatchingCollectionQuery(e,n,r)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):k.resolve(ar());let a=-1,l=s;return o.next(c=>k.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?k.resolve():this.getBaseDocument(e,u,h).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Ie())).next(u=>({batchId:a,changes:K1(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ee(n)).next(r=>{let i=ia();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r){const i=n.collectionGroup;let s=ia();return this.indexManager.getCollectionParents(e,i).next(o=>k.forEach(o,a=>{const l=function(c,u){return new fh(u,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(n,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,l,r).next(c=>{c.forEach((u,h)=>{s=s.insert(u,h)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,n,r){let i;return this.remoteDocumentCache.getAllFromCollection(e,n.path,r).next(s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId))).next(s=>{s.forEach((a,l)=>{const c=l.getKey();i.get(c)===null&&(i=i.insert(c,qe.newInvalidDocument(c)))});let o=ia();return i.forEach((a,l)=>{const c=s.get(a);c!==void 0&&xa(c.mutation,l,gn.empty(),We.now()),jg(n,l)&&(o=o.insert(a,l))}),o})}getBaseDocument(e,n,r){return r===null||r.mutation.type===1?this.remoteDocumentCache.getEntry(e,n):k.resolve(qe.newInvalidDocument(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tH{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,n){return k.resolve(this.Zn.get(n))}saveBundleMetadata(e,n){var r;return this.Zn.set(n.id,{id:(r=n).id,version:r.version,createTime:mn(r.createTime)}),k.resolve()}getNamedQuery(e,n){return k.resolve(this.ts.get(n))}saveNamedQuery(e,n){return this.ts.set(n.name,function(r){return{name:r.name,query:hT(r.bundledQuery),readTime:mn(r.readTime)}}(n)),k.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nH{constructor(){this.overlays=new it(ee.comparator),this.es=new Map}getOverlay(e,n){return k.resolve(this.overlays.get(n))}getOverlays(e,n){const r=ar();return k.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.ue(e,n,s)}),k.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.es.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(r)),k.resolve()}getOverlaysForCollection(e,n,r){const i=ar(),s=n.length+1,o=new ee(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return k.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new it((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let u=s.get(c.largestBatchId);u===null&&(u=ar(),s=s.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=ar(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=i)););return k.resolve(a)}ue(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.es.get(i.largestBatchId).delete(r.key);this.es.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Gg(n,r));let s=this.es.get(n);s===void 0&&(s=Ie(),this.es.set(n,s)),this.es.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(){this.ns=new $e(lt.ss),this.rs=new $e(lt.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,n){const r=new lt(e,n);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.cs(new lt(e,n))}hs(e,n){e.forEach(r=>this.removeReference(r,n))}ls(e){const n=new ee(new Ve([])),r=new lt(n,e),i=new lt(n,e+1),s=[];return this.rs.forEachInRange([r,i],o=>{this.cs(o),s.push(o.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const n=new ee(new Ve([])),r=new lt(n,e),i=new lt(n,e+1);let s=Ie();return this.rs.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new lt(e,0),r=this.ns.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class lt{constructor(e,n){this.key=e,this._s=n}static ss(e,n){return ee.comparator(e.key,n.key)||Te(e._s,n._s)}static os(e,n){return Te(e._s,n._s)||ee.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rH{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.ws=1,this.gs=new $e(lt.ss)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new qg(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.gs=this.gs.add(new lt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return k.resolve(o)}lookupMutationBatch(e,n){return k.resolve(this.ys(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ps(r),s=i<0?0:i;return k.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new lt(n,0),i=new lt(n,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([r,i],o=>{const a=this.ys(o._s);s.push(a)}),k.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new $e(Te);return n.forEach(i=>{const s=new lt(i,0),o=new lt(i,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,o],a=>{r=r.add(a._s)})}),k.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;ee.isDocumentKey(s)||(s=s.child(""));const o=new lt(new ee(s),0);let a=new $e(Te);return this.gs.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(l._s)),!0)},o),k.resolve(this.Is(a))}Is(e){const n=[];return e.forEach(r=>{const i=this.ys(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){be(this.Ts(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.gs;return k.forEach(n.mutations,i=>{const s=new lt(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,n){const r=new lt(n,0),i=this.gs.firstAfterOrEqual(r);return k.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}Ts(e,n){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const n=this.ps(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iH{constructor(e){this.Es=e,this.docs=new it(ee.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.Es(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return k.resolve(r?r.document.mutableCopy():qe.newInvalidDocument(n))}getEntries(e,n){let r=fn();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():qe.newInvalidDocument(i))}),k.resolve(r)}getAllFromCollection(e,n,r){let i=fn();const s=new ee(n.child("")),o=this.docs.getIteratorFrom(s);for(;o.hasNext();){const{key:a,value:{document:l}}=o.getNext();if(!n.isPrefixOf(a.path))break;a.path.length>n.length+1||Ug(S1(l),r)<=0||(i=i.insert(l.key,l.mutableCopy()))}return k.resolve(i)}getAllFromCollectionGroup(e,n,r,i){ae()}As(e,n){return k.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new sH(this)}getSize(e){return k.resolve(this.size)}}class sH extends gT{constructor(e){super(),this.Yn=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(r)}),k.waitFor(n)}getFromCache(e,n){return this.Yn.getEntry(e,n)}getAllFromCache(e,n){return this.Yn.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oH{constructor(e){this.persistence=e,this.Rs=new yi(n=>gs(n),Tl),this.lastRemoteSnapshotVersion=ge.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Xg,this.targetCount=0,this.vs=bs.Pn()}forEachTarget(e,n){return this.Rs.forEach((r,i)=>n(i)),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.bs&&(this.bs=n),k.resolve()}Dn(e){this.Rs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.vs=new bs(n),this.highestTargetId=n),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,n){return this.Dn(n),this.targetCount+=1,k.resolve()}updateTargetData(e,n){return this.Dn(n),k.resolve()}removeTargetData(e,n){return this.Rs.delete(n.target),this.Ps.ls(n.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Rs.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),k.waitFor(s).next(()=>i)}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,n){const r=this.Rs.get(n)||null;return k.resolve(r)}addMatchingKeys(e,n,r){return this.Ps.us(n,r),k.resolve()}removeMatchingKeys(e,n,r){this.Ps.hs(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),k.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Ps.ls(n),k.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Ps.ds(n);return k.resolve(r)}containsKey(e,n){return k.resolve(this.Ps.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bT{constructor(e,n){this.Vs={},this.overlays={},this.Ss=new An(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new oH(this),this.indexManager=new Kz,this.remoteDocumentCache=function(r){return new iH(r)}(r=>this.referenceDelegate.xs(r)),this.It=new cT(n),this.Ns=new tH(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new nH,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Vs[e.toKey()];return r||(r=new rH(n,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,n,r){K("MemoryPersistence","Starting transaction:",e);const i=new aH(this.Ss.next());return this.referenceDelegate.ks(),r(i).next(s=>this.referenceDelegate.Os(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ms(e,n){return k.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,n)))}}class aH extends C1{constructor(e){super(),this.currentSequenceNumber=e}}class xh{constructor(e){this.persistence=e,this.Fs=new Xg,this.$s=null}static Bs(e){return new xh(e)}get Ls(){if(this.$s)return this.$s;throw ae()}addReference(e,n,r){return this.Fs.addReference(r,n),this.Ls.delete(r.toString()),k.resolve()}removeReference(e,n,r){return this.Fs.removeReference(r,n),this.Ls.add(r.toString()),k.resolve()}markPotentiallyOrphaned(e,n){return this.Ls.add(n.toString()),k.resolve()}removeTarget(e,n){this.Fs.ls(n.targetId).forEach(i=>this.Ls.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Ls.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}ks(){this.$s=new Set}Os(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.Ls,r=>{const i=ee.fromPath(r);return this.Us(e,i).next(s=>{s||n.removeEntry(i,ge.min())})}).next(()=>(this.$s=null,n.apply(e)))}updateLimboDocument(e,n){return this.Us(e,n).next(r=>{r?this.Ls.delete(n.toString()):this.Ls.add(n.toString())})}xs(e){return 0}Us(e,n){return k.or([()=>k.resolve(this.Fs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ms(e,n)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lH{constructor(e){this.It=e}$(e,n,r,i){const s=new hh("createOrUpgrade",n);r<1&&i>=1&&(function(a){a.createObjectStore("owner")}(e),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Hw,{unique:!0}),a.createObjectStore("documentMutations")}(e),sv(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=k.resolve();return r<3&&i>=3&&(r!==0&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),sv(e)),o=o.next(()=>function(a){const l=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ge.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",c)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(a,l){return l.store("mutations").W().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Hw,{unique:!0});const u=l.store("mutations"),h=c.map(d=>u.put(d));return k.waitFor(h)})}(e,s))),o=o.next(()=>{(function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.qs(s))),r<6&&i>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),r<7&&i>=7&&(o=o.next(()=>this.Gs(s))),r<8&&i>=8&&(o=o.next(()=>this.Qs(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.js(s))),r<11&&i>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(a){const l=a.createObjectStore("documentOverlays",{keyPath:Dz});l.createIndex("collectionPathOverlayIndex",Rz,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",Pz,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(a){const l=a.createObjectStore("remoteDocumentsV14",{keyPath:xz});l.createIndex("documentKeyIndex",Sz),l.createIndex("collectionGroupIndex",Tz)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.zs(e,s))),r<15&&i>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:_z}).createIndex("sequenceNumberIndex",Mz,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:Oz}).createIndex("documentKeyIndex",Nz,{unique:!1})}(e))),o}Ks(e){let n=0;return e.store("remoteDocuments").Z((r,i)=>{n+=gu(i)}).next(()=>{const r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}qs(e){const n=e.store("mutationQueues"),r=e.store("mutations");return n.W().next(i=>k.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>k.forEach(a,l=>{be(l.userId===s.userId);const c=Bi(this.It,l);return dT(e,s.userId,c).next(()=>{})}))}))}Gs(e){const n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((o,a)=>{const l=new Ve(o),c=function(u){return[0,Wt(u)]}(l);s.push(n.get(c).next(u=>u?k.resolve():(h=>n.put({targetId:0,path:Wt(h),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>k.waitFor(s))})}Qs(e,n){e.createObjectStore("collectionParents",{keyPath:Az});const r=n.store("collectionParents"),i=new Jg,s=o=>{if(i.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Wt(l)})}};return n.store("remoteDocuments").Z({X:!0},(o,a)=>{const l=new Ve(o);return s(l.popLast())}).next(()=>n.store("documentMutations").Z({X:!0},([o,a,l],c)=>{const u=lr(a);return s(u.popLast())}))}js(e){const n=e.store("targets");return n.Z((r,i)=>{const s=sa(i),o=uT(this.It,s);return n.put(o)})}Ws(e,n){const r=n.store("remoteDocuments"),i=[];return r.Z((s,o)=>{const a=n.store("remoteDocumentsV14"),l=(c=o,c.document?new ee(Ve.fromString(c.document.name).popFirst(5)):c.noDocument?ee.fromSegments(c.noDocument.path):c.unknownDocument?ee.fromSegments(c.unknownDocument.path):ae()).path.toArray();var c;/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>k.waitFor(i))}zs(e,n){const r=n.store("mutations"),i=mT(this.It),s=new bT(xh.Bs,this.It.re);return r.W().next(o=>{const a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Ie();Bi(this.It,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),k.forEach(a,(l,c)=>{const u=new wt(c),h=vh.oe(this.It,u),d=s.getIndexManager(u),f=Eh.oe(u,this.It,d,s.referenceDelegate);return new yT(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ep(n,An.at),l).next()})})}}function sv(t){t.createObjectStore("targetDocuments",{keyPath:kz}).createIndex("documentTargetsIndex",Iz,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Cz,{unique:!0}),t.createObjectStore("targetGlobal")}const Md="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Yg{constructor(e,n,r,i,s,o,a,l,c,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Hs=s,this.window=o,this.document=a,this.Js=c,this.Ys=u,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!Yg.C())throw new se(U.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Yz(this,i),this.ii=n+"main",this.It=new cT(l),this.ri=new Er(this.ii,this.Xs,new lH(this.It)),this.Cs=new Wz(this.referenceDelegate,this.It),this.remoteDocumentCache=mT(this.It),this.Ns=new Vz,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,u===!1&&jt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new se(U.FAILED_PRECONDITION,Md);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new An(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>sc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(n=>{n||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(n=>this.isPrimary&&!n?this._i(e).next(()=>!1):!!n&&this.wi(e).next(()=>!0))).catch(e=>{if(mi(e))return K("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return K("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Jo(e).get("owner").next(n=>k.resolve(this.mi(n)))}gi(e){return sc(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=gt(n,"clientMetadata");return r.W().next(i=>{const s=this.Ii(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return k.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.oi)for(const n of e)this.oi.removeItem(this.Ti(n.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?k.resolve(!0):Jo(e).get("owner").next(n=>{if(n!==null&&this.pi(n.leaseTimestampMs,5e3)&&!this.Ei(n.ownerId)){if(this.mi(n)&&this.networkEnabled)return!0;if(!this.mi(n)){if(!n.allowTabSynchronization)throw new se(U.FAILED_PRECONDITION,Md);return!1}}return!(!this.networkEnabled||!this.inForeground)||sc(e).W().next(r=>this.Ii(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&K("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const n=new ep(e,An.at);return this._i(n).next(()=>this.gi(n))}),this.ri.close(),this.Pi()}Ii(e,n){return e.filter(r=>this.pi(r.updateTimeMs,n)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>sc(e).W().next(n=>this.Ii(n,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,n){return Eh.oe(e,this.It,n,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new qz(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return vh.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(e,n,r){K("IndexedDbPersistence","Starting transaction:",e);const i=n==="readonly"?"readonly":"readwrite",s=(o=this.Xs)===15?Bz:o===14?lT:o===13?aT:o===12?Lz:o===11?oT:void ae();var o;let a;return this.ri.runTransaction(e,i,s,l=>(a=new ep(l,this.Ss?this.Ss.next():An.at),n==="readwrite-primary"?this.fi(a).next(c=>!!c||this.di(a)).next(c=>{if(!c)throw jt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new se(U.FAILED_PRECONDITION,T1);return r(a)}).next(c=>this.wi(a).next(()=>c)):this.Vi(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Vi(e){return Jo(e).get("owner").next(n=>{if(n!==null&&this.pi(n.leaseTimestampMs,5e3)&&!this.Ei(n.ownerId)&&!this.mi(n)&&!(this.Ys||this.allowTabSynchronization&&n.allowTabSynchronization))throw new se(U.FAILED_PRECONDITION,Md)})}wi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Jo(e).put("owner",n)}static C(){return Er.C()}_i(e){const n=Jo(e);return n.get("owner").next(r=>this.mi(r)?(K("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):k.resolve())}pi(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(jt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}ci(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground=this.document.visibilityState==="visible")}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Zs=()=>{this.Ai(),jF()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var n;try{const r=((n=this.oi)===null||n===void 0?void 0:n.getItem(this.Ti(e)))!==null;return K("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return jt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){jt("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Jo(t){return gt(t,"owner")}function sc(t){return gt(t,"clientMetadata")}function cH(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Si=r,this.Di=i}static Ci(e,n){let r=Ie(),i=Ie();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Qg(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wT{constructor(){this.xi=!1}initialize(e,n){this.Ni=e,this.indexManager=n,this.xi=!0}getDocumentsMatchingQuery(e,n,r,i){return this.ki(e,n).next(s=>s||this.Oi(e,n,i,r)).next(s=>s||this.Mi(e,n))}ki(e,n){if(Dw(n))return k.resolve(null);let r=Wn(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=Jf(n,null,"F"),r=Wn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Ie(...s);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.Fi(n,a);return this.$i(n,c,o,l.readTime)?this.ki(e,Jf(n,null,"F")):this.Bi(e,c,n,l)}))})))}Oi(e,n,r,i){return Dw(n)||i.isEqual(ge.min())?this.Mi(e,n):this.Ni.getDocuments(e,r).next(s=>{const o=this.Fi(n,s);return this.$i(n,o,r,i)?this.Mi(e,n):(Kf()<=Le.DEBUG&&K("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Xf(n)),this.Bi(e,o,n,vU(i,-1)))})}Fi(e,n){let r=new $e(D1(e));return n.forEach((i,s)=>{jg(e,s)&&(r=r.add(s))}),r}$i(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Mi(e,n){return Kf()<=Le.DEBUG&&K("QueryEngine","Using full collection scan to execute query:",Xf(n)),this.Ni.getDocumentsMatchingQuery(e,n,wn.min())}Bi(e,n,r,i){return this.Ni.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uH{constructor(e,n,r,i){this.persistence=e,this.Li=n,this.It=i,this.Ui=new it(Te),this.qi=new yi(s=>gs(s),Tl),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yT(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ui))}}function vT(t,e,n,r){return new uH(t,e,n,r)}async function ET(t,e){const n=we(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Qi(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=Ie();for(const c of i){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of s){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return n.localDocuments.getDocuments(r,l).next(c=>({ji:c,removedBatchIds:o,addedBatchIds:a}))})})}function hH(t,e){const n=we(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,l,c){const u=l.batch,h=u.keys();let d=k.resolve();return h.forEach(f=>{d=d.next(()=>c.getEntry(a,f)).next(p=>{const g=l.docVersions.get(f);be(g!==null),p.version.compareTo(g)<0&&(u.applyToRemoteDocument(p,l),p.isValidDocument()&&(p.setReadTime(l.commitVersion),c.addEntry(p)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,u))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=Ie();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function xT(t){const e=we(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Cs.getLastRemoteSnapshotVersion(n))}function dH(t,e){const n=we(t),r=e.snapshotVersion;let i=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.Ui;const a=[];e.targetChanges.forEach((u,h)=>{const d=i.get(h);if(!d)return;a.push(n.Cs.removeMatchingKeys(s,u.removedDocuments,h).next(()=>n.Cs.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.has(h)?f=f.withResumeToken(pt.EMPTY_BYTE_STRING,ge.min()).withLastLimboFreeSnapshotVersion(ge.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),i=i.insert(h,f),function(p,g,m){return p.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-p.snapshotVersion.toMicroseconds()>=3e8?!0:m.addedDocuments.size+m.modifiedDocuments.size+m.removedDocuments.size>0}(d,f,u)&&a.push(n.Cs.updateTargetData(s,f))});let l=fn(),c=Ie();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(fH(s,o,e.documentUpdates).next(u=>{l=u.Wi,c=u.zi})),!r.isEqual(ge.min())){const u=n.Cs.getLastRemoteSnapshotVersion(s).next(h=>n.Cs.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return k.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(n.Ui=i,s))}function fH(t,e,n){let r=Ie(),i=Ie();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=fn();return n.forEach((a,l)=>{const c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(ge.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):K("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Wi:o,zi:i}})}function pH(t,e){const n=we(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function gH(t,e){const n=we(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Cs.getTargetData(r,e).next(s=>s?(i=s,k.resolve(i)):n.Cs.allocateTargetId(r).next(o=>(i=new ti(e,o,0,r.currentSequenceNumber),n.Cs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.Ui.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(r.targetId,r),n.qi.set(e,r.targetId)),r})}async function tp(t,e,n){const r=we(t),i=r.Ui.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!mi(o))throw o;K("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ui=r.Ui.remove(e),r.qi.delete(i.target)}function ov(t,e,n){const r=we(t);let i=ge.min(),s=Ie();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,l,c){const u=we(a),h=u.qi.get(c);return h!==void 0?k.resolve(u.Ui.get(h)):u.Cs.getTargetData(l,c)}(r,o,Wn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.Li.getDocumentsMatchingQuery(o,e,n?i:ge.min(),n?s:Ie())).next(a=>(mH(r,jU(e),a),{documents:a,Hi:s})))}function mH(t,e,n){let r=t.Ki.get(e)||ge.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Ki.set(e,r)}class av{constructor(){this.activeTargetIds=W1()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ST{constructor(){this.Lr=new av,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,n,r){this.Ur[e]=n}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new av,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{qr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){K("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){K("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bH={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wH{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vH extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.oo=n+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,n,r,i,s){const o=this.ho(e,n);K("RestConnection","Sending: ",o,r);const a={};return this.lo(a,i,s),this.fo(e,o,a,r).then(l=>(K("RestConnection","Received: ",l),l),l=>{throw lu("RestConnection",`${e} failed with error: `,l,"url: ",o,"request:",r),l})}_o(e,n,r,i,s,o){return this.ao(e,n,r,i,s)}lo(e,n,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Bo,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}ho(e,n){const r=bH[e];return`${this.oo}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,n,r,i){return new Promise((s,o)=>{const a=new cU;a.listenOnce(oU.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Ad.NO_ERROR:const c=a.getResponseJson();K("Connection","XHR received:",JSON.stringify(c)),s(c);break;case Ad.TIMEOUT:K("Connection",'RPC "'+e+'" timed out'),o(new se(U.DEADLINE_EXCEEDED,"Request time out"));break;case Ad.HTTP_ERROR:const u=a.getStatus();if(K("Connection",'RPC "'+e+'" failed with status:',u,"response text:",a.getResponseText()),u>0){const h=a.getResponseJson().error;if(h&&h.status&&h.message){const d=function(f){const p=f.toLowerCase().replace(/_/g,"-");return Object.values(U).indexOf(p)>=0?p:U.UNKNOWN}(h.status);o(new se(d,h.message))}else o(new se(U.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new se(U.UNAVAILABLE,"Connection failed."));break;default:ae()}}finally{K("Connection",'RPC "'+e+'" completed.')}});const l=JSON.stringify(i);a.send(n,"POST",l,r,15)})}wo(e,n,r){const i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=iU(),o=sU(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new lU({})),this.lo(a.initMessageHeaders,n,r),a.encodeInitMessageHeaders=!0;const l=i.join("");K("Connection","Creating WebChannel: "+l,a);const c=s.createWebChannel(l,a);let u=!1,h=!1;const d=new wH({Hr:p=>{h?K("Connection","Not sending because WebChannel is closed:",p):(u||(K("Connection","Opening WebChannel transport."),c.open(),u=!0),K("Connection","WebChannel sending:",p),c.send(p))},Jr:()=>c.close()}),f=(p,g,m)=>{p.listen(g,w=>{try{m(w)}catch(_){setTimeout(()=>{throw _},0)}})};return f(c,ec.EventType.OPEN,()=>{h||K("Connection","WebChannel transport opened.")}),f(c,ec.EventType.CLOSE,()=>{h||(h=!0,K("Connection","WebChannel transport closed"),d.io())}),f(c,ec.EventType.ERROR,p=>{h||(h=!0,lu("Connection","WebChannel transport errored:",p),d.io(new se(U.UNAVAILABLE,"The operation could not be completed")))}),f(c,ec.EventType.MESSAGE,p=>{var g;if(!h){const m=p.data[0];be(!!m);const w=m,_=w.error||((g=w[0])===null||g===void 0?void 0:g.error);if(_){K("Connection","WebChannel received error:",_);const M=_.status;let y=function(R){const j=Ze[R];if(j!==void 0)return H1(j)}(M),L=_.message;y===void 0&&(y=U.INTERNAL,L="Unknown error status: "+M+" with message "+_.message),h=!0,d.io(new se(y,L)),c.close()}else K("Connection","WebChannel received:",m),d.ro(m)}}),f(o,aU.STAT_EVENT,p=>{p.stat===bw.PROXY?K("Connection","Detected buffering proxy"):p.stat===bw.NOPROXY&&K("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EH(){return typeof window<"u"?window:null}function Cc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sh(t){return new cz(t,!0)}class TT{constructor(e,n,r=1e3,i=1.5,s=6e4){this.Hs=e,this.timerId=n,this.mo=r,this.yo=i,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const n=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,n-r);i>0&&K("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(e,n,r,i,s,o,a,l){this.Hs=e,this.vo=r,this.Vo=i,this.So=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new TT(e,n)}ko(){return this.state===1||this.state===5||this.Oo()}Oo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Mo()}async stop(){this.ko()&&await this.close(0)}Fo(){this.state=0,this.No.reset()}$o(){this.Oo()&&this.Co===null&&(this.Co=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.Bo()))}Lo(e){this.Uo(),this.stream.send(e)}async Bo(){if(this.Oo())return this.close(0)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}async close(e,n){this.Uo(),this.qo(),this.No.cancel(),this.Do++,e!==4?this.No.reset():n&&n.code===U.RESOURCE_EXHAUSTED?(jt(n.toString()),jt("Using maximum backoff delay to prevent overloading the backend."),this.No.Ao()):n&&n.code===U.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Ko(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(n)}Ko(){}auth(){this.state=1;const e=this.Go(this.Do),n=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Do===n&&this.Qo(r,i)},r=>{e(()=>{const i=new se(U.UNKNOWN,"Fetching auth token failed: "+r.message);return this.jo(i)})})}Qo(e,n){const r=this.Go(this.Do);this.stream=this.Wo(e,n),this.stream.Yr(()=>{r(()=>(this.state=2,this.xo=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.Oo()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(i=>{r(()=>this.jo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Mo(){this.state=5,this.No.Ro(async()=>{this.state=0,this.start()})}jo(e){return K("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Go(e){return n=>{this.Hs.enqueueAndForget(()=>this.Do===e?n():(K("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class xH extends CT{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.It=s}Wo(e,n){return this.So.wo("Listen",e,n)}onMessage(e){this.No.reset();const n=dz(this.It,e),r=function(i){if(!("targetChange"in i))return ge.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?ge.min():s.readTime?mn(s.readTime):ge.min()}(e);return this.listener.zo(n,r)}Ho(e){const n={};n.database=Qf(this.It),n.addTarget=function(i,s){let o;const a=s.target;return o=uu(a)?{documents:eT(i,a)}:{query:tT(i,a)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?o.resumeToken=X1(i,s.resumeToken):s.snapshotVersion.compareTo(ge.min())>0&&(o.readTime=al(i,s.snapshotVersion.toTimestamp())),o}(this.It,e);const r=pz(this.It,e);r&&(n.labels=r),this.Lo(n)}Jo(e){const n={};n.database=Qf(this.It),n.removeTarget=e,this.Lo(n)}}class SH extends CT{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.It=s,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(e,n){return this.So.wo("Write",e,n)}onMessage(e){if(be(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Yo){this.No.reset();const n=fz(e.writeResults,e.commitTime),r=mn(e.commitTime);return this.listener.tu(r,n)}return be(!e.writeResults||e.writeResults.length===0),this.Yo=!0,this.listener.eu()}nu(){const e={};e.database=Qf(this.It),this.Lo(e)}Zo(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>fu(this.It,r))};this.Lo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TH extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.So=r,this.It=i,this.su=!1}iu(){if(this.su)throw new se(U.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,n,r){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.So.ao(e,n,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new se(U.UNKNOWN,i.toString())})}_o(e,n,r,i){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.So._o(e,n,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new se(U.UNKNOWN,s.toString())})}terminate(){this.su=!0}}class CH{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}cu(){this.ru===0&&(this.au("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.au("Offline"),Promise.resolve())))}lu(e){this.state==="Online"?this.au("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.au("Offline")))}set(e){this.fu(),this.ru=0,e==="Online"&&(this.uu=!1),this.au(e)}au(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}hu(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(jt(n),this.uu=!1):K("OnlineStateTracker",n)}fu(){this.ou!==null&&(this.ou.cancel(),this.ou=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kH{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=s,this.gu.qr(o=>{r.enqueueAndForget(async()=>{ks(this)&&(K("RemoteStore","Restarting streams for network reachability change."),await async function(a){const l=we(a);l.wu.add(4),await kl(l),l.yu.set("Unknown"),l.wu.delete(4),await Th(l)}(this))})}),this.yu=new CH(r,i)}}async function Th(t){if(ks(t))for(const e of t.mu)await e(!0)}async function kl(t){for(const e of t.mu)await e(!1)}function kT(t,e){const n=we(t);n._u.has(e.targetId)||(n._u.set(e.targetId,e),tm(n)?em(n):Vo(n).Oo()&&Zg(n,e))}function IT(t,e){const n=we(t),r=Vo(n);n._u.delete(e),r.Oo()&&AT(n,e),n._u.size===0&&(r.Oo()?r.$o():ks(n)&&n.yu.set("Unknown"))}function Zg(t,e){t.pu.Mt(e.targetId),Vo(t).Ho(e)}function AT(t,e){t.pu.Mt(e),Vo(t).Jo(e)}function em(t){t.pu=new oz({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t._u.get(e)||null}),Vo(t).start(),t.yu.cu()}function tm(t){return ks(t)&&!Vo(t).ko()&&t._u.size>0}function ks(t){return we(t).wu.size===0}function _T(t){t.pu=void 0}async function IH(t){t._u.forEach((e,n)=>{Zg(t,e)})}async function AH(t,e){_T(t),tm(t)?(t.yu.lu(e),em(t)):t.yu.set("Unknown")}async function _H(t,e,n){if(t.yu.set("Online"),e instanceof J1&&e.state===2&&e.cause)try{await async function(r,i){const s=i.cause;for(const o of i.targetIds)r._u.has(o)&&(await r.remoteSyncer.rejectListen(o,s),r._u.delete(o),r.pu.removeTarget(o))}(t,e)}catch(r){K("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await mu(t,r)}else if(e instanceof Sc?t.pu.Gt(e):e instanceof G1?t.pu.Yt(e):t.pu.Wt(e),!n.isEqual(ge.min()))try{const r=await xT(t.localStore);n.compareTo(r)>=0&&await function(i,s){const o=i.pu.te(s);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const c=i._u.get(l);c&&i._u.set(l,c.withResumeToken(a.resumeToken,s))}}),o.targetMismatches.forEach(a=>{const l=i._u.get(a);if(!l)return;i._u.set(a,l.withResumeToken(pt.EMPTY_BYTE_STRING,l.snapshotVersion)),AT(i,a);const c=new ti(l.target,a,1,l.sequenceNumber);Zg(i,c)}),i.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(r){K("RemoteStore","Failed to raise snapshot:",r),await mu(t,r)}}async function mu(t,e,n){if(!mi(e))throw e;t.wu.add(1),await kl(t),t.yu.set("Offline"),n||(n=()=>xT(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{K("RemoteStore","Retrying IndexedDB access"),await n(),t.wu.delete(1),await Th(t)})}function MT(t,e){return e().catch(n=>mu(t,n,e))}async function Il(t){const e=we(t),n=ui(e);let r=e.du.length>0?e.du[e.du.length-1].batchId:-1;for(;MH(e);)try{const i=await pH(e.localStore,r);if(i===null){e.du.length===0&&n.$o();break}r=i.batchId,OH(e,i)}catch(i){await mu(e,i)}OT(e)&&NT(e)}function MH(t){return ks(t)&&t.du.length<10}function OH(t,e){t.du.push(e);const n=ui(t);n.Oo()&&n.Xo&&n.Zo(e.mutations)}function OT(t){return ks(t)&&!ui(t).ko()&&t.du.length>0}function NT(t){ui(t).start()}async function NH(t){ui(t).nu()}async function DH(t){const e=ui(t);for(const n of t.du)e.Zo(n.mutations)}async function RH(t,e,n){const r=t.du.shift(),i=Wg.from(r,e,n);await MT(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Il(t)}async function PH(t,e){e&&ui(t).Xo&&await async function(n,r){if(i=r.code,tz(i)&&i!==U.ABORTED){const s=n.du.shift();ui(n).Fo(),await MT(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r)),await Il(n)}var i}(t,e),OT(t)&&NT(t)}async function cv(t,e){const n=we(t);n.asyncQueue.verifyOperationInProgress(),K("RemoteStore","RemoteStore received new credentials");const r=ks(n);n.wu.add(3),await kl(n),r&&n.yu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.wu.delete(3),await Th(n)}async function LH(t,e){const n=we(t);e?(n.wu.delete(2),await Th(n)):e||(n.wu.add(2),await kl(n),n.yu.set("Unknown"))}function Vo(t){return t.Iu||(t.Iu=function(e,n,r){const i=we(e);return i.iu(),new xH(n,i.So,i.authCredentials,i.appCheckCredentials,i.It,r)}(t.datastore,t.asyncQueue,{Yr:IH.bind(null,t),Zr:AH.bind(null,t),zo:_H.bind(null,t)}),t.mu.push(async e=>{e?(t.Iu.Fo(),tm(t)?em(t):t.yu.set("Unknown")):(await t.Iu.stop(),_T(t))})),t.Iu}function ui(t){return t.Tu||(t.Tu=function(e,n,r){const i=we(e);return i.iu(),new SH(n,i.So,i.authCredentials,i.appCheckCredentials,i.It,r)}(t.datastore,t.asyncQueue,{Yr:NH.bind(null,t),Zr:PH.bind(null,t),eu:DH.bind(null,t),tu:RH.bind(null,t)}),t.mu.push(async e=>{e?(t.Tu.Fo(),await Il(t)):(await t.Tu.stop(),t.du.length>0&&(K("RemoteStore",`Stopping write stream with ${t.du.length} pending writes`),t.du=[]))})),t.Tu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Kn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new nm(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new se(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rm(t,e){if(jt("AsyncQueue",`${e}: ${t}`),mi(t))return new se(U.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e){this.comparator=e?(n,r)=>e(n,r)||ee.comparator(n.key,r.key):(n,r)=>ee.comparator(n.key,r.key),this.keyedMap=ia(),this.sortedSet=new it(this.comparator)}static emptySet(e){return new ro(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ro)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ro;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(){this.Eu=new it(ee.comparator)}track(e){const n=e.doc.key,r=this.Eu.get(n);r?e.type!==0&&r.type===3?this.Eu=this.Eu.insert(n,e):e.type===3&&r.type!==1?this.Eu=this.Eu.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Eu=this.Eu.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Eu=this.Eu.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Eu=this.Eu.remove(n):e.type===1&&r.type===2?this.Eu=this.Eu.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Eu=this.Eu.insert(n,{type:2,doc:e.doc}):ae():this.Eu=this.Eu.insert(n,e)}Au(){const e=[];return this.Eu.inorderTraversal((n,r)=>{e.push(r)}),e}}class ko{constructor(e,n,r,i,s,o,a,l){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l}static fromInitialDocuments(e,n,r,i){const s=[];return n.forEach(o=>{s.push({type:0,doc:o})}),new ko(e,n,ro.emptySet(n),s,r,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&gh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BH{constructor(){this.Ru=void 0,this.listeners=[]}}class FH{constructor(){this.queries=new yi(e=>N1(e),gh),this.onlineState="Unknown",this.bu=new Set}}async function DT(t,e){const n=we(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new BH),i)try{s.Ru=await n.onListen(r)}catch(o){const a=rm(o,`Initialization of query '${Xf(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,s),s.listeners.push(e),e.Pu(n.onlineState),s.Ru&&e.vu(s.Ru)&&im(n)}async function RT(t,e){const n=we(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function VH(t,e){const n=we(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.listeners)a.vu(i)&&(r=!0);o.Ru=i}}r&&im(n)}function $H(t,e,n){const r=we(t),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(e)}function im(t){t.bu.forEach(e=>{e.next()})}class PT{constructor(e,n,r){this.query=e,this.Vu=n,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=r||{}}vu(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new ko(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let n=!1;return this.Su?this.Cu(e)&&(this.Vu.next(e),n=!0):this.xu(e,this.onlineState)&&(this.Nu(e),n=!0),this.Du=e,n}onError(e){this.Vu.error(e)}Pu(e){this.onlineState=e;let n=!1;return this.Du&&!this.Su&&this.xu(this.Du,e)&&(this.Nu(this.Du),n=!0),n}xu(e,n){if(!e.fromCache)return!0;const r=n!=="Offline";return(!this.options.ku||!r)&&(!e.docs.isEmpty()||n==="Offline")}Cu(e){if(e.docChanges.length>0)return!0;const n=this.Du&&this.Du.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Nu(e){e=ko.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Su=!0,this.Vu.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LT{constructor(e){this.key=e}}class BT{constructor(e){this.key=e}}class UH{constructor(e,n){this.query=e,this.Uu=n,this.qu=null,this.current=!1,this.Ku=Ie(),this.mutatedKeys=Ie(),this.Gu=D1(e),this.Qu=new ro(this.Gu)}get ju(){return this.Uu}Wu(e,n){const r=n?n.zu:new uv,i=n?n.Qu:this.Qu;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{const d=i.get(u),f=jg(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),g=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let m=!1;d&&f?d.data.isEqual(f.data)?p!==g&&(r.track({type:3,doc:f}),m=!0):this.Hu(d,f)||(r.track({type:2,doc:f}),m=!0,(l&&this.Gu(f,l)>0||c&&this.Gu(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),m=!0):d&&!f&&(r.track({type:1,doc:d}),m=!0,(l||c)&&(a=!0)),m&&(f?(o=o.add(f),s=g?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{Qu:o,zu:r,$i:a,mutatedKeys:s}}Hu(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Au();s.sort((c,u)=>function(h,d){const f=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ae()}};return f(h)-f(d)}(c.type,u.type)||this.Gu(c.doc,u.doc)),this.Ju(r);const o=n?this.Yu():[],a=this.Ku.size===0&&this.current?1:0,l=a!==this.qu;return this.qu=a,s.length!==0||l?{snapshot:new ko(this.query,e.Qu,i,s,e.mutatedKeys,a===0,l,!1),Xu:o}:{Xu:o}}Pu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new uv,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(n=>this.Uu=this.Uu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Uu=this.Uu.delete(n)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Ie(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const n=[];return e.forEach(r=>{this.Ku.has(r)||n.push(new BT(r))}),this.Ku.forEach(r=>{e.has(r)||n.push(new LT(r))}),n}tc(e){this.Uu=e.Hi,this.Ku=Ie();const n=this.Wu(e.documents);return this.applyChanges(n,!0)}ec(){return ko.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.qu===0)}}class zH{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class HH{constructor(e){this.key=e,this.nc=!1}}class jH{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new yi(a=>N1(a),gh),this.rc=new Map,this.oc=new Set,this.uc=new it(ee.comparator),this.cc=new Map,this.ac=new Xg,this.hc={},this.lc=new Map,this.fc=bs.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function KH(t,e){const n=tj(t);let r,i;const s=n.ic.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const o=await gH(n.localStore,Wn(e));n.isPrimaryClient&&kT(n.remoteStore,o);const a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=await qH(n,e,r,a==="current")}return i}async function qH(t,e,n,r){t._c=(u,h,d)=>async function(f,p,g,m){let w=p.view.Wu(g);w.$i&&(w=await ov(f.localStore,p.query,!1).then(({documents:y})=>p.view.Wu(y,w)));const _=m&&m.targetChanges.get(p.targetId),M=p.view.applyChanges(w,f.isPrimaryClient,_);return dv(f,p.targetId,M.Xu),M.snapshot}(t,u,h,d);const i=await ov(t.localStore,e,!0),s=new UH(e,i.Hi),o=s.Wu(i.documents),a=Cl.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline"),l=s.applyChanges(o,t.isPrimaryClient,a);dv(t,n,l.Xu);const c=new zH(e,n,s);return t.ic.set(e,c),t.rc.has(n)?t.rc.get(n).push(e):t.rc.set(n,[e]),l.snapshot}async function WH(t,e){const n=we(t),r=n.ic.get(e),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter(s=>!gh(s,e))),void n.ic.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await tp(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),IT(n.remoteStore,r.targetId),np(n,r.targetId)}).catch(Ts)):(np(n,r.targetId),await tp(n.localStore,r.targetId,!0))}async function GH(t,e,n){const r=zT(t);try{const i=await function(s,o){const a=we(s),l=We.now(),c=o.reduce((d,f)=>d.add(f.key),Ie());let u,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let f=fn(),p=Ie();return a.Gi.getEntries(d,c).next(g=>{f=g,f.forEach((m,w)=>{w.isValidDocument()||(p=p.add(m))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,f)).next(g=>{u=g;const m=[];for(const w of o){const _=ZU(w,u.get(w.key).overlayedDocument);_!=null&&m.push(new Ar(w.key,_,M1(_.value.mapValue),Pt.exists(!0)))}return a.mutationQueue.addMutationBatch(d,l,m,o)}).next(g=>{h=g;const m=g.applyToLocalDocumentSet(u,p);return a.documentOverlayCache.saveOverlays(d,g.batchId,m)})}).then(()=>({batchId:h.batchId,changes:K1(u)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,o,a){let l=s.hc[s.currentUser.toKey()];l||(l=new it(Te)),l=l.insert(o,a),s.hc[s.currentUser.toKey()]=l}(r,i.batchId,n),await Al(r,i.changes),await Il(r.remoteStore)}catch(i){const s=rm(i,"Failed to persist write");n.reject(s)}}async function FT(t,e){const n=we(t);try{const r=await dH(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.cc.get(s);o&&(be(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.nc=!0:i.modifiedDocuments.size>0?be(o.nc):i.removedDocuments.size>0&&(be(o.nc),o.nc=!1))}),await Al(n,r,e)}catch(r){await Ts(r)}}function hv(t,e,n){const r=we(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.ic.forEach((s,o)=>{const a=o.view.Pu(e);a.snapshot&&i.push(a.snapshot)}),function(s,o){const a=we(s);a.onlineState=o;let l=!1;a.queries.forEach((c,u)=>{for(const h of u.listeners)h.Pu(o)&&(l=!0)}),l&&im(a)}(r.eventManager,e),i.length&&r.sc.zo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function JH(t,e,n){const r=we(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.cc.get(e),s=i&&i.key;if(s){let o=new it(ee.comparator);o=o.insert(s,qe.newNoDocument(s,ge.min()));const a=Ie().add(s),l=new wh(ge.min(),new Map,new $e(Te),o,a);await FT(r,l),r.uc=r.uc.remove(s),r.cc.delete(e),sm(r)}else await tp(r.localStore,e,!1).then(()=>np(r,e,n)).catch(Ts)}async function XH(t,e){const n=we(t),r=e.batch.batchId;try{const i=await hH(n.localStore,e);$T(n,r,null),VT(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Al(n,i)}catch(i){await Ts(i)}}async function YH(t,e,n){const r=we(t);try{const i=await function(s,o){const a=we(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return a.mutationQueue.lookupMutationBatch(l,o).next(u=>(be(u!==null),c=u.keys(),a.mutationQueue.removeMutationBatch(l,u))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>a.localDocuments.getDocuments(l,c))})}(r.localStore,e);$T(r,e,n),VT(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Al(r,i)}catch(i){await Ts(i)}}function VT(t,e){(t.lc.get(e)||[]).forEach(n=>{n.resolve()}),t.lc.delete(e)}function $T(t,e,n){const r=we(t);let i=r.hc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.hc[r.currentUser.toKey()]=i}}function np(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(r=>{t.ac.containsKey(r)||UT(t,r)})}function UT(t,e){t.oc.delete(e.path.canonicalString());const n=t.uc.get(e);n!==null&&(IT(t.remoteStore,n),t.uc=t.uc.remove(e),t.cc.delete(n),sm(t))}function dv(t,e,n){for(const r of n)r instanceof LT?(t.ac.addReference(r.key,e),QH(t,r)):r instanceof BT?(K("SyncEngine","Document no longer in limbo: "+r.key),t.ac.removeReference(r.key,e),t.ac.containsKey(r.key)||UT(t,r.key)):ae()}function QH(t,e){const n=e.key,r=n.path.canonicalString();t.uc.get(n)||t.oc.has(r)||(K("SyncEngine","New document in limbo: "+n),t.oc.add(r),sm(t))}function sm(t){for(;t.oc.size>0&&t.uc.size<t.maxConcurrentLimboResolutions;){const e=t.oc.values().next().value;t.oc.delete(e);const n=new ee(Ve.fromString(e)),r=t.fc.next();t.cc.set(r,new HH(n)),t.uc=t.uc.insert(n,r),kT(t.remoteStore,new ti(Wn(ph(n.path)),r,2,An.at))}}async function Al(t,e,n){const r=we(t),i=[],s=[],o=[];r.ic.isEmpty()||(r.ic.forEach((a,l)=>{o.push(r._c(l,e,n).then(c=>{if((c||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c!=null&&c.fromCache?"not-current":"current"),c){i.push(c);const u=Qg.Ci(l.targetId,c);s.push(u)}}))}),await Promise.all(o),r.sc.zo(i),await async function(a,l){const c=we(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>k.forEach(l,h=>k.forEach(h.Si,d=>c.persistence.referenceDelegate.addReference(u,h.targetId,d)).next(()=>k.forEach(h.Di,d=>c.persistence.referenceDelegate.removeReference(u,h.targetId,d)))))}catch(u){if(!mi(u))throw u;K("LocalStore","Failed to update sequence numbers: "+u)}for(const u of l){const h=u.targetId;if(!u.fromCache){const d=c.Ui.get(h),f=d.snapshotVersion,p=d.withLastLimboFreeSnapshotVersion(f);c.Ui=c.Ui.insert(h,p)}}}(r.localStore,s))}async function ZH(t,e){const n=we(t);if(!n.currentUser.isEqual(e)){K("SyncEngine","User change. New user:",e.toKey());const r=await ET(n.localStore,e);n.currentUser=e,function(i,s){i.lc.forEach(o=>{o.forEach(a=>{a.reject(new se(U.CANCELLED,s))})}),i.lc.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Al(n,r.ji)}}function ej(t,e){const n=we(t),r=n.cc.get(e);if(r&&r.nc)return Ie().add(r.key);{let i=Ie();const s=n.rc.get(e);if(!s)return i;for(const o of s){const a=n.ic.get(o);i=i.unionWith(a.view.ju)}return i}}function tj(t){const e=we(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=FT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ej.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=JH.bind(null,e),e.sc.zo=VH.bind(null,e.eventManager),e.sc.wc=$H.bind(null,e.eventManager),e}function zT(t){const e=we(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=XH.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=YH.bind(null,e),e}class HT{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=Sh(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,n){return null}Ec(e,n){return null}Ic(e){return vT(this.persistence,new wT,e.initialUser,this.It)}yc(e){return new bT(xh.Bs,this.It)}gc(e){return new ST}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class nj extends HT{constructor(e,n,r){super(),this.Ac=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await zT(this.Ac.syncEngine),await Il(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return vT(this.persistence,new wT,e.initialUser,this.It)}Tc(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new Jz(r,e.asyncQueue,n)}Ec(e,n){const r=new TU(n,this.persistence);return new SU(e.asyncQueue,r)}yc(e){const n=cH(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?tn.withCacheSize(this.cacheSizeBytes):tn.DEFAULT;return new Yg(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,EH(),Cc(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(e){return new ST}}class jT{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hv(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=ZH.bind(null,this.syncEngine),await LH(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new FH}createDatastore(e){const n=Sh(e.databaseInfo.databaseId),r=(i=e.databaseInfo,new vH(i));var i;return function(s,o,a,l){return new TH(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return n=this.localStore,r=this.datastore,i=e.asyncQueue,s=a=>hv(this.syncEngine,a,0),o=lv.C()?new lv:new yH,new kH(n,r,i,s,o);var n,r,i,s,o}createSyncEngine(e,n){return function(r,i,s,o,a,l,c){const u=new jH(r,i,s,o,a,l);return c&&(u.dc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=we(e);K("RemoteStore","RemoteStore shutting down."),n.wu.add(5),await kl(n),n.gu.shutdown(),n.yu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(t,e,n){if(!n)throw new se(U.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function rj(t,e,n,r){if(e===!0&&r===!0)throw new se(U.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function fv(t){if(!ee.isDocumentKey(t))throw new se(U.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function pv(t){if(ee.isDocumentKey(t))throw new se(U.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function om(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ae()}function Rn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new se(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=om(t);throw new se(U.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=new Map;class mv{constructor(e){var n;if(e.host===void 0){if(e.ssl!==void 0)throw new se(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new se(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,rj("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new mv({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new se(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new se(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new mv(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new uU;switch(n.type){case"gapi":const r=n.client;return new pU(r,n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new se(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=gv.get(e);n&&(K("ComponentProvider","Removing Datastore"),gv.delete(e),n.terminate())}(this),Promise.resolve()}}function ij(t,e,n,r={}){var i;const s=(t=Rn(t,Ch))._getSettings();if(s.host!=="firestore.googleapis.com"&&s.host!==e&&lu("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){let o,a;if(typeof r.mockUserToken=="string")o=r.mockUserToken,a=wt.MOCK_USER;else{o=oS(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new se(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new wt(l)}t._authCredentials=new hU(new w1(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ni(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ln(this.firestore,e,this._key)}}class kh{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new kh(this.firestore,e,this._query)}}class ni extends kh{constructor(e,n,r){super(e,n,ph(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ln(this.firestore,null,new ee(e))}withConverter(e){return new ni(this.firestore,e,this._path)}}function Xo(t,e,...n){if(t=Dn(t),KT("collection","path",e),t instanceof Ch){const r=Ve.fromString(e,...n);return pv(r),new ni(t,null,r)}{if(!(t instanceof ln||t instanceof ni))throw new se(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ve.fromString(e,...n));return pv(r),new ni(t.firestore,null,r)}}function oa(t,e,...n){if(t=Dn(t),arguments.length===1&&(e=v1.R()),KT("doc","path",e),t instanceof Ch){const r=Ve.fromString(e,...n);return fv(r),new ln(t,null,new ee(r))}{if(!(t instanceof ln||t instanceof ni))throw new se(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ve.fromString(e,...n));return fv(r),new ln(t.firestore,t instanceof ni?t.converter:null,new ee(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qT{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):jt("Uncaught Error in snapshot listener:",e)}bc(){this.muted=!0}Rc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=wt.UNAUTHENTICATED,this.clientId=v1.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{K("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(K("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new se(U.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Kn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=rm(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function WT(t,e){t.asyncQueue.verifyOperationInProgress(),K("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await ET(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function GT(t,e){t.asyncQueue.verifyOperationInProgress();const n=await oj(t);K("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(i=>cv(e.remoteStore,i)),t.setAppCheckTokenChangeListener((i,s)=>cv(e.remoteStore,s)),t.onlineComponents=e}async function oj(t){return t.offlineComponents||(K("FirestoreClient","Using default OfflineComponentProvider"),await WT(t,new HT)),t.offlineComponents}async function JT(t){return t.onlineComponents||(K("FirestoreClient","Using default OnlineComponentProvider"),await GT(t,new jT)),t.onlineComponents}function aj(t){return JT(t).then(e=>e.syncEngine)}async function XT(t){const e=await JT(t),n=e.eventManager;return n.onListen=KH.bind(null,e.syncEngine),n.onUnlisten=WH.bind(null,e.syncEngine),n}function lj(t,e,n={}){const r=new Kn;return t.asyncQueue.enqueueAndForget(async()=>function(i,s,o,a,l){const c=new qT({next:h=>{s.enqueueAndForget(()=>RT(i,u));const d=h.docs.has(o);!d&&h.fromCache?l.reject(new se(U.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?l.reject(new se(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(h)},error:h=>l.reject(h)}),u=new PT(ph(o.path),c,{includeMetadataChanges:!0,ku:!0});return DT(i,u)}(await XT(t),t.asyncQueue,e,n,r)),r.promise}function cj(t,e,n={}){const r=new Kn;return t.asyncQueue.enqueueAndForget(async()=>function(i,s,o,a,l){const c=new qT({next:h=>{s.enqueueAndForget(()=>RT(i,u)),h.fromCache&&a.source==="server"?l.reject(new se(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(h)},error:h=>l.reject(h)}),u=new PT(o,c,{includeMetadataChanges:!0,ku:!0});return DT(i,u)}(await XT(t),t.asyncQueue,e,n,r)),r.promise}class uj{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.No=new TT(this,"async_queue_retry"),this.Wc=()=>{const n=Cc();n&&K("AsyncQueue","Visibility state changed to "+n.visibilityState),this.No.Po()};const e=Cc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const n=Cc();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const n=new Kn;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.No.reset()}catch(e){if(!mi(e))throw e;K("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.No.Ro(()=>this.Jc())}}Hc(e){const n=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{this.Kc=r,this.Gc=!1;const i=function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),o}(r);throw jt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Gc=!1,r))));return this.Bc=n,n}enqueueAfterDelay(e,n,r){this.zc(),this.jc.indexOf(e)>-1&&(n=0);const i=nm.createAndSchedule(this,e,n,r,s=>this.Yc(s));return this.qc.push(i),i}zc(){this.Kc&&ae()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const n of this.qc)if(n.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.qc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.qc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const n=this.qc.indexOf(e);this.qc.splice(n,1)}}class bi extends Ch{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new uj,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||YT(this),this._firestoreClient.terminate()}}function hj(t,e){const n=typeof t=="object"?t:pS(),r=typeof t=="string"?t:e||"(default)",i=hS(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=sS("firestore");if(s){const[o,a]=s.split(":");ij(i,o,parseInt(a,10))}}return i}function Ih(t){return t._firestoreClient||YT(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function YT(t){var e;const n=t._freezeSettings(),r=function(i,s,o,a){return new kU(i,s,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new sj(t._authCredentials,t._appCheckCredentials,t._queue,r)}function dj(t,e){pj(t=Rn(t,bi));const n=Ih(t),r=t._freezeSettings(),i=new jT;return fj(n,i,new nj(i,r.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function fj(t,e,n){const r=new Kn;return t.asyncQueue.enqueue(async()=>{try{await WT(t,n),await GT(t,e),r.resolve()}catch(i){const s=i;if(!function(o){return o.name==="FirebaseError"?o.code===U.FAILED_PRECONDITION||o.code===U.UNIMPLEMENTED:typeof DOMException<"u"&&o instanceof DOMException?o.code===22||o.code===20||o.code===11:!0}(s))throw s;lu("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}}).then(()=>r.promise)}function pj(t){if(t._initialized||t._terminated)throw new se(U.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Io(pt.fromBase64String(e))}catch(n){throw new se(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Io(pt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new se(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new se(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new se(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Te(this._lat,e._lat)||Te(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gj=/^__.*__$/;class mj{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ar(e,this.data,this.fieldMask,n,this.fieldTransforms):new Fo(e,this.data,n,this.fieldTransforms)}}class QT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ar(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function ZT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ae()}}class cm{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.It=r,this.ignoreUndefinedProperties=i,s===void 0&&this.na(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new cm(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ia({path:r,oa:!1});return i.ua(e),i}ca(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ia({path:r,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return yu(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(ZT(this.sa)&&gj.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class yj{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.It=r||Sh(e)}da(e,n,r,i=!1){return new cm({sa:e,methodName:n,fa:r,path:tt.emptyPath(),oa:!1,la:i},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function um(t){const e=t._freezeSettings(),n=Sh(t._databaseId);return new yj(t._databaseId,!!e.ignoreUndefinedProperties,n)}function eC(t,e,n,r,i,s={}){const o=t.da(s.merge||s.mergeFields?2:0,e,n,i);hm("Data must be an object, but it was:",o,r);const a=tC(r,o);let l,c;if(s.merge)l=new gn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=rp(e,h,n);if(!o.contains(d))throw new se(U.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);rC(u,d)||u.push(d)}l=new gn(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new mj(new Ot(a),l,c)}class _h extends am{_toFieldTransform(e){if(e.sa!==2)throw e.sa===1?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof _h}}function bj(t,e,n,r){const i=t.da(1,e,n);hm("Data must be an object, but it was:",i,r);const s=[],o=Ot.empty();Cs(r,(l,c)=>{const u=dm(e,l,n);c=Dn(c);const h=i.ca(u);if(c instanceof _h)s.push(u);else{const d=Mh(c,h);d!=null&&(s.push(u),o.set(u,d))}});const a=new gn(s);return new QT(o,a,i.fieldTransforms)}function wj(t,e,n,r,i,s){const o=t.da(1,e,n),a=[rp(e,r,n)],l=[i];if(s.length%2!=0)throw new se(U.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(rp(e,s[d])),l.push(s[d+1]);const c=[],u=Ot.empty();for(let d=a.length-1;d>=0;--d)if(!rC(c,a[d])){const f=a[d];let p=l[d];p=Dn(p);const g=o.ca(f);if(p instanceof _h)c.push(f);else{const m=Mh(p,g);m!=null&&(c.push(f),u.set(f,m))}}const h=new gn(c);return new QT(u,h,o.fieldTransforms)}function Mh(t,e){if(nC(t=Dn(t)))return hm("Unsupported field value:",e,t),tC(t,e);if(t instanceof am)return function(n,r){if(!ZT(r.sa))throw r.ha(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(n,r){const i=[];let s=0;for(const o of n){let a=Mh(o,r.aa(s));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),s++}return{arrayValue:{values:i}}}(t,e)}return function(n,r){if((n=Dn(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return qU(r.It,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=We.fromDate(n);return{timestampValue:al(r.It,i)}}if(n instanceof We){const i=new We(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:al(r.It,i)}}if(n instanceof lm)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Io)return{bytesValue:X1(r.It,n._byteString)};if(n instanceof ln){const i=r.databaseId,s=n.firestore._databaseId;if(!s.isEqual(i))throw r.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Kg(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.ha(`Unsupported field value: ${om(n)}`)}(t,e)}function tC(t,e){const n={};return k1(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Cs(t,(r,i)=>{const s=Mh(i,e.ra(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function nC(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof We||t instanceof lm||t instanceof Io||t instanceof ln||t instanceof am)}function hm(t,e,n){if(!nC(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){const r=om(n);throw r==="an object"?e.ha(t+" a custom object"):e.ha(t+" "+r)}}function rp(t,e,n){if((e=Dn(e))instanceof Ah)return e._internalPath;if(typeof e=="string")return dm(t,e);throw yu("Field path arguments must be of type string or ",t,!1,void 0,n)}const vj=new RegExp("[~\\*/\\[\\]]");function dm(t,e,n){if(e.search(vj)>=0)throw yu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ah(...e.split("."))._internalPath}catch{throw yu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function yu(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new se(U.INVALID_ARGUMENT,a+t+l)}function rC(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ln(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Ej(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(sC("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Ej extends iC{data(){return super.data()}}function sC(t,e){return typeof e=="string"?dm(t,e):e instanceof Ah?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xj(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new se(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sj{convertValue(e,n="none"){switch(ps(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ds(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw ae()}}convertObject(e,n){const r={};return Cs(e.fields,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new lm(Ge(e.latitude),Ge(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=A1(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(el(e));default:return null}}convertTimestamp(e){const n=li(e);return new We(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ve.fromString(e);be(iT(r));const i=new fs(r.get(1),r.get(3)),s=new ee(r.popFirst(5));return i.isEqual(n)||jt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oC(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class aC extends iC{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new kc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(sC("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class kc extends aC{data(e={}){return super.data(e)}}class Tj{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new aa(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new kc(this._firestore,this._userDataWriter,r.key,r,new aa(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new se(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new kc(r._firestore,r._userDataWriter,o.doc.key,o.doc,new aa(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>i||o.type!==3).map(o=>{const a=new kc(r._firestore,r._userDataWriter,o.doc.key,o.doc,new aa(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let l=-1,c=-1;return o.type!==0&&(l=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),o.type!==1&&(s=s.add(o.doc),c=s.indexOf(o.doc.key)),{type:Cj(o.type),doc:a,oldIndex:l,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Cj(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ae()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kj(t){t=Rn(t,ln);const e=Rn(t.firestore,bi);return lj(Ih(e),t._key).then(n=>Oj(e,t,n))}class lC extends Sj{constructor(e){super(),this.firestore=e}convertBytes(e){return new Io(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new ln(this.firestore,null,n)}}function Ij(t){t=Rn(t,kh);const e=Rn(t.firestore,bi),n=Ih(e),r=new lC(e);return xj(t._query),cj(n,t._query).then(i=>new Tj(e,r,t,i))}function Aj(t,e,n){t=Rn(t,ln);const r=Rn(t.firestore,bi),i=oC(t.converter,e,n);return Oh(r,[eC(um(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,Pt.none())])}function _j(t,e,n,...r){t=Rn(t,ln);const i=Rn(t.firestore,bi),s=um(i);let o;return o=typeof(e=Dn(e))=="string"||e instanceof Ah?wj(s,"updateDoc",t._key,e,n,r):bj(s,"updateDoc",t._key,e),Oh(i,[o.toMutation(t._key,Pt.exists(!0))])}function Mj(t){return Oh(Rn(t.firestore,bi),[new bh(t._key,Pt.none())])}function oc(t,e){const n=Rn(t.firestore,bi),r=oa(t),i=oC(t.converter,e);return Oh(n,[eC(um(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,Pt.exists(!1))]).then(()=>r)}function Oh(t,e){return function(n,r){const i=new Kn;return n.asyncQueue.enqueueAndForget(async()=>GH(await aj(n),r,i)),i.promise}(Ih(t),e)}function Oj(t,e,n){const r=n.docs.get(e._key),i=new lC(t);return new aC(t,i,e._key,r,new aa(n.hasPendingWrites,n.fromCache),e.converter)}(function(t,e=!0){(function(n){Bo=n})(dS),qa(new vo("firestore",(n,{instanceIdentifier:r,options:i})=>{const s=n.getProvider("app").getImmediate(),o=new bi(new dU(n.getProvider("auth-internal")),new mU(n.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new se(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fs(a.options.projectId,l)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),ei(ww,"3.6.0",t),ei(ww,"3.6.0","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC="firebasestorage.googleapis.com",uC="storageBucket",Nj=2*60*1e3,Dj=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye extends xs{constructor(e,n){super(Od(e),`Firebase Storage: ${n} (${Od(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ye.prototype)}_codeEquals(e){return Od(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function Od(t){return"storage/"+t}function fm(){const t="An unknown error occurred, please check the error payload for server response.";return new Ye("unknown",t)}function Rj(t){return new Ye("object-not-found","Object '"+t+"' does not exist.")}function Pj(t){return new Ye("quota-exceeded","Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Lj(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ye("unauthenticated",t)}function Bj(){return new Ye("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function Fj(t){return new Ye("unauthorized","User does not have permission to access '"+t+"'.")}function Vj(){return new Ye("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function hC(){return new Ye("canceled","User canceled the upload/download.")}function $j(t){return new Ye("invalid-url","Invalid URL '"+t+"'.")}function Uj(t){return new Ye("invalid-default-bucket","Invalid default bucket '"+t+"'.")}function zj(){return new Ye("no-default-bucket","No default bucket found. Did you set the '"+uC+"' property when initializing the app?")}function dC(){return new Ye("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Hj(){return new Ye("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function jj(){return new Ye("no-download-url","The given file does not have any download URLs.")}function ip(t){return new Ye("invalid-argument",t)}function fC(){return new Ye("app-deleted","The Firebase app was deleted.")}function Kj(t){return new Ye("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ta(t,e){return new Ye("invalid-format","String does not match format '"+t+"': "+e)}function Yo(t){throw new Ye("internal-error","Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=pn.makeFromUrl(e,n)}catch{return new pn(e,"")}if(r.path==="")return r;throw Uj(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s(y){y.path.charAt(y.path.length-1)==="/"&&(y.path_=y.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),l={bucket:1,path:3};function c(y){y.path_=decodeURIComponent(y.path)}const u="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${i}/o${d}`,"i"),p={bucket:1,path:3},g=n===cC?"(?:storage.googleapis.com|storage.cloud.google.com)":n,m="([^?#]*)",w=new RegExp(`^https?://${g}/${i}/${m}`,"i"),M=[{regex:a,indices:l,postModify:s},{regex:f,indices:p,postModify:c},{regex:w,indices:{bucket:1,path:2},postModify:c}];for(let y=0;y<M.length;y++){const L=M[y],R=L.regex.exec(e);if(R){const j=R[L.indices.bucket];let N=R[L.indices.path];N||(N=""),r=new pn(j,N),L.postModify(r);break}}if(r==null)throw $j(e);return r}}class qj{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wj(t,e,n){let r=1,i=null,s=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...m){c||(c=!0,e.apply(null,m))}function h(m){i=setTimeout(()=>{i=null,t(f,l())},m)}function d(){s&&clearTimeout(s)}function f(m,...w){if(c){d();return}if(m){d(),u.call(null,m,...w);return}if(l()||o){d(),u.call(null,m,...w);return}r<64&&(r*=2);let M;a===1?(a=2,M=0):M=(r+Math.random())*1e3,h(M)}let p=!1;function g(m){p||(p=!0,d(),!c&&(i!==null?(m||(a=2),clearTimeout(i),h(0)):m||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,g(!0)},n),g}function Gj(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jj(t){return t!==void 0}function Xj(t){return typeof t=="function"}function Yj(t){return typeof t=="object"&&!Array.isArray(t)}function Nh(t){return typeof t=="string"||t instanceof String}function yv(t){return pm()&&t instanceof Blob}function pm(){return typeof Blob<"u"}function bv(t,e,n,r){if(r<e)throw ip(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw ip(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function pC(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ns;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ns||(ns={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qj{constructor(e,n,r,i,s,o,a,l,c,u,h){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((d,f)=>{this.resolve_=d,this.reject_=f,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new ac(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===ns.NO_ERROR,l=s.getStatus();if(!a||this.isRetryStatusCode_(l)){const u=s.getErrorCode()===ns.ABORT;r(!1,new ac(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new ac(c,s))})},n=(r,i)=>{const s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());Jj(l)?s(l):s()}catch(l){o(l)}else if(a!==null){const l=fm();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(i.canceled){const l=this.appDelete_?fC():hC();o(l)}else{const l=Vj();o(l)}};this.canceled_?n(!1,new ac(!1,null,!0)):this.backoffId_=Wj(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Gj(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const n=e>=500&&e<600,i=[408,429].indexOf(e)!==-1,s=this.additionalRetryCodes_.indexOf(e)!==-1;return n||i||s}}class ac{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function Zj(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function eK(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function tK(t,e){e&&(t["X-Firebase-GMPID"]=e)}function nK(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function rK(t,e,n,r,i,s){const o=pC(t.urlParams),a=t.url+o,l=Object.assign({},t.headers);return tK(l,e),Zj(l,n),eK(l,s),nK(l,r),new Qj(a,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iK(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function sK(...t){const e=iK();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(pm())return new Blob(t);throw new Ye("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function oK(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aK(t){return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Nd{constructor(e,n){this.data=e,this.contentType=n||null}}function lK(t,e){switch(t){case cr.RAW:return new Nd(gC(e));case cr.BASE64:case cr.BASE64URL:return new Nd(mC(t,e));case cr.DATA_URL:return new Nd(uK(e),hK(e))}throw fm()}function gC(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const s=r,o=t.charCodeAt(++n);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function cK(t){let e;try{e=decodeURIComponent(t)}catch{throw Ta(cr.DATA_URL,"Malformed data URL.")}return gC(e)}function mC(t,e){switch(t){case cr.BASE64:{const i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Ta(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case cr.BASE64URL:{const i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Ta(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=aK(e)}catch{throw Ta(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class yC{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw Ta(cr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=dK(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function uK(t){const e=new yC(t);return e.base64?mC(cr.BASE64,e.rest):cK(e.rest)}function hK(t){return new yC(t).contentType}function dK(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,n){let r=0,i="";yv(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(yv(this.data_)){const r=this.data_,i=oK(r,e,n);return i===null?null:new $r(i)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new $r(r,!0)}}static getBlob(...e){if(pm()){const n=e.map(r=>r instanceof $r?r.data_:r);return new $r(sK.apply(null,n))}else{const n=e.map(o=>Nh(o)?lK(cr.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let s=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new $r(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bC(t){let e;try{e=JSON.parse(t)}catch{return null}return Yj(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fK(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function pK(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function wC(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gK(t,e){return e}class Ut{constructor(e,n,r,i){this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||gK}}let lc=null;function mK(t){return!Nh(t)||t.length<2?t:wC(t)}function vC(){if(lc)return lc;const t=[];t.push(new Ut("bucket")),t.push(new Ut("generation")),t.push(new Ut("metageneration")),t.push(new Ut("name","fullPath",!0));function e(s,o){return mK(o)}const n=new Ut("name");n.xform=e,t.push(n);function r(s,o){return o!==void 0?Number(o):o}const i=new Ut("size");return i.xform=r,t.push(i),t.push(new Ut("timeCreated")),t.push(new Ut("updated")),t.push(new Ut("md5Hash",null,!0)),t.push(new Ut("cacheControl",null,!0)),t.push(new Ut("contentDisposition",null,!0)),t.push(new Ut("contentEncoding",null,!0)),t.push(new Ut("contentLanguage",null,!0)),t.push(new Ut("contentType",null,!0)),t.push(new Ut("metadata","customMetadata",!0)),lc=t,lc}function yK(t,e){function n(){const r=t.bucket,i=t.fullPath,s=new pn(r,i);return e._makeStorageReference(s)}Object.defineProperty(t,"ref",{get:n})}function bK(t,e,n){const r={};r.type="file";const i=n.length;for(let s=0;s<i;s++){const o=n[s];r[o.local]=o.xform(r,e[o.server])}return yK(r,t),r}function EC(t,e,n){const r=bC(e);return r===null?null:bK(t,r,n)}function wK(t,e,n,r){const i=bC(e);if(i===null||!Nh(i.downloadTokens))return null;const s=i.downloadTokens;if(s.length===0)return null;const o=encodeURIComponent;return s.split(",").map(c=>{const u=t.bucket,h=t.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=_l(d,n,r),p=pC({alt:"media",token:c});return f+p})[0]}function xC(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(n[s.server]=t[s.local])}return JSON.stringify(n)}class $o{constructor(e,n,r,i){this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(t){if(!t)throw fm()}function gm(t,e){function n(r,i){const s=EC(t,i,e);return Sr(s!==null),s}return n}function vK(t,e){function n(r,i){const s=EC(t,i,e);return Sr(s!==null),wK(s,i,t.host,t._protocol)}return n}function Ml(t){function e(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=Bj():i=Lj():n.getStatus()===402?i=Pj(t.bucket):n.getStatus()===403?i=Fj(t.path):i=r,i.serverResponse=r.serverResponse,i}return e}function SC(t){const e=Ml(t);function n(r,i){let s=e(r,i);return r.getStatus()===404&&(s=Rj(t.path)),s.serverResponse=i.serverResponse,s}return n}function EK(t,e,n){const r=e.fullServerUrl(),i=_l(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new $o(i,s,gm(t,n),o);return a.errorHandler=SC(e),a}function xK(t,e,n){const r=e.fullServerUrl(),i=_l(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new $o(i,s,vK(t,n),o);return a.errorHandler=SC(e),a}function SK(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function TC(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=SK(null,e)),r}function TK(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let M="";for(let y=0;y<2;y++)M=M+Math.random().toString().slice(2);return M}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=TC(e,r,i),u=xC(c,n),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,d=`\r
--`+l+"--",f=$r.getBlob(h,r,d);if(f===null)throw dC();const p={name:c.fullPath},g=_l(s,t.host,t._protocol),m="POST",w=t.maxUploadRetryTime,_=new $o(g,m,gm(t,n),w);return _.urlParams=p,_.headers=o,_.body=f.uploadData(),_.errorHandler=Ml(e),_}class bu{constructor(e,n,r,i){this.current=e,this.total=n,this.finalized=!!r,this.metadata=i||null}}function mm(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{Sr(!1)}return Sr(!!n&&(e||["active"]).indexOf(n)!==-1),n}function CK(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o=TC(e,r,i),a={name:o.fullPath},l=_l(s,t.host,t._protocol),c="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=xC(o,n),d=t.maxUploadRetryTime;function f(g){mm(g);let m;try{m=g.getResponseHeader("X-Goog-Upload-URL")}catch{Sr(!1)}return Sr(Nh(m)),m}const p=new $o(l,c,f,d);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=Ml(e),p}function kK(t,e,n,r){const i={"X-Goog-Upload-Command":"query"};function s(c){const u=mm(c,["active","final"]);let h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Sr(!1)}h||Sr(!1);const d=Number(h);return Sr(!isNaN(d)),new bu(d,r.size(),u==="final")}const o="POST",a=t.maxUploadRetryTime,l=new $o(n,o,s,a);return l.headers=i,l.errorHandler=Ml(e),l}const wv=256*1024;function IK(t,e,n,r,i,s,o,a){const l=new bu(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw Hj();const c=l.total-l.current;let u=c;i>0&&(u=Math.min(u,i));const h=l.current,d=h+u,p={"X-Goog-Upload-Command":u===c?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`},g=r.slice(h,d);if(g===null)throw dC();function m(y,L){const R=mm(y,["active","final"]),j=l.current+u,N=r.size();let J;return R==="final"?J=gm(e,s)(y,L):J=null,new bu(j,N,R==="final",J)}const w="POST",_=e.maxUploadRetryTime,M=new $o(n,w,m,_);return M.headers=p,M.body=g.uploadData(),M.progressCallback=a||null,M.errorHandler=Ml(t),M}const nn={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Dd(t){switch(t){case"running":case"pausing":case"canceling":return nn.RUNNING;case"paused":return nn.PAUSED;case"success":return nn.SUCCESS;case"canceled":return nn.CANCELED;case"error":return nn.ERROR;default:return nn.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AK{constructor(e,n,r){if(Xj(e)||n!=null||r!=null)this.next=e,this.error=n!=null?n:void 0,this.complete=r!=null?r:void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ls(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class _K{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ns.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ns.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ns.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,i){if(this.sent_)throw Yo("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Yo("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Yo("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Yo("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Yo("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class MK extends _K{initXhr(){this.xhr_.responseType="text"}}function Us(){return new MK}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OK{constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=vC(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{this._request=void 0,this._chunkMultiplier=1,i._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=i,this._transition("error"))},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals("canceled")?this.completeTransitions_():(this._error=i,this._transition("error"))},this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=CK(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,Us,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const i=kK(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,Us,n,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=wv*this._chunkMultiplier,n=new bu(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=IK(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,Us,i,s);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){wv*this._chunkMultiplier<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=EK(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,Us,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=TK(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,Us,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":this._state=e,this._request!==void 0&&this._request.cancel();break;case"pausing":this._state=e,this._request!==void 0&&this._request.cancel();break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=hC(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=Dd(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,i){const s=new AK(n||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(Dd(this._state)){case nn.SUCCESS:Ls(this._resolve.bind(null,this.snapshot))();break;case nn.CANCELED:case nn.ERROR:const n=this._reject;Ls(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Dd(this._state)){case nn.RUNNING:case nn.PAUSED:e.next&&Ls(e.next.bind(e,this.snapshot))();break;case nn.SUCCESS:e.complete&&Ls(e.complete.bind(e))();break;case nn.CANCELED:case nn.ERROR:e.error&&Ls(e.error.bind(e,this._error))();break;default:e.error&&Ls(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,n){this._service=e,n instanceof pn?this._location=n:this._location=pn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new ws(e,n)}get root(){const e=new pn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wC(this._location.path)}get storage(){return this._service}get parent(){const e=fK(this._location.path);if(e===null)return null;const n=new pn(this._location.bucket,e);return new ws(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw Kj(e)}}function NK(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new OK(t,new $r(e),n)}function DK(t){t._throwIfRoot("getDownloadURL");const e=xK(t.storage,t._location,vC());return t.storage.makeRequestWithTokens(e,Us).then(n=>{if(n===null)throw jj();return n})}function RK(t,e){const n=pK(t._location.path,e),r=new pn(t._location.bucket,n);return new ws(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PK(t){return/^[A-Za-z]+:\/\//.test(t)}function LK(t,e){return new ws(t,e)}function CC(t,e){if(t instanceof ym){const n=t;if(n._bucket==null)throw zj();const r=new ws(n,n._bucket);return e!=null?CC(r,e):r}else return e!==void 0?RK(t,e):t}function BK(t,e){if(e&&PK(e)){if(t instanceof ym)return LK(t,e);throw ip("To use ref(service, url), the first argument must be a Storage instance.")}else return CC(t,e)}function vv(t,e){const n=e==null?void 0:e[uC];return n==null?null:pn.makeFromBucketSpec(n,t)}function FK(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:oS(i,t.app.options.projectId))}class ym{constructor(e,n,r,i,s){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=cC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Nj,this._maxUploadRetryTime=Dj,this._requests=new Set,i!=null?this._bucket=pn.makeFromBucketSpec(i,this._host):this._bucket=vv(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=pn.makeFromBucketSpec(this._url,e):this._bucket=vv(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){bv("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){bv("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ws(this,e)}_makeRequest(e,n,r,i){if(this._deleted)return new qj(fC());{const s=rK(e,this._appId,r,i,n,this._firebaseVersion);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const Ev="@firebase/storage",xv="0.9.10";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kC="storage";function VK(t,e,n){return t=Dn(t),NK(t,e,n)}function $K(t){return t=Dn(t),DK(t)}function UK(t,e){return t=Dn(t),BK(t,e)}function zK(t=pS(),e){t=Dn(t);const r=hS(t,kC).getImmediate({identifier:e}),i=sS("storage");if(i){const[s,o]=i.split(":");HK(r,s,parseInt(o,10))}return r}function HK(t,e,n,r={}){FK(t,e,n,r)}function jK(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new ym(n,r,i,e,dS)}function KK(){qa(new vo(kC,jK,"PUBLIC").setMultipleInstances(!0)),ei(Ev,xv,""),ei(Ev,xv,"esm2017")}KK();const IC=(t,e)=>{const n=t.__vccOpts||t;for(const[r,i]of e)n[r]=i;return n};pl.registerLanguage("html",ML);pl.registerLanguage("css",xL);pl.registerLanguage("js",IL);pl.registerLanguage("ts",_L);const qK={apiKey:"AIzaSyCubD42khVRvb7mj1TGhiZCih0XOLUc9bM",authDomain:"pcou-editor.firebaseapp.com",projectId:"pcou-editor",storageBucket:"pcou-editor.appspot.com",messagingSenderId:"810870940225",appId:"1:810870940225:web:9b6169b6168c80ef8cdcc0"},WK=fS(qK),Yn=hj(WK);dj(Yn).catch(t=>{(t.code=="failed-precondition"||t.code=="unimplemented")&&console.log(t.code)});const GK=zK(),JK={components:{EditorContent:bR,BubbleMenu:mR},props:{isLoggedin:Boolean},data(){return{editor:null,html:null,htmltitle:null,pageid:null,editable:!1,topicstatus:"topicsprod",revision:0,revisionCur:0,isLoading:!1,isDeleting:!1,isSaving:!1,toctitle:"map",toc:[],caption:"",img1:"",imageData:null,progress:0}},mounted(){this.topicstatus="topicsprod",this.pageid="r0eEMUtWa3jGwTdWrYTk",this.openToc(this.topicstatus),this.editor=new yR({editable:this.editable,content:this.openContent(this.topicstatus,this.pageid),extensions:[mP,gL.configure({lowlight:pl}),VF,RF.configure({resizable:!0}),BF,LF,PF]}),this.html=this.editor.getHTML(),this.editor.on("update",()=>{this.html=this.editor.getHTML()})},watch:{editable(){this.editor.setEditable(this.editable),this.editable?this.topicstatus="topics":this.topicstatus="topicsprod",this.openToc(this.topicstatus),this.openContent(this.topicstatus,this.pageid)}},methods:{Login(){this.isLoggedin=!0},setContent(){this.editor.commands.setContent(`
        <p>
          test content
        </p>
      `,!0),this.editor.commands.focus()},clearContent(){this.editor.chain().clearContent(!0).focus().run()},openToc:async function(t){this.isLoading=!0,this.topicstatus=t,await Ij(Xo(Yn,t)).then(e=>this.toc=e.docs).finally(()=>this.isLoading=!1)},openContent:async function(t,e){const n=oa(Yn,t,e),r=await kj(n);r.exists()&&(this.editor.commands.setContent(r.data().body,!0),this.pageid=e,this.topicstatus=t,this.htmltitle=r.data().title,this.revision=r.data().revision)},PublishContent:async function(t,e){this.isSaving=!0,this.topicstatus="topicsprod";const n=oa(Yn,this.topicstatus,t);await Aj(n,{body:this.html,title:this.htmltitle,revision:this.revision+1}),await oc(Xo(Yn,this.topicstatus+"/"+t+"/topic-hist"),{title:this.htmltitle,body:this.html,revision:this.revision+1}).then(()=>this.isSaving=!1),this.editor.commands.setContent(this.html,!0),this.editor.commands.focus()},saveContent:async function(t,e){this.isSaving=!0,this.topicstatus="topics";const n=oa(Yn,this.topicstatus,t);await _j(n,{body:this.html,title:this.htmltitle,revision:this.revision+1}),await oc(Xo(Yn,this.topicstatus+"/"+t+"/topic-hist"),{title:this.htmltitle,body:this.html,revision:this.revision+1}).then(()=>this.isSaving=!1),this.editor.commands.setContent(this.html,!0),this.editor.commands.focus(),this.openToc(this.topicstatus)},newContent:async function(){this.revisionCur=0,this.editor.commands.setContent("<p>new content</p>",!0),this.editor.commands.focus();const t=await oc(Xo(Yn,"topics/"),{title:"Enter the title here",body:`<p>Add your new incredidable content,don't be shy with diagrams, info graphics, ect </p><img src="https://firebasestorage.googleapis.com/v0/b/pcou-editor.appspot.com/o/AdobeStock_163171020.jpeg?alt=media&token=da67c836-11c2-449a-a0ce-74fd77e5dc54" alt="Girl in a jacket" width="50%" height="50%">`,version:1,revision:this.revisionCur});this.pageid=t.id},deletePage:async function(t){this.isDeleting=!0;const e=oa(Yn,"topics",t);await Mj(e).then(()=>{console.log("Entire Document has been deleted successfully.")}).finally(()=>this.isDeleting=!1),this.editor.commands.setContent("<p>content deleted</p>",!0),this.editor.commands.focus()},click1(){this.$refs.input1.click()},previewImage(t){this.uploadValue=0,this.img1=null,this.imageData=t.target.files[0],console.log("imagedata:",this.imageData),this.onUpload()},onUpload(){this.img1=null;const t=UK(GK,this.imageData.name),e=VK(t,this.imageData);e.on("state_changed",n=>{const r=n.bytesTransferred/n.totalBytes*100;switch(console.log("Upload is "+r+"% done"),n.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},n=>{},()=>{$K(e.snapshot.ref).then(n=>{this.img1=n,this.addImage()})})},addImage(){const t=this.img1;t&&this.editor.chain().focus().setImage({src:t}).run()},create:async function(){await oc(Xo(Yn,"images"),{url:this.img1,caption:this.caption})}},beforeUnmount(){this.editor.destroy()}},XK={class:"actions"},YK={class:"map-actions"},QK={key:0,style:{color:"red",margin:"0px",padding:"0px","padding-top":"18px"}},ZK={class:"content-actions"},eq={key:0,class:"checkboxedit",style:{"text-align":"right"}},tq=q("label",{for:"editable"},"edit",-1),nq=q("i",{class:"fa fa-bold"},null,-1),rq=[nq],iq=q("i",{class:"fa fa-italic"},null,-1),sq=[iq],oq=q("i",{class:"fa fa-list"},null,-1),aq=[oq],lq=q("i",{class:"fa fa-image"},null,-1),cq=[lq],uq=q("i",{class:"fa fa-table"},null,-1),hq=[uq],dq=["disabled"],fq=q("i",{class:"fa fa-code"},null,-1),pq=[fq],gq=q("i",{class:"fa fa-code"},"-",-1),mq=[gq],yq=["disabled"],bq=q("i",{class:"fa fa-rotate-left"},null,-1),wq=[bq],vq=["disabled"],Eq=q("i",{class:"fa fa-rotate-right"},null,-1),xq=[Eq],Sq=q("i",{class:"fa fa-new"},null,-1),Tq=q("i",{class:"fa fa-save"},null,-1),Cq=q("i",{class:"fa fa-upload"},null,-1),kq=q("i",{class:"fa fa-trash"},null,-1),Iq=[kq],Aq={key:2,class:"view-actions"},_q=q("i",{class:"fa fa-star"},null,-1),Mq=q("i",{class:"fa fa-file-pdf"},null,-1),Oq=q("i",{class:"fa fa-share"},null,-1),Nq=q("div",{class:"rw-actions"},null,-1),Dq={class:"content-row"},Rq={class:"map-tree"},Pq={key:0},Lq=["onClick"],Bq={class:"editor"},Fq={key:0},Vq={key:1},$q=q("i",{class:"fa fa-bold"},null,-1),Uq=[$q],zq=q("i",{class:"fa fa-italic"},null,-1),Hq=[zq],jq=q("div",{class:"infos"},[q("p",{class:"infos"}," Item > Collection > topic1")],-1),Kq={class:"rw-content"},qq={key:0},Wq=q("h4",null,"titles ",-1),Gq=q("label",null,"Map title: ",-1),Jq=SI('<p></p><label for="fname">Page alias: </label><br><input type="text" id="fname" name="fname" value="page1"><br><p></p><h4>Options </h4><label class="container">Machine translation <input type="checkbox" checked="checked"><span class="checkmark"></span></label><h4>infos: </h4><p>Redability index: 30</p><p>seo-suggested search term: acme, pcou, </p><p>Product: Acme</p><h4>metadatas: </h4>',13),Xq=q("h4",null,"Chat/feedback ",-1),Yq={key:1},Qq=q("h4",null," On this page ",-1),Zq=q("p",null,"DataRelated Information ",-1),e2=q("h4",null,"Was this page helpful? ",-1),t2=q("p",null,"Yes/No",-1),n2=q("p",null,null,-1),r2=q("h5",null,"temp infos ",-1),i2={style:{"font-size":"10px"}},s2={style:{"font-size":"10px"}},o2={style:{"font-size":"10px"}};function a2(t,e,n,r,i,s){const o=zd("bubble-menu"),a=zd("editor-content");return Ht(),hn(Tn,null,[q("div",XK,[q("div",YK,[i.editable?(Ht(),hn("p",QK," DRAFT ")):_s("",!0)]),q("div",ZK,[n.isLoggedin?(Ht(),hn("div",eq,[tq,Nm(q("input",{type:"checkbox",id:"editable","onUpdate:modelValue":e[0]||(e[0]=l=>i.editable=l)},null,512),[[rA,i.editable]])])):_s("",!0),i.editable?(Ht(),hn("div",{key:1,class:Zt(["edit-actions",{editable:i.editable}])},[q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("heading",{level:1})}]),onClick:e[1]||(e[1]=l=>i.editor.chain().focus().toggleHeading({level:1}).run())},"H1",2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("heading",{level:2})}]),onClick:e[2]||(e[2]=l=>i.editor.chain().focus().toggleHeading({level:2}).run())},"H2",2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("heading",{level:3})}]),onClick:e[3]||(e[3]=l=>i.editor.chain().focus().toggleHeading({level:3}).run())},"H3",2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("bold")}]),onClick:e[4]||(e[4]=l=>i.editor.chain().focus().toggleBold().run())},rq,2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("italic")}]),onClick:e[5]||(e[5]=l=>i.editor.chain().focus().toggleItalic().run())},sq,2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("bulletList")}]),onClick:e[6]||(e[6]=l=>i.editor.chain().focus().toggleBulletList().run())},aq,2),q("button",{class:"bta",onClick:e[7]||(e[7]=(...l)=>s.click1&&s.click1(...l))},cq),q("input",{type:"file",ref:"input1",style:{display:"none"},onChange:e[8]||(e[8]=(...l)=>s.previewImage&&s.previewImage(...l)),accept:"image/*"},null,544),q("button",{class:"bta",onClick:e[9]||(e[9]=l=>i.editor.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run())},hq),q("button",{class:"bta",onClick:e[10]||(e[10]=l=>i.editor.chain().focus().setCodeBlock().run()),disabled:i.editor.isActive("codeBlock")},pq,8,dq),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("codeBlock")}]),onClick:e[11]||(e[11]=l=>i.editor.chain().focus().toggleCodeBlock().run())},mq,2),q("button",{class:"bta",onClick:e[12]||(e[12]=l=>i.editor.chain().focus().undo().run()),disabled:!i.editor.can().undo()},wq,8,yq),q("button",{class:"bta",onClick:e[13]||(e[13]=l=>i.editor.chain().focus().redo().run()),disabled:!i.editor.can().redo()},xq,8,vq),q("button",{class:"bta",onClick:e[14]||(e[14]=l=>s.newContent())},[Sq,Ii("New")]),q("button",{class:"bta",onClick:e[15]||(e[15]=l=>s.saveContent(i.pageid,i.revision))},[Ii("Draft "),Tq]),q("button",{class:"bta",onClick:e[16]||(e[16]=l=>s.PublishContent(i.pageid))},[Ii("Publish "),Cq]),q("button",{class:"bta",onClick:e[17]||(e[17]=l=>s.deletePage(i.pageid))},Iq)],2)):(Ht(),hn("div",Aq,[q("button",{class:"bta-v",onClick:e[18]||(e[18]=(...l)=>t.tbd&&t.tbd(...l))},[Ii("Favorite "),_q]),q("button",{class:"bta-v",onClick:e[19]||(e[19]=(...l)=>t.tbd&&t.tbd(...l))},[Ii("pdf "),Mq]),q("button",{class:"bta-v",onClick:e[20]||(e[20]=(...l)=>t.tbd&&t.tbd(...l))},[Ii("share "),Oq])]))]),Nq]),q("div",Dq,[q("div",Rq,[q("h4",null,Mr(i.toctitle),1),i.isLoading?(Ht(),hn("div",Pq,"Loading... ")):_s("",!0),q("ul",null,[(Ht(!0),hn(Tn,null,Zk(i.toc,l=>(Ht(),hn("li",null,[q("a",{href:"#",onClick:aA(c=>s.openContent(this.topicstatus,l.id),["prevent"]),target:"_blank"},Mr(l.data().title),9,Lq)]))),256))])]),q("div",Bq,[i.isDeleting?(Ht(),hn("div",Fq,"Deleting...")):_s("",!0),i.isSaving?(Ht(),hn("div",Vq,"Saving...")):_s("",!0),i.editor?(Ht(),d0(o,{key:2,editor:i.editor,"tippy-options":{duration:100}},{default:Yv(()=>[q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("bold")}]),onClick:e[21]||(e[21]=l=>i.editor.chain().focus().toggleBold().run())},Uq,2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("italic")}]),onClick:e[22]||(e[22]=l=>i.editor.chain().focus().toggleItalic().run())},Hq,2),q("button",{class:Zt(["bta",{"is-active":i.editor.isActive("strike")}]),onClick:e[23]||(e[23]=l=>i.editor.chain().focus().toggleStrike().run())},"uicommand",2)]),_:1},8,["editor"])):_s("",!0),jq,Dt(a,{editor:i.editor},null,8,["editor"])]),q("div",Kq,[i.editable?(Ht(),hn("div",qq,[Wq,Gq,Nm(q("input",{type:"text","onUpdate:modelValue":e[24]||(e[24]=l=>i.htmltitle=l),class:"input",required:""},null,512),[[nA,i.htmltitle]]),Jq,q("p",null,"Context: "+Mr(i.topicstatus),1),q("p",null,"pageid: "+Mr(i.pageid),1),q("p",null,"Revision: "+Mr(i.revision),1),Xq])):(Ht(),hn("div",Yq,[Qq,Zq,e2,t2,n2,r2,q("p",i2,"context: "+Mr(i.topicstatus),1),q("p",s2," pageid: "+Mr(i.pageid),1),q("p",o2,"Revision: "+Mr(i.revision),1)]))])])],64)}const l2=IC(JK,[["render",a2]]);const c2={name:"app",components:{tthtml:l2},data(){return{Logged:!1}},methods:{Login(){}}},u2={id:"app"},h2={class:"header"},d2={class:"h-logo"},f2=q("i",{class:"fa fa-rocket",style:{"font-size":"20px"}},null,-1),p2=[f2],g2=q("div",{class:"h-title"}," Gazelle ua ",-1),m2={class:"h-menu"},y2=q("i",{class:"fa fa-align-justify"},null,-1),b2=[y2],w2={class:"h-profile"},v2=q("i",{class:"fa fa-user"},null,-1),E2=[v2],x2={class:"viewer"};function S2(t,e,n,r,i,s){const o=zd("tthtml");return Ht(),hn("div",u2,[q("div",h2,[q("div",d2,[q("button",{class:"bt-h",onClick:e[0]||(e[0]=a=>t.tbd())},p2)]),g2,q("div",m2,[q("button",{class:"bt-h",onClick:e[1]||(e[1]=a=>t.tbd())},b2)]),q("div",w2,[q("button",{class:"bt-h-p",onClick:e[2]||(e[2]=a=>i.Logged=!i.Logged)},E2)])]),q("div",x2,[Dt(o,{isLoggedin:i.Logged},null,8,["isLoggedin"])])])}const T2=IC(c2,[["render",S2]]);const C2=uA(T2);C2.mount("#app");
