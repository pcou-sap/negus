(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function Of(t,e){const n=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const ET="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",xT=Of(ET);function $w(t){return!!t||t===""}function Df(t){if(de(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],i=it(r)?CT(r):Df(r);if(i)for(const s in i)e[s]=i[s]}return e}else{if(it(t))return t;if(He(t))return t}}const ST=/;(?![^(]*\))/g,TT=/:(.+)/;function CT(t){const e={};return t.split(ST).forEach(n=>{if(n){const r=n.split(TT);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Xt(t){let e="";if(it(t))e=t;else if(de(t))for(let n=0;n<t.length;n++){const r=Xt(t[n]);r&&(e+=r+" ")}else if(He(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}function kT(t,e){if(t.length!==e.length)return!1;let n=!0;for(let r=0;n&&r<t.length;r++)n=Yc(t[r],e[r]);return n}function Yc(t,e){if(t===e)return!0;let n=zg(t),r=zg(e);if(n||r)return n&&r?t.getTime()===e.getTime():!1;if(n=oa(t),r=oa(e),n||r)return t===e;if(n=de(t),r=de(e),n||r)return n&&r?kT(t,e):!1;if(n=He(t),r=He(e),n||r){if(!n||!r)return!1;const i=Object.keys(t).length,s=Object.keys(e).length;if(i!==s)return!1;for(const o in t){const a=t.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Yc(t[o],e[o]))return!1}}return String(t)===String(e)}function zw(t,e){return t.findIndex(n=>Yc(n,e))}const $g=t=>it(t)?t:t==null?"":de(t)||He(t)&&(t.toString===jw||!Ce(t.toString))?JSON.stringify(t,Uw,2):String(t),Uw=(t,e)=>e&&e.__v_isRef?Uw(t,e.value):Rs(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[r,i])=>(n[`${r} =>`]=i,n),{})}:Zc(e)?{[`Set(${e.size})`]:[...e.values()]}:He(e)&&!de(e)&&!Kw(e)?String(e):e,ze={},_s=[],Ln=()=>{},IT=()=>!1,AT=/^on[^a-z]/,Qc=t=>AT.test(t),_f=t=>t.startsWith("onUpdate:"),Pt=Object.assign,Rf=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},MT=Object.prototype.hasOwnProperty,Ne=(t,e)=>MT.call(t,e),de=Array.isArray,Rs=t=>Ha(t)==="[object Map]",Zc=t=>Ha(t)==="[object Set]",zg=t=>Ha(t)==="[object Date]",Ce=t=>typeof t=="function",it=t=>typeof t=="string",oa=t=>typeof t=="symbol",He=t=>t!==null&&typeof t=="object",Hw=t=>He(t)&&Ce(t.then)&&Ce(t.catch),jw=Object.prototype.toString,Ha=t=>jw.call(t),NT=t=>Ha(t).slice(8,-1),Kw=t=>Ha(t)==="[object Object]",Lf=t=>it(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,$l=Of(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),eu=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},OT=/-(\w)/g,ir=eu(t=>t.replace(OT,(e,n)=>n?n.toUpperCase():"")),DT=/\B([A-Z])/g,fo=eu(t=>t.replace(DT,"-$1").toLowerCase()),tu=eu(t=>t.charAt(0).toUpperCase()+t.slice(1)),hh=eu(t=>t?`on${tu(t)}`:""),aa=(t,e)=>!Object.is(t,e),zl=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},sc=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},ad=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let Ug;const _T=()=>Ug||(Ug=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let jn;class RT{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&jn&&(this.parent=jn,this.index=(jn.scopes||(jn.scopes=[])).push(this)-1)}run(e){if(this.active){const n=jn;try{return jn=this,e()}finally{jn=n}}}on(){jn=this}off(){jn=this.parent}stop(e){if(this.active){let n,r;for(n=0,r=this.effects.length;n<r;n++)this.effects[n].stop();for(n=0,r=this.cleanups.length;n<r;n++)this.cleanups[n]();if(this.scopes)for(n=0,r=this.scopes.length;n<r;n++)this.scopes[n].stop(!0);if(this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.active=!1}}}function LT(t,e=jn){e&&e.active&&e.effects.push(t)}const Pf=t=>{const e=new Set(t);return e.w=0,e.n=0,e},qw=t=>(t.w&Wr)>0,Ww=t=>(t.n&Wr)>0,PT=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=Wr},BT=t=>{const{deps:e}=t;if(e.length){let n=0;for(let r=0;r<e.length;r++){const i=e[r];qw(i)&&!Ww(i)?i.delete(t):e[n++]=i,i.w&=~Wr,i.n&=~Wr}e.length=n}},ld=new WeakMap;let Lo=0,Wr=1;const cd=30;let Nn;const _i=Symbol(""),ud=Symbol("");class Bf{constructor(e,n=null,r){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,LT(this,r)}run(){if(!this.active)return this.fn();let e=Nn,n=Fr;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=Nn,Nn=this,Fr=!0,Wr=1<<++Lo,Lo<=cd?PT(this):Hg(this),this.fn()}finally{Lo<=cd&&BT(this),Wr=1<<--Lo,Nn=this.parent,Fr=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Nn===this?this.deferStop=!0:this.active&&(Hg(this),this.onStop&&this.onStop(),this.active=!1)}}function Hg(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Fr=!0;const Gw=[];function po(){Gw.push(Fr),Fr=!1}function go(){const t=Gw.pop();Fr=t===void 0?!0:t}function dn(t,e,n){if(Fr&&Nn){let r=ld.get(t);r||ld.set(t,r=new Map);let i=r.get(n);i||r.set(n,i=Pf()),Jw(i)}}function Jw(t,e){let n=!1;Lo<=cd?Ww(t)||(t.n|=Wr,n=!qw(t)):n=!t.has(Nn),n&&(t.add(Nn),Nn.deps.push(t))}function mr(t,e,n,r,i,s){const o=ld.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(n==="length"&&de(t))o.forEach((l,c)=>{(c==="length"||c>=r)&&a.push(l)});else switch(n!==void 0&&a.push(o.get(n)),e){case"add":de(t)?Lf(n)&&a.push(o.get("length")):(a.push(o.get(_i)),Rs(t)&&a.push(o.get(ud)));break;case"delete":de(t)||(a.push(o.get(_i)),Rs(t)&&a.push(o.get(ud)));break;case"set":Rs(t)&&a.push(o.get(_i));break}if(a.length===1)a[0]&&hd(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);hd(Pf(l))}}function hd(t,e){const n=de(t)?t:[...t];for(const r of n)r.computed&&jg(r);for(const r of n)r.computed||jg(r)}function jg(t,e){(t!==Nn||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const FT=Of("__proto__,__v_isRef,__isVue"),Xw=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(oa)),VT=Ff(),$T=Ff(!1,!0),zT=Ff(!0),Kg=UT();function UT(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const r=Be(this);for(let s=0,o=this.length;s<o;s++)dn(r,"get",s+"");const i=r[e](...n);return i===-1||i===!1?r[e](...n.map(Be)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){po();const r=Be(this)[e].apply(this,n);return go(),r}}),t}function Ff(t=!1,e=!1){return function(r,i,s){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_isShallow")return e;if(i==="__v_raw"&&s===(t?e?iC:tv:e?ev:Zw).get(r))return r;const o=de(r);if(!t&&o&&Ne(Kg,i))return Reflect.get(Kg,i,s);const a=Reflect.get(r,i,s);return(oa(i)?Xw.has(i):FT(i))||(t||dn(r,"get",i),e)?a:Ot(a)?o&&Lf(i)?a:a.value:He(a)?t?nv(a):ru(a):a}}const HT=Yw(),jT=Yw(!0);function Yw(t=!1){return function(n,r,i,s){let o=n[r];if(js(o)&&Ot(o)&&!Ot(i))return!1;if(!t&&(!oc(i)&&!js(i)&&(o=Be(o),i=Be(i)),!de(n)&&Ot(o)&&!Ot(i)))return o.value=i,!0;const a=de(n)&&Lf(r)?Number(r)<n.length:Ne(n,r),l=Reflect.set(n,r,i,s);return n===Be(s)&&(a?aa(i,o)&&mr(n,"set",r,i):mr(n,"add",r,i)),l}}function KT(t,e){const n=Ne(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&n&&mr(t,"delete",e,void 0),r}function qT(t,e){const n=Reflect.has(t,e);return(!oa(e)||!Xw.has(e))&&dn(t,"has",e),n}function WT(t){return dn(t,"iterate",de(t)?"length":_i),Reflect.ownKeys(t)}const Qw={get:VT,set:HT,deleteProperty:KT,has:qT,ownKeys:WT},GT={get:zT,set(t,e){return!0},deleteProperty(t,e){return!0}},JT=Pt({},Qw,{get:$T,set:jT}),Vf=t=>t,nu=t=>Reflect.getPrototypeOf(t);function dl(t,e,n=!1,r=!1){t=t.__v_raw;const i=Be(t),s=Be(e);n||(e!==s&&dn(i,"get",e),dn(i,"get",s));const{has:o}=nu(i),a=r?Vf:n?Hf:la;if(o.call(i,e))return a(t.get(e));if(o.call(i,s))return a(t.get(s));t!==i&&t.get(e)}function fl(t,e=!1){const n=this.__v_raw,r=Be(n),i=Be(t);return e||(t!==i&&dn(r,"has",t),dn(r,"has",i)),t===i?n.has(t):n.has(t)||n.has(i)}function pl(t,e=!1){return t=t.__v_raw,!e&&dn(Be(t),"iterate",_i),Reflect.get(t,"size",t)}function qg(t){t=Be(t);const e=Be(this);return nu(e).has.call(e,t)||(e.add(t),mr(e,"add",t,t)),this}function Wg(t,e){e=Be(e);const n=Be(this),{has:r,get:i}=nu(n);let s=r.call(n,t);s||(t=Be(t),s=r.call(n,t));const o=i.call(n,t);return n.set(t,e),s?aa(e,o)&&mr(n,"set",t,e):mr(n,"add",t,e),this}function Gg(t){const e=Be(this),{has:n,get:r}=nu(e);let i=n.call(e,t);i||(t=Be(t),i=n.call(e,t)),r&&r.call(e,t);const s=e.delete(t);return i&&mr(e,"delete",t,void 0),s}function Jg(){const t=Be(this),e=t.size!==0,n=t.clear();return e&&mr(t,"clear",void 0,void 0),n}function gl(t,e){return function(r,i){const s=this,o=s.__v_raw,a=Be(o),l=e?Vf:t?Hf:la;return!t&&dn(a,"iterate",_i),o.forEach((c,u)=>r.call(i,l(c),l(u),s))}}function ml(t,e,n){return function(...r){const i=this.__v_raw,s=Be(i),o=Rs(s),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=i[t](...r),u=n?Vf:e?Hf:la;return!e&&dn(s,"iterate",l?ud:_i),{next(){const{value:h,done:d}=c.next();return d?{value:h,done:d}:{value:a?[u(h[0]),u(h[1])]:u(h),done:d}},[Symbol.iterator](){return this}}}}function xr(t){return function(...e){return t==="delete"?!1:this}}function XT(){const t={get(s){return dl(this,s)},get size(){return pl(this)},has:fl,add:qg,set:Wg,delete:Gg,clear:Jg,forEach:gl(!1,!1)},e={get(s){return dl(this,s,!1,!0)},get size(){return pl(this)},has:fl,add:qg,set:Wg,delete:Gg,clear:Jg,forEach:gl(!1,!0)},n={get(s){return dl(this,s,!0)},get size(){return pl(this,!0)},has(s){return fl.call(this,s,!0)},add:xr("add"),set:xr("set"),delete:xr("delete"),clear:xr("clear"),forEach:gl(!0,!1)},r={get(s){return dl(this,s,!0,!0)},get size(){return pl(this,!0)},has(s){return fl.call(this,s,!0)},add:xr("add"),set:xr("set"),delete:xr("delete"),clear:xr("clear"),forEach:gl(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=ml(s,!1,!1),n[s]=ml(s,!0,!1),e[s]=ml(s,!1,!0),r[s]=ml(s,!0,!0)}),[t,n,e,r]}const[YT,QT,ZT,eC]=XT();function $f(t,e){const n=e?t?eC:ZT:t?QT:YT;return(r,i,s)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?r:Reflect.get(Ne(n,i)&&i in r?n:r,i,s)}const tC={get:$f(!1,!1)},nC={get:$f(!1,!0)},rC={get:$f(!0,!1)},Zw=new WeakMap,ev=new WeakMap,tv=new WeakMap,iC=new WeakMap;function sC(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function oC(t){return t.__v_skip||!Object.isExtensible(t)?0:sC(NT(t))}function ru(t){return js(t)?t:zf(t,!1,Qw,tC,Zw)}function aC(t){return zf(t,!1,JT,nC,ev)}function nv(t){return zf(t,!0,GT,rC,tv)}function zf(t,e,n,r,i){if(!He(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const s=i.get(t);if(s)return s;const o=oC(t);if(o===0)return t;const a=new Proxy(t,o===2?r:n);return i.set(t,a),a}function Ls(t){return js(t)?Ls(t.__v_raw):!!(t&&t.__v_isReactive)}function js(t){return!!(t&&t.__v_isReadonly)}function oc(t){return!!(t&&t.__v_isShallow)}function rv(t){return Ls(t)||js(t)}function Be(t){const e=t&&t.__v_raw;return e?Be(e):t}function Uf(t){return sc(t,"__v_skip",!0),t}const la=t=>He(t)?ru(t):t,Hf=t=>He(t)?nv(t):t;function jf(t){Fr&&Nn&&(t=Be(t),Jw(t.dep||(t.dep=Pf())))}function Kf(t,e){t=Be(t),t.dep&&hd(t.dep)}function Ot(t){return!!(t&&t.__v_isRef===!0)}function qf(t){return lC(t,!1)}function lC(t,e){return Ot(t)?t:new cC(t,e)}class cC{constructor(e,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?e:Be(e),this._value=n?e:la(e)}get value(){return jf(this),this._value}set value(e){const n=this.__v_isShallow||oc(e)||js(e);e=n?e:Be(e),aa(e,this._rawValue)&&(this._rawValue=e,this._value=n?e:la(e),Kf(this))}}function iv(t){return Ot(t)?t.value:t}const uC={get:(t,e,n)=>iv(Reflect.get(t,e,n)),set:(t,e,n,r)=>{const i=t[e];return Ot(i)&&!Ot(n)?(i.value=n,!0):Reflect.set(t,e,n,r)}};function sv(t){return Ls(t)?t:new Proxy(t,uC)}class hC{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:n,set:r}=e(()=>jf(this),()=>Kf(this));this._get=n,this._set=r}get value(){return this._get()}set value(e){this._set(e)}}function dC(t){return new hC(t)}var ov;class fC{constructor(e,n,r,i){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this[ov]=!1,this._dirty=!0,this.effect=new Bf(e,()=>{this._dirty||(this._dirty=!0,Kf(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=r}get value(){const e=Be(this);return jf(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}ov="__v_isReadonly";function pC(t,e,n=!1){let r,i;const s=Ce(t);return s?(r=t,i=Ln):(r=t.get,i=t.set),new fC(r,i,s||!i,n)}function Vr(t,e,n,r){let i;try{i=r?t(...r):t()}catch(s){iu(s,e,n)}return i}function Tn(t,e,n,r){if(Ce(t)){const s=Vr(t,e,n,r);return s&&Hw(s)&&s.catch(o=>{iu(o,e,n)}),s}const i=[];for(let s=0;s<t.length;s++)i.push(Tn(t[s],e,n,r));return i}function iu(t,e,n,r=!0){const i=e?e.vnode:null;if(e){let s=e.parent;const o=e.proxy,a=n;for(;s;){const c=s.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](t,o,a)===!1)return}s=s.parent}const l=e.appContext.config.errorHandler;if(l){Vr(l,null,10,[t,o,a]);return}}gC(t,n,i,r)}function gC(t,e,n,r=!0){console.error(t)}let ca=!1,dd=!1;const Mt=[];let Gn=0;const Ps=[];let ur=null,vi=0;const av=Promise.resolve();let Wf=null;function lv(t){const e=Wf||av;return t?e.then(this?t.bind(this):t):e}function mC(t){let e=Gn+1,n=Mt.length;for(;e<n;){const r=e+n>>>1;ua(Mt[r])<t?e=r+1:n=r}return e}function Gf(t){(!Mt.length||!Mt.includes(t,ca&&t.allowRecurse?Gn+1:Gn))&&(t.id==null?Mt.push(t):Mt.splice(mC(t.id),0,t),cv())}function cv(){!ca&&!dd&&(dd=!0,Wf=av.then(hv))}function yC(t){const e=Mt.indexOf(t);e>Gn&&Mt.splice(e,1)}function bC(t){de(t)?Ps.push(...t):(!ur||!ur.includes(t,t.allowRecurse?vi+1:vi))&&Ps.push(t),cv()}function Xg(t,e=ca?Gn+1:0){for(;e<Mt.length;e++){const n=Mt[e];n&&n.pre&&(Mt.splice(e,1),e--,n())}}function uv(t){if(Ps.length){const e=[...new Set(Ps)];if(Ps.length=0,ur){ur.push(...e);return}for(ur=e,ur.sort((n,r)=>ua(n)-ua(r)),vi=0;vi<ur.length;vi++)ur[vi]();ur=null,vi=0}}const ua=t=>t.id==null?1/0:t.id,wC=(t,e)=>{const n=ua(t)-ua(e);if(n===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function hv(t){dd=!1,ca=!0,Mt.sort(wC);const e=Ln;try{for(Gn=0;Gn<Mt.length;Gn++){const n=Mt[Gn];n&&n.active!==!1&&Vr(n,null,14)}}finally{Gn=0,Mt.length=0,uv(),ca=!1,Wf=null,(Mt.length||Ps.length)&&hv()}}function vC(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||ze;let i=n;const s=e.startsWith("update:"),o=s&&e.slice(7);if(o&&o in r){const u=`${o==="modelValue"?"model":o}Modifiers`,{number:h,trim:d}=r[u]||ze;d&&(i=n.map(f=>f.trim())),h&&(i=n.map(ad))}let a,l=r[a=hh(e)]||r[a=hh(ir(e))];!l&&s&&(l=r[a=hh(fo(e))]),l&&Tn(l,t,6,i);const c=r[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,Tn(c,t,6,i)}}function dv(t,e,n=!1){const r=e.emitsCache,i=r.get(t);if(i!==void 0)return i;const s=t.emits;let o={},a=!1;if(!Ce(t)){const l=c=>{const u=dv(c,e,!0);u&&(a=!0,Pt(o,u))};!n&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!s&&!a?(He(t)&&r.set(t,null),null):(de(s)?s.forEach(l=>o[l]=null):Pt(o,s),He(t)&&r.set(t,o),o)}function su(t,e){return!t||!Qc(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ne(t,e[0].toLowerCase()+e.slice(1))||Ne(t,fo(e))||Ne(t,e))}let xn=null,fv=null;function ac(t){const e=xn;return xn=t,fv=t&&t.type.__scopeId||null,e}function pv(t,e=xn,n){if(!e||t._n)return t;const r=(...i)=>{r._d&&cm(-1);const s=ac(e),o=t(...i);return ac(s),r._d&&cm(1),o};return r._n=!0,r._c=!0,r._d=!0,r}function dh(t){const{type:e,vnode:n,proxy:r,withProxy:i,props:s,propsOptions:[o],slots:a,attrs:l,emit:c,render:u,renderCache:h,data:d,setupState:f,ctx:p,inheritAttrs:g}=t;let m,w;const D=ac(t);try{if(n.shapeFlag&4){const y=i||r;m=qn(u.call(y,y,h,s,f,d,p)),w=l}else{const y=e;m=qn(y.length>1?y(s,{attrs:l,slots:a,emit:c}):y(s,null)),w=e.props?l:EC(l)}}catch(y){Ko.length=0,iu(y,t,1),m=Dt(Pn)}let P=m;if(w&&g!==!1){const y=Object.keys(w),{shapeFlag:F}=P;y.length&&F&7&&(o&&y.some(_f)&&(w=xC(w,o)),P=Gr(P,w))}return n.dirs&&(P=Gr(P),P.dirs=P.dirs?P.dirs.concat(n.dirs):n.dirs),n.transition&&(P.transition=n.transition),m=P,ac(D),m}const EC=t=>{let e;for(const n in t)(n==="class"||n==="style"||Qc(n))&&((e||(e={}))[n]=t[n]);return e},xC=(t,e)=>{const n={};for(const r in t)(!_f(r)||!(r.slice(9)in e))&&(n[r]=t[r]);return n};function SC(t,e,n){const{props:r,children:i,component:s}=t,{props:o,children:a,patchFlag:l}=e,c=s.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return r?Yg(r,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let h=0;h<u.length;h++){const d=u[h];if(o[d]!==r[d]&&!su(c,d))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Yg(r,o,c):!0:!!o;return!1}function Yg(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let i=0;i<r.length;i++){const s=r[i];if(e[s]!==t[s]&&!su(n,s))return!0}return!1}function TC({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const CC=t=>t.__isSuspense;function kC(t,e){e&&e.pendingBranch?de(t)?e.effects.push(...t):e.effects.push(t):bC(t)}function IC(t,e){if(at){let n=at.provides;const r=at.parent&&at.parent.provides;r===n&&(n=at.provides=Object.create(r)),n[t]=e}}function fh(t,e,n=!1){const r=at||xn;if(r){const i=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(i&&t in i)return i[t];if(arguments.length>1)return n&&Ce(e)?e.call(r.proxy):e}}function AC(t,e){return Jf(t,null,e)}const Qg={};function ph(t,e,n){return Jf(t,e,n)}function Jf(t,e,{immediate:n,deep:r,flush:i,onTrack:s,onTrigger:o}=ze){const a=at;let l,c=!1,u=!1;if(Ot(t)?(l=()=>t.value,c=oc(t)):Ls(t)?(l=()=>t,r=!0):de(t)?(u=!0,c=t.some(w=>Ls(w)||oc(w)),l=()=>t.map(w=>{if(Ot(w))return w.value;if(Ls(w))return Mi(w);if(Ce(w))return Vr(w,a,2)})):Ce(t)?e?l=()=>Vr(t,a,2):l=()=>{if(!(a&&a.isUnmounted))return h&&h(),Tn(t,a,3,[d])}:l=Ln,e&&r){const w=l;l=()=>Mi(w())}let h,d=w=>{h=m.onStop=()=>{Vr(w,a,4)}};if(da)return d=Ln,e?n&&Tn(e,a,3,[l(),u?[]:void 0,d]):l(),Ln;let f=u?[]:Qg;const p=()=>{if(!!m.active)if(e){const w=m.run();(r||c||(u?w.some((D,P)=>aa(D,f[P])):aa(w,f)))&&(h&&h(),Tn(e,a,3,[w,f===Qg?void 0:f,d]),f=w)}else m.run()};p.allowRecurse=!!e;let g;i==="sync"?g=p:i==="post"?g=()=>Yt(p,a&&a.suspense):(p.pre=!0,a&&(p.id=a.uid),g=()=>Gf(p));const m=new Bf(l,g);return e?n?p():f=m.run():i==="post"?Yt(m.run.bind(m),a&&a.suspense):m.run(),()=>{m.stop(),a&&a.scope&&Rf(a.scope.effects,m)}}function MC(t,e,n){const r=this.proxy,i=it(t)?t.includes(".")?gv(r,t):()=>r[t]:t.bind(r,r);let s;Ce(e)?s=e:(s=e.handler,n=e);const o=at;Ks(this);const a=Jf(i,s.bind(r),n);return o?Ks(o):Ri(),a}function gv(t,e){const n=e.split(".");return()=>{let r=t;for(let i=0;i<n.length&&r;i++)r=r[n[i]];return r}}function Mi(t,e){if(!He(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),Ot(t))Mi(t.value,e);else if(de(t))for(let n=0;n<t.length;n++)Mi(t[n],e);else if(Zc(t)||Rs(t))t.forEach(n=>{Mi(n,e)});else if(Kw(t))for(const n in t)Mi(t[n],e);return t}function NC(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return lu(()=>{t.isMounted=!0}),Ka(()=>{t.isUnmounting=!0}),t}const yn=[Function,Array],OC={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:yn,onEnter:yn,onAfterEnter:yn,onEnterCancelled:yn,onBeforeLeave:yn,onLeave:yn,onAfterLeave:yn,onLeaveCancelled:yn,onBeforeAppear:yn,onAppear:yn,onAfterAppear:yn,onAppearCancelled:yn},setup(t,{slots:e}){const n=Ov(),r=NC();let i;return()=>{const s=e.default&&yv(e.default(),!0);if(!s||!s.length)return;let o=s[0];if(s.length>1){for(const g of s)if(g.type!==Pn){o=g;break}}const a=Be(t),{mode:l}=a;if(r.isLeaving)return gh(o);const c=Zg(o);if(!c)return gh(o);const u=fd(c,a,r,n);pd(c,u);const h=n.subTree,d=h&&Zg(h);let f=!1;const{getTransitionKey:p}=c.type;if(p){const g=p();i===void 0?i=g:g!==i&&(i=g,f=!0)}if(d&&d.type!==Pn&&(!Ei(c,d)||f)){const g=fd(d,a,r,n);if(pd(d,g),l==="out-in")return r.isLeaving=!0,g.afterLeave=()=>{r.isLeaving=!1,n.update()},gh(o);l==="in-out"&&c.type!==Pn&&(g.delayLeave=(m,w,D)=>{const P=mv(r,d);P[String(d.key)]=d,m._leaveCb=()=>{w(),m._leaveCb=void 0,delete u.delayedLeave},u.delayedLeave=D})}return o}}},DC=OC;function mv(t,e){const{leavingVNodes:n}=t;let r=n.get(e.type);return r||(r=Object.create(null),n.set(e.type,r)),r}function fd(t,e,n,r){const{appear:i,mode:s,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:u,onBeforeLeave:h,onLeave:d,onAfterLeave:f,onLeaveCancelled:p,onBeforeAppear:g,onAppear:m,onAfterAppear:w,onAppearCancelled:D}=e,P=String(t.key),y=mv(n,t),F=(_,Z)=>{_&&Tn(_,r,9,Z)},R=(_,Z)=>{const ie=Z[1];F(_,Z),de(_)?_.every(he=>he.length<=1)&&ie():_.length<=1&&ie()},K={mode:s,persisted:o,beforeEnter(_){let Z=a;if(!n.isMounted)if(i)Z=g||a;else return;_._leaveCb&&_._leaveCb(!0);const ie=y[P];ie&&Ei(t,ie)&&ie.el._leaveCb&&ie.el._leaveCb(),F(Z,[_])},enter(_){let Z=l,ie=c,he=u;if(!n.isMounted)if(i)Z=m||l,ie=w||c,he=D||u;else return;let ve=!1;const Ee=_._enterCb=Oe=>{ve||(ve=!0,Oe?F(he,[_]):F(ie,[_]),K.delayedLeave&&K.delayedLeave(),_._enterCb=void 0)};Z?R(Z,[_,Ee]):Ee()},leave(_,Z){const ie=String(t.key);if(_._enterCb&&_._enterCb(!0),n.isUnmounting)return Z();F(h,[_]);let he=!1;const ve=_._leaveCb=Ee=>{he||(he=!0,Z(),Ee?F(p,[_]):F(f,[_]),_._leaveCb=void 0,y[ie]===t&&delete y[ie])};y[ie]=t,d?R(d,[_,ve]):ve()},clone(_){return fd(_,e,n,r)}};return K}function gh(t){if(ou(t))return t=Gr(t),t.children=null,t}function Zg(t){return ou(t)?t.children?t.children[0]:void 0:t}function pd(t,e){t.shapeFlag&6&&t.component?pd(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function yv(t,e=!1,n){let r=[],i=0;for(let s=0;s<t.length;s++){let o=t[s];const a=n==null?o.key:String(n)+String(o.key!=null?o.key:s);o.type===wn?(o.patchFlag&128&&i++,r=r.concat(yv(o.children,e,a))):(e||o.type!==Pn)&&r.push(a!=null?Gr(o,{key:a}):o)}if(i>1)for(let s=0;s<r.length;s++)r[s].patchFlag=-2;return r}function ja(t){return Ce(t)?{setup:t,name:t.name}:t}const Ul=t=>!!t.type.__asyncLoader,ou=t=>t.type.__isKeepAlive;function _C(t,e){bv(t,"a",e)}function RC(t,e){bv(t,"da",e)}function bv(t,e,n=at){const r=t.__wdc||(t.__wdc=()=>{let i=n;for(;i;){if(i.isDeactivated)return;i=i.parent}return t()});if(au(e,r,n),n){let i=n.parent;for(;i&&i.parent;)ou(i.parent.vnode)&&LC(r,e,n,i),i=i.parent}}function LC(t,e,n,r){const i=au(e,t,r,!0);wv(()=>{Rf(r[e],i)},n)}function au(t,e,n=at,r=!1){if(n){const i=n[t]||(n[t]=[]),s=e.__weh||(e.__weh=(...o)=>{if(n.isUnmounted)return;po(),Ks(n);const a=Tn(e,n,t,o);return Ri(),go(),a});return r?i.unshift(s):i.push(s),s}}const wr=t=>(e,n=at)=>(!da||t==="sp")&&au(t,(...r)=>e(...r),n),PC=wr("bm"),lu=wr("m"),BC=wr("bu"),FC=wr("u"),Ka=wr("bum"),wv=wr("um"),VC=wr("sp"),$C=wr("rtg"),zC=wr("rtc");function UC(t,e=at){au("ec",t,e)}function em(t,e){const n=xn;if(n===null)return t;const r=uu(n)||n.proxy,i=t.dirs||(t.dirs=[]);for(let s=0;s<e.length;s++){let[o,a,l,c=ze]=e[s];Ce(o)&&(o={mounted:o,updated:o}),o.deep&&Mi(a),i.push({dir:o,instance:r,value:a,oldValue:void 0,arg:l,modifiers:c})}return t}function hi(t,e,n,r){const i=t.dirs,s=e&&e.dirs;for(let o=0;o<i.length;o++){const a=i[o];s&&(a.oldValue=s[o].value);let l=a.dir[r];l&&(po(),Tn(l,n,8,[t.el,a,t,e]),go())}}const vv="components";function gd(t,e){return jC(vv,t,!0,e)||t}const HC=Symbol();function jC(t,e,n=!0,r=!1){const i=xn||at;if(i){const s=i.type;if(t===vv){const a=Tk(s,!1);if(a&&(a===e||a===ir(e)||a===tu(ir(e))))return s}const o=tm(i[t]||s[t],e)||tm(i.appContext[t],e);return!o&&r?s:o}}function tm(t,e){return t&&(t[e]||t[ir(e)]||t[tu(ir(e))])}function KC(t,e,n,r){let i;const s=n&&n[r];if(de(t)||it(t)){i=new Array(t.length);for(let o=0,a=t.length;o<a;o++)i[o]=e(t[o],o,void 0,s&&s[o])}else if(typeof t=="number"){i=new Array(t);for(let o=0;o<t;o++)i[o]=e(o+1,o,void 0,s&&s[o])}else if(He(t))if(t[Symbol.iterator])i=Array.from(t,(o,a)=>e(o,a,void 0,s&&s[a]));else{const o=Object.keys(t);i=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];i[a]=e(t[c],c,a,s&&s[a])}}else i=[];return n&&(n[r]=i),i}const md=t=>t?Dv(t)?uu(t)||t.proxy:md(t.parent):null,lc=Pt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>md(t.parent),$root:t=>md(t.root),$emit:t=>t.emit,$options:t=>Xf(t),$forceUpdate:t=>t.f||(t.f=()=>Gf(t.update)),$nextTick:t=>t.n||(t.n=lv.bind(t.proxy)),$watch:t=>MC.bind(t)}),qC={get({_:t},e){const{ctx:n,setupState:r,data:i,props:s,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return r[e];case 2:return i[e];case 4:return n[e];case 3:return s[e]}else{if(r!==ze&&Ne(r,e))return o[e]=1,r[e];if(i!==ze&&Ne(i,e))return o[e]=2,i[e];if((c=t.propsOptions[0])&&Ne(c,e))return o[e]=3,s[e];if(n!==ze&&Ne(n,e))return o[e]=4,n[e];yd&&(o[e]=0)}}const u=lc[e];let h,d;if(u)return e==="$attrs"&&dn(t,"get",e),u(t);if((h=a.__cssModules)&&(h=h[e]))return h;if(n!==ze&&Ne(n,e))return o[e]=4,n[e];if(d=l.config.globalProperties,Ne(d,e))return d[e]},set({_:t},e,n){const{data:r,setupState:i,ctx:s}=t;return i!==ze&&Ne(i,e)?(i[e]=n,!0):r!==ze&&Ne(r,e)?(r[e]=n,!0):Ne(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(s[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:i,propsOptions:s}},o){let a;return!!n[o]||t!==ze&&Ne(t,o)||e!==ze&&Ne(e,o)||(a=s[0])&&Ne(a,o)||Ne(r,o)||Ne(lc,o)||Ne(i.config.globalProperties,o)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Ne(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let yd=!0;function WC(t){const e=Xf(t),n=t.proxy,r=t.ctx;yd=!1,e.beforeCreate&&nm(e.beforeCreate,t,"bc");const{data:i,computed:s,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:h,mounted:d,beforeUpdate:f,updated:p,activated:g,deactivated:m,beforeDestroy:w,beforeUnmount:D,destroyed:P,unmounted:y,render:F,renderTracked:R,renderTriggered:K,errorCaptured:_,serverPrefetch:Z,expose:ie,inheritAttrs:he,components:ve,directives:Ee,filters:Oe}=e;if(c&&GC(c,r,null,t.appContext.config.unwrapInjectedRef),o)for(const T in o){const M=o[T];Ce(M)&&(r[T]=M.bind(n))}if(i){const T=i.call(n,n);He(T)&&(t.data=ru(T))}if(yd=!0,s)for(const T in s){const M=s[T],q=Ce(M)?M.bind(n,n):Ce(M.get)?M.get.bind(n,n):Ln,ne=!Ce(M)&&Ce(M.set)?M.set.bind(n):Ln,me=kk({get:q,set:ne});Object.defineProperty(r,T,{enumerable:!0,configurable:!0,get:()=>me.value,set:xe=>me.value=xe})}if(a)for(const T in a)Ev(a[T],r,n,T);if(l){const T=Ce(l)?l.call(n):l;Reflect.ownKeys(T).forEach(M=>{IC(M,T[M])})}u&&nm(u,t,"c");function v(T,M){de(M)?M.forEach(q=>T(q.bind(n))):M&&T(M.bind(n))}if(v(PC,h),v(lu,d),v(BC,f),v(FC,p),v(_C,g),v(RC,m),v(UC,_),v(zC,R),v($C,K),v(Ka,D),v(wv,y),v(VC,Z),de(ie))if(ie.length){const T=t.exposed||(t.exposed={});ie.forEach(M=>{Object.defineProperty(T,M,{get:()=>n[M],set:q=>n[M]=q})})}else t.exposed||(t.exposed={});F&&t.render===Ln&&(t.render=F),he!=null&&(t.inheritAttrs=he),ve&&(t.components=ve),Ee&&(t.directives=Ee)}function GC(t,e,n=Ln,r=!1){de(t)&&(t=bd(t));for(const i in t){const s=t[i];let o;He(s)?"default"in s?o=fh(s.from||i,s.default,!0):o=fh(s.from||i):o=fh(s),Ot(o)&&r?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[i]=o}}function nm(t,e,n){Tn(de(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,n)}function Ev(t,e,n,r){const i=r.includes(".")?gv(n,r):()=>n[r];if(it(t)){const s=e[t];Ce(s)&&ph(i,s)}else if(Ce(t))ph(i,t.bind(n));else if(He(t))if(de(t))t.forEach(s=>Ev(s,e,n,r));else{const s=Ce(t.handler)?t.handler.bind(n):e[t.handler];Ce(s)&&ph(i,s,t)}}function Xf(t){const e=t.type,{mixins:n,extends:r}=e,{mixins:i,optionsCache:s,config:{optionMergeStrategies:o}}=t.appContext,a=s.get(e);let l;return a?l=a:!i.length&&!n&&!r?l=e:(l={},i.length&&i.forEach(c=>cc(l,c,o,!0)),cc(l,e,o)),He(e)&&s.set(e,l),l}function cc(t,e,n,r=!1){const{mixins:i,extends:s}=e;s&&cc(t,s,n,!0),i&&i.forEach(o=>cc(t,o,n,!0));for(const o in e)if(!(r&&o==="expose")){const a=JC[o]||n&&n[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const JC={data:rm,props:mi,emits:mi,methods:mi,computed:mi,beforeCreate:Vt,created:Vt,beforeMount:Vt,mounted:Vt,beforeUpdate:Vt,updated:Vt,beforeDestroy:Vt,beforeUnmount:Vt,destroyed:Vt,unmounted:Vt,activated:Vt,deactivated:Vt,errorCaptured:Vt,serverPrefetch:Vt,components:mi,directives:mi,watch:YC,provide:rm,inject:XC};function rm(t,e){return e?t?function(){return Pt(Ce(t)?t.call(this,this):t,Ce(e)?e.call(this,this):e)}:e:t}function XC(t,e){return mi(bd(t),bd(e))}function bd(t){if(de(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function Vt(t,e){return t?[...new Set([].concat(t,e))]:e}function mi(t,e){return t?Pt(Pt(Object.create(null),t),e):e}function YC(t,e){if(!t)return e;if(!e)return t;const n=Pt(Object.create(null),t);for(const r in e)n[r]=Vt(t[r],e[r]);return n}function QC(t,e,n,r=!1){const i={},s={};sc(s,cu,1),t.propsDefaults=Object.create(null),xv(t,e,i,s);for(const o in t.propsOptions[0])o in i||(i[o]=void 0);n?t.props=r?i:aC(i):t.type.props?t.props=i:t.props=s,t.attrs=s}function ZC(t,e,n,r){const{props:i,attrs:s,vnode:{patchFlag:o}}=t,a=Be(i),[l]=t.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const u=t.vnode.dynamicProps;for(let h=0;h<u.length;h++){let d=u[h];if(su(t.emitsOptions,d))continue;const f=e[d];if(l)if(Ne(s,d))f!==s[d]&&(s[d]=f,c=!0);else{const p=ir(d);i[p]=wd(l,a,p,f,t,!1)}else f!==s[d]&&(s[d]=f,c=!0)}}}else{xv(t,e,i,s)&&(c=!0);let u;for(const h in a)(!e||!Ne(e,h)&&((u=fo(h))===h||!Ne(e,u)))&&(l?n&&(n[h]!==void 0||n[u]!==void 0)&&(i[h]=wd(l,a,h,void 0,t,!0)):delete i[h]);if(s!==a)for(const h in s)(!e||!Ne(e,h)&&!0)&&(delete s[h],c=!0)}c&&mr(t,"set","$attrs")}function xv(t,e,n,r){const[i,s]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if($l(l))continue;const c=e[l];let u;i&&Ne(i,u=ir(l))?!s||!s.includes(u)?n[u]=c:(a||(a={}))[u]=c:su(t.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(s){const l=Be(n),c=a||ze;for(let u=0;u<s.length;u++){const h=s[u];n[h]=wd(i,l,h,c[h],t,!Ne(c,h))}}return o}function wd(t,e,n,r,i,s){const o=t[n];if(o!=null){const a=Ne(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&Ce(l)){const{propsDefaults:c}=i;n in c?r=c[n]:(Ks(i),r=c[n]=l.call(null,e),Ri())}else r=l}o[0]&&(s&&!a?r=!1:o[1]&&(r===""||r===fo(n))&&(r=!0))}return r}function Sv(t,e,n=!1){const r=e.propsCache,i=r.get(t);if(i)return i;const s=t.props,o={},a=[];let l=!1;if(!Ce(t)){const u=h=>{l=!0;const[d,f]=Sv(h,e,!0);Pt(o,d),f&&a.push(...f)};!n&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!s&&!l)return He(t)&&r.set(t,_s),_s;if(de(s))for(let u=0;u<s.length;u++){const h=ir(s[u]);im(h)&&(o[h]=ze)}else if(s)for(const u in s){const h=ir(u);if(im(h)){const d=s[u],f=o[h]=de(d)||Ce(d)?{type:d}:d;if(f){const p=am(Boolean,f.type),g=am(String,f.type);f[0]=p>-1,f[1]=g<0||p<g,(p>-1||Ne(f,"default"))&&a.push(h)}}}const c=[o,a];return He(t)&&r.set(t,c),c}function im(t){return t[0]!=="$"}function sm(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function om(t,e){return sm(t)===sm(e)}function am(t,e){return de(e)?e.findIndex(n=>om(n,t)):Ce(e)&&om(e,t)?0:-1}const Tv=t=>t[0]==="_"||t==="$stable",Yf=t=>de(t)?t.map(qn):[qn(t)],ek=(t,e,n)=>{if(e._n)return e;const r=pv((...i)=>Yf(e(...i)),n);return r._c=!1,r},Cv=(t,e,n)=>{const r=t._ctx;for(const i in t){if(Tv(i))continue;const s=t[i];if(Ce(s))e[i]=ek(i,s,r);else if(s!=null){const o=Yf(s);e[i]=()=>o}}},kv=(t,e)=>{const n=Yf(e);t.slots.default=()=>n},tk=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=Be(e),sc(e,"_",n)):Cv(e,t.slots={})}else t.slots={},e&&kv(t,e);sc(t.slots,cu,1)},nk=(t,e,n)=>{const{vnode:r,slots:i}=t;let s=!0,o=ze;if(r.shapeFlag&32){const a=e._;a?n&&a===1?s=!1:(Pt(i,e),!n&&a===1&&delete i._):(s=!e.$stable,Cv(e,i)),o=e}else e&&(kv(t,e),o={default:1});if(s)for(const a in i)!Tv(a)&&!(a in o)&&delete i[a]};function Iv(){return{app:null,config:{isNativeTag:IT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let rk=0;function ik(t,e){return function(r,i=null){Ce(r)||(r=Object.assign({},r)),i!=null&&!He(i)&&(i=null);const s=Iv(),o=new Set;let a=!1;const l=s.app={_uid:rk++,_component:r,_props:i,_container:null,_context:s,_instance:null,version:Ik,get config(){return s.config},set config(c){},use(c,...u){return o.has(c)||(c&&Ce(c.install)?(o.add(c),c.install(l,...u)):Ce(c)&&(o.add(c),c(l,...u))),l},mixin(c){return s.mixins.includes(c)||s.mixins.push(c),l},component(c,u){return u?(s.components[c]=u,l):s.components[c]},directive(c,u){return u?(s.directives[c]=u,l):s.directives[c]},mount(c,u,h){if(!a){const d=Dt(r,i);return d.appContext=s,u&&e?e(d,c):t(d,c,h),a=!0,l._container=c,c.__vue_app__=l,uu(d.component)||d.component.proxy}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,u){return s.provides[c]=u,l}};return l}}function vd(t,e,n,r,i=!1){if(de(t)){t.forEach((d,f)=>vd(d,e&&(de(e)?e[f]:e),n,r,i));return}if(Ul(r)&&!i)return;const s=r.shapeFlag&4?uu(r.component)||r.component.proxy:r.el,o=i?null:s,{i:a,r:l}=t,c=e&&e.r,u=a.refs===ze?a.refs={}:a.refs,h=a.setupState;if(c!=null&&c!==l&&(it(c)?(u[c]=null,Ne(h,c)&&(h[c]=null)):Ot(c)&&(c.value=null)),Ce(l))Vr(l,a,12,[o,u]);else{const d=it(l),f=Ot(l);if(d||f){const p=()=>{if(t.f){const g=d?u[l]:l.value;i?de(g)&&Rf(g,s):de(g)?g.includes(s)||g.push(s):d?(u[l]=[s],Ne(h,l)&&(h[l]=u[l])):(l.value=[s],t.k&&(u[t.k]=l.value))}else d?(u[l]=o,Ne(h,l)&&(h[l]=o)):f&&(l.value=o,t.k&&(u[t.k]=o))};o?(p.id=-1,Yt(p,n)):p()}}}const Yt=kC;function sk(t){return ok(t)}function ok(t,e){const n=_T();n.__VUE__=!0;const{insert:r,remove:i,patchProp:s,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:h,nextSibling:d,setScopeId:f=Ln,insertStaticContent:p}=t,g=(b,E,I,$=null,L=null,S=null,G=!1,N=null,A=!!E.dynamicChildren)=>{if(b===E)return;b&&!Ei(b,E)&&($=gt(b),xe(b,L,S,!0),b=null),E.patchFlag===-2&&(A=!1,E.dynamicChildren=null);const{type:B,ref:Y,shapeFlag:X}=E;switch(B){case Zf:m(b,E,I,$);break;case Pn:w(b,E,I,$);break;case Hl:b==null&&D(E,I,$,G);break;case wn:ve(b,E,I,$,L,S,G,N,A);break;default:X&1?F(b,E,I,$,L,S,G,N,A):X&6?Ee(b,E,I,$,L,S,G,N,A):(X&64||X&128)&&B.process(b,E,I,$,L,S,G,N,A,mt)}Y!=null&&L&&vd(Y,b&&b.ref,S,E||b,!E)},m=(b,E,I,$)=>{if(b==null)r(E.el=a(E.children),I,$);else{const L=E.el=b.el;E.children!==b.children&&c(L,E.children)}},w=(b,E,I,$)=>{b==null?r(E.el=l(E.children||""),I,$):E.el=b.el},D=(b,E,I,$)=>{[b.el,b.anchor]=p(b.children,E,I,$,b.el,b.anchor)},P=({el:b,anchor:E},I,$)=>{let L;for(;b&&b!==E;)L=d(b),r(b,I,$),b=L;r(E,I,$)},y=({el:b,anchor:E})=>{let I;for(;b&&b!==E;)I=d(b),i(b),b=I;i(E)},F=(b,E,I,$,L,S,G,N,A)=>{G=G||E.type==="svg",b==null?R(E,I,$,L,S,G,N,A):Z(b,E,L,S,G,N,A)},R=(b,E,I,$,L,S,G,N)=>{let A,B;const{type:Y,props:X,shapeFlag:te,transition:x,dirs:C}=b;if(A=b.el=o(b.type,S,X&&X.is,X),te&8?u(A,b.children):te&16&&_(b.children,A,null,$,L,S&&Y!=="foreignObject",G,N),C&&hi(b,null,$,"created"),X){for(const H in X)H!=="value"&&!$l(H)&&s(A,H,null,X[H],S,b.children,$,L,je);"value"in X&&s(A,"value",null,X.value),(B=X.onVnodeBeforeMount)&&Hn(B,$,b)}K(A,b,b.scopeId,G,$),C&&hi(b,null,$,"beforeMount");const V=(!L||L&&!L.pendingBranch)&&x&&!x.persisted;V&&x.beforeEnter(A),r(A,E,I),((B=X&&X.onVnodeMounted)||V||C)&&Yt(()=>{B&&Hn(B,$,b),V&&x.enter(A),C&&hi(b,null,$,"mounted")},L)},K=(b,E,I,$,L)=>{if(I&&f(b,I),$)for(let S=0;S<$.length;S++)f(b,$[S]);if(L){let S=L.subTree;if(E===S){const G=L.vnode;K(b,G,G.scopeId,G.slotScopeIds,L.parent)}}},_=(b,E,I,$,L,S,G,N,A=0)=>{for(let B=A;B<b.length;B++){const Y=b[B]=N?Ir(b[B]):qn(b[B]);g(null,Y,E,I,$,L,S,G,N)}},Z=(b,E,I,$,L,S,G)=>{const N=E.el=b.el;let{patchFlag:A,dynamicChildren:B,dirs:Y}=E;A|=b.patchFlag&16;const X=b.props||ze,te=E.props||ze;let x;I&&di(I,!1),(x=te.onVnodeBeforeUpdate)&&Hn(x,I,E,b),Y&&hi(E,b,I,"beforeUpdate"),I&&di(I,!0);const C=L&&E.type!=="foreignObject";if(B?ie(b.dynamicChildren,B,N,I,$,C,S):G||M(b,E,N,null,I,$,C,S,!1),A>0){if(A&16)he(N,E,X,te,I,$,L);else if(A&2&&X.class!==te.class&&s(N,"class",null,te.class,L),A&4&&s(N,"style",X.style,te.style,L),A&8){const V=E.dynamicProps;for(let H=0;H<V.length;H++){const ce=V[H],De=X[ce],gn=te[ce];(gn!==De||ce==="value")&&s(N,ce,De,gn,L,b.children,I,$,je)}}A&1&&b.children!==E.children&&u(N,E.children)}else!G&&B==null&&he(N,E,X,te,I,$,L);((x=te.onVnodeUpdated)||Y)&&Yt(()=>{x&&Hn(x,I,E,b),Y&&hi(E,b,I,"updated")},$)},ie=(b,E,I,$,L,S,G)=>{for(let N=0;N<E.length;N++){const A=b[N],B=E[N],Y=A.el&&(A.type===wn||!Ei(A,B)||A.shapeFlag&70)?h(A.el):I;g(A,B,Y,null,$,L,S,G,!0)}},he=(b,E,I,$,L,S,G)=>{if(I!==$){if(I!==ze)for(const N in I)!$l(N)&&!(N in $)&&s(b,N,I[N],null,G,E.children,L,S,je);for(const N in $){if($l(N))continue;const A=$[N],B=I[N];A!==B&&N!=="value"&&s(b,N,B,A,G,E.children,L,S,je)}"value"in $&&s(b,"value",I.value,$.value)}},ve=(b,E,I,$,L,S,G,N,A)=>{const B=E.el=b?b.el:a(""),Y=E.anchor=b?b.anchor:a("");let{patchFlag:X,dynamicChildren:te,slotScopeIds:x}=E;x&&(N=N?N.concat(x):x),b==null?(r(B,I,$),r(Y,I,$),_(E.children,I,Y,L,S,G,N,A)):X>0&&X&64&&te&&b.dynamicChildren?(ie(b.dynamicChildren,te,I,L,S,G,N),(E.key!=null||L&&E===L.subTree)&&Qf(b,E,!0)):M(b,E,I,Y,L,S,G,N,A)},Ee=(b,E,I,$,L,S,G,N,A)=>{E.slotScopeIds=N,b==null?E.shapeFlag&512?L.ctx.activate(E,I,$,G,A):Oe(E,I,$,L,S,G,A):Ue(b,E,A)},Oe=(b,E,I,$,L,S,G)=>{const N=b.component=wk(b,$,L);if(ou(b)&&(N.ctx.renderer=mt),vk(N),N.asyncDep){if(L&&L.registerDep(N,v),!b.el){const A=N.subTree=Dt(Pn);w(null,A,E,I)}return}v(N,b,E,I,L,S,G)},Ue=(b,E,I)=>{const $=E.component=b.component;if(SC(b,E,I))if($.asyncDep&&!$.asyncResolved){T($,E,I);return}else $.next=E,yC($.update),$.update();else E.el=b.el,$.vnode=E},v=(b,E,I,$,L,S,G)=>{const N=()=>{if(b.isMounted){let{next:Y,bu:X,u:te,parent:x,vnode:C}=b,V=Y,H;di(b,!1),Y?(Y.el=C.el,T(b,Y,G)):Y=C,X&&zl(X),(H=Y.props&&Y.props.onVnodeBeforeUpdate)&&Hn(H,x,Y,C),di(b,!0);const ce=dh(b),De=b.subTree;b.subTree=ce,g(De,ce,h(De.el),gt(De),b,L,S),Y.el=ce.el,V===null&&TC(b,ce.el),te&&Yt(te,L),(H=Y.props&&Y.props.onVnodeUpdated)&&Yt(()=>Hn(H,x,Y,C),L)}else{let Y;const{el:X,props:te}=E,{bm:x,m:C,parent:V}=b,H=Ul(E);if(di(b,!1),x&&zl(x),!H&&(Y=te&&te.onVnodeBeforeMount)&&Hn(Y,V,E),di(b,!0),X&&Jt){const ce=()=>{b.subTree=dh(b),Jt(X,b.subTree,b,L,null)};H?E.type.__asyncLoader().then(()=>!b.isUnmounted&&ce()):ce()}else{const ce=b.subTree=dh(b);g(null,ce,I,$,b,L,S),E.el=ce.el}if(C&&Yt(C,L),!H&&(Y=te&&te.onVnodeMounted)){const ce=E;Yt(()=>Hn(Y,V,ce),L)}(E.shapeFlag&256||V&&Ul(V.vnode)&&V.vnode.shapeFlag&256)&&b.a&&Yt(b.a,L),b.isMounted=!0,E=I=$=null}},A=b.effect=new Bf(N,()=>Gf(B),b.scope),B=b.update=()=>A.run();B.id=b.uid,di(b,!0),B()},T=(b,E,I)=>{E.component=b;const $=b.vnode.props;b.vnode=E,b.next=null,ZC(b,E.props,$,I),nk(b,E.children,I),po(),Xg(),go()},M=(b,E,I,$,L,S,G,N,A=!1)=>{const B=b&&b.children,Y=b?b.shapeFlag:0,X=E.children,{patchFlag:te,shapeFlag:x}=E;if(te>0){if(te&128){ne(B,X,I,$,L,S,G,N,A);return}else if(te&256){q(B,X,I,$,L,S,G,N,A);return}}x&8?(Y&16&&je(B,L,S),X!==B&&u(I,X)):Y&16?x&16?ne(B,X,I,$,L,S,G,N,A):je(B,L,S,!0):(Y&8&&u(I,""),x&16&&_(X,I,$,L,S,G,N,A))},q=(b,E,I,$,L,S,G,N,A)=>{b=b||_s,E=E||_s;const B=b.length,Y=E.length,X=Math.min(B,Y);let te;for(te=0;te<X;te++){const x=E[te]=A?Ir(E[te]):qn(E[te]);g(b[te],x,I,null,L,S,G,N,A)}B>Y?je(b,L,S,!0,!1,X):_(E,I,$,L,S,G,N,A,X)},ne=(b,E,I,$,L,S,G,N,A)=>{let B=0;const Y=E.length;let X=b.length-1,te=Y-1;for(;B<=X&&B<=te;){const x=b[B],C=E[B]=A?Ir(E[B]):qn(E[B]);if(Ei(x,C))g(x,C,I,null,L,S,G,N,A);else break;B++}for(;B<=X&&B<=te;){const x=b[X],C=E[te]=A?Ir(E[te]):qn(E[te]);if(Ei(x,C))g(x,C,I,null,L,S,G,N,A);else break;X--,te--}if(B>X){if(B<=te){const x=te+1,C=x<Y?E[x].el:$;for(;B<=te;)g(null,E[B]=A?Ir(E[B]):qn(E[B]),I,C,L,S,G,N,A),B++}}else if(B>te)for(;B<=X;)xe(b[B],L,S,!0),B++;else{const x=B,C=B,V=new Map;for(B=C;B<=te;B++){const Q=E[B]=A?Ir(E[B]):qn(E[B]);Q.key!=null&&V.set(Q.key,B)}let H,ce=0;const De=te-C+1;let gn=!1,Er=0;const ci=new Array(De);for(B=0;B<De;B++)ci[B]=0;for(B=x;B<=X;B++){const Q=b[B];if(ce>=De){xe(Q,L,S,!0);continue}let le;if(Q.key!=null)le=V.get(Q.key);else for(H=C;H<=te;H++)if(ci[H-C]===0&&Ei(Q,E[H])){le=H;break}le===void 0?xe(Q,L,S,!0):(ci[le-C]=B+1,le>=Er?Er=le:gn=!0,g(Q,E[le],I,null,L,S,G,N,A),ce++)}const O=gn?ak(ci):_s;for(H=O.length-1,B=De-1;B>=0;B--){const Q=C+B,le=E[Q],Re=Q+1<Y?E[Q+1].el:$;ci[B]===0?g(null,le,I,Re,L,S,G,N,A):gn&&(H<0||B!==O[H]?me(le,I,Re,2):H--)}}},me=(b,E,I,$,L=null)=>{const{el:S,type:G,transition:N,children:A,shapeFlag:B}=b;if(B&6){me(b.component.subTree,E,I,$);return}if(B&128){b.suspense.move(E,I,$);return}if(B&64){G.move(b,E,I,mt);return}if(G===wn){r(S,E,I);for(let X=0;X<A.length;X++)me(A[X],E,I,$);r(b.anchor,E,I);return}if(G===Hl){P(b,E,I);return}if($!==2&&B&1&&N)if($===0)N.beforeEnter(S),r(S,E,I),Yt(()=>N.enter(S),L);else{const{leave:X,delayLeave:te,afterLeave:x}=N,C=()=>r(S,E,I),V=()=>{X(S,()=>{C(),x&&x()})};te?te(S,C,V):V()}else r(S,E,I)},xe=(b,E,I,$=!1,L=!1)=>{const{type:S,props:G,ref:N,children:A,dynamicChildren:B,shapeFlag:Y,patchFlag:X,dirs:te}=b;if(N!=null&&vd(N,null,I,b,!0),Y&256){E.ctx.deactivate(b);return}const x=Y&1&&te,C=!Ul(b);let V;if(C&&(V=G&&G.onVnodeBeforeUnmount)&&Hn(V,E,b),Y&6)Le(b.component,I,$);else{if(Y&128){b.suspense.unmount(I,$);return}x&&hi(b,null,E,"beforeUnmount"),Y&64?b.type.remove(b,E,I,L,mt,$):B&&(S!==wn||X>0&&X&64)?je(B,E,I,!1,!0):(S===wn&&X&384||!L&&Y&16)&&je(A,E,I),$&&Ye(b)}(C&&(V=G&&G.onVnodeUnmounted)||x)&&Yt(()=>{V&&Hn(V,E,b),x&&hi(b,null,E,"unmounted")},I)},Ye=b=>{const{type:E,el:I,anchor:$,transition:L}=b;if(E===wn){ke(I,$);return}if(E===Hl){y(b);return}const S=()=>{i(I),L&&!L.persisted&&L.afterLeave&&L.afterLeave()};if(b.shapeFlag&1&&L&&!L.persisted){const{leave:G,delayLeave:N}=L,A=()=>G(I,S);N?N(b.el,S,A):A()}else S()},ke=(b,E)=>{let I;for(;b!==E;)I=d(b),i(b),b=I;i(E)},Le=(b,E,I)=>{const{bum:$,scope:L,update:S,subTree:G,um:N}=b;$&&zl($),L.stop(),S&&(S.active=!1,xe(G,b,E,I)),N&&Yt(N,E),Yt(()=>{b.isUnmounted=!0},E),E&&E.pendingBranch&&!E.isUnmounted&&b.asyncDep&&!b.asyncResolved&&b.suspenseId===E.pendingId&&(E.deps--,E.deps===0&&E.resolve())},je=(b,E,I,$=!1,L=!1,S=0)=>{for(let G=S;G<b.length;G++)xe(b[G],E,I,$,L)},gt=b=>b.shapeFlag&6?gt(b.component.subTree):b.shapeFlag&128?b.suspense.next():d(b.anchor||b.el),Ct=(b,E,I)=>{b==null?E._vnode&&xe(E._vnode,null,null,!0):g(E._vnode||null,b,E,null,null,null,I),Xg(),uv(),E._vnode=b},mt={p:g,um:xe,m:me,r:Ye,mt:Oe,mc:_,pc:M,pbc:ie,n:gt,o:t};let kt,Jt;return e&&([kt,Jt]=e(mt)),{render:Ct,hydrate:kt,createApp:ik(Ct,kt)}}function di({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function Qf(t,e,n=!1){const r=t.children,i=e.children;if(de(r)&&de(i))for(let s=0;s<r.length;s++){const o=r[s];let a=i[s];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[s]=Ir(i[s]),a.el=o.el),n||Qf(o,a))}}function ak(t){const e=t.slice(),n=[0];let r,i,s,o,a;const l=t.length;for(r=0;r<l;r++){const c=t[r];if(c!==0){if(i=n[n.length-1],t[i]<c){e[r]=i,n.push(r);continue}for(s=0,o=n.length-1;s<o;)a=s+o>>1,t[n[a]]<c?s=a+1:o=a;c<t[n[s]]&&(s>0&&(e[r]=n[s-1]),n[s]=r)}}for(s=n.length,o=n[s-1];s-- >0;)n[s]=o,o=e[o];return n}const lk=t=>t.__isTeleport,jo=t=>t&&(t.disabled||t.disabled===""),lm=t=>typeof SVGElement<"u"&&t instanceof SVGElement,Ed=(t,e)=>{const n=t&&t.to;return it(n)?e?e(n):null:n},ck={__isTeleport:!0,process(t,e,n,r,i,s,o,a,l,c){const{mc:u,pc:h,pbc:d,o:{insert:f,querySelector:p,createText:g,createComment:m}}=c,w=jo(e.props);let{shapeFlag:D,children:P,dynamicChildren:y}=e;if(t==null){const F=e.el=g(""),R=e.anchor=g("");f(F,n,r),f(R,n,r);const K=e.target=Ed(e.props,p),_=e.targetAnchor=g("");K&&(f(_,K),o=o||lm(K));const Z=(ie,he)=>{D&16&&u(P,ie,he,i,s,o,a,l)};w?Z(n,R):K&&Z(K,_)}else{e.el=t.el;const F=e.anchor=t.anchor,R=e.target=t.target,K=e.targetAnchor=t.targetAnchor,_=jo(t.props),Z=_?n:R,ie=_?F:K;if(o=o||lm(R),y?(d(t.dynamicChildren,y,Z,i,s,o,a),Qf(t,e,!0)):l||h(t,e,Z,ie,i,s,o,a,!1),w)_||yl(e,n,F,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const he=e.target=Ed(e.props,p);he&&yl(e,he,null,c,0)}else _&&yl(e,R,K,c,1)}},remove(t,e,n,r,{um:i,o:{remove:s}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:u,target:h,props:d}=t;if(h&&s(u),(o||!jo(d))&&(s(c),a&16))for(let f=0;f<l.length;f++){const p=l[f];i(p,e,n,!0,!!p.dynamicChildren)}},move:yl,hydrate:uk};function yl(t,e,n,{o:{insert:r},m:i},s=2){s===0&&r(t.targetAnchor,e,n);const{el:o,anchor:a,shapeFlag:l,children:c,props:u}=t,h=s===2;if(h&&r(o,e,n),(!h||jo(u))&&l&16)for(let d=0;d<c.length;d++)i(c[d],e,n,2);h&&r(a,e,n)}function uk(t,e,n,r,i,s,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const u=e.target=Ed(e.props,l);if(u){const h=u._lpa||u.firstChild;if(e.shapeFlag&16)if(jo(e.props))e.anchor=c(o(t),e,a(t),n,r,i,s),e.targetAnchor=h;else{e.anchor=o(t);let d=h;for(;d;)if(d=o(d),d&&d.nodeType===8&&d.data==="teleport anchor"){e.targetAnchor=d,u._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(h,e,u,n,r,i,s)}}return e.anchor&&o(e.anchor)}const hk=ck,wn=Symbol(void 0),Zf=Symbol(void 0),Pn=Symbol(void 0),Hl=Symbol(void 0),Ko=[];let Dn=null;function on(t=!1){Ko.push(Dn=t?null:[])}function dk(){Ko.pop(),Dn=Ko[Ko.length-1]||null}let ha=1;function cm(t){ha+=t}function Av(t){return t.dynamicChildren=ha>0?Dn||_s:null,dk(),ha>0&&Dn&&Dn.push(t),t}function Mn(t,e,n,r,i,s){return Av(W(t,e,n,r,i,s,!0))}function Mv(t,e,n,r,i){return Av(Dt(t,e,n,r,i,!0))}function xd(t){return t?t.__v_isVNode===!0:!1}function Ei(t,e){return t.type===e.type&&t.key===e.key}const cu="__vInternal",Nv=({key:t})=>t!=null?t:null,jl=({ref:t,ref_key:e,ref_for:n})=>t!=null?it(t)||Ot(t)||Ce(t)?{i:xn,r:t,k:e,f:!!n}:t:null;function W(t,e=null,n=null,r=0,i=null,s=t===wn?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Nv(e),ref:e&&jl(e),scopeId:fv,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null};return a?(ep(l,n),s&128&&t.normalize(l)):n&&(l.shapeFlag|=it(n)?8:16),ha>0&&!o&&Dn&&(l.patchFlag>0||s&6)&&l.patchFlag!==32&&Dn.push(l),l}const Dt=fk;function fk(t,e=null,n=null,r=0,i=null,s=!1){if((!t||t===HC)&&(t=Pn),xd(t)){const a=Gr(t,e,!0);return n&&ep(a,n),ha>0&&!s&&Dn&&(a.shapeFlag&6?Dn[Dn.indexOf(t)]=a:Dn.push(a)),a.patchFlag|=-2,a}if(Ck(t)&&(t=t.__vccOpts),e){e=pk(e);let{class:a,style:l}=e;a&&!it(a)&&(e.class=Xt(a)),He(l)&&(rv(l)&&!de(l)&&(l=Pt({},l)),e.style=Df(l))}const o=it(t)?1:CC(t)?128:lk(t)?64:He(t)?4:Ce(t)?2:0;return W(t,e,n,r,i,o,s,!0)}function pk(t){return t?rv(t)||cu in t?Pt({},t):t:null}function Gr(t,e,n=!1){const{props:r,ref:i,patchFlag:s,children:o}=t,a=e?mk(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&Nv(a),ref:e&&e.ref?n&&i?de(i)?i.concat(jl(e)):[i,jl(e)]:jl(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:o,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==wn?s===-1?16:s|16:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Gr(t.ssContent),ssFallback:t.ssFallback&&Gr(t.ssFallback),el:t.el,anchor:t.anchor}}function Cr(t=" ",e=0){return Dt(Zf,null,t,e)}function gk(t,e){const n=Dt(Hl,null,t);return n.staticCount=e,n}function bl(t="",e=!1){return e?(on(),Mv(Pn,null,t)):Dt(Pn,null,t)}function qn(t){return t==null||typeof t=="boolean"?Dt(Pn):de(t)?Dt(wn,null,t.slice()):typeof t=="object"?Ir(t):Dt(Zf,null,String(t))}function Ir(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Gr(t)}function ep(t,e){let n=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(de(e))n=16;else if(typeof e=="object")if(r&65){const i=e.default;i&&(i._c&&(i._d=!1),ep(t,i()),i._c&&(i._d=!0));return}else{n=32;const i=e._;!i&&!(cu in e)?e._ctx=xn:i===3&&xn&&(xn.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Ce(e)?(e={default:e,_ctx:xn},n=32):(e=String(e),r&64?(n=16,e=[Cr(e)]):n=8);t.children=e,t.shapeFlag|=n}function mk(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const i in r)if(i==="class")e.class!==r.class&&(e.class=Xt([e.class,r.class]));else if(i==="style")e.style=Df([e.style,r.style]);else if(Qc(i)){const s=e[i],o=r[i];o&&s!==o&&!(de(s)&&s.includes(o))&&(e[i]=s?[].concat(s,o):o)}else i!==""&&(e[i]=r[i])}return e}function Hn(t,e,n,r=null){Tn(t,e,7,[n,r])}const yk=Iv();let bk=0;function wk(t,e,n){const r=t.type,i=(e?e.appContext:t.appContext)||yk,s={uid:bk++,vnode:t,type:r,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new RT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Sv(r,i),emitsOptions:dv(r,i),emit:null,emitted:null,propsDefaults:ze,inheritAttrs:r.inheritAttrs,ctx:ze,data:ze,props:ze,attrs:ze,slots:ze,refs:ze,setupState:ze,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=e?e.root:s,s.emit=vC.bind(null,s),t.ce&&t.ce(s),s}let at=null;const Ov=()=>at||xn,Ks=t=>{at=t,t.scope.on()},Ri=()=>{at&&at.scope.off(),at=null};function Dv(t){return t.vnode.shapeFlag&4}let da=!1;function vk(t,e=!1){da=e;const{props:n,children:r}=t.vnode,i=Dv(t);QC(t,n,i,e),tk(t,r);const s=i?Ek(t,e):void 0;return da=!1,s}function Ek(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=Uf(new Proxy(t.ctx,qC));const{setup:r}=n;if(r){const i=t.setupContext=r.length>1?Sk(t):null;Ks(t),po();const s=Vr(r,t,0,[t.props,i]);if(go(),Ri(),Hw(s)){if(s.then(Ri,Ri),e)return s.then(o=>{um(t,o,e)}).catch(o=>{iu(o,t,0)});t.asyncDep=s}else um(t,s,e)}else _v(t,e)}function um(t,e,n){Ce(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:He(e)&&(t.setupState=sv(e)),_v(t,n)}let hm;function _v(t,e,n){const r=t.type;if(!t.render){if(!e&&hm&&!r.render){const i=r.template||Xf(t).template;if(i){const{isCustomElement:s,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Pt(Pt({isCustomElement:s,delimiters:a},o),l);r.render=hm(i,c)}}t.render=r.render||Ln}Ks(t),po(),WC(t),go(),Ri()}function xk(t){return new Proxy(t.attrs,{get(e,n){return dn(t,"get","$attrs"),e[n]}})}function Sk(t){const e=r=>{t.exposed=r||{}};let n;return{get attrs(){return n||(n=xk(t))},slots:t.slots,emit:t.emit,expose:e}}function uu(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(sv(Uf(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in lc)return lc[n](t)}}))}function Tk(t,e=!0){return Ce(t)?t.displayName||t.name:t.name||e&&t.__name}function Ck(t){return Ce(t)&&"__vccOpts"in t}const kk=(t,e)=>pC(t,e,da);function Li(t,e,n){const r=arguments.length;return r===2?He(e)&&!de(e)?xd(e)?Dt(t,null,[e]):Dt(t,e):Dt(t,null,e):(r>3?n=Array.prototype.slice.call(arguments,2):r===3&&xd(n)&&(n=[n]),Dt(t,e,n))}const Ik="3.2.40",Ak="http://www.w3.org/2000/svg",xi=typeof document<"u"?document:null,dm=xi&&xi.createElement("template"),Mk={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const i=e?xi.createElementNS(Ak,t):xi.createElement(t,n?{is:n}:void 0);return t==="select"&&r&&r.multiple!=null&&i.setAttribute("multiple",r.multiple),i},createText:t=>xi.createTextNode(t),createComment:t=>xi.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>xi.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,r,i,s){const o=n?n.previousSibling:e.lastChild;if(i&&(i===s||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),n),!(i===s||!(i=i.nextSibling)););else{dm.innerHTML=r?`<svg>${t}</svg>`:t;const a=dm.content;if(r){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function Nk(t,e,n){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function Ok(t,e,n){const r=t.style,i=it(n);if(n&&!i){for(const s in n)Sd(r,s,n[s]);if(e&&!it(e))for(const s in e)n[s]==null&&Sd(r,s,"")}else{const s=r.display;i?e!==n&&(r.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(r.display=s)}}const fm=/\s*!important$/;function Sd(t,e,n){if(de(n))n.forEach(r=>Sd(t,e,r));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const r=Dk(t,e);fm.test(n)?t.setProperty(fo(r),n.replace(fm,""),"important"):t[r]=n}}const pm=["Webkit","Moz","ms"],mh={};function Dk(t,e){const n=mh[e];if(n)return n;let r=ir(e);if(r!=="filter"&&r in t)return mh[e]=r;r=tu(r);for(let i=0;i<pm.length;i++){const s=pm[i]+r;if(s in t)return mh[e]=s}return e}const gm="http://www.w3.org/1999/xlink";function _k(t,e,n,r,i){if(r&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(gm,e.slice(6,e.length)):t.setAttributeNS(gm,e,n);else{const s=xT(e);n==null||s&&!$w(n)?t.removeAttribute(e):t.setAttribute(e,s?"":n)}}function Rk(t,e,n,r,i,s,o){if(e==="innerHTML"||e==="textContent"){r&&o(r,i,s),t[e]=n==null?"":n;return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=n;const l=n==null?"":n;(t.value!==l||t.tagName==="OPTION")&&(t.value=l),n==null&&t.removeAttribute(e);return}let a=!1;if(n===""||n==null){const l=typeof t[e];l==="boolean"?n=$w(n):n==null&&l==="string"?(n="",a=!0):l==="number"&&(n=0,a=!0)}try{t[e]=n}catch{}a&&t.removeAttribute(e)}const[Rv,Lk]=(()=>{let t=Date.now,e=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(t=performance.now.bind(performance));const n=navigator.userAgent.match(/firefox\/(\d+)/i);e=!!(n&&Number(n[1])<=53)}return[t,e]})();let Td=0;const Pk=Promise.resolve(),Bk=()=>{Td=0},Fk=()=>Td||(Pk.then(Bk),Td=Rv());function Si(t,e,n,r){t.addEventListener(e,n,r)}function Vk(t,e,n,r){t.removeEventListener(e,n,r)}function $k(t,e,n,r,i=null){const s=t._vei||(t._vei={}),o=s[e];if(r&&o)o.value=r;else{const[a,l]=zk(e);if(r){const c=s[e]=Uk(r,i);Si(t,a,c,l)}else o&&(Vk(t,a,o,l),s[e]=void 0)}}const mm=/(?:Once|Passive|Capture)$/;function zk(t){let e;if(mm.test(t)){e={};let r;for(;r=t.match(mm);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):fo(t.slice(2)),e]}function Uk(t,e){const n=r=>{const i=r.timeStamp||Rv();(Lk||i>=n.attached-1)&&Tn(Hk(r,n.value),e,5,[r])};return n.value=t,n.attached=Fk(),n}function Hk(t,e){if(de(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(r=>i=>!i._stopped&&r&&r(i))}else return e}const ym=/^on[a-z]/,jk=(t,e,n,r,i=!1,s,o,a,l)=>{e==="class"?Nk(t,r,i):e==="style"?Ok(t,n,r):Qc(e)?_f(e)||$k(t,e,n,r,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Kk(t,e,r,i))?Rk(t,e,r,s,o,a,l):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),_k(t,e,r,i))};function Kk(t,e,n,r){return r?!!(e==="innerHTML"||e==="textContent"||e in t&&ym.test(e)&&Ce(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||ym.test(e)&&it(n)?!1:e in t}const qk={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};DC.props;const uc=t=>{const e=t.props["onUpdate:modelValue"]||!1;return de(e)?n=>zl(e,n):e};function Wk(t){t.target.composing=!0}function bm(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Gk={created(t,{modifiers:{lazy:e,trim:n,number:r}},i){t._assign=uc(i);const s=r||i.props&&i.props.type==="number";Si(t,e?"change":"input",o=>{if(o.target.composing)return;let a=t.value;n&&(a=a.trim()),s&&(a=ad(a)),t._assign(a)}),n&&Si(t,"change",()=>{t.value=t.value.trim()}),e||(Si(t,"compositionstart",Wk),Si(t,"compositionend",bm),Si(t,"change",bm))},mounted(t,{value:e}){t.value=e==null?"":e},beforeUpdate(t,{value:e,modifiers:{lazy:n,trim:r,number:i}},s){if(t._assign=uc(s),t.composing||document.activeElement===t&&t.type!=="range"&&(n||r&&t.value.trim()===e||(i||t.type==="number")&&ad(t.value)===e))return;const o=e==null?"":e;t.value!==o&&(t.value=o)}},Jk={deep:!0,created(t,e,n){t._assign=uc(n),Si(t,"change",()=>{const r=t._modelValue,i=Xk(t),s=t.checked,o=t._assign;if(de(r)){const a=zw(r,i),l=a!==-1;if(s&&!l)o(r.concat(i));else if(!s&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Zc(r)){const a=new Set(r);s?a.add(i):a.delete(i),o(a)}else o(Lv(t,s))})},mounted:wm,beforeUpdate(t,e,n){t._assign=uc(n),wm(t,e,n)}};function wm(t,{value:e,oldValue:n},r){t._modelValue=e,de(e)?t.checked=zw(e,r.props.value)>-1:Zc(e)?t.checked=e.has(r.props.value):e!==n&&(t.checked=Yc(e,Lv(t,!0)))}function Xk(t){return"_value"in t?t._value:t.value}function Lv(t,e){const n=e?"_trueValue":"_falseValue";return n in t?t[n]:e}const Yk=["ctrl","shift","alt","meta"],Qk={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>Yk.some(n=>t[`${n}Key`]&&!e.includes(n))},Zk=(t,e)=>(n,...r)=>{for(let i=0;i<e.length;i++){const s=Qk[e[i]];if(s&&s(n,e))return}return t(n,...r)},eI=Pt({patchProp:jk},Mk);let vm;function tI(){return vm||(vm=sk(eI))}const nI=(...t)=>{const e=tI().createApp(...t),{mount:n}=e;return e.mount=r=>{const i=rI(r);if(!i)return;const s=e._component;!Ce(s)&&!s.render&&!s.template&&(s.template=i.innerHTML),i.innerHTML="";const o=n(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},e};function rI(t){return it(t)?document.querySelector(t):t}function yt(t){this.content=t}yt.prototype={constructor:yt,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new yt(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new yt(n)},addToStart:function(t,e){return new yt([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new yt(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new yt(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=yt.from(t),t.size?new yt(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=yt.from(t),t.size?new yt(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=yt.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};yt.from=function(t){if(t instanceof yt)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new yt(e)};function Pv(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=Pv(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function Bv(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=Bv(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class U{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{a.isText?(s+=a.text.slice(Math.max(e,l)-l,n-l),o=!r):a.isLeaf?(i?s+=typeof i=="function"?i(a):i:a.type.spec.leafText&&(s+=a.type.spec.leafText(a)),o=!r):!o&&a.isBlock&&(s+=r,o=!0)},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new U(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new U(r,i)}cutByIndex(e,n){return e==n?U.empty:e==0&&n==this.content.length?this:new U(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new U(i,s)}addToStart(e){return new U([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new U(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return Pv(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return Bv(this,e,n,r)}findIndex(e,n=-1){if(e==0)return wl(0,e);if(e==this.size)return wl(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let r=0,i=0;;r++){let s=this.child(r),o=i+s.nodeSize;if(o>=e)return o==e||n>0?wl(r+1,o):wl(r,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return U.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new U(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return U.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new U(n||e,r)}static from(e){if(!e)return U.empty;if(e instanceof U)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new U([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}U.empty=new U([],0);const yh={index:0,offset:0};function wl(t,e){return yh.index=t,yh.offset=e,yh}function hc(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!hc(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!hc(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}class Fe{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&hc(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);return r.create(n.attrs)}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Fe.none;if(e instanceof Fe)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}}Fe.none=[];class fa extends Error{}class J{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=Vv(this.content,e+this.openStart,n);return r&&new J(r,this.openStart,this.openEnd)}removeBetween(e,n){return new J(Fv(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return J.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new J(U.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new J(e,r,i)}}J.empty=new J(U.empty,0,0);function Fv(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(Fv(s.content,e-i-1,n-i-1)))}function Vv(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=Vv(o.content,e-s-1,n);return a&&t.replaceChild(i,o.copy(a))}function iI(t,e,n){if(n.openStart>t.depth)throw new fa("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new fa("Inconsistent open depths");return $v(t,e,n,0)}function $v(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=$v(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Bi(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=sI(n,t);return Bi(s,Uv(t,o,a,e,r))}else return Bi(s,dc(t,e,r))}function zv(t,e){if(!e.type.compatibleContent(t.type))throw new fa("Cannot join "+e.type.name+" onto "+t.type.name)}function Cd(t,e,n){let r=t.node(n);return zv(r,e.node(n)),r}function Pi(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function qo(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(Pi(t.nodeAfter,r),s++));for(let a=s;a<o;a++)Pi(i.child(a),r);e&&e.depth==n&&e.textOffset&&Pi(e.nodeBefore,r)}function Bi(t,e){if(!t.type.validContent(e))throw new fa("Invalid content for node "+t.type.name);return t.copy(e)}function Uv(t,e,n,r,i){let s=t.depth>i&&Cd(t,e,i+1),o=r.depth>i&&Cd(n,r,i+1),a=[];return qo(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(zv(s,o),Pi(Bi(s,Uv(t,e,n,r,i+1)),a)):(s&&Pi(Bi(s,dc(t,e,i+1)),a),qo(e,n,i,a),o&&Pi(Bi(o,dc(n,r,i+1)),a)),qo(r,null,i,a),new U(a)}function dc(t,e,n){let r=[];if(qo(null,t,n,r),t.depth>n){let i=Cd(t,e,n+1);Pi(Bi(i,dc(t,e,n+1)),r)}return qo(e,null,n,r),new U(r)}function sI(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(U.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class pa{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Fe.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new fc(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new pa(n,r,s)}static resolveCached(e,n){for(let i=0;i<bh.length;i++){let s=bh[i];if(s.pos==n&&s.doc==e)return s}let r=bh[wh]=pa.resolve(e,n);return wh=(wh+1)%oI,r}}let bh=[],wh=0,oI=12;class fc{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const aI=Object.create(null);class nr{constructor(e,n,r,i=Fe.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||U.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&hc(this.attrs,n||e.defaultAttrs||aI)&&Fe.sameSet(this.marks,r||Fe.none)}copy(e=null){return e==this.content?this:new nr(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new nr(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return J.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new J(c,i.depth-o,s.depth-o)}replace(e,n,r){return iI(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return pa.resolveCached(this,e)}resolveNoCache(e){return pa.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Hv(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=U.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){if(!this.type.validContent(this.content))throw new RangeError(`Invalid content for node ${this.type.name}: ${this.content.toString().slice(0,50)}`);let e=Fe.none;for(let n=0;n<this.marks.length;n++)e=this.marks[n].addToSet(e);if(!Fe.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r=null;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=U.fromJSON(e,n.content);return e.nodeType(n.type).create(n.attrs,i,r)}}nr.prototype.text=void 0;class pc extends nr{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Hv(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new pc(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new pc(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Hv(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Ki{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new lI(e,n);if(r.next==null)return Ki.empty;let i=jv(r);r.next&&r.err("Unexpected trailing text");let s=gI(pI(i));return mI(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return U.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:h}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);let d=s(h,a.concat(u));if(d)return d}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}Ki.empty=new Ki(!0);class lI{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function jv(t){let e=[];do e.push(cI(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function cI(t){let e=[];do e.push(uI(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function uI(t){let e=fI(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=hI(t,e);else break;return e}function Em(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function hI(t,e){let n=Em(t),r=n;return t.eat(",")&&(t.next!="}"?r=Em(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function dI(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.groups.indexOf(e)>-1&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function fI(t){if(t.eat("(")){let e=jv(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=dI(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function pI(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Kv(t,e){return e-t}function xm(t,e){let n=[];return r(e),n.sort(Kv);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function gI(t){let e=Object.create(null);return n(xm(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);xm(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new Ki(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Kv);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function mI(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function qv(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function Wv(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function Gv(t){let e=Object.create(null);if(t)for(let n in t)e[n]=new yI(t[n]);return e}class gc{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Gv(r.attrs),this.defaultAttrs=qv(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ki.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Wv(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new nr(this,this.computeAttrs(e),U.from(n),Fe.setFrom(r))}createChecked(e=null,n,r){if(n=U.from(n),!this.validContent(n))throw new RangeError("Invalid content for node "+this.name);return new nr(this,this.computeAttrs(e),n,Fe.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=U.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(U.empty,!0);return s?new nr(this,e,n.append(s),Fe.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Fe.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new gc(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}}class yI{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class hu{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=Gv(i.attrs),this.excluded=null;let s=qv(this.attrs);this.instance=s?new Fe(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Fe(this,Wv(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new hu(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}excludes(e){return this.excluded.indexOf(e)>-1}}class bI{constructor(e){this.cached=Object.create(null),this.spec={nodes:yt.from(e.nodes),marks:yt.from(e.marks||{}),topNode:e.topNode},this.nodes=gc.compile(this.spec.nodes,this),this.marks=hu.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let i=this.nodes[r],s=i.spec.content||"",o=i.spec.marks;i.contentMatch=n[s]||(n[s]=Ki.parse(s,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.markSet=o=="_"?null:o?Sm(this,o.split(" ")):o==""||!i.inlineContent?[]:null}for(let r in this.marks){let i=this.marks[r],s=i.spec.excludes;i.excluded=s==null?[i]:s==""?[]:Sm(this,s.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof gc){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new pc(r,r.defaultAttrs,e,Fe.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeFromJSON(e){return nr.fromJSON(this,e)}markFromJSON(e){return Fe.fromJSON(this,e)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function Sm(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}class qs{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[],n.forEach(r=>{r.tag?this.tags.push(r):r.style&&this.styles.push(r)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new Cm(this,n,!1);return r.addAll(e,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new Cm(this,n,!0);return r.addAll(e,n.from,n.to),J.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(EI(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=km(o)),o.mark=i})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=km(o)),o.node=i})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new qs(e,qs.schemaRules(e)))}}const Jv={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},wI={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Xv={ol:!0,ul:!0},mc=1,yc=2,Wo=4;function Tm(t,e,n){return e!=null?(e?mc:0)|(e==="full"?yc:0):t&&t.whitespace=="pre"?mc|yc:n&~Wo}class vl{constructor(e,n,r,i,s,o,a){this.type=e,this.attrs=n,this.marks=r,this.pendingMarks=i,this.solid=s,this.options=a,this.content=[],this.activeMarks=Fe.none,this.stashMarks=[],this.match=o||(a&Wo?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(U.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&mc)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=U.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(U.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}popFromStashMark(e){for(let n=this.stashMarks.length-1;n>=0;n--)if(e.eq(this.stashMarks[n]))return this.stashMarks.splice(n,1)[0]}applyPending(e){for(let n=0,r=this.pendingMarks;n<r.length;n++){let i=r[n];(this.type?this.type.allowsMarkType(i.type):SI(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Jv.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Cm{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0;let i=n.topNode,s,o=Tm(null,n.preserveWhitespace,0)|(r?Wo:0);i?s=new vl(i.type,i.attrs,Fe.none,Fe.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new vl(null,null,Fe.none,Fe.none,!0,null,o):s=new vl(e.schema.topNodeType,null,Fe.none,Fe.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){let n=e.getAttribute("style"),r=n?this.readStyles(xI(n)):null,i=this.top;if(r!=null)for(let s=0;s<r.length;s++)this.addPendingMark(r[s]);if(this.addElement(e),r!=null)for(let s=0;s<r.length;s++)this.removePendingMark(r[s],i)}}addTextNode(e){let n=e.nodeValue,r=this.top;if(r.options&yc||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(r.options&mc)r.options&yc?n=n.replace(/\r\n?/g,`
`):n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let i=r.content[r.content.length-1],s=e.previousSibling;(!i||s&&s.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n)),this.findInText(e)}else this.findInside(e)}addElement(e,n){let r=e.nodeName.toLowerCase(),i;Xv.hasOwnProperty(r)&&this.parser.normalizeLists&&vI(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,n));if(s?s.ignore:wI.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let o,a=this.top,l=this.needsBlock;if(Jv.hasOwnProperty(r))o=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),o&&this.sync(a),this.needsBlock=l}else this.addElementByRule(e,s,s.consuming===!1?i:void 0)}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let n=Fe.none;e:for(let r=0;r<e.length;r+=2)for(let i=void 0;;){let s=this.parser.matchStyle(e[r],e[r+1],this,i);if(!s)continue e;if(s.ignore)return null;if(n=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(n),s.consuming===!1)i=s;else break}return n}addElementByRule(e,n,r){let i,s,o;n.node?(s=this.parser.schema.nodes[n.node],s.isLeaf?this.insertNode(s.create(n.attrs))||this.leafFallback(e):i=this.enter(s,n.attrs||null,n.preserveWhitespace)):(o=this.parser.schema.marks[n.mark].create(n.attrs),this.addPendingMark(o));let a=this.top;if(s&&s.isLeaf)this.findInside(e);else if(r)this.addElement(e,r);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l)}i&&this.sync(a)&&this.open--,o&&this.removePendingMark(o,a)}addAll(e,n,r){let i=n||0;for(let s=n?e.childNodes[n]:e.firstChild,o=r==null?null:e.childNodes[r];s!=o;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s);this.findAtPoint(e,i)}findPlace(e){let n,r;for(let i=this.open;i>=0;i--){let s=this.nodes[i],o=s.findWrapping(e);if(o&&(!n||n.length>o.length)&&(n=o,r=s,!o.length)||s.solid)break}if(!n)return!1;this.sync(r);for(let i=0;i<n.length;i++)this.enterInner(n[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let n=this.textblockFromContext();n&&this.enterInner(n)}if(this.findPlace(e)){this.closeExtra();let n=this.top;n.applyPending(e.type),n.match&&(n.match=n.match.matchType(e.type));let r=n.activeMarks;for(let i=0;i<e.marks.length;i++)(!n.type||n.type.allowsMarkType(e.marks[i].type))&&(r=e.marks[i].addToSet(r));return n.content.push(e.mark(r)),!0}return!1}enter(e,n,r){let i=this.findPlace(e.create(n));return i&&this.enterInner(e,n,!0,r),i}enterInner(e,n=null,r=!1,i){this.closeExtra();let s=this.top;s.applyPending(e),s.match=s.match&&s.match.matchType(e);let o=Tm(e,i,s.options);s.options&Wo&&s.content.length==0&&(o|=Wo),this.nodes.push(new vl(e,n,s.activeMarks,s.pendingMarks,r,null,o)),this.open++}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let n=this.open;n>=0;n--)if(this.nodes[n]==e)return this.open=n,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&u.groups.indexOf(c)==-1)return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}addPendingMark(e){let n=TI(e,this.top.pendingMarks);n&&this.top.stashMarks.push(n),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,n){for(let r=this.open;r>=0;r--){let i=this.nodes[r];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let o=i.popFromStashMark(e);o&&i.type&&i.type.allowsMarkType(o.type)&&(i.activeMarks=o.addToSet(i.activeMarks))}if(i==n)break}}}function vI(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Xv.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function EI(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function xI(t){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,n,r=[];for(;n=e.exec(t);)r.push(n[1],n[2].trim());return r}function km(t){let e={};for(let n in t)e[n]=t[n];return e}function SI(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}function TI(t,e){for(let n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}class Qn{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=vh(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=Qn.renderSpec(vh(n),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&Qn.renderSpec(vh(r),i(e,n))}static renderSpec(e,n,r=null){if(typeof n=="string")return{dom:e.createTextNode(n)};if(n.nodeType!=null)return{dom:n};if(n.dom&&n.dom.nodeType!=null)return n;let i=n[0],s=i.indexOf(" ");s>0&&(r=i.slice(0,s),i=i.slice(s+1));let o,a=r?e.createElementNS(r,i):e.createElement(i),l=n[1],c=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){c=2;for(let u in l)if(l[u]!=null){let h=u.indexOf(" ");h>0?a.setAttributeNS(u.slice(0,h),u.slice(h+1),l[u]):a.setAttribute(u,l[u])}}for(let u=c;u<n.length;u++){let h=n[u];if(h===0){if(u<n.length-1||u>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{let{dom:d,contentDOM:f}=Qn.renderSpec(e,h,r);if(a.appendChild(d),f){if(o)throw new RangeError("Multiple content holes");o=f}}}return{dom:a,contentDOM:o}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Qn(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=Im(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return Im(e.marks)}}function Im(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function vh(t){return t.document||window.document}const Yv=65535,Qv=Math.pow(2,16);function CI(t,e){return t+e*Qv}function Am(t){return t&Yv}function kI(t){return(t-(t&Yv))/Qv}const Zv=1,e0=2,Kl=4,t0=8;class kd{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&t0)>0}get deletedBefore(){return(this.delInfo&(Zv|Kl))>0}get deletedAfter(){return(this.delInfo&(e0|Kl))>0}get deletedAcross(){return(this.delInfo&Kl)>0}}class vn{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&vn.empty)return vn.empty}recover(e){let n=0,r=Am(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+kI(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],h=l+c;if(e<=h){let d=c?e==l?-1:e==h?1:n:n,f=l+i+(d<0?0:u);if(r)return f;let p=e==(n<0?l:h)?null:CI(a/3,e-l),g=e==l?e0:e==h?Zv:Kl;return(n<0?e!=l:e!=h)&&(g|=t0),new kd(f,g,p)}i+=u-c}return r?e+i:new kd(e+i,0,null)}touches(e,n){let r=0,i=Am(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new vn(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?vn.empty:new vn(e<0?[0,-e,0]:[0,0,e])}}vn.empty=new vn([]);class Bs{constructor(e=[],n,r=0,i=e.length){this.maps=e,this.mirror=n,this.from=r,this.to=i}slice(e=0,n=this.maps.length){return new Bs(this.maps,this.mirror,e,n)}copy(){return new Bs(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,n){this.to=this.maps.push(e),n!=null&&this.setMirror(this.maps.length-1,n)}appendMapping(e){for(let n=0,r=this.maps.length;n<e.maps.length;n++){let i=e.getMirror(n);this.appendMap(e.maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this.maps.length+e.maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e.maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new Bs;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this.maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this.maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this.maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new kd(e,i,null)}}const Eh=Object.create(null);class rn{getMap(){return vn.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Eh[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Eh)throw new RangeError("Duplicate use of step JSON ID "+e);return Eh[e]=n,n.prototype.jsonID=e,n}}class rt{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new rt(e,null)}static fail(e){return new rt(null,e)}static fromReplace(e,n,r,i){try{return rt.ok(e.replace(n,r,i))}catch(s){if(s instanceof fa)return rt.fail(s.message);throw s}}}function tp(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(tp(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return U.fromArray(r)}class Dr extends rn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new J(tp(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return rt.fromReplace(e,this.from,this.to,s)}invert(){return new Zn(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Dr(n.pos,r.pos,this.mark)}merge(e){return e instanceof Dr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Dr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Dr(n.from,n.to,e.markFromJSON(n.mark))}}rn.jsonID("addMark",Dr);class Zn extends rn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new J(tp(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return rt.fromReplace(e,this.from,this.to,r)}invert(){return new Dr(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Zn(n.pos,r.pos,this.mark)}merge(e){return e instanceof Zn&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Zn(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Zn(n.from,n.to,e.markFromJSON(n.mark))}}rn.jsonID("removeMark",Zn);class _r extends rn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return rt.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return rt.fromReplace(e,this.pos,this.pos+1,new J(U.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new _r(this.pos,n.marks[i]);return new _r(this.pos,this.mark)}}return new Ws(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new _r(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new _r(n.pos,e.markFromJSON(n.mark))}}rn.jsonID("addNodeMark",_r);class Ws extends rn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return rt.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return rt.fromReplace(e,this.pos,this.pos+1,new J(U.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new _r(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ws(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ws(n.pos,e.markFromJSON(n.mark))}}rn.jsonID("removeNodeMark",Ws);class At extends rn{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&Id(e,this.from,this.to)?rt.fail("Structure replace would overwrite content"):rt.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new vn([this.from,this.to-this.from,this.slice.size])}invert(e){return new At(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new At(n.pos,Math.max(n.pos,r.pos),this.slice)}merge(e){if(!(e instanceof At)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?J.empty:new J(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new At(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?J.empty:new J(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new At(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new At(n.from,n.to,J.fromJSON(e,n.slice),!!n.structure)}}rn.jsonID("replace",At);class lt extends rn{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Id(e,this.from,this.gapFrom)||Id(e,this.gapTo,this.to)))return rt.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return rt.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?rt.fromReplace(e,this.from,this.to,r):rt.fail("Content does not fit in gap")}getMap(){return new vn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new lt(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),s=e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new lt(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new lt(n.from,n.to,n.gapFrom,n.gapTo,J.fromJSON(e,n.slice),n.insert,!!n.structure)}}rn.jsonID("replaceAround",lt);function Id(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function II(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&u.type.allowsMarkType(r.type)){let d=Math.max(c,e),f=Math.min(c+l.nodeSize,n),p=r.addToSet(h);for(let g=0;g<h.length;g++)h[g].isInSet(p)||(o&&o.to==d&&o.mark.eq(h[g])?o.to=f:i.push(o=new Zn(d,f,h[g])));a&&a.to==d?a.to=f:s.push(a=new Dr(d,f,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function AI(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof hu){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let h=l[u],d;for(let f=0;f<i.length;f++){let p=i[f];p.step==s-1&&h.eq(i[f].style)&&(d=p)}d?(d.to=c,d.step=s):i.push({style:h,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new Zn(o.from,o.to,o.style)))}function MI(t,e,n,r=n.contentMatch){let i=t.doc.nodeAt(e),s=[],o=e+1;for(let a=0;a<i.childCount;a++){let l=i.child(a),c=o+l.nodeSize,u=r.matchType(l.type);if(!u)s.push(new At(o,c,J.empty));else{r=u;for(let h=0;h<l.marks.length;h++)n.allowsMarkType(l.marks[h].type)||t.step(new Zn(o,c,l.marks[h]))}o=c}if(!r.validEnd){let a=r.fillBefore(U.empty,!0);t.replace(o,o,new J(a,0,0))}for(let a=s.length-1;a>=0;a--)t.step(s[a])}function NI(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function mo(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!NI(i,s,o))break}return null}function OI(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=U.empty,h=0;for(let p=s,g=!1;p>n;p--)g||r.index(p)>0?(g=!0,u=U.from(r.node(p).copy(u)),h++):l--;let d=U.empty,f=0;for(let p=s,g=!1;p>n;p--)g||i.after(p+1)<i.end(p)?(g=!0,d=U.from(i.node(p).copy(d)),f++):c++;t.step(new lt(l,c,o,a,new J(u.append(d),h,f),u.size-h,!0))}function np(t,e,n=null,r=t){let i=DI(t,e),s=i&&_I(r,e);return s?i.map(Mm).concat({type:e,attrs:n}).concat(s.map(Mm)):null}function Mm(t){return{type:t,attrs:null}}function DI(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function _I(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function RI(t,e,n){let r=U.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=U.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new lt(i,s,i,s,new J(r,0,0),n.length,!0))}function LI(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{if(o.isTextblock&&!o.hasMarkup(r,i)&&PI(t.doc,t.mapping.slice(s).map(a),r)){t.clearIncompatible(t.mapping.slice(s).map(a,1),r);let l=t.mapping.slice(s),c=l.map(a,1),u=l.map(a+o.nodeSize,1);return t.step(new lt(c,u,c+1,u-1,new J(U.from(r.create(i,null,o.marks)),0,0),1,!0)),!1}})}function PI(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function BI(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new lt(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new J(U.from(o),0,0),1,!0))}function Fs(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let h=i.node(c),d=i.index(c);if(h.type.spec.isolating)return!1;let f=h.content.cutByIndex(d,h.childCount),p=r&&r[u]||h;if(p!=h&&(f=f.replaceChild(0,p.type.create(p.attrs))),!h.canReplace(d+1,h.childCount)||!p.type.validContent(f))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function FI(t,e,n=1,r){let i=t.doc.resolve(e),s=U.empty,o=U.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=U.from(i.node(a).copy(s));let u=r&&r[c];o=U.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new At(e,e,new J(s.append(o),n,n),!0))}function yo(t,e){let n=t.resolve(e),r=n.index();return VI(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function VI(t,e){return!!(t&&e&&!t.isLeaf&&t.canAppend(e))}function $I(t,e,n){let r=new At(e-n,e+n,J.empty,!0);t.step(r)}function zI(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function n0(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let h=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=h&&c.canReplaceWith(l,l,h[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function rp(t,e,n=e,r=J.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return r0(i,s,r)?new At(e,n,r):new UI(i,s,r).fit()}function r0(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class UI{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=U.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=U.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new J(s,o,a);return e>-1?new lt(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new At(r.pos,i.pos,l):null}findFittable(){for(let e=1;e<=2;e++)for(let n=this.unplaced.openStart;n>=0;n--){let r,i=null;n?(i=xh(this.unplaced.content,n-1).firstChild,r=i.content):r=this.unplaced.content;let s=r.firstChild;for(let o=this.depth;o>=0;o--){let{type:a,match:l}=this.frontier[o],c,u=null;if(e==1&&(s?l.matchType(s.type)||(u=l.fillBefore(U.from(s),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:o,parent:i,inject:u};if(e==2&&s&&(c=l.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:i,wrap:c};if(i&&l.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=xh(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new J(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=xh(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new J(Po(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new J(Po(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let g=0;g<s.length;g++)this.openFrontierNode(s[g]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:h,type:d}=this.frontier[n];if(i){for(let g=0;g<i.childCount;g++)u.push(i.child(g));h=h.matchFragment(i)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let g=a.child(c),m=h.matchType(g.type);if(!m)break;c++,(c>1||l==0||g.content.size)&&(h=m,u.push(i0(g.mark(d.allowedMarks(g.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Bo(this.placed,n,U.from(u)),this.frontier[n].match=h,p&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,m=a;g<f;g++){let w=m.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),m=w.content}this.unplaced=p?e==0?J.empty:new J(Po(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new J(Po(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Sh(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=Sh(e,n,i,r,s);if(!!o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Sh(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Bo(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Bo(this.placed,this.depth,U.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(U.empty,!0);n.childCount&&(this.placed=Bo(this.placed,this.frontier.length,n))}}function Po(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Po(t.firstChild.content,e-1,n)))}function Bo(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Bo(t.lastChild.content,e-1,n)))}function xh(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function i0(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,i0(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(U.empty,!0)))),t.copy(r)}function Sh(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!HI(n,s.content,o)?a:null}function HI(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function jI(t){return t.spec.defining||t.spec.definingForContent}function KI(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(r0(i,s,r))return t.step(new At(e,n,r));let o=o0(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let d=i.depth,f=i.pos-1;d>0;d--,f--){let p=i.node(d).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(d)>-1?a=d:i.before(d)==f&&o.splice(1,0,-d)}let l=o.indexOf(a),c=[],u=r.openStart;for(let d=r.content,f=0;;f++){let p=d.firstChild;if(c.push(p),f==r.openStart)break;d=p.content}for(let d=u-1;d>=0;d--){let f=c[d].type,p=jI(f);if(p&&i.node(l).type!=f)u=d;else if(p||!f.isTextblock)break}for(let d=r.openStart;d>=0;d--){let f=(d+u+1)%(r.openStart+1),p=c[f];if(!!p)for(let g=0;g<o.length;g++){let m=o[(g+l)%o.length],w=!0;m<0&&(w=!1,m=-m);let D=i.node(m-1),P=i.index(m-1);if(D.canReplaceWith(P,P,p.type,p.marks))return t.replace(i.before(m),w?s.after(m):n,new J(s0(r.content,0,r.openStart,f),f,r.openEnd))}}let h=t.steps.length;for(let d=o.length-1;d>=0&&(t.replace(e,n,r),!(t.steps.length>h));d--){let f=o[d];f<0||(e=i.before(f),n=s.after(f))}}function s0(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(s0(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(U.empty,!0))}return t}function qI(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=zI(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new J(U.from(r),0,0))}function WI(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=o0(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o)return t.delete(r.before(o),n);t.delete(e,n)}function o0(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class Vs extends rn{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return rt.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return rt.fromReplace(e,this.pos,this.pos+1,new J(U.from(i),0,n.isLeaf?0:1))}getMap(){return vn.empty}invert(e){return new Vs(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Vs(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Vs(n.pos,n.attr,n.value)}}rn.jsonID("attr",Vs);let Gs=class extends Error{};Gs=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Gs.prototype=Object.create(Error.prototype);Gs.prototype.constructor=Gs;Gs.prototype.name="TransformError";class a0{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Bs}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Gs(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=J.empty){let i=rp(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new J(U.from(r),0,0))}delete(e,n){return this.replace(e,n,J.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return KI(this,e,n,r),this}replaceRangeWith(e,n,r){return qI(this,e,n,r),this}deleteRange(e,n){return WI(this,e,n),this}lift(e,n){return OI(this,e,n),this}join(e,n=1){return $I(this,e,n),this}wrap(e,n){return RI(this,e,n),this}setBlockType(e,n=e,r,i=null){return LI(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i=[]){return BI(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new Vs(e,n,r)),this}addNodeMark(e,n){return this.step(new _r(e,n)),this}removeNodeMark(e,n){if(!(n instanceof Fe)){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n=n.isInSet(r.marks),!n)return this}return this.step(new Ws(e,n)),this}split(e,n=1,r){return FI(this,e,n,r),this}addMark(e,n,r){return II(this,e,n,r),this}removeMark(e,n,r){return AI(this,e,n,r),this}clearIncompatible(e,n,r){return MI(this,e,n,r),this}}const Th=Object.create(null);class ue{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new l0(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=J.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?J.empty:n),a==0&&Dm(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),Dm(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new pe(e):xs(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?xs(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):xs(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Bn(e.node(0))}static atStart(e){return xs(e,e,0,0,1)||new Bn(e)}static atEnd(e){return xs(e,e,e.content.size,e.childCount,-1)||new Bn(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Th[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Th)throw new RangeError("Duplicate use of selection JSON ID "+e);return Th[e]=n,n.prototype.jsonID=e,n}getBookmark(){return pe.between(this.$anchor,this.$head).getBookmark()}}ue.prototype.visible=!0;class l0{constructor(e,n){this.$from=e,this.$to=n}}let Nm=!1;function Om(t){!Nm&&!t.parent.inlineContent&&(Nm=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class pe extends ue{constructor(e,n=e){Om(e),Om(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return ue.near(r);let i=e.resolve(n.map(this.anchor));return new pe(i.parent.inlineContent?i:r,r)}replace(e,n=J.empty){if(super.replace(e,n),n==J.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof pe&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new du(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new pe(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=ue.findFrom(n,r,!0)||ue.findFrom(n,-r,!0);if(s)n=s.$head;else return ue.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(ue.findFrom(e,-r,!0)||ue.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new pe(e,n)}}ue.jsonID("text",pe);class du{constructor(e,n){this.anchor=e,this.head=n}map(e){return new du(e.map(this.anchor),e.map(this.head))}resolve(e){return pe.between(e.resolve(this.anchor),e.resolve(this.head))}}class fe extends ue{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?ue.near(s):new fe(s)}content(){return new J(U.from(this.node),0,0)}eq(e){return e instanceof fe&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new ip(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new fe(e.resolve(n.anchor))}static create(e,n){return new fe(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}fe.prototype.visible=!1;ue.jsonID("node",fe);class ip{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new du(r,r):new ip(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&fe.isSelectable(r)?new fe(n):ue.near(n)}}class Bn extends ue{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=J.empty){if(n==J.empty){e.delete(0,e.doc.content.size);let r=ue.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Bn(e)}map(e){return new Bn(e)}eq(e){return e instanceof Bn}getBookmark(){return GI}}ue.jsonID("all",Bn);const GI={map(){return this},resolve(t){return new Bn(t)}};function xs(t,e,n,r,i,s=!1){if(e.inlineContent)return pe.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&fe.isSelectable(a))return fe.create(t,n-(i<0?a.nodeSize:0))}else{let l=xs(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function Dm(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof At||i instanceof lt))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(ue.near(t.doc.resolve(o),n))}const _m=1,El=2,Rm=4;class JI extends a0{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|_m)&~El,this.storedMarks=null,this}get selectionSet(){return(this.updated&_m)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=El,this}ensureMarks(e){return Fe.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&El)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~El,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Fe.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r==null?n:r,!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),this.selection.empty||this.setSelection(ue.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Rm,this}get scrolledIntoView(){return(this.updated&Rm)>0}}function Lm(t,e){return!e||!t?t:t.bind(e)}class Fo{constructor(e,n,r){this.name=e,this.init=Lm(n.init,r),this.apply=Lm(n.apply,r)}}const XI=[new Fo("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Fo("selection",{init(t,e){return t.selection||ue.atStart(e.doc)},apply(t){return t.selection}}),new Fo("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Fo("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Ch{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=XI.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Fo(r.key,r.spec.state,r))})}}class Is{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let h=0;h<this.config.plugins.length;h++)i.push(h<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Is(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new JI(this)}static create(e){let n=new Ch(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Is(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new Ch(this.schema,e.plugins),r=n.fields,i=new Is(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new Ch(e.schema,e.plugins),s=new Is(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=nr.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=ue.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function c0(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=c0(i,e,{})),n[r]=i}return n}class St{constructor(e){this.spec=e,this.props={},e.props&&c0(e.props,this,this.props),this.key=e.key?e.key.key:u0("plugin")}getState(e){return e[this.key]}}const kh=Object.create(null);function u0(t){return t in kh?t+"$"+ ++kh[t]:(kh[t]=0,t+"$")}class sn{constructor(e="key"){this.key=u0(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const an=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},ga=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let Pm=null;const hr=function(t,e,n){let r=Pm||(Pm=document.createRange());return r.setEnd(t,n==null?t.nodeValue.length:n),r.setStart(t,e||0),r},qi=function(t,e,n,r){return n&&(Bm(t,e,n,r,-1)||Bm(t,e,n,r,1))},YI=/^(img|br|input|textarea|hr)$/i;function Bm(t,e,n,r,i){for(;;){if(t==n&&e==r)return!0;if(e==(i<0?0:Jn(t))){let s=t.parentNode;if(!s||s.nodeType!=1||ZI(t)||YI.test(t.nodeName)||t.contentEditable=="false")return!1;e=an(t)+(i<0?0:1),t=s}else if(t.nodeType==1){if(t=t.childNodes[e+(i<0?-1:0)],t.contentEditable=="false")return!1;e=i<0?Jn(t):0}else return!1}}function Jn(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function QI(t,e,n){for(let r=e==0,i=e==Jn(t);r||i;){if(t==n)return!0;let s=an(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==Jn(t)}}function ZI(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const fu=function(t){return t.focusNode&&qi(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function As(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function eA(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}const Jr=typeof navigator<"u"?navigator:null,Fm=typeof document<"u"?document:null,ni=Jr&&Jr.userAgent||"",Ad=/Edge\/(\d+)/.exec(ni),h0=/MSIE \d/.exec(ni),Md=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ni),en=!!(h0||Md||Ad),$r=h0?document.documentMode:Md?+Md[1]:Ad?+Ad[1]:0,$n=!en&&/gecko\/(\d+)/i.test(ni);$n&&+(/Firefox\/(\d+)/.exec(ni)||[0,0])[1];const Nd=!en&&/Chrome\/(\d+)/.exec(ni),Zt=!!Nd,tA=Nd?+Nd[1]:0,Kt=!en&&!!Jr&&/Apple Computer/.test(Jr.vendor),Js=Kt&&(/Mobile\/\w+/.test(ni)||!!Jr&&Jr.maxTouchPoints>2),bn=Js||(Jr?/Mac/.test(Jr.platform):!1),Xn=/Android \d/.test(ni),pu=!!Fm&&"webkitFontSmoothing"in Fm.documentElement.style,nA=pu?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function rA(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Sr(t,e){return typeof t=="number"?t:t[e]}function iA(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function Vm(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;o=ga(o)){if(o.nodeType!=1)continue;let a=o,l=a==s.body,c=l?rA(s):iA(a),u=0,h=0;if(e.top<c.top+Sr(r,"top")?h=-(c.top-e.top+Sr(i,"top")):e.bottom>c.bottom-Sr(r,"bottom")&&(h=e.bottom-c.bottom+Sr(i,"bottom")),e.left<c.left+Sr(r,"left")?u=-(c.left-e.left+Sr(i,"left")):e.right>c.right-Sr(r,"right")&&(u=e.right-c.right+Sr(i,"right")),u||h)if(l)s.defaultView.scrollBy(u,h);else{let d=a.scrollLeft,f=a.scrollTop;h&&(a.scrollTop+=h),u&&(a.scrollLeft+=u);let p=a.scrollLeft-d,g=a.scrollTop-f;e={left:e.left-p,top:e.top-g,right:e.right-p,bottom:e.bottom-g}}if(l)break}}function sA(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:d0(t.dom)}}function d0(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=ga(r));return e}function oA({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;f0(n,r==0?0:r-e)}function f0(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let ms=null;function aA(t){if(t.setActive)return t.setActive();if(ms)return t.focus(ms);let e=d0(t);t.focus(ms==null?{get preventScroll(){return ms={preventScroll:!0},!0}}:void 0),ms||(ms=!1,f0(e,0))}function p0(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top;for(let l=t.firstChild,c=0;l;l=l.nextSibling,c++){let u;if(l.nodeType==1)u=l.getClientRects();else if(l.nodeType==3)u=hr(l).getClientRects();else continue;for(let h=0;h<u.length;h++){let d=u[h];if(d.top<=o&&d.bottom>=a){o=Math.max(d.bottom,o),a=Math.min(d.top,a);let f=d.left>e.left?d.left-e.left:d.right<e.left?e.left-d.right:0;if(f<r){n=l,r=f,i=f&&n.nodeType==3?{left:d.right<e.left?d.right:d.left,top:e.top}:e,l.nodeType==1&&f&&(s=c+(e.left>=(d.left+d.right)/2?1:0));continue}}!n&&(e.left>=d.right&&e.top>=d.top||e.left>=d.left&&e.top>=d.bottom)&&(s=c+1)}}return n&&n.nodeType==3?lA(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:p0(n,i)}function lA(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=kr(r,1);if(s.top!=s.bottom&&sp(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function sp(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function cA(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function uA(t,e,n){let{node:r,offset:i}=p0(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function hA(t,e,n,r){let i=-1;for(let s=e;s!=t.dom;){let o=t.docView.nearestDesc(s,!0);if(!o)return null;if(o.node.isBlock&&o.parent){let a=o.dom.getBoundingClientRect();if(a.left>r.left||a.top>r.top)i=o.posBefore;else if(a.right<r.left||a.bottom<r.top)i=o.posAfter;else break}s=o.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,1)}function g0(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(sp(e,c))return g0(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function dA(t,e){let n=t.dom.ownerDocument,r,i=0;if(n.caretPositionFromPoint)try{let l=n.caretPositionFromPoint(e.left,e.top);l&&({offsetNode:r,offset:i}=l)}catch{}if(!r&&n.caretRangeFromPoint){let l=n.caretRangeFromPoint(e.left,e.top);l&&({startContainer:r,startOffset:i}=l)}let s=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),o;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let l=t.dom.getBoundingClientRect();if(!sp(e,l)||(s=g0(t.dom,e,l),!s))return null}if(Kt)for(let l=s;r&&l;l=ga(l))l.draggable&&(r=void 0);if(s=cA(s,e),r){if($n&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let l=r.childNodes[i],c;l.nodeName=="IMG"&&(c=l.getBoundingClientRect()).right<=e.left&&c.bottom>e.top&&i++}r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(o=hA(t,r,i,e))}o==null&&(o=uA(t,s,e));let a=t.docView.nearestDesc(s,!0);return{pos:o,inside:a?a.posAtStart-a.border:-1}}function kr(t,e){let n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}const fA=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function m0(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=pu||$n;if(r.nodeType==3)if(o&&(fA.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=kr(hr(r,i,i),n);if($n&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=kr(hr(r,i-1,i-1),-1);if(c.top==l.top){let u=kr(hr(r,i,i+1),-1);if(u.top!=l.top)return ko(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,ko(kr(hr(r,l,c),1),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==Jn(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return Ih(l.getBoundingClientRect(),!1)}if(s==null&&i<Jn(r)){let l=r.childNodes[i];if(l.nodeType==1)return Ih(l.getBoundingClientRect(),!0)}return Ih(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==Jn(r))){let l=r.childNodes[i-1],c=l.nodeType==3?hr(l,Jn(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return ko(kr(c,1),!1)}if(s==null&&i<Jn(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?hr(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return ko(kr(c,-1),!0)}return ko(kr(r.nodeType==3?hr(r):r,-n),n>=0)}function ko(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Ih(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function y0(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function pA(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return y0(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}let o=m0(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=hr(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const gA=/[\u0590-\u08ac]/;function mA(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return!gA.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:y0(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:h}=t.domSelectionRange(),d=a.caretBidiLevel;a.modify("move",n,"character");let f=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:g}=t.domSelectionRange(),m=p&&!f.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==g;try{a.collapse(u,h),l&&(l!=u||c!=h)&&a.extend&&a.extend(l,c)}catch{}return d!=null&&(a.caretBidiLevel=d),m})}let $m=null,zm=null,Um=!1;function yA(t,e,n){return $m==e&&zm==n?Um:($m=e,zm=n,Um=n=="up"||n=="down"?pA(t,e,n):mA(t,e,n))}const Fn=0,Hm=1,Ms=2,sr=3;class qa{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=Fn,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>an(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return(i==null?r>0:i)?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof w0){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof b0&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?an(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?an(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let h=a;h>0;h--){let d=this.children[h-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){i=an(d.dom)+1;break}e-=d.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){s=an(h.dom);break}n+=h.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let d=0,f=0;d<this.children.length;d++){let p=this.children[d],g=f+p.size;if(s>f&&o<g)return p.setSelection(e-f-p.border,n-f-p.border,r,i);f=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.getSelection(),u=!1;if(($n||Kt)&&e==n){let{node:d,offset:f}=a;if(d.nodeType==3){if(u=!!(f&&d.nodeValue[f-1]==`
`),u&&f==d.nodeValue.length)for(let p=d,g;p;p=p.parentNode){if(g=p.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:an(g)+1});break}let m=p.pmViewDesc;if(m&&m.node&&m.node.isBlock)break}}else{let p=d.childNodes[f-1];u=p&&(p.nodeName=="BR"||p.contentEditable=="false")}}if($n&&c.focusNode&&c.focusNode!=l.node&&c.focusNode.nodeType==1){let d=c.focusNode.childNodes[c.focusOffset];d&&d.contentEditable=="false"&&(i=!0)}if(!(i||u&&Kt)&&qi(a.node,a.offset,c.anchorNode,c.anchorOffset)&&qi(l.node,l.offset,c.focusNode,c.focusOffset))return;let h=!1;if((c.extend||e==n)&&!u){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let f=a;a=l,l=f}let d=document.createRange();d.setEnd(l.node,l.offset),d.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(d)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Ms:Hm,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=sr:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?Ms:sr}r=o}this.dirty=Ms}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Ms:Hm;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class b0 extends qa{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==Fn&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class bA extends qa{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Wi extends qa{constructor(e,n,r,i){super(e,[],r,i),this.mark=n}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=Qn.renderSpec(document,n.type.spec.toDOM(n,r))),new Wi(e,n,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&sr||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return this.dirty!=sr&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Fn){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Fn}}slice(e,n,r){let i=Wi.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=_d(s,n,o,r)),e>0&&(s=_d(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}}class Gi extends qa{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a,o&&this.updateChildren(l,c)}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,h=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=Qn.renderSpec(document,n.type.spec.toDOM(n)));!h&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let d=u;return u=x0(u,r,n),c?l=new wA(e,n,r,i,u,h||null,d,c,s,o+1):n.isText?new gu(e,n,r,i,u,d,s):new Gi(e,n,r,i,u,h||null,d,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>U.empty)}return e}matchesNode(e,n,r){return this.dirty==Fn&&e.eq(this.node)&&Dd(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new EA(this,o&&o.node,e);TA(this.node,this.innerDeco,(c,u,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(u==this.node.childCount?Fe.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,h,d)=>{l.syncToMarks(c.marks,r,e);let f;l.findNodeMatch(c,u,h,d)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(f=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,h,f,e)||l.updateNextNode(c,u,h,e,d)||l.addNode(c,u,h,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Ms)&&(o&&this.protectLocalComposition(e,o),v0(this.contentDOM,this.children,e),Js&&CA(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof pe)||r<n||i>n+this.node.content.size)return null;let s=e.domSelectionRange(),o=kA(s.focusNode,s.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let a=o.nodeValue,l=IA(this.node.content,a,r-n,i-n);return l<0?null:{node:o,pos:l,text:a}}else return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new bA(this,s,n,i);e.input.compositionNodes.push(o),this.children=_d(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==sr||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Fn}updateOuterDeco(e){if(Dd(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=E0(this.dom,this.nodeDOM,Od(this.outerDeco,this.node,n),Od(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function jm(t,e,n,r,i){return x0(r,e,t),new Gi(void 0,t,e,n,r,r,r,i,0)}class gu extends Gi{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==sr||this.dirty!=Fn&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Fn||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Fn,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new gu(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=sr)}get domAtom(){return!1}}class w0 extends qa{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Fn&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class wA extends Gi{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==sr)return!1;if(this.spec.update){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function v0(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=Km(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof Wi){let l=r?r.previousSibling:t.lastChild;v0(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=Km(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Go=function(t){t&&(this.nodeName=t)};Go.prototype=Object.create(null);const Ni=[new Go];function Od(t,e,n){if(t.length==0)return Ni;let r=n?Ni[0]:new Go,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(!!o){o.nodeName&&i.push(r=new Go(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Go(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function E0(t,e,n,r){if(n==Ni&&r==Ni)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Ni[0]),i=l}vA(i,a||Ni[0],o)}return i}function vA(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function x0(t,e,n){return E0(t,t,Ni,Od(e,n,t.nodeType!=1))}function Dd(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Km(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class EA{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=xA(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Fn,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++)if(this.top.children[l].matchesMark(e[s])){a=l;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Wi.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==sr&&o.dom==o.contentDOM&&(o.dirty=Ms),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s){for(let o=this.index;o<this.top.children.length;o++){let a=this.top.children[o];if(a instanceof Gi){let l=this.preMatch.matched.get(a);if(l!=null&&l!=s)return!1;let c=a.dom;if(!(this.lock&&(c==this.lock||c.nodeType==1&&c.contains(this.lock.parentNode))&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=sr&&Dd(n,a.outerDeco)))&&a.update(e,n,r,i))return this.destroyBetween(this.index,o),a.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,n,r,i,s){this.top.children.splice(this.index++,0,Gi.create(this.top,e,n,r,i,s)),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new b0(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Wi;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof gu)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Kt||Zt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new w0(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}}function xA(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof Wi)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(!!l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function SA(t,e){return t.type.side-e.type.side}function TA(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){if(o<i.length&&i[o].to==s){let p=i[o++],g;for(;o<i.length&&i[o].to==s;)(g||(g=[p])).push(i[o++]);if(g){g.sort(SA);for(let m=0;m<g.length;m++)n(g[m],c,!!l)}else n(p,c,!!l)}let u,h;if(l)h=-1,u=l,l=null;else if(c<t.childCount)h=c,u=t.child(c++);else break;for(let p=0;p<a.length;p++)a[p].to<=s&&a.splice(p--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let d=s+u.nodeSize;if(u.isText){let p=d;o<i.length&&i[o].from<p&&(p=i[o].from);for(let g=0;g<a.length;g++)a[g].to<p&&(p=a[g].to);p<d&&(l=u.cut(p-s),u=u.cut(0,p-s),d=p,h=-1)}let f=u.isInline&&!u.isLeaf?a.filter(p=>!p.inline):a.slice();r(u,f,e.forChild(s,u),h),s=d}}function CA(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function kA(t,e){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0){if(t.childNodes.length>e&&t.childNodes[e].nodeType==3)return t.childNodes[e];t=t.childNodes[e-1],e=Jn(t)}else if(t.nodeType==1&&e<t.childNodes.length)t=t.childNodes[e],e=0;else return null}}function IA(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function _d(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function op(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(fu(n)){for(l=a;i&&!i.node;)i=i.parent;let u=i.node;if(i&&u.isAtom&&fe.isSelectable(u)&&i.parent&&!(u.isInline&&QI(n.focusNode,n.focusOffset,i.dom))){let h=i.posBefore;c=new fe(o==h?a:r.resolve(h))}}else{let u=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(u<0)return null;l=r.resolve(u)}if(!c){let u=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=ap(t,l,a,u)}return c}function S0(t){return t.editable?t.hasFocus():C0(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function gr(t,e=!1){let n=t.state.selection;if(T0(t,n),!!S0(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Zt){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&qi(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)MA(t);else{let{anchor:r,head:i}=n,s,o;qm&&!(n instanceof pe)&&(n.$from.parent.inlineContent||(s=Wm(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=Wm(t,n.to))),t.docView.setSelection(r,i,t.root,e),qm&&(s&&Gm(s),o&&Gm(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&AA(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const qm=Kt||Zt&&tA<63;function Wm(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Kt&&i&&i.contentEditable=="false")return Ah(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Ah(i);if(s)return Ah(s)}}function Ah(t){return t.contentEditable="true",Kt&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Gm(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function AA(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!S0(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function MA(t){let e=t.domSelection(),n=document.createRange(),r=t.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setEnd(r.parentNode,an(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&en&&$r<=11&&(r.disabled=!0,r.disabled=!1)}function T0(t,e){if(e instanceof fe){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Jm(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Jm(t)}function Jm(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function ap(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||pe.between(e,n,r)}function Xm(t){return t.editable&&!t.hasFocus()?!1:C0(t)}function C0(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function NA(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return qi(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Rd(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&ue.findFrom(s,e)}function Ti(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Ym(t,e,n){let r=t.state.selection;if(r instanceof pe){if(!r.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){let i=Rd(t.state,e);return i&&i instanceof fe?Ti(t,i):!1}else if(!(bn&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?fe.isSelectable(s)?Ti(t,new fe(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):pu?Ti(t,new pe(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else{if(r instanceof fe&&r.node.isInline)return Ti(t,new pe(e>0?r.$to:r.$from));{let i=Rd(t.state,e);return i?Ti(t,i):!1}}}function bc(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Jo(t){let e=t.pmViewDesc;return e&&e.size==0&&(t.nextSibling||t.nodeName!="BR")}function Mh(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for($n&&n.nodeType==1&&r<bc(n)&&Jo(n.childNodes[r])&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Jo(a))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(k0(n))break;{let a=n.previousSibling;for(;a&&Jo(a);)i=n.parentNode,s=an(a),a=a.previousSibling;if(a)n=a,r=bc(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?Ld(t,n,r):i&&Ld(t,i,s)}function Nh(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=bc(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Jo(a))s=n,o=++r;else break}else{if(k0(n))break;{let a=n.nextSibling;for(;a&&Jo(a);)s=a.parentNode,o=an(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=bc(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&Ld(t,s,o)}function k0(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Ld(t,e,n){let r=t.domSelection();if(fu(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&gr(t)},50)}function Qm(t,e,n){let r=t.state.selection;if(r instanceof pe&&!r.empty||n.indexOf("s")>-1||bn&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=Rd(t.state,e);if(o&&o instanceof fe)return Ti(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof Bn?ue.near(o,e):ue.findFrom(o,e);return a?Ti(t,a):!1}return!1}function Zm(t,e){if(!(t.state.selection instanceof pe))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function ey(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function OA(t){if(!Kt||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;ey(t,r,"true"),setTimeout(()=>ey(t,r,"false"),20)}return!1}function DA(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function _A(t,e){let n=e.keyCode,r=DA(e);return n==8||bn&&n==72&&r=="c"?Zm(t,-1)||Mh(t):n==46||bn&&n==68&&r=="c"?Zm(t,1)||Nh(t):n==13||n==27?!0:n==37||bn&&n==66&&r=="c"?Ym(t,-1,r)||Mh(t):n==39||bn&&n==70&&r=="c"?Ym(t,1,r)||Nh(t):n==38||bn&&n==80&&r=="c"?Qm(t,-1,r)||Mh(t):n==40||bn&&n==78&&r=="c"?OA(t)||Qm(t,1,r)||Nh(t):r==(bn?"m":"c")&&(n==66||n==73||n==89||n==90)}function I0(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let f=r.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),r=f.content}let o=t.someProp("clipboardSerializer")||Qn.fromSchema(t.state.schema),a=_0(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,h=0;for(;c&&c.nodeType==1&&(u=D0[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${h?` -${h}`:""} ${JSON.stringify(n)}`);let d=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:d}}function A0(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",d=>{e=d(e,s||r,t)}),s)return e?new J(U.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):J.empty;let h=t.someProp("clipboardTextParser",d=>d(e,i,r,t));if(h)a=h;else{let d=i.marks(),{schema:f}=t.state,p=Qn.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let m=o.appendChild(document.createElement("p"));g&&m.appendChild(p.serializeNode(f.text(g,d)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),o=PA(n),pu&&BA(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let d=o.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;o=d}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||qs.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!RA.test(d.parentNode.nodeName)?{ignore:!0}:null}})),u)a=FA(ty(a,+u[1],+u[2]),u[4]);else if(a=J.maxOpen(LA(a.content,i),!0),a.openStart||a.openEnd){let h=0,d=0;for(let f=a.content.firstChild;h<a.openStart&&!f.type.spec.isolating;h++,f=f.firstChild);for(let f=a.content.lastChild;d<a.openEnd&&!f.type.spec.isolating;d++,f=f.lastChild);a=ty(a,h,d)}return t.someProp("transformPasted",h=>{a=h(a,t)}),a}const RA=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function LA(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&N0(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=O0(o[o.length-1],s.length));let u=M0(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return U.from(o)}return t}function M0(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,U.from(t));return t}function N0(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=N0(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(U.from(M0(n,t,i+1))))}}function O0(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,O0(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(U.empty,!0);return t.copy(n.append(r))}function Pd(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return i<r-1&&(a=Pd(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,t.childCount>1||s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(U.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function ty(t,e,n){return e<t.openStart&&(t=new J(Pd(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new J(Pd(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const D0={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let ny=null;function _0(){return ny||(ny=document.implementation.createHTMLDocument("title"))}function PA(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=_0().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&D0[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=t,i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function BA(t){let e=t.querySelectorAll(Zt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent=="\xA0"&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function FA(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=U.from(l.create(r[a+1],i)),s++,o++}return new J(i,s,o)}const qt={},Wt={},VA={touchstart:!0,touchmove:!0};class $A{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function zA(t){for(let e in qt){let n=qt[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{HA(t,r)&&!lp(t,r)&&(t.editable||!(r.type in Wt))&&n(t,r)},VA[e]?{passive:!0}:void 0)}Kt&&t.dom.addEventListener("input",()=>null),Bd(t)}function Rr(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function UA(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function Bd(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>lp(t,r))})}function lp(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function HA(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function jA(t,e){!lp(t,e)&&qt[e.type]&&(t.editable||!(e.type in Wt))&&qt[e.type](t,e)}Wt.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!L0(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Xn&&Zt&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Js&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,As(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||_A(t,n)?n.preventDefault():Rr(t,"key")};Wt.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Wt.keypress=(t,e)=>{let n=e;if(L0(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||bn&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof pe)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode);t.someProp("handleTextInput",s=>s(t,r.$from.pos,r.$to.pos,i))||t.dispatch(t.state.tr.insertText(i).scrollIntoView()),n.preventDefault()}};function mu(t){return{left:t.clientX,top:t.clientY}}function KA(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function cp(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function $s(t,e,n){t.focused||t.focus();let r=t.state.tr.setSelection(e);n=="pointer"&&r.setMeta("pointer",!0),t.dispatch(r)}function qA(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&fe.isSelectable(r)?($s(t,new fe(n),"pointer"),!0):!1}function WA(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof fe&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(fe.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?($s(t,fe.create(t.state.doc,i),"pointer"),!0):!1}function GA(t,e,n,r,i){return cp(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?WA(t,n):qA(t,n))}function JA(t,e,n,r){return cp(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function XA(t,e,n,r){return cp(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||YA(t,n,r)}function YA(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?($s(t,pe.create(r,0,r.content.size),"pointer"),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)$s(t,pe.create(r,a+1,a+1+o.content.size),"pointer");else if(fe.isSelectable(o))$s(t,fe.create(r,a),"pointer");else continue;return!0}}function up(t){return wc(t)}const R0=bn?"metaKey":"ctrlKey";qt.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=up(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&KA(n,t.input.lastClick)&&!n[R0]&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s};let o=t.posAtCoords(mu(n));!o||(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new QA(t,o,n,!!r)):(s=="doubleClick"?JA:XA)(t,o.pos,o.inside,n)?n.preventDefault():Rr(t,"pointer"))};class QA{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[R0],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l?l.dom:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof fe&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&$n&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Rr(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>gr(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(mu(e))),this.updateAllowDefault(e),this.allowDefault||!n?Rr(this.view,"pointer"):GA(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Kt&&this.mightDrag&&!this.mightDrag.node.isAtom||Zt&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?($s(this.view,ue.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):Rr(this.view,"pointer")}move(e){this.updateAllowDefault(e),Rr(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}qt.touchstart=t=>{t.input.lastTouch=Date.now(),up(t),Rr(t,"pointer")};qt.touchmove=t=>{t.input.lastTouch=Date.now(),Rr(t,"pointer")};qt.contextmenu=t=>up(t);function L0(t,e){return t.composing?!0:Kt&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const ZA=Xn?5e3:-1;Wt.compositionstart=Wt.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),wc(t,!0),t.markCursor=null;else if(wc(t),$n&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){t.domSelection().collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}P0(t,ZA)};Wt.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,P0(t,20))};function P0(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>wc(t),e))}function B0(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=eM());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function eM(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function wc(t,e=!1){if(!(Xn&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),B0(t),e||t.docView&&t.docView.dirty){let n=op(t);return n&&!n.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(n)):t.updateState(t.state),!0}return!1}}function tM(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Xs=en&&$r<15||Js&&nA<604;qt.copy=Wt.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=Xs?null:n.clipboardData,o=r.content(),{dom:a,text:l}=I0(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):tM(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function nM(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function rM(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Fd(t,r.value,null,e):Fd(t,r.textContent,r.innerHTML,e)},50)}function Fd(t,e,n,r){let i=A0(t,e,n,t.input.shiftKey,t.state.selection.$from);if(t.someProp("handlePaste",a=>a(t,r,i||J.empty)))return!0;if(!i)return!1;let s=nM(i),o=s?t.state.tr.replaceSelectionWith(s,t.input.shiftKey):t.state.tr.replaceSelection(i);return t.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Wt.paste=(t,e)=>{let n=e;if(t.composing&&!Xn)return;let r=Xs?null:n.clipboardData;r&&Fd(t,r.getData("text/plain"),r.getData("text/html"),n)?n.preventDefault():rM(t,n)};class iM{constructor(e,n){this.slice=e,this.move=n}}const F0=bn?"altKey":"ctrlKey";qt.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(mu(n));if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof fe?i.to-1:i.to))){if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(fe.create(t.state.doc,r.mightDrag.pos)));else if(n.target&&n.target.nodeType==1){let c=t.docView.nearestDesc(n.target,!0);c&&c.node.type.spec.draggable&&c!=t.docView&&t.dispatch(t.state.tr.setSelection(fe.create(t.state.doc,c.posBefore)))}}let o=t.state.selection.content(),{dom:a,text:l}=I0(t,o);n.dataTransfer.clearData(),n.dataTransfer.setData(Xs?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",Xs||n.dataTransfer.setData("text/plain",l),t.dragging=new iM(o,!n[F0])};qt.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Wt.dragover=Wt.dragenter=(t,e)=>e.preventDefault();Wt.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(mu(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",p=>{o=p(o,t)}):o=A0(t,n.dataTransfer.getData(Xs?"Text":"text/plain"),Xs?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&!n[F0]);if(t.someProp("handleDrop",p=>p(t,n,o||J.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?n0(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;a&&c.deleteSelection();let u=c.mapping.map(l),h=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,d=c.doc;if(h?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(d))return;let f=c.doc.resolve(u);if(h&&fe.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new fe(f));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((g,m,w,D)=>p=D),c.setSelection(ap(t,f,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};qt.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&gr(t)},20))};qt.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};qt.beforeinput=(t,e)=>{if(Zt&&Xn&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,As(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Wt)qt[t]=Wt[t];function ma(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class hp{constructor(e,n){this.toDOM=e,this.spec=n||Fi,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new zt(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof hp&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&ma(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class zr{constructor(e,n){this.attrs=e,this.spec=n||Fi}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new zt(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof zr&&ma(this.attrs,e.attrs)&&ma(this.spec,e.spec)}static is(e){return e.type instanceof zr}destroy(){}}class dp{constructor(e,n){this.attrs=e,this.spec=n||Fi}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new zt(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof dp&&ma(this.attrs,e.attrs)&&ma(this.spec,e.spec)}destroy(){}}class zt{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new zt(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new zt(e,e,new hp(n,r))}static inline(e,n,r,i){return new zt(e,n,new zr(r,i))}static node(e,n,r,i){return new zt(e,n,new dp(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof zr}}const Ss=[],Fi={};class Ze{constructor(e,n){this.local=e.length?e:Ss,this.children=n.length?n:Ss}static create(e,n){return n.length?vc(n,e,0,Fi):It}find(e,n,r){let i=[];return this.findInner(e==null?0:e,n==null?1e9:n,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==It||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Fi)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?sM(this.children,o||[],e,n,r,i,s):o?new Ze(o.sort(Vi),Ss):It}add(e,n){return n.length?this==It?Ze.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(!!(u=$0(n,a,c))){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,vc(u,a,c+1,Fi)),s+=3}});let o=V0(s?z0(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Ze(o.length?this.local.concat(o).sort(Vi):this.local,i||this.children)}remove(e){return e.length==0||this==It?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>a&&h.to<l&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=It?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new Ze(i,r):It}forChild(e,n){if(this==It)return this;if(n.isLeaf)return Ze.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof zr){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new Ze(i.sort(Vi),Ss);return r?new Mr([a,r]):a}return r||It}eq(e){if(this==e)return!0;if(!(e instanceof Ze)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return fp(this.localsInner(e))}localsInner(e){if(this==It)return Ss;if(e.inlineContent||!this.local.some(zr.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof zr||n.push(this.local[r]);return n}}Ze.empty=new Ze([],[]);Ze.removeOverlap=fp;const It=Ze.empty;class Mr{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,Fi));return Mr.from(r)}forChild(e,n){if(n.isLeaf)return Ze.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=It&&(s instanceof Mr?r=r.concat(s.members):r.push(s))}return Mr.from(r)}eq(e){if(!(e instanceof Mr)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(!!s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?fp(r?n:n.sort(Vi)):Ss}static from(e){switch(e.length){case 0:return It;case 1:return e[0];default:return new Mr(e)}}}function sM(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let h=0;n.maps[c].forEach((d,f,p,g)=>{let m=g-p-(f-d);for(let w=0;w<a.length;w+=3){let D=a[w+1];if(D<0||d>D+u-h)continue;let P=a[w]+u-h;f>=P?a[w+1]=d<=P?-2:-1:p>=i&&m&&(a[w]+=m,a[w+1]+=m)}h+=m}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),h=u-i;if(h<0||h>=r.content.size){l=!0;continue}let d=n.map(t[c+1]+s,-1),f=d-i,{index:p,offset:g}=r.content.findIndex(h),m=r.maybeChild(p);if(m&&g==h&&g+m.nodeSize==f){let w=a[c+2].mapInner(n,m,u+1,t[c]+s+1,o);w!=It?(a[c]=h,a[c+1]=f,a[c+2]=w):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=oM(a,t,e,n,i,s,o),u=vc(c,r,0,o);e=u.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,d=0;h<u.children.length;h+=3){let f=u.children[h];for(;d<a.length&&a[d]<f;)d+=3;a.splice(d,0,u.children[h],u.children[h+1],u.children[h+2])}}return new Ze(e.sort(Vi),a)}function V0(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new zt(i.from+e,i.to+e,i.type))}return n}function oM(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let h=l.local[u].map(r,i,c);h?n.push(h):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function $0(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function z0(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function vc(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=$0(t,a,l+n);if(c){s=!0;let u=vc(c,a,n+l+1,r);u!=It&&i.push(l,l+a.nodeSize,u)}});let o=V0(s?z0(t):t,-n).sort(Vi);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new Ze(o,i):It}function Vi(t,e){return t.from-e.from||t.to-e.to}function fp(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),ry(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),ry(e,i,r.copy(s.from,r.to)));break}}}return e}function ry(t,e,n){for(;e<t.length&&Vi(n,t[e])>0;)e++;t.splice(e,0,n)}function Oh(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=It&&e.push(r)}),t.cursorWrapper&&e.push(Ze.create(t.state.doc,[t.cursorWrapper.deco])),Mr.from(e)}const aM={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},lM=en&&$r<=11;class cM{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class uM{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new cM,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);en&&$r<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),lM&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,aM)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(!!Xm(this.view)){if(this.suppressingSelectionUpdates)return gr(this.view);if(en&&$r<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&qi(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=ga(s))n.add(s);for(let s=e.anchorNode;s;s=ga(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.observer?this.observer.takeRecords():[];this.queue.length&&(n=this.queue.concat(n),this.queue.length=0);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Xm(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let h=this.registerMutation(n[u],l);h&&(s=s<0?h.from:Math.min(h.from,s),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if($n&&l.length>1){let u=l.filter(h=>h.nodeName=="BR");if(u.length==2){let h=u[0],d=u[1];h.parentNode&&h.parentNode.parentNode==d.parentNode?d.remove():h.remove()}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&e.input.lastTouch<Date.now()-300&&fu(r)&&(c=op(e))&&c.eq(ue.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,gr(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),hM(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||gr(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++)n.push(e.addedNodes[u]);if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(en&&$r<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:d}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h),(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(s=d)}let o=i&&i.parentNode==e.target?an(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?an(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let iy=new WeakMap,sy=!1;function hM(t){if(!iy.has(t)&&(iy.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=$n,sy)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),sy=!0}}function dM(t){let e;function n(l){l.preventDefault(),l.stopImmediatePropagation(),e=l.getTargetRanges()[0]}t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0);let r=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return qi(a.node,a.offset,s,o)&&([r,i,s,o]=[s,o,r,i]),{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}}function fM(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],fu(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Zt&&t.input.lastKeyCode===8)for(let m=s;m>i;m--){let w=r.childNodes[m-1],D=w.pmViewDesc;if(w.nodeName=="BR"&&!D){s=m;break}if(!D||D.size)break}let h=t.state.doc,d=t.someProp("domParser")||qs.fromSchema(t.state.schema),f=h.resolve(o),p=null,g=d.parse(r,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:i,to:s,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:pM,context:f});if(c&&c[0].pos!=null){let m=c[0].pos,w=c[1]&&c[1].pos;w==null&&(w=m),p={anchor:m+o,head:w+o}}return{doc:g,sel:p,from:o,to:a}}function pM(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Kt&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Kt&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}function gM(t,e,n,r,i){if(e<0){let _=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,Z=op(t,_);if(Z&&!t.state.selection.eq(Z)){let ie=t.state.tr.setSelection(Z);_=="pointer"?ie.setMeta("pointer",!0):_=="key"&&ie.scrollIntoView(),t.dispatch(ie)}return}let s=t.state.doc.resolve(e),o=s.sharedDepth(n);e=s.before(o+1),n=t.state.doc.resolve(n).after(o+1);let a=t.state.selection,l=fM(t,e,n),c=t.state.doc,u=c.slice(l.from,l.to),h,d;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,d="end"):(h=t.state.selection.from,d="start"),t.input.lastKeyCode=null;let f=bM(u.content,l.doc.content,l.from,h,d);if((Js&&t.input.lastIOSEnter>Date.now()-225||Xn)&&i.some(_=>_.nodeName=="DIV"||_.nodeName=="P"||_.nodeName=="LI")&&(!f||f.endA>=f.endB)&&t.someProp("handleKeyDown",_=>_(t,As(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!f)if(r&&a instanceof pe&&!a.empty&&a.$head.sameParent(a.$anchor)&&!t.composing&&!(l.sel&&l.sel.anchor!=l.sel.head))f={start:a.from,endA:a.to,endB:a.to};else{if(l.sel){let _=oy(t,t.state.doc,l.sel);_&&!_.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(_))}return}if(Zt&&t.cursorWrapper&&l.sel&&l.sel.anchor==t.cursorWrapper.deco.from&&l.sel.head==l.sel.anchor){let _=f.endB-f.start;l.sel={anchor:l.sel.anchor+_,head:l.sel.anchor+_}}t.input.domChangeCount++,t.state.selection.from<t.state.selection.to&&f.start==f.endB&&t.state.selection instanceof pe&&(f.start>t.state.selection.from&&f.start<=t.state.selection.from+2&&t.state.selection.from>=l.from?f.start=t.state.selection.from:f.endA<t.state.selection.to&&f.endA>=t.state.selection.to-2&&t.state.selection.to<=l.to&&(f.endB+=t.state.selection.to-f.endA,f.endA=t.state.selection.to)),en&&$r<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>l.from&&l.doc.textBetween(f.start-l.from-1,f.start-l.from+1)==" \xA0"&&(f.start--,f.endA--,f.endB--);let p=l.doc.resolveNoCache(f.start-l.from),g=l.doc.resolveNoCache(f.endB-l.from),m=c.resolve(f.start),w=p.sameParent(g)&&p.parent.inlineContent&&m.end()>=f.endA,D;if((Js&&t.input.lastIOSEnter>Date.now()-225&&(!w||i.some(_=>_.nodeName=="DIV"||_.nodeName=="P"))||!w&&p.pos<l.doc.content.size&&(D=ue.findFrom(l.doc.resolve(p.pos+1),1,!0))&&D.head==g.pos)&&t.someProp("handleKeyDown",_=>_(t,As(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>f.start&&yM(c,f.start,f.endA,p,g)&&t.someProp("handleKeyDown",_=>_(t,As(8,"Backspace")))){Xn&&Zt&&t.domObserver.suppressSelectionUpdates();return}Zt&&Xn&&f.endB==f.start&&(t.input.lastAndroidDelete=Date.now()),Xn&&!w&&p.start()!=g.start()&&g.parentOffset==0&&p.depth==g.depth&&l.sel&&l.sel.anchor==l.sel.head&&l.sel.head==f.endA&&(f.endB-=2,g=l.doc.resolveNoCache(f.endB-l.from),setTimeout(()=>{t.someProp("handleKeyDown",function(_){return _(t,As(13,"Enter"))})},20));let P=f.start,y=f.endA,F,R,K;if(w){if(p.pos==g.pos)en&&$r<=11&&p.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>gr(t),20)),F=t.state.tr.delete(P,y),R=c.resolve(f.start).marksAcross(c.resolve(f.endA));else if(f.endA==f.endB&&(K=mM(p.parent.content.cut(p.parentOffset,g.parentOffset),m.parent.content.cut(m.parentOffset,f.endA-m.start()))))F=t.state.tr,K.type=="add"?F.addMark(P,y,K.mark):F.removeMark(P,y,K.mark);else if(p.parent.child(p.index()).isText&&p.index()==g.index()-(g.textOffset?0:1)){let _=p.parent.textBetween(p.parentOffset,g.parentOffset);if(t.someProp("handleTextInput",Z=>Z(t,P,y,_)))return;F=t.state.tr.insertText(_,P,y)}}if(F||(F=t.state.tr.replace(P,y,l.doc.slice(f.start-l.from,f.endB-l.from))),l.sel){let _=oy(t,F.doc,l.sel);_&&!(Zt&&Xn&&t.composing&&_.empty&&(f.start!=f.endB||t.input.lastAndroidDelete<Date.now()-100)&&(_.head==P||_.head==F.mapping.map(y)-1)||en&&_.empty&&_.head==P)&&F.setSelection(_)}R&&F.ensureMarks(R),t.dispatch(F.scrollIntoView())}function oy(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:ap(t,e.resolve(n.anchor),e.resolve(n.head))}function mM(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(U.from(c).eq(t))return{mark:a,type:o}}function yM(t,e,n,r,i){if(!r.parent.isTextblock||n-e<=i.pos-r.pos||Dh(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(Dh(s,!0,!0));return!o.parent.isTextblock||o.pos>n||Dh(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function Dh(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function bM(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}return o<s&&t.size<e.size?(s-=r<=s&&r>=o?s-r:0,a=s+(a-o),o=s):a<s&&(s-=r<=s&&r>=a?s-r:0,o=s+(o-a),a=s),{start:s,endA:o,endB:a}}class wM{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new $A,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(hy),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=cy(this),ly(this),this.nodeViews=uy(this),this.docView=jm(this.state.doc,ay(this),Oh(this),this.dom,this),this.domObserver=new uM(this,(r,i,s,o)=>gM(this,r,i,s,o)),this.domObserver.start(),zA(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Bd(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(hy),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){let r=this.state,i=!1,s=!1;e.storedMarks&&this.composing&&(B0(this),s=!0),this.state=e;let o=r.plugins!=e.plugins||this._props.plugins!=n.plugins;if(o||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let d=uy(this);EM(d,this.nodeViews)&&(this.nodeViews=d,i=!0)}(o||n.handleDOMEvents!=this._props.handleDOMEvents)&&Bd(this),this.editable=cy(this),ly(this);let a=Oh(this),l=ay(this),c=r.plugins!=e.plugins&&!r.doc.eq(e.doc)?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",u=i||!this.docView.matchesNode(e.doc,l,a);(u||!e.selection.eq(r.selection))&&(s=!0);let h=c=="preserve"&&s&&this.dom.style.overflowAnchor==null&&sA(this);if(s){this.domObserver.stop();let d=u&&(en||Zt)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&vM(r.selection,e.selection);if(u){let f=Zt?this.trackWrites=this.domSelectionRange().focusNode:null;(i||!this.docView.update(e.doc,l,a,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=jm(e.doc,l,a,this.dom,this)),f&&!this.trackWrites&&(d=!0)}d||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&NA(this))?gr(this,d):(T0(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),c=="reset"?this.dom.scrollTop=0:c=="to selection"?this.scrollToSelection():h&&oA(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof fe){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&Vm(this,n.getBoundingClientRect(),e)}else Vm(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(en){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&aA(this.dom),gr(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}posAtCoords(e){return dA(this,e)}coordsAtPos(e,n=1){return m0(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return yA(this,n||this.state,e)}destroy(){!this.docView||(UA(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Oh(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return this.docView==null}dispatchEvent(e){return jA(this,e)}dispatch(e){let n=this._props.dispatchTransaction;n?n.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return Kt&&this.root.nodeType===11&&eA(this.dom.ownerDocument)==this.dom?dM(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function ay(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"&&(e.class+=" "+n[r]),r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),[zt.node(0,t.state.doc.content.size,e)]}function ly(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:zt.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function cy(t){return!t.someProp("editable",e=>e(t.state)===!1)}function vM(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function uy(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function EM(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function hy(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Xr={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ec={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},dy=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent);typeof navigator<"u"&&/Gecko\/\d+/.test(navigator.userAgent);var xM=typeof navigator<"u"&&/Mac/.test(navigator.platform),SM=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),TM=xM||dy&&+dy[1]<57;for(var vt=0;vt<10;vt++)Xr[48+vt]=Xr[96+vt]=String(vt);for(var vt=1;vt<=24;vt++)Xr[vt+111]="F"+vt;for(var vt=65;vt<=90;vt++)Xr[vt]=String.fromCharCode(vt+32),Ec[vt]=String.fromCharCode(vt);for(var _h in Xr)Ec.hasOwnProperty(_h)||(Ec[_h]=Xr[_h]);function CM(t){var e=TM&&(t.ctrlKey||t.altKey||t.metaKey)||SM&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Ec:Xr)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const kM=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function IM(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))kM?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function AM(t){let e=Object.create(null);for(let n in t)e[IM(n)]=t[n];return e}function Rh(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n!==!1&&e.shiftKey&&(t="Shift-"+t),t}function MM(t){return new St({props:{handleKeyDown:pp(t)}})}function pp(t){let e=AM(t);return function(n,r){let i=CM(r),s=i.length==1&&i!=" ",o,a=e[Rh(i,r,!s)];if(a&&a(n.state,n.dispatch,n))return!0;if(s&&(r.shiftKey||r.altKey||r.metaKey||i.charCodeAt(0)>127)&&(o=Xr[r.keyCode])&&o!=i){let l=e[Rh(o,r,!0)];if(l&&l(n.state,n.dispatch,n))return!0}else if(s&&r.shiftKey){let l=e[Rh(i,r,!0)];if(l&&l(n.state,n.dispatch,n))return!0}return!1}}const NM=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0),OM=(t,e,n)=>{let{$cursor:r}=t.selection;if(!r||(n?!n.endOfTextblock("backward",t):r.parentOffset>0))return!1;let i=U0(r);if(!i){let o=r.blockRange(),a=o&&mo(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(!s.type.spec.isolating&&K0(t,i,e))return!0;if(r.parent.content.size==0&&(Ys(s,"end")||fe.isSelectable(s))){let o=rp(t.doc,r.before(),r.after(),J.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Ys(s,"end")?ue.findFrom(a.doc.resolve(a.mapping.map(i.pos,-1)),-1):fe.create(a.doc,i.pos-s.nodeSize)),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1};function Ys(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const DM=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=U0(r)}let o=s&&s.nodeBefore;return!o||!fe.isSelectable(o)?!1:(e&&e(t.tr.setSelection(fe.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function U0(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}const _M=(t,e,n)=>{let{$cursor:r}=t.selection;if(!r||(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size))return!1;let i=H0(r);if(!i)return!1;let s=i.nodeAfter;if(K0(t,i,e))return!0;if(r.parent.content.size==0&&(Ys(s,"start")||fe.isSelectable(s))){let o=rp(t.doc,r.before(),r.after(),J.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Ys(s,"start")?ue.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):fe.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},RM=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=H0(r)}let o=s&&s.nodeAfter;return!o||!fe.isSelectable(o)?!1:(e&&e(t.tr.setSelection(fe.create(t.doc,s.pos)).scrollIntoView()),!0)};function H0(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const LM=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&mo(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},PM=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function j0(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const BM=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=j0(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(ue.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},FM=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof Bn||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=j0(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(pe.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},VM=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(Fs(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&mo(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)},$M=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(fe.create(t.doc,i))),!0)};function zM(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||yo(t.doc,e.pos))?!1:(n&&n(t.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0)}function K0(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s,o;if(r.type.spec.isolating||i.type.spec.isolating)return!1;if(zM(t,e,n))return!0;let a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(s=(o=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&o.matchType(s[0]||i.type).validEnd){if(n){let h=e.pos+i.nodeSize,d=U.empty;for(let g=s.length-1;g>=0;g--)d=U.from(s[g].create(null,d));d=U.from(r.copy(d));let f=t.tr.step(new lt(e.pos-1,h,e.pos,h,new J(d,1,0),s.length,!0)),p=h+2*s.length;yo(f.doc,p)&&f.join(p),n(f.scrollIntoView())}return!0}let l=ue.findFrom(e,1),c=l&&l.$from.blockRange(l.$to),u=c&&mo(c);if(u!=null&&u>=e.depth)return n&&n(t.tr.lift(c,u).scrollIntoView()),!0;if(a&&Ys(i,"start",!0)&&Ys(r,"end")){let h=r,d=[];for(;d.push(h),!h.isTextblock;)h=h.lastChild;let f=i,p=1;for(;!f.isTextblock;f=f.firstChild)p++;if(h.canReplace(h.childCount,h.childCount,f.content)){if(n){let g=U.empty;for(let w=d.length-1;w>=0;w--)g=U.from(d[w].copy(g));let m=t.tr.step(new lt(e.pos-d.length,e.pos+i.nodeSize,e.pos+p,e.pos+i.nodeSize-p,new J(g,d.length,0),0,!0));n(m.scrollIntoView())}return!0}}return!1}function q0(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(pe.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const UM=q0(-1),HM=q0(1);function jM(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&np(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function fy(t,e=null){return function(n,r){let{from:i,to:s}=n.selection,o=!1;return n.doc.nodesBetween(i,s,(a,l)=>{if(o)return!1;if(!(!a.isTextblock||a.hasMarkup(t,e)))if(a.type==t)o=!0;else{let c=n.doc.resolve(l),u=c.index();o=c.parent.canReplaceWith(u,u+1,t)}}),o?(r&&r(n.tr.setBlockType(i,s,t,e).scrollIntoView()),!0):!1}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function KM(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=!1,l=o;if(!o)return!1;if(o.depth>=2&&i.node(o.depth-1).type.compatibleContent(t)&&o.startIndex==0){if(i.index(o.depth-1)==0)return!1;let u=n.doc.resolve(o.start-2);l=new fc(u,u,o.depth),o.endIndex<o.parent.childCount&&(o=new fc(i,n.doc.resolve(s.end(o.depth)),o.depth)),a=!0}let c=np(l,t,e,o);return c?(r&&r(qM(n.tr,o,c,a,t).scrollIntoView()),!0):!1}}function qM(t,e,n,r,i){let s=U.empty;for(let u=n.length-1;u>=0;u--)s=U.from(n[u].type.create(n[u].attrs,s));t.step(new lt(e.start-(r?2:0),e.end,e.start,e.end,new J(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,h=e.endIndex,d=!0;u<h;u++,d=!1)!d&&Fs(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function WM(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?GM(e,n,t,s):JM(e,n,s):!0:!1}}function GM(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new lt(s-1,o,s,o,new J(U.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new fc(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=mo(r);if(a==null)return!1;i.lift(r,a);let l=i.mapping.map(s,-1)-1;return yo(i.doc,l)&&i.join(l),e(i.scrollIntoView()),!0}function JM(t,e,n){let r=t.tr,i=n.parent;for(let f=n.end,p=n.endIndex-1,g=n.startIndex;p>g;p--)f-=i.child(p).nodeSize,r.delete(f-1,f+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?U.empty:U.from(i))))return!1;let h=s.pos,d=h+o.nodeSize;return r.step(new lt(h-(a?1:0),d+(l?1:0),h+1,d-1,new J((a?U.empty:U.from(i.copy(U.empty))).append(l?U.empty:U.from(i.copy(U.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function XM(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=U.from(c?t.create():null),h=new J(U.from(t.create(null,U.from(a.type.create(null,u)))),c?3:1,0),d=s.start,f=s.end;n(e.tr.step(new lt(d-(c?3:1),f,d,f,h,1,!0)).scrollIntoView())}return!0}}function yu(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),filterTransaction:e.filterTransaction,plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}class bu{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:i}=n,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const h=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(d=>d===!0)),h={...Object.fromEntries(Object.entries(r).map(([d,f])=>[d,(...g)=>{const m=this.buildProps(c,n),w=f(...g)(m);return a.push(w),h}])),run:u};return h}createCan(e){const{rawCommands:n,state:r}=this,i=!1,s=e||r.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i;s.storedMarks&&e.setStoredMarks(s.storedMarks);const a={tr:e,editor:i,view:o,state:yu({state:s,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class YM{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(i=>i!==n):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function re(t,e,n){return t.config[e]===void 0&&t.parent?re(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?re(t.parent,e,n):null}):t.config[e]}function wu(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function W0(t){const e=[],{nodeExtensions:n,markExtensions:r}=wu(t),i=[...n,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=re(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([d,f])=>{e.push({type:h,name:d,attribute:{...s,...f}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=re(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,h])=>{const d={...s,...h};(h==null?void 0:h.isRequired)&&(h==null?void 0:h.default)===void 0&&delete d.default,e.push({type:o.name,name:u,attribute:d})})}),e}function ut(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function st(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}i==="class"?r[i]=[r[i],s].join(" "):i==="style"?r[i]=[r[i],s].join("; "):r[i]=s}),r},{})}function Vd(t,e){return e.filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>st(n,r),{})}function G0(t){return typeof t=="function"}function Se(t,e=void 0,...n){return G0(t)?e?t.bind(e)(...n):t(...n):t}function QM(t={}){return Object.keys(t).length===0&&t.constructor===Object}function ZM(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function py(t,e){return t.style?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):ZM(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function gy(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&QM(n)?!1:n!=null))}function eN(t){var e;const n=W0(t),{nodeExtensions:r,markExtensions:i}=wu(t),s=(e=r.find(l=>re(l,"topNode")))===null||e===void 0?void 0:e.name,o=Object.fromEntries(r.map(l=>{const c=n.filter(m=>m.type===l.name),u={name:l.name,options:l.options,storage:l.storage},h=t.reduce((m,w)=>{const D=re(w,"extendNodeSchema",u);return{...m,...D?D(l):{}}},{}),d=gy({...h,content:Se(re(l,"content",u)),marks:Se(re(l,"marks",u)),group:Se(re(l,"group",u)),inline:Se(re(l,"inline",u)),atom:Se(re(l,"atom",u)),selectable:Se(re(l,"selectable",u)),draggable:Se(re(l,"draggable",u)),code:Se(re(l,"code",u)),defining:Se(re(l,"defining",u)),isolating:Se(re(l,"isolating",u)),attrs:Object.fromEntries(c.map(m=>{var w;return[m.name,{default:(w=m==null?void 0:m.attribute)===null||w===void 0?void 0:w.default}]}))}),f=Se(re(l,"parseHTML",u));f&&(d.parseDOM=f.map(m=>py(m,c)));const p=re(l,"renderHTML",u);p&&(d.toDOM=m=>p({node:m,HTMLAttributes:Vd(m,c)}));const g=re(l,"renderText",u);return g&&(d.toText=g),[l.name,d]})),a=Object.fromEntries(i.map(l=>{const c=n.filter(g=>g.type===l.name),u={name:l.name,options:l.options,storage:l.storage},h=t.reduce((g,m)=>{const w=re(m,"extendMarkSchema",u);return{...g,...w?w(l):{}}},{}),d=gy({...h,inclusive:Se(re(l,"inclusive",u)),excludes:Se(re(l,"excludes",u)),group:Se(re(l,"group",u)),spanning:Se(re(l,"spanning",u)),code:Se(re(l,"code",u)),attrs:Object.fromEntries(c.map(g=>{var m;return[g.name,{default:(m=g==null?void 0:g.attribute)===null||m===void 0?void 0:m.default}]}))}),f=Se(re(l,"parseHTML",u));f&&(d.parseDOM=f.map(g=>py(g,c)));const p=re(l,"renderHTML",u);return p&&(d.toDOM=g=>p({mark:g,HTMLAttributes:Vd(g,c)})),[l.name,d]}));return new bI({topNode:s,nodes:o,marks:a})}function Lh(t,e){return e.nodes[t]||e.marks[t]||null}function my(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}const tN=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;n+=(((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%").slice(0,Math.max(0,r-s))}),n};function gp(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class vu{constructor(e){this.find=e.find,this.handler=e.handler}}const nN=(t,e)=>{if(gp(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[];return r.push(n.text),r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Ph(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!!(!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(d=>d.type.spec.code)))return!1;let u=!1;const h=tN(c)+s;return o.forEach(d=>{if(u)return;const f=nN(h,d.find);if(!f)return;const p=l.state.tr,g=yu({state:l.state,transaction:p}),m={from:r-(f[0].length-s.length),to:i},{commands:w,chain:D,can:P}=new bu({editor:n,state:g});d.handler({state:g,range:m,match:f,commands:w,chain:D,can:P})===null||!p.steps.length||(p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function rN(t){const{editor:e,rules:n}=t,r=new St({state:{init(){return null},apply(i,s){const o=i.getMeta(r);return o||(i.selectionSet||i.docChanged?null:s)}},props:{handleTextInput(i,s,o,a){return Ph({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&Ph({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?Ph({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function iN(t){return typeof t=="number"}class sN{constructor(e){this.find=e.find,this.handler=e.handler}}const oN=(t,e)=>{if(gp(e))return[...t.matchAll(e)];const n=e(t);return n?n.map(r=>{const i=[];return i.push(r.text),i.index=r.index,i.input=t,i.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(r.replaceWith)),i}):[]};function aN(t){const{editor:e,state:n,from:r,to:i,rule:s}=t,{commands:o,chain:a,can:l}=new bu({editor:e,state:n}),c=[];return n.doc.nodesBetween(r,i,(h,d)=>{if(!h.isTextblock||h.type.spec.code)return;const f=Math.max(r,d),p=Math.min(i,d+h.content.size),g=h.textBetween(f-d,p-d,void 0,"\uFFFC");oN(g,s.find).forEach(w=>{if(w.index===void 0)return;const D=f+w.index+1,P=D+w[0].length,y={from:n.tr.mapping.map(D),to:n.tr.mapping.map(P)},F=s.handler({state:n,range:y,match:w,commands:o,chain:a,can:l});c.push(F)})}),c.every(h=>h!==null)}function lN(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1;return n.map(a=>new St({view(l){const c=u=>{var h;r=!((h=l.dom.parentElement)===null||h===void 0)&&h.contains(u.target)?l.dom.parentElement:null};return window.addEventListener("dragstart",c),{destroy(){window.removeEventListener("dragstart",c)}}},props:{handleDOMEvents:{drop:l=>(s=r===l.dom.parentElement,!1),paste:(l,c)=>{var u;const h=(u=c.clipboardData)===null||u===void 0?void 0:u.getData("text/html");return i=!!(h!=null&&h.includes("data-pm-slice")),!1}}},appendTransaction:(l,c,u)=>{const h=l[0],d=h.getMeta("uiEvent")==="paste"&&!i,f=h.getMeta("uiEvent")==="drop"&&!s;if(!d&&!f)return;const p=c.doc.content.findDiffStart(u.doc.content),g=c.doc.content.findDiffEnd(u.doc.content);if(!iN(p)||!g||p===g.b)return;const m=u.tr,w=yu({state:u,transaction:m});if(!(!aN({editor:e,state:w,from:Math.max(p-1,0),to:g.b-1,rule:a})||!m.steps.length))return m}}))}function cN(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return[...new Set(e)]}class Ns{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=Ns.resolve(e),this.schema=eN(this.extensions),this.extensions.forEach(r=>{var i;this.editor.extensionStorage[r.name]=r.storage;const s={name:r.name,options:r.options,storage:r.storage,editor:this.editor,type:Lh(r.name,this.schema)};r.type==="mark"&&((i=Se(re(r,"keepOnSplit",s)))!==null&&i!==void 0?i:!0)&&this.splittableMarks.push(r.name);const o=re(r,"onBeforeCreate",s);o&&this.editor.on("beforeCreate",o);const a=re(r,"onCreate",s);a&&this.editor.on("create",a);const l=re(r,"onUpdate",s);l&&this.editor.on("update",l);const c=re(r,"onSelectionUpdate",s);c&&this.editor.on("selectionUpdate",c);const u=re(r,"onTransaction",s);u&&this.editor.on("transaction",u);const h=re(r,"onFocus",s);h&&this.editor.on("focus",h);const d=re(r,"onBlur",s);d&&this.editor.on("blur",d);const f=re(r,"onDestroy",s);f&&this.editor.on("destroy",f)})}static resolve(e){const n=Ns.sort(Ns.flatten(e)),r=cN(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=re(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(e){return e.sort((r,i)=>{const s=re(r,"priority")||100,o=re(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:Lh(n.name,this.schema)},i=re(n,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,n=Ns.sort([...this.extensions].reverse()),r=[],i=[],s=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:Lh(o.name,this.schema)},l=[],c=re(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&o.config.exitable&&(u.ArrowRight=()=>Yr.handleExit({editor:e,mark:o})),c){const g=Object.fromEntries(Object.entries(c()).map(([m,w])=>[m,()=>w({editor:e})]));u={...u,...g}}const h=MM(u);l.push(h);const d=re(o,"addInputRules",a);my(o,e.options.enableInputRules)&&d&&r.push(...d());const f=re(o,"addPasteRules",a);my(o,e.options.enablePasteRules)&&f&&i.push(...f());const p=re(o,"addProseMirrorPlugins",a);if(p){const g=p();l.push(...g)}return l}).flat();return[rN({editor:e,rules:r}),...lN({editor:e,rules:i}),...s]}get attributes(){return W0(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=wu(this.extensions);return Object.fromEntries(n.filter(r=>!!re(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),s={name:r.name,options:r.options,storage:r.storage,editor:e,type:ut(r.name,this.schema)},o=re(r,"addNodeView",s);if(!o)return[];const a=(l,c,u,h)=>{const d=Vd(l,i);return o()({editor:e,node:l,getPos:u,decorations:h,HTMLAttributes:d,extension:r})};return[r.name,a]}))}}function uN(t){return Object.prototype.toString.call(t).slice(8,-1)}function Bh(t){return uN(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Eu(t,e){const n={...t};return Bh(t)&&Bh(e)&&Object.keys(e).forEach(r=>{Bh(e[r])?r in t?n[r]=Eu(t[r],e[r]):Object.assign(n,{[r]:e[r]}):Object.assign(n,{[r]:e[r]})}),n}class Gt{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Se(re(this,"addOptions",{name:this.name}))),this.storage=Se(re(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Gt(e)}configure(e={}){const n=this.extend();return n.options=Eu(this.options,e),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new Gt(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Se(re(n,"addOptions",{name:n.name})),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}}function J0(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="",l=!0;return t.nodesBetween(r,i,(c,u,h,d)=>{var f;const p=o==null?void 0:o[c.type.name];p?(c.isBlock&&!l&&(a+=s,l=!0),h&&(a+=p({node:c,pos:u,parent:h,index:d,range:e}))):c.isText?(a+=(f=c==null?void 0:c.text)===null||f===void 0?void 0:f.slice(Math.max(r,u)-u,i-u),l=!1):c.isBlock&&!l&&(a+=s,l=!0)}),a}function X0(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const hN=Gt.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new St({key:new sn("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=X0(n);return J0(r,{from:o,to:a},{textSerializers:l})}}})]}}),dN=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),fN=(t=!1)=>({commands:e})=>e.setContent("",t),pN=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,h=c.resolve(u.map(l)),d=c.resolve(u.map(l+a.nodeSize)),f=h.blockRange(d);if(!f)return;const p=mo(f);if(a.type.isTextblock){const{defaultType:g}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(f.start,g)}(p||p===0)&&e.lift(f,p)})}),!0},gN=t=>e=>t(e),mN=()=>({state:t,dispatch:e})=>FM(t,e),yN=t=>({tr:e,state:n,dispatch:r})=>{const i=ut(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},bN=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},wN=()=>({state:t,dispatch:e})=>NM(t,e),vN=()=>({commands:t})=>t.keyboardShortcut("Enter"),EN=()=>({state:t,dispatch:e})=>BM(t,e);function xc(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:gp(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function $d(t,e,n={}){return t.find(r=>r.type===e&&xc(r.attrs,n))}function xN(t,e,n={}){return!!$d(t,e,n)}function mp(t,e,n={}){if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if(t.parentOffset===r.offset&&r.offset!==0&&(r=t.parent.childBefore(t.parentOffset)),!r.node)return;const i=$d([...r.node.marks],e,n);if(!i)return;let s=r.index,o=t.start()+r.offset,a=s+1,l=o+r.node.nodeSize;for($d([...r.node.marks],e,n);s>0&&i.isInSet(t.parent.child(s-1).marks);)s-=1,o-=t.parent.child(s).nodeSize;for(;a<t.parent.childCount&&xN([...t.parent.child(a).marks],e,n);)l+=t.parent.child(a).nodeSize,a+=1;return{from:o,to:l}}function ri(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const SN=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=ri(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const h=mp(l,s,e);if(h&&h.from<=c&&h.to>=u){const d=pe.create(o,h.from,h.to);n.setSelection(d)}}return!0},TN=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function yp(t){return t instanceof pe}function dr(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Y0(t,e=null){if(!e)return null;const n=ue.atStart(t),r=ue.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?pe.create(t,dr(0,i,s),dr(t.content.size,i,s)):pe.create(t,dr(e,i,s),dr(e,i,s))}function bp(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const CN=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{bp()&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!yp(n.state.selection))return o(),!0;const a=Y0(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},kN=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),IN=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e);function yy(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function Sc(t,e,n){if(n={slice:!0,parseOptions:{},...n},typeof t=="object"&&t!==null)try{return Array.isArray(t)?U.fromArray(t.map(r=>e.nodeFromJSON(r))):e.nodeFromJSON(t)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",r),Sc("",e,n)}if(typeof t=="string"){const r=qs.fromSchema(e);return n.slice?r.parseSlice(yy(t),n.parseOptions).content:r.parse(yy(t),n.parseOptions)}return Sc("",e,n)}function AN(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof At||i instanceof lt))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(ue.near(t.doc.resolve(o),n))}const MN=t=>t.toString().startsWith("<"),NN=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{if(i){n={parseOptions:{},updateSelection:!0,...n};const o=Sc(e,s.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if(o.toString()==="<>")return!0;let{from:a,to:l}=typeof t=="number"?{from:t,to:t}:t,c=!0,u=!0;if((MN(o)?o:[o]).forEach(d=>{d.check(),c=c?d.isText&&d.marks.length===0:!1,u=u?d.isBlock:!1}),a===l&&u){const{parent:d}=r.doc.resolve(a);d.isTextblock&&!d.type.spec.code&&!d.childCount&&(a-=1,l+=1)}c?r.insertText(e,a,l):r.replaceWith(a,l,o),n.updateSelection&&AN(r,r.steps.length-1,-1)}return!0},ON=()=>({state:t,dispatch:e})=>OM(t,e),DN=()=>({state:t,dispatch:e})=>_M(t,e);function Q0(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function _N(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))bp()||Q0()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}const RN=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=_N(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function ya(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?ut(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(h,d)=>{if(h.isText)return;const f=Math.max(r,d),p=Math.min(i,d+h.nodeSize);a.push({node:h,from:f,to:p})});const l=i-r,c=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>xc(h.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((h,d)=>h+d.to-d.from,0)>=l}const LN=(t,e={})=>({state:n,dispatch:r})=>{const i=ut(t,n.schema);return ya(n,i,e)?LM(n,r):!1},PN=()=>({state:t,dispatch:e})=>VM(t,e),BN=t=>({state:e,dispatch:n})=>{const r=ut(t,e.schema);return WM(r)(e,n)},FN=()=>({state:t,dispatch:e})=>PM(t,e);function xu(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function by(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}const VN=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=xu(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=ut(t,r.schema)),a==="mark"&&(o=ri(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,by(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(h=>{o===h.type&&n.addMark(u,u+c.nodeSize,o.create(by(h.attrs,e)))})})}),!0):!1},$N=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),zN=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),UN=()=>({state:t,dispatch:e})=>DM(t,e),HN=()=>({state:t,dispatch:e})=>RM(t,e),jN=()=>({state:t,dispatch:e})=>$M(t,e),KN=()=>({state:t,dispatch:e})=>HM(t,e),qN=()=>({state:t,dispatch:e})=>UM(t,e);function Z0(t,e,n={}){return Sc(t,e,{slice:!1,parseOptions:n})}const WN=(t,e=!1,n={})=>({tr:r,editor:i,dispatch:s})=>{const{doc:o}=r,a=Z0(t,i.schema,n);return s&&r.replaceWith(0,o.content.size,a).setMeta("preventUpdate",!e),!0};function GN(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function zd(t,e){const n=[];return t.descendants((r,i)=>{e(r)&&n.push({node:r,pos:i})}),n}function eE(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function wp(t){return e=>eE(e.$from,t)}function JN(t,e){const n=Qn.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function XN(t,e){const n={from:0,to:t.content.size};return J0(t,n,e)}function tE(t,e){const n=ri(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function YN(t,e){const n=ut(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function QN(t,e){const n=xu(typeof e=="string"?e:e.name,t.schema);return n==="node"?YN(t,e):n==="mark"?tE(t,e):{}}function nE(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t-1),o=mp(s,i.type);!o||r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}function Ud(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?ri(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>s?s.name===h.type.name:!0).find(h=>xc(h.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:h,$to:d})=>{const f=h.pos,p=d.pos;t.doc.nodesBetween(f,p,(g,m)=>{if(!g.isText&&!g.marks.length)return;const w=Math.max(f,m),D=Math.min(p,m+g.nodeSize);o+=D-w,a.push(...g.marks.map(y=>({mark:y,from:w,to:D})))})}),o===0)return!1;const l=a.filter(h=>s?s.name===h.mark.type.name:!0).filter(h=>xc(h.mark.attrs,n,{strict:!1})).reduce((h,d)=>h+d.to-d.from,0),c=a.filter(h=>s?h.mark.type!==s&&h.mark.type.excludes(s):!0).reduce((h,d)=>h+d.to-d.from,0);return(l>0?l+c:l)>=o}function ZN(t,e,n={}){if(!e)return ya(t,null,n)||Ud(t,null,n);const r=xu(e,t.schema);return r==="node"?ya(t,e,n):r==="mark"?Ud(t,e,n):!1}function wy(t,e){const{nodeExtensions:n}=wu(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=Se(re(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function eO(t){var e;const n=(e=t.type.createAndFill())===null||e===void 0?void 0:e.toJSON(),r=t.toJSON();return JSON.stringify(n)===JSON.stringify(r)}function tO(t){return t instanceof fe}function rE(t,e,n){const i=t.state.doc.content.size,s=dr(e,0,i),o=dr(n,0,i),a=t.coordsAtPos(s),l=t.coordsAtPos(o,-1),c=Math.min(a.top,l.top),u=Math.max(a.bottom,l.bottom),h=Math.min(a.left,l.left),d=Math.max(a.right,l.right),f=d-h,p=u-c,w={top:c,bottom:u,left:h,right:d,width:f,height:p,x:h,y:c};return{...w,toJSON:()=>w}}function nO(t,e,n){var r;const{selection:i}=e;let s=null;if(yp(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!==null&&r!==void 0?r:s.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,h,d)=>{if(c)return!1;if(u.isInline){const f=!d||d.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(n));c=f&&p}return!c}),c})}const rO=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=ri(t,r.schema);if(i)if(o){const c=tE(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(u,h,(d,f)=>{const p=Math.max(f,u),g=Math.min(f+d.nodeSize,h);d.marks.find(w=>w.type===l)?d.marks.forEach(w=>{l===w.type&&n.addMark(p,g,l.create({...w.attrs,...e}))}):n.addMark(p,g,l.create(e))})});return nO(r,n,l)},iO=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),sO=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=ut(t,n.schema);return s.isTextblock?i().command(({commands:o})=>fy(s,e)(n)?!0:o.clearNodes()).command(({state:o})=>fy(s,e)(o,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},oO=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=dr(t,0,r.content.size),s=fe.create(r,i);e.setSelection(s)}return!0},aO=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=pe.atStart(r).from,a=pe.atEnd(r).to,l=dr(i,o,a),c=dr(s,o,a),u=pe.create(r,l,c);e.setSelection(u)}return!0},lO=t=>({state:e,dispatch:n})=>{const r=ut(t,e.schema);return XM(r)(e,n)};function ql(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}function vy(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e==null?void 0:e.includes(i.type.name));t.tr.ensureMarks(r)}}const cO=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=ql(c,a.node().type.name,a.node().attrs);if(s instanceof fe&&s.node.isBlock)return!a.parentOffset||!Fs(o,a.pos)?!1:(r&&(t&&vy(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(r){const h=l.parentOffset===l.parent.content.size;s instanceof pe&&e.deleteSelection();const d=a.depth===0?void 0:GN(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=h&&d?[{type:d,attrs:u}]:void 0,p=Fs(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&Fs(e.doc,e.mapping.map(a.pos),1,d?[{type:d}]:void 0)&&(p=!0,f=d?[{type:d,attrs:u}]:void 0),p&&(e.split(e.mapping.map(a.pos),1,f),d&&!h&&!a.parentOffset&&a.parent.type!==d)){const g=e.mapping.map(a.before()),m=e.doc.resolve(g);a.node(-1).canReplaceWith(m.index(),m.index()+1,d)&&e.setNodeMarkup(e.mapping.map(a.before()),d)}t&&vy(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return!0},uO=t=>({tr:e,state:n,dispatch:r,editor:i})=>{var s;const o=ut(t,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const u=a.node(-1);if(u.type!==o)return!1;const h=i.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==o||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let m=U.empty;const w=a.index(-1)?1:a.index(-2)?2:3;for(let K=a.depth-w;K>=a.depth-3;K-=1)m=U.from(a.node(K).copy(m));const D=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,P=ql(h,a.node().type.name,a.node().attrs),y=((s=o.contentMatch.defaultType)===null||s===void 0?void 0:s.createAndFill(P))||void 0;m=m.append(U.from(o.createAndFill(null,y)||void 0));const F=a.before(a.depth-(w-1));e.replace(F,a.after(-D),new J(m,4-w,0));let R=-1;e.doc.nodesBetween(F,e.doc.content.size,(K,_)=>{if(R>-1)return!1;K.isTextblock&&K.content.size===0&&(R=_+1)}),R>-1&&e.setSelection(pe.near(e.doc.resolve(R))),e.scrollIntoView()}return!0}const d=l.pos===a.end()?u.contentMatchAt(0).defaultType:null,f=ql(h,u.type.name,u.attrs),p=ql(h,a.node().type.name,a.node().attrs);e.delete(a.pos,l.pos);const g=d?[{type:o,attrs:f},{type:d,attrs:p}]:[{type:o,attrs:f}];return Fs(e.doc,a.pos,2)?(r&&e.split(a.pos,2,g).scrollIntoView(),!0):!1},Ey=(t,e)=>{const n=wp(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&yo(t.doc,n.pos)&&t.join(n.pos),!0},xy=(t,e)=>{const n=wp(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===(i==null?void 0:i.type)&&yo(t.doc,r)&&t.join(r),!0},hO=(t,e)=>({editor:n,tr:r,state:i,dispatch:s,chain:o,commands:a,can:l})=>{const{extensions:c}=n.extensionManager,u=ut(t,i.schema),h=ut(e,i.schema),{selection:d}=i,{$from:f,$to:p}=d,g=f.blockRange(p);if(!g)return!1;const m=wp(w=>wy(w.type.name,c))(d);if(g.depth>=1&&m&&g.depth-m.depth<=1){if(m.node.type===u)return a.liftListItem(h);if(wy(m.node.type.name,c)&&u.validContent(m.node.content)&&s)return o().command(()=>(r.setNodeMarkup(m.pos,u),!0)).command(()=>Ey(r,u)).command(()=>xy(r,u)).run()}return o().command(()=>l().wrapInList(u)?!0:a.clearNodes()).wrapInList(u).command(()=>Ey(r,u)).command(()=>xy(r,u)).run()},dO=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=ri(t,r.schema);return Ud(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},fO=(t,e,n={})=>({state:r,commands:i})=>{const s=ut(t,r.schema),o=ut(e,r.schema);return ya(r,s,n)?i.setNode(o):i.setNode(s,n)},pO=(t,e={})=>({state:n,commands:r})=>{const i=ut(t,n.schema);return ya(n,i,e)?r.lift(i):r.wrapIn(i,e)},gO=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},mO=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},yO=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=ri(t,r.schema),{$from:c,empty:u,ranges:h}=a;if(!i)return!0;if(u&&o){let{from:d,to:f}=a;const p=(s=c.marks().find(m=>m.type===l))===null||s===void 0?void 0:s.attrs,g=mp(c,l,p);g&&(d=g.from,f=g.to),n.removeMark(d,f,l)}else h.forEach(d=>{n.removeMark(d.$from.pos,d.$to.pos,l)});return n.removeStoredMark(l),!0},bO=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=xu(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=ut(t,r.schema)),a==="mark"&&(o=ri(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;r.doc.nodesBetween(c,u,(h,d)=>{s&&s===h.type&&n.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(f=>{if(o===f.type){const p=Math.max(d,c),g=Math.min(d+h.nodeSize,u);n.addMark(p,g,o.create({...f.attrs,...e}))}})})}),!0):!1},wO=(t,e={})=>({state:n,dispatch:r})=>{const i=ut(t,n.schema);return jM(i,e)(n,r)},vO=(t,e={})=>({state:n,dispatch:r})=>{const i=ut(t,n.schema);return KM(i,e)(n,r)};var EO=Object.freeze({__proto__:null,blur:dN,clearContent:fN,clearNodes:pN,command:gN,createParagraphNear:mN,deleteNode:yN,deleteRange:bN,deleteSelection:wN,enter:vN,exitCode:EN,extendMarkRange:SN,first:TN,focus:CN,forEach:kN,insertContent:IN,insertContentAt:NN,joinBackward:ON,joinForward:DN,keyboardShortcut:RN,lift:LN,liftEmptyBlock:PN,liftListItem:BN,newlineInCode:FN,resetAttributes:VN,scrollIntoView:$N,selectAll:zN,selectNodeBackward:UN,selectNodeForward:HN,selectParentNode:jN,selectTextblockEnd:KN,selectTextblockStart:qN,setContent:WN,setMark:rO,setMeta:iO,setNode:sO,setNodeSelection:oO,setTextSelection:aO,sinkListItem:lO,splitBlock:cO,splitListItem:uO,toggleList:hO,toggleMark:dO,toggleNode:fO,toggleWrap:pO,undoInputRule:gO,unsetAllMarks:mO,unsetMark:yO,updateAttributes:bO,wrapIn:wO,wrapInList:vO});const xO=Gt.create({name:"commands",addCommands(){return{...EO}}}),SO=Gt.create({name:"editable",addProseMirrorPlugins(){return[new St({key:new sn("editable"),props:{editable:()=>this.editor.options.editable}})]}}),TO=Gt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new St({key:new sn("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),CO=Gt.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:h}=l,{pos:d,parent:f}=h,p=ue.atStart(c).from===d;return!u||!p||!f.type.isTextblock||f.textContent.length?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return bp()||Q0()?s:i},addProseMirrorPlugins(){return[new St({key:new sn("clearDocument"),appendTransaction:(t,e,n)=>{if(!(t.some(p=>p.docChanged)&&!e.doc.eq(n.doc)))return;const{empty:i,from:s,to:o}=e.selection,a=ue.atStart(e.doc).from,l=ue.atEnd(e.doc).to,c=s===a&&o===l,u=n.doc.textBetween(0,n.doc.content.size," "," ").length===0;if(i||!c||!u)return;const h=n.tr,d=yu({state:n,transaction:h}),{commands:f}=new bu({editor:this.editor,state:d});if(f.clearNodes(),!!h.steps.length)return h}})]}}),kO=Gt.create({name:"tabindex",addProseMirrorPlugins(){return[new St({key:new sn("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var IO=Object.freeze({__proto__:null,ClipboardTextSerializer:hN,Commands:xO,Editable:SO,FocusEvents:TO,Keymap:CO,Tabindex:kO});const AO=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function MO(t,e){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}class NO extends YM{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=MO(AO,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e}),this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=G0(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});this.view.updateState(i)}unregisterPlugin(e){if(this.isDestroyed)return;const n=typeof e=="string"?`${e}$`:e.key,r=this.state.reconfigure({plugins:this.state.plugins.filter(i=>!i.key.startsWith(n))});this.view.updateState(r)}createExtensionManager(){const n=[...this.options.enableCoreExtensions?Object.values(IO):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new Ns(n,this)}createCommandManager(){this.commandManager=new bu({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Z0(this.options.content,this.schema,this.options.parseOptions),n=Y0(e,this.options.autofocus);this.view=new wM(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:Is.create({doc:e,selection:n||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return QN(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return ZN(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return JN(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return XN(this.state.doc,{blockSeparator:n,textSerializers:{...r,...X0(this.schema)}})}get isEmpty(){return eO(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}}function Qs(t){return new vu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];let l=n.to;if(o){const c=a.search(/\S/),u=n.from+a.indexOf(o),h=u+o.length;if(nE(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(g=>g===t.type&&g!==f.mark.type)).filter(f=>f.to>u).length)return null;h<n.to&&s.delete(h,n.to),u>n.from&&s.delete(n.from+c,u),l=n.from+c+o.length,s.addMark(n.from+c,l,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function OO(t){return new vu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;if(r[1]){const l=r[0].lastIndexOf(r[1]);let c=o+l;c>a?c=a:a=c+r[1].length;const u=r[0][r[0].length-1];s.insertText(u,o+r[0].length-1),s.replaceWith(c,a,t.type.create(i))}else r[0]&&s.replaceWith(o,a,t.type.create(i))}})}function Hd(t){return new vu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=Se(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)}})}function vp(t){return new vu({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r)||{},s=e.tr.delete(n.from,n.to),a=s.doc.resolve(n.from).blockRange(),l=a&&np(a,t.type,i);if(!l)return null;s.wrap(a,l);const c=s.doc.resolve(n.from-1).nodeBefore;c&&c.type===t.type&&yo(s.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,c))&&s.join(n.from-1)}})}class Yr{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Se(re(this,"addOptions",{name:this.name}))),this.storage=Se(re(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Yr(e)}configure(e={}){const n=this.extend();return n.options=Eu(this.options,e),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new Yr(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Se(re(n,"addOptions",{name:n.name})),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}class ht{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Se(re(this,"addOptions",{name:this.name}))),this.storage=Se(re(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ht(e)}configure(e={}){const n=this.extend();return n.options=Eu(this.options,e),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new ht(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Se(re(n,"addOptions",{name:n.name})),n.storage=Se(re(n,"addStorage",{name:n.name,options:n.options})),n}}function Zs(t){return new sN({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Se(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];let l=n.to;if(o){const c=a.search(/\S/),u=n.from+a.indexOf(o),h=u+o.length;if(nE(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(g=>g===t.type&&g!==f.mark.type)).filter(f=>f.to>u).length)return null;h<n.to&&s.delete(h,n.to),u>n.from&&s.delete(n.from+c,u),l=n.from+c+o.length,s.addMark(n.from+c,l,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}var tn="top",kn="bottom",In="right",nn="left",Ep="auto",Wa=[tn,kn,In,nn],eo="start",ba="end",DO="clippingParents",iE="viewport",Io="popper",_O="reference",Sy=Wa.reduce(function(t,e){return t.concat([e+"-"+eo,e+"-"+ba])},[]),sE=[].concat(Wa,[Ep]).reduce(function(t,e){return t.concat([e,e+"-"+eo,e+"-"+ba])},[]),RO="beforeRead",LO="read",PO="afterRead",BO="beforeMain",FO="main",VO="afterMain",$O="beforeWrite",zO="write",UO="afterWrite",HO=[RO,LO,PO,BO,FO,VO,$O,zO,UO];function or(t){return t?(t.nodeName||"").toLowerCase():null}function An(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ji(t){var e=An(t).Element;return t instanceof e||t instanceof Element}function Cn(t){var e=An(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function xp(t){if(typeof ShadowRoot>"u")return!1;var e=An(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function jO(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var r=e.styles[n]||{},i=e.attributes[n]||{},s=e.elements[n];!Cn(s)||!or(s)||(Object.assign(s.style,r),Object.keys(i).forEach(function(o){var a=i[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function KO(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(r){var i=e.elements[r],s=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:n[r]),a=o.reduce(function(l,c){return l[c]="",l},{});!Cn(i)||!or(i)||(Object.assign(i.style,a),Object.keys(s).forEach(function(l){i.removeAttribute(l)}))})}}const oE={name:"applyStyles",enabled:!0,phase:"write",fn:jO,effect:KO,requires:["computeStyles"]};function rr(t){return t.split("-")[0]}var $i=Math.max,Tc=Math.min,to=Math.round;function jd(){var t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function aE(){return!/^((?!chrome|android).)*safari/i.test(jd())}function no(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var r=t.getBoundingClientRect(),i=1,s=1;e&&Cn(t)&&(i=t.offsetWidth>0&&to(r.width)/t.offsetWidth||1,s=t.offsetHeight>0&&to(r.height)/t.offsetHeight||1);var o=Ji(t)?An(t):window,a=o.visualViewport,l=!aE()&&n,c=(r.left+(l&&a?a.offsetLeft:0))/i,u=(r.top+(l&&a?a.offsetTop:0))/s,h=r.width/i,d=r.height/s;return{width:h,height:d,top:u,right:c+h,bottom:u+d,left:c,x:c,y:u}}function Sp(t){var e=no(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function lE(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&xp(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function yr(t){return An(t).getComputedStyle(t)}function qO(t){return["table","td","th"].indexOf(or(t))>=0}function ii(t){return((Ji(t)?t.ownerDocument:t.document)||window.document).documentElement}function Su(t){return or(t)==="html"?t:t.assignedSlot||t.parentNode||(xp(t)?t.host:null)||ii(t)}function Ty(t){return!Cn(t)||yr(t).position==="fixed"?null:t.offsetParent}function WO(t){var e=/firefox/i.test(jd()),n=/Trident/i.test(jd());if(n&&Cn(t)){var r=yr(t);if(r.position==="fixed")return null}var i=Su(t);for(xp(i)&&(i=i.host);Cn(i)&&["html","body"].indexOf(or(i))<0;){var s=yr(i);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return i;i=i.parentNode}return null}function Ga(t){for(var e=An(t),n=Ty(t);n&&qO(n)&&yr(n).position==="static";)n=Ty(n);return n&&(or(n)==="html"||or(n)==="body"&&yr(n).position==="static")?e:n||WO(t)||e}function Tp(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Xo(t,e,n){return $i(t,Tc(e,n))}function GO(t,e,n){var r=Xo(t,e,n);return r>n?n:r}function cE(){return{top:0,right:0,bottom:0,left:0}}function uE(t){return Object.assign({},cE(),t)}function hE(t,e){return e.reduce(function(n,r){return n[r]=t,n},{})}var JO=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,uE(typeof e!="number"?e:hE(e,Wa))};function XO(t){var e,n=t.state,r=t.name,i=t.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=rr(n.placement),l=Tp(a),c=[nn,In].indexOf(a)>=0,u=c?"height":"width";if(!(!s||!o)){var h=JO(i.padding,n),d=Sp(s),f=l==="y"?tn:nn,p=l==="y"?kn:In,g=n.rects.reference[u]+n.rects.reference[l]-o[l]-n.rects.popper[u],m=o[l]-n.rects.reference[l],w=Ga(s),D=w?l==="y"?w.clientHeight||0:w.clientWidth||0:0,P=g/2-m/2,y=h[f],F=D-d[u]-h[p],R=D/2-d[u]/2+P,K=Xo(y,R,F),_=l;n.modifiersData[r]=(e={},e[_]=K,e.centerOffset=K-R,e)}}function YO(t){var e=t.state,n=t.options,r=n.element,i=r===void 0?"[data-popper-arrow]":r;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||!lE(e.elements.popper,i)||(e.elements.arrow=i))}const QO={name:"arrow",enabled:!0,phase:"main",fn:XO,effect:YO,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ro(t){return t.split("-")[1]}var ZO={top:"auto",right:"auto",bottom:"auto",left:"auto"};function eD(t){var e=t.x,n=t.y,r=window,i=r.devicePixelRatio||1;return{x:to(e*i)/i||0,y:to(n*i)/i||0}}function Cy(t){var e,n=t.popper,r=t.popperRect,i=t.placement,s=t.variation,o=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,h=t.isFixed,d=o.x,f=d===void 0?0:d,p=o.y,g=p===void 0?0:p,m=typeof u=="function"?u({x:f,y:g}):{x:f,y:g};f=m.x,g=m.y;var w=o.hasOwnProperty("x"),D=o.hasOwnProperty("y"),P=nn,y=tn,F=window;if(c){var R=Ga(n),K="clientHeight",_="clientWidth";if(R===An(n)&&(R=ii(n),yr(R).position!=="static"&&a==="absolute"&&(K="scrollHeight",_="scrollWidth")),R=R,i===tn||(i===nn||i===In)&&s===ba){y=kn;var Z=h&&R===F&&F.visualViewport?F.visualViewport.height:R[K];g-=Z-r.height,g*=l?1:-1}if(i===nn||(i===tn||i===kn)&&s===ba){P=In;var ie=h&&R===F&&F.visualViewport?F.visualViewport.width:R[_];f-=ie-r.width,f*=l?1:-1}}var he=Object.assign({position:a},c&&ZO),ve=u===!0?eD({x:f,y:g}):{x:f,y:g};if(f=ve.x,g=ve.y,l){var Ee;return Object.assign({},he,(Ee={},Ee[y]=D?"0":"",Ee[P]=w?"0":"",Ee.transform=(F.devicePixelRatio||1)<=1?"translate("+f+"px, "+g+"px)":"translate3d("+f+"px, "+g+"px, 0)",Ee))}return Object.assign({},he,(e={},e[y]=D?g+"px":"",e[P]=w?f+"px":"",e.transform="",e))}function tD(t){var e=t.state,n=t.options,r=n.gpuAcceleration,i=r===void 0?!0:r,s=n.adaptive,o=s===void 0?!0:s,a=n.roundOffsets,l=a===void 0?!0:a,c={placement:rr(e.placement),variation:ro(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Cy(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Cy(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const nD={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:tD,data:{}};var xl={passive:!0};function rD(t){var e=t.state,n=t.instance,r=t.options,i=r.scroll,s=i===void 0?!0:i,o=r.resize,a=o===void 0?!0:o,l=An(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&c.forEach(function(u){u.addEventListener("scroll",n.update,xl)}),a&&l.addEventListener("resize",n.update,xl),function(){s&&c.forEach(function(u){u.removeEventListener("scroll",n.update,xl)}),a&&l.removeEventListener("resize",n.update,xl)}}const iD={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:rD,data:{}};var sD={left:"right",right:"left",bottom:"top",top:"bottom"};function Wl(t){return t.replace(/left|right|bottom|top/g,function(e){return sD[e]})}var oD={start:"end",end:"start"};function ky(t){return t.replace(/start|end/g,function(e){return oD[e]})}function Cp(t){var e=An(t),n=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:n,scrollTop:r}}function kp(t){return no(ii(t)).left+Cp(t).scrollLeft}function aD(t,e){var n=An(t),r=ii(t),i=n.visualViewport,s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;var c=aE();(c||!c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a+kp(t),y:l}}function lD(t){var e,n=ii(t),r=Cp(t),i=(e=t.ownerDocument)==null?void 0:e.body,s=$i(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=$i(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+kp(t),l=-r.scrollTop;return yr(i||n).direction==="rtl"&&(a+=$i(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function Ip(t){var e=yr(t),n=e.overflow,r=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function dE(t){return["html","body","#document"].indexOf(or(t))>=0?t.ownerDocument.body:Cn(t)&&Ip(t)?t:dE(Su(t))}function Yo(t,e){var n;e===void 0&&(e=[]);var r=dE(t),i=r===((n=t.ownerDocument)==null?void 0:n.body),s=An(r),o=i?[s].concat(s.visualViewport||[],Ip(r)?r:[]):r,a=e.concat(o);return i?a:a.concat(Yo(Su(o)))}function Kd(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function cD(t,e){var n=no(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function Iy(t,e,n){return e===iE?Kd(aD(t,n)):Ji(e)?cD(e,n):Kd(lD(ii(t)))}function uD(t){var e=Yo(Su(t)),n=["absolute","fixed"].indexOf(yr(t).position)>=0,r=n&&Cn(t)?Ga(t):t;return Ji(r)?e.filter(function(i){return Ji(i)&&lE(i,r)&&or(i)!=="body"}):[]}function hD(t,e,n,r){var i=e==="clippingParents"?uD(t):[].concat(e),s=[].concat(i,[n]),o=s[0],a=s.reduce(function(l,c){var u=Iy(t,c,r);return l.top=$i(u.top,l.top),l.right=Tc(u.right,l.right),l.bottom=Tc(u.bottom,l.bottom),l.left=$i(u.left,l.left),l},Iy(t,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function fE(t){var e=t.reference,n=t.element,r=t.placement,i=r?rr(r):null,s=r?ro(r):null,o=e.x+e.width/2-n.width/2,a=e.y+e.height/2-n.height/2,l;switch(i){case tn:l={x:o,y:e.y-n.height};break;case kn:l={x:o,y:e.y+e.height};break;case In:l={x:e.x+e.width,y:a};break;case nn:l={x:e.x-n.width,y:a};break;default:l={x:e.x,y:e.y}}var c=i?Tp(i):null;if(c!=null){var u=c==="y"?"height":"width";switch(s){case eo:l[c]=l[c]-(e[u]/2-n[u]/2);break;case ba:l[c]=l[c]+(e[u]/2-n[u]/2);break}}return l}function wa(t,e){e===void 0&&(e={});var n=e,r=n.placement,i=r===void 0?t.placement:r,s=n.strategy,o=s===void 0?t.strategy:s,a=n.boundary,l=a===void 0?DO:a,c=n.rootBoundary,u=c===void 0?iE:c,h=n.elementContext,d=h===void 0?Io:h,f=n.altBoundary,p=f===void 0?!1:f,g=n.padding,m=g===void 0?0:g,w=uE(typeof m!="number"?m:hE(m,Wa)),D=d===Io?_O:Io,P=t.rects.popper,y=t.elements[p?D:d],F=hD(Ji(y)?y:y.contextElement||ii(t.elements.popper),l,u,o),R=no(t.elements.reference),K=fE({reference:R,element:P,strategy:"absolute",placement:i}),_=Kd(Object.assign({},P,K)),Z=d===Io?_:R,ie={top:F.top-Z.top+w.top,bottom:Z.bottom-F.bottom+w.bottom,left:F.left-Z.left+w.left,right:Z.right-F.right+w.right},he=t.modifiersData.offset;if(d===Io&&he){var ve=he[i];Object.keys(ie).forEach(function(Ee){var Oe=[In,kn].indexOf(Ee)>=0?1:-1,Ue=[tn,kn].indexOf(Ee)>=0?"y":"x";ie[Ee]+=ve[Ue]*Oe})}return ie}function dD(t,e){e===void 0&&(e={});var n=e,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=l===void 0?sE:l,u=ro(r),h=u?a?Sy:Sy.filter(function(p){return ro(p)===u}):Wa,d=h.filter(function(p){return c.indexOf(p)>=0});d.length===0&&(d=h);var f=d.reduce(function(p,g){return p[g]=wa(t,{placement:g,boundary:i,rootBoundary:s,padding:o})[rr(g)],p},{});return Object.keys(f).sort(function(p,g){return f[p]-f[g]})}function fD(t){if(rr(t)===Ep)return[];var e=Wl(t);return[ky(t),e,ky(e)]}function pD(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var i=n.mainAxis,s=i===void 0?!0:i,o=n.altAxis,a=o===void 0?!0:o,l=n.fallbackPlacements,c=n.padding,u=n.boundary,h=n.rootBoundary,d=n.altBoundary,f=n.flipVariations,p=f===void 0?!0:f,g=n.allowedAutoPlacements,m=e.options.placement,w=rr(m),D=w===m,P=l||(D||!p?[Wl(m)]:fD(m)),y=[m].concat(P).reduce(function(ke,Le){return ke.concat(rr(Le)===Ep?dD(e,{placement:Le,boundary:u,rootBoundary:h,padding:c,flipVariations:p,allowedAutoPlacements:g}):Le)},[]),F=e.rects.reference,R=e.rects.popper,K=new Map,_=!0,Z=y[0],ie=0;ie<y.length;ie++){var he=y[ie],ve=rr(he),Ee=ro(he)===eo,Oe=[tn,kn].indexOf(ve)>=0,Ue=Oe?"width":"height",v=wa(e,{placement:he,boundary:u,rootBoundary:h,altBoundary:d,padding:c}),T=Oe?Ee?In:nn:Ee?kn:tn;F[Ue]>R[Ue]&&(T=Wl(T));var M=Wl(T),q=[];if(s&&q.push(v[ve]<=0),a&&q.push(v[T]<=0,v[M]<=0),q.every(function(ke){return ke})){Z=he,_=!1;break}K.set(he,q)}if(_)for(var ne=p?3:1,me=function(Le){var je=y.find(function(gt){var Ct=K.get(gt);if(Ct)return Ct.slice(0,Le).every(function(mt){return mt})});if(je)return Z=je,"break"},xe=ne;xe>0;xe--){var Ye=me(xe);if(Ye==="break")break}e.placement!==Z&&(e.modifiersData[r]._skip=!0,e.placement=Z,e.reset=!0)}}const gD={name:"flip",enabled:!0,phase:"main",fn:pD,requiresIfExists:["offset"],data:{_skip:!1}};function Ay(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function My(t){return[tn,In,kn,nn].some(function(e){return t[e]>=0})}function mD(t){var e=t.state,n=t.name,r=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,o=wa(e,{elementContext:"reference"}),a=wa(e,{altBoundary:!0}),l=Ay(o,r),c=Ay(a,i,s),u=My(l),h=My(c);e.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}const yD={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:mD};function bD(t,e,n){var r=rr(t),i=[nn,tn].indexOf(r)>=0?-1:1,s=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[nn,In].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function wD(t){var e=t.state,n=t.options,r=t.name,i=n.offset,s=i===void 0?[0,0]:i,o=sE.reduce(function(u,h){return u[h]=bD(h,e.rects,s),u},{}),a=o[e.placement],l=a.x,c=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=o}const vD={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:wD};function ED(t){var e=t.state,n=t.name;e.modifiersData[n]=fE({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const xD={name:"popperOffsets",enabled:!0,phase:"read",fn:ED,data:{}};function SD(t){return t==="x"?"y":"x"}function TD(t){var e=t.state,n=t.options,r=t.name,i=n.mainAxis,s=i===void 0?!0:i,o=n.altAxis,a=o===void 0?!1:o,l=n.boundary,c=n.rootBoundary,u=n.altBoundary,h=n.padding,d=n.tether,f=d===void 0?!0:d,p=n.tetherOffset,g=p===void 0?0:p,m=wa(e,{boundary:l,rootBoundary:c,padding:h,altBoundary:u}),w=rr(e.placement),D=ro(e.placement),P=!D,y=Tp(w),F=SD(y),R=e.modifiersData.popperOffsets,K=e.rects.reference,_=e.rects.popper,Z=typeof g=="function"?g(Object.assign({},e.rects,{placement:e.placement})):g,ie=typeof Z=="number"?{mainAxis:Z,altAxis:Z}:Object.assign({mainAxis:0,altAxis:0},Z),he=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ve={x:0,y:0};if(!!R){if(s){var Ee,Oe=y==="y"?tn:nn,Ue=y==="y"?kn:In,v=y==="y"?"height":"width",T=R[y],M=T+m[Oe],q=T-m[Ue],ne=f?-_[v]/2:0,me=D===eo?K[v]:_[v],xe=D===eo?-_[v]:-K[v],Ye=e.elements.arrow,ke=f&&Ye?Sp(Ye):{width:0,height:0},Le=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:cE(),je=Le[Oe],gt=Le[Ue],Ct=Xo(0,K[v],ke[v]),mt=P?K[v]/2-ne-Ct-je-ie.mainAxis:me-Ct-je-ie.mainAxis,kt=P?-K[v]/2+ne+Ct+gt+ie.mainAxis:xe+Ct+gt+ie.mainAxis,Jt=e.elements.arrow&&Ga(e.elements.arrow),b=Jt?y==="y"?Jt.clientTop||0:Jt.clientLeft||0:0,E=(Ee=he==null?void 0:he[y])!=null?Ee:0,I=T+mt-E-b,$=T+kt-E,L=Xo(f?Tc(M,I):M,T,f?$i(q,$):q);R[y]=L,ve[y]=L-T}if(a){var S,G=y==="x"?tn:nn,N=y==="x"?kn:In,A=R[F],B=F==="y"?"height":"width",Y=A+m[G],X=A-m[N],te=[tn,nn].indexOf(w)!==-1,x=(S=he==null?void 0:he[F])!=null?S:0,C=te?Y:A-K[B]-_[B]-x+ie.altAxis,V=te?A+K[B]+_[B]-x-ie.altAxis:X,H=f&&te?GO(C,A,V):Xo(f?C:Y,A,f?V:X);R[F]=H,ve[F]=H-A}e.modifiersData[r]=ve}}const CD={name:"preventOverflow",enabled:!0,phase:"main",fn:TD,requiresIfExists:["offset"]};function kD(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function ID(t){return t===An(t)||!Cn(t)?Cp(t):kD(t)}function AD(t){var e=t.getBoundingClientRect(),n=to(e.width)/t.offsetWidth||1,r=to(e.height)/t.offsetHeight||1;return n!==1||r!==1}function MD(t,e,n){n===void 0&&(n=!1);var r=Cn(e),i=Cn(e)&&AD(e),s=ii(e),o=no(t,i,n),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!n)&&((or(e)!=="body"||Ip(s))&&(a=ID(e)),Cn(e)?(l=no(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=kp(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function ND(t){var e=new Map,n=new Set,r=[];t.forEach(function(s){e.set(s.name,s)});function i(s){n.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!n.has(a)){var l=e.get(a);l&&i(l)}}),r.push(s)}return t.forEach(function(s){n.has(s.name)||i(s)}),r}function OD(t){var e=ND(t);return HO.reduce(function(n,r){return n.concat(e.filter(function(i){return i.phase===r}))},[])}function DD(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function _D(t){var e=t.reduce(function(n,r){var i=n[r.name];return n[r.name]=i?Object.assign({},i,r,{options:Object.assign({},i.options,r.options),data:Object.assign({},i.data,r.data)}):r,n},{});return Object.keys(e).map(function(n){return e[n]})}var Ny={placement:"bottom",modifiers:[],strategy:"absolute"};function Oy(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function RD(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,r=n===void 0?[]:n,i=e.defaultOptions,s=i===void 0?Ny:i;return function(a,l,c){c===void 0&&(c=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ny,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},h=[],d=!1,f={state:u,setOptions:function(w){var D=typeof w=="function"?w(u.options):w;g(),u.options=Object.assign({},s,u.options,D),u.scrollParents={reference:Ji(a)?Yo(a):a.contextElement?Yo(a.contextElement):[],popper:Yo(l)};var P=OD(_D([].concat(r,u.options.modifiers)));return u.orderedModifiers=P.filter(function(y){return y.enabled}),p(),f.update()},forceUpdate:function(){if(!d){var w=u.elements,D=w.reference,P=w.popper;if(!!Oy(D,P)){u.rects={reference:MD(D,Ga(P),u.options.strategy==="fixed"),popper:Sp(P)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(ie){return u.modifiersData[ie.name]=Object.assign({},ie.data)});for(var y=0;y<u.orderedModifiers.length;y++){if(u.reset===!0){u.reset=!1,y=-1;continue}var F=u.orderedModifiers[y],R=F.fn,K=F.options,_=K===void 0?{}:K,Z=F.name;typeof R=="function"&&(u=R({state:u,options:_,name:Z,instance:f})||u)}}}},update:DD(function(){return new Promise(function(m){f.forceUpdate(),m(u)})}),destroy:function(){g(),d=!0}};if(!Oy(a,l))return f;f.setOptions(c).then(function(m){!d&&c.onFirstUpdate&&c.onFirstUpdate(m)});function p(){u.orderedModifiers.forEach(function(m){var w=m.name,D=m.options,P=D===void 0?{}:D,y=m.effect;if(typeof y=="function"){var F=y({state:u,name:w,instance:f,options:P}),R=function(){};h.push(F||R)}})}function g(){h.forEach(function(m){return m()}),h=[]}return f}}var LD=[iD,xD,nD,oE,vD,gD,CD,QO,yD],PD=RD({defaultModifiers:LD}),BD="tippy-box",pE="tippy-content",FD="tippy-backdrop",gE="tippy-arrow",mE="tippy-svg-arrow",yi={passive:!0,capture:!0},yE=function(){return document.body};function Fh(t,e,n){if(Array.isArray(t)){var r=t[e];return r==null?Array.isArray(n)?n[e]:n:r}return t}function Ap(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function bE(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Dy(t,e){if(e===0)return t;var n;return function(r){clearTimeout(n),n=setTimeout(function(){t(r)},e)}}function VD(t){return t.split(/\s+/).filter(Boolean)}function Ts(t){return[].concat(t)}function _y(t,e){t.indexOf(e)===-1&&t.push(e)}function $D(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function zD(t){return t.split("-")[0]}function Cc(t){return[].slice.call(t)}function Ry(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function Qo(){return document.createElement("div")}function Tu(t){return["Element","Fragment"].some(function(e){return Ap(t,e)})}function UD(t){return Ap(t,"NodeList")}function HD(t){return Ap(t,"MouseEvent")}function jD(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function KD(t){return Tu(t)?[t]:UD(t)?Cc(t):Array.isArray(t)?t:Cc(document.querySelectorAll(t))}function Vh(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function Ly(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function qD(t){var e,n=Ts(t),r=n[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function WD(t,e){var n=e.clientX,r=e.clientY;return t.every(function(i){var s=i.popperRect,o=i.popperState,a=i.props,l=a.interactiveBorder,c=zD(o.placement),u=o.modifiersData.offset;if(!u)return!0;var h=c==="bottom"?u.top.y:0,d=c==="top"?u.bottom.y:0,f=c==="right"?u.left.x:0,p=c==="left"?u.right.x:0,g=s.top-r+h>l,m=r-s.bottom-d>l,w=s.left-n+f>l,D=n-s.right-p>l;return g||m||w||D})}function $h(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){t[r](i,n)})}function Py(t,e){for(var n=e;n;){var r;if(t.contains(n))return!0;n=n.getRootNode==null||(r=n.getRootNode())==null?void 0:r.host}return!1}var Wn={isTouch:!1},By=0;function GD(){Wn.isTouch||(Wn.isTouch=!0,window.performance&&document.addEventListener("mousemove",wE))}function wE(){var t=performance.now();t-By<20&&(Wn.isTouch=!1,document.removeEventListener("mousemove",wE)),By=t}function JD(){var t=document.activeElement;if(jD(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function XD(){document.addEventListener("touchstart",GD,yi),window.addEventListener("blur",JD)}var YD=typeof window<"u"&&typeof document<"u",QD=YD?!!window.msCrypto:!1,ZD={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},e_={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},_n=Object.assign({appendTo:yE,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},ZD,e_),t_=Object.keys(_n),n_=function(e){var n=Object.keys(e);n.forEach(function(r){_n[r]=e[r]})};function vE(t){var e=t.plugins||[],n=e.reduce(function(r,i){var s=i.name,o=i.defaultValue;if(s){var a;r[s]=t[s]!==void 0?t[s]:(a=_n[s])!=null?a:o}return r},{});return Object.assign({},t,n)}function r_(t,e){var n=e?Object.keys(vE(Object.assign({},_n,{plugins:e}))):t_,r=n.reduce(function(i,s){var o=(t.getAttribute("data-tippy-"+s)||"").trim();if(!o)return i;if(s==="content")i[s]=o;else try{i[s]=JSON.parse(o)}catch{i[s]=o}return i},{});return r}function Fy(t,e){var n=Object.assign({},e,{content:bE(e.content,[t])},e.ignoreAttributes?{}:r_(t,e.plugins));return n.aria=Object.assign({},_n.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var i_=function(){return"innerHTML"};function qd(t,e){t[i_()]=e}function Vy(t){var e=Qo();return t===!0?e.className=gE:(e.className=mE,Tu(t)?e.appendChild(t):qd(e,t)),e}function $y(t,e){Tu(e.content)?(qd(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?qd(t,e.content):t.textContent=e.content)}function Wd(t){var e=t.firstElementChild,n=Cc(e.children);return{box:e,content:n.find(function(r){return r.classList.contains(pE)}),arrow:n.find(function(r){return r.classList.contains(gE)||r.classList.contains(mE)}),backdrop:n.find(function(r){return r.classList.contains(FD)})}}function EE(t){var e=Qo(),n=Qo();n.className=BD,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Qo();r.className=pE,r.setAttribute("data-state","hidden"),$y(r,t.props),e.appendChild(n),n.appendChild(r),i(t.props,t.props);function i(s,o){var a=Wd(e),l=a.box,c=a.content,u=a.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(s.content!==o.content||s.allowHTML!==o.allowHTML)&&$y(c,t.props),o.arrow?u?s.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(Vy(o.arrow))):l.appendChild(Vy(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:i}}EE.$$tippy=!0;var s_=1,Sl=[],zh=[];function o_(t,e){var n=Fy(t,Object.assign({},_n,vE(Ry(e)))),r,i,s,o=!1,a=!1,l=!1,c=!1,u,h,d,f=[],p=Dy(I,n.interactiveDebounce),g,m=s_++,w=null,D=$D(n.plugins),P={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},y={id:m,reference:t,popper:Qo(),popperInstance:w,props:n,state:P,plugins:D,clearDelayTimeouts:C,setProps:V,setContent:H,show:ce,hide:De,hideWithInteractivity:gn,enable:te,disable:x,unmount:Er,destroy:ci};if(!n.render)return y;var F=n.render(y),R=F.popper,K=F.onUpdate;R.setAttribute("data-tippy-root",""),R.id="tippy-"+y.id,y.popper=R,t._tippy=y,R._tippy=y;var _=D.map(function(O){return O.fn(y)}),Z=t.hasAttribute("aria-expanded");return Jt(),ne(),T(),M("onCreate",[y]),n.showOnCreate&&Y(),R.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),R.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&Oe().addEventListener("mousemove",p)}),y;function ie(){var O=y.props.touch;return Array.isArray(O)?O:[O,0]}function he(){return ie()[0]==="hold"}function ve(){var O;return!!((O=y.props.render)!=null&&O.$$tippy)}function Ee(){return g||t}function Oe(){var O=Ee().parentNode;return O?qD(O):document}function Ue(){return Wd(R)}function v(O){return y.state.isMounted&&!y.state.isVisible||Wn.isTouch||u&&u.type==="focus"?0:Fh(y.props.delay,O?0:1,_n.delay)}function T(O){O===void 0&&(O=!1),R.style.pointerEvents=y.props.interactive&&!O?"":"none",R.style.zIndex=""+y.props.zIndex}function M(O,Q,le){if(le===void 0&&(le=!0),_.forEach(function(_e){_e[O]&&_e[O].apply(_e,Q)}),le){var Re;(Re=y.props)[O].apply(Re,Q)}}function q(){var O=y.props.aria;if(!!O.content){var Q="aria-"+O.content,le=R.id,Re=Ts(y.props.triggerTarget||t);Re.forEach(function(_e){var Ft=_e.getAttribute(Q);if(y.state.isVisible)_e.setAttribute(Q,Ft?Ft+" "+le:le);else{var mn=Ft&&Ft.replace(le,"").trim();mn?_e.setAttribute(Q,mn):_e.removeAttribute(Q)}})}}function ne(){if(!(Z||!y.props.aria.expanded)){var O=Ts(y.props.triggerTarget||t);O.forEach(function(Q){y.props.interactive?Q.setAttribute("aria-expanded",y.state.isVisible&&Q===Ee()?"true":"false"):Q.removeAttribute("aria-expanded")})}}function me(){Oe().removeEventListener("mousemove",p),Sl=Sl.filter(function(O){return O!==p})}function xe(O){if(!(Wn.isTouch&&(l||O.type==="mousedown"))){var Q=O.composedPath&&O.composedPath()[0]||O.target;if(!(y.props.interactive&&Py(R,Q))){if(Ts(y.props.triggerTarget||t).some(function(le){return Py(le,Q)})){if(Wn.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else M("onClickOutside",[y,O]);y.props.hideOnClick===!0&&(y.clearDelayTimeouts(),y.hide(),a=!0,setTimeout(function(){a=!1}),y.state.isMounted||je())}}}function Ye(){l=!0}function ke(){l=!1}function Le(){var O=Oe();O.addEventListener("mousedown",xe,!0),O.addEventListener("touchend",xe,yi),O.addEventListener("touchstart",ke,yi),O.addEventListener("touchmove",Ye,yi)}function je(){var O=Oe();O.removeEventListener("mousedown",xe,!0),O.removeEventListener("touchend",xe,yi),O.removeEventListener("touchstart",ke,yi),O.removeEventListener("touchmove",Ye,yi)}function gt(O,Q){mt(O,function(){!y.state.isVisible&&R.parentNode&&R.parentNode.contains(R)&&Q()})}function Ct(O,Q){mt(O,Q)}function mt(O,Q){var le=Ue().box;function Re(_e){_e.target===le&&($h(le,"remove",Re),Q())}if(O===0)return Q();$h(le,"remove",h),$h(le,"add",Re),h=Re}function kt(O,Q,le){le===void 0&&(le=!1);var Re=Ts(y.props.triggerTarget||t);Re.forEach(function(_e){_e.addEventListener(O,Q,le),f.push({node:_e,eventType:O,handler:Q,options:le})})}function Jt(){he()&&(kt("touchstart",E,{passive:!0}),kt("touchend",$,{passive:!0})),VD(y.props.trigger).forEach(function(O){if(O!=="manual")switch(kt(O,E),O){case"mouseenter":kt("mouseleave",$);break;case"focus":kt(QD?"focusout":"blur",L);break;case"focusin":kt("focusout",L);break}})}function b(){f.forEach(function(O){var Q=O.node,le=O.eventType,Re=O.handler,_e=O.options;Q.removeEventListener(le,Re,_e)}),f=[]}function E(O){var Q,le=!1;if(!(!y.state.isEnabled||S(O)||a)){var Re=((Q=u)==null?void 0:Q.type)==="focus";u=O,g=O.currentTarget,ne(),!y.state.isVisible&&HD(O)&&Sl.forEach(function(_e){return _e(O)}),O.type==="click"&&(y.props.trigger.indexOf("mouseenter")<0||o)&&y.props.hideOnClick!==!1&&y.state.isVisible?le=!0:Y(O),O.type==="click"&&(o=!le),le&&!Re&&X(O)}}function I(O){var Q=O.target,le=Ee().contains(Q)||R.contains(Q);if(!(O.type==="mousemove"&&le)){var Re=B().concat(R).map(function(_e){var Ft,mn=_e._tippy,ps=(Ft=mn.popperInstance)==null?void 0:Ft.state;return ps?{popperRect:_e.getBoundingClientRect(),popperState:ps,props:n}:null}).filter(Boolean);WD(Re,O)&&(me(),X(O))}}function $(O){var Q=S(O)||y.props.trigger.indexOf("click")>=0&&o;if(!Q){if(y.props.interactive){y.hideWithInteractivity(O);return}X(O)}}function L(O){y.props.trigger.indexOf("focusin")<0&&O.target!==Ee()||y.props.interactive&&O.relatedTarget&&R.contains(O.relatedTarget)||X(O)}function S(O){return Wn.isTouch?he()!==O.type.indexOf("touch")>=0:!1}function G(){N();var O=y.props,Q=O.popperOptions,le=O.placement,Re=O.offset,_e=O.getReferenceClientRect,Ft=O.moveTransition,mn=ve()?Wd(R).arrow:null,ps=_e?{getBoundingClientRect:_e,contextElement:_e.contextElement||Ee()}:t,Vg={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ul){var gs=ul.state;if(ve()){var vT=Ue(),uh=vT.box;["placement","reference-hidden","escaped"].forEach(function(hl){hl==="placement"?uh.setAttribute("data-placement",gs.placement):gs.attributes.popper["data-popper-"+hl]?uh.setAttribute("data-"+hl,""):uh.removeAttribute("data-"+hl)}),gs.attributes.popper={}}}},ui=[{name:"offset",options:{offset:Re}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Ft}},Vg];ve()&&mn&&ui.push({name:"arrow",options:{element:mn,padding:3}}),ui.push.apply(ui,(Q==null?void 0:Q.modifiers)||[]),y.popperInstance=PD(ps,R,Object.assign({},Q,{placement:le,onFirstUpdate:d,modifiers:ui}))}function N(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function A(){var O=y.props.appendTo,Q,le=Ee();y.props.interactive&&O===yE||O==="parent"?Q=le.parentNode:Q=bE(O,[le]),Q.contains(R)||Q.appendChild(R),y.state.isMounted=!0,G()}function B(){return Cc(R.querySelectorAll("[data-tippy-root]"))}function Y(O){y.clearDelayTimeouts(),O&&M("onTrigger",[y,O]),Le();var Q=v(!0),le=ie(),Re=le[0],_e=le[1];Wn.isTouch&&Re==="hold"&&_e&&(Q=_e),Q?r=setTimeout(function(){y.show()},Q):y.show()}function X(O){if(y.clearDelayTimeouts(),M("onUntrigger",[y,O]),!y.state.isVisible){je();return}if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(O.type)>=0&&o)){var Q=v(!1);Q?i=setTimeout(function(){y.state.isVisible&&y.hide()},Q):s=requestAnimationFrame(function(){y.hide()})}}function te(){y.state.isEnabled=!0}function x(){y.hide(),y.state.isEnabled=!1}function C(){clearTimeout(r),clearTimeout(i),cancelAnimationFrame(s)}function V(O){if(!y.state.isDestroyed){M("onBeforeUpdate",[y,O]),b();var Q=y.props,le=Fy(t,Object.assign({},Q,Ry(O),{ignoreAttributes:!0}));y.props=le,Jt(),Q.interactiveDebounce!==le.interactiveDebounce&&(me(),p=Dy(I,le.interactiveDebounce)),Q.triggerTarget&&!le.triggerTarget?Ts(Q.triggerTarget).forEach(function(Re){Re.removeAttribute("aria-expanded")}):le.triggerTarget&&t.removeAttribute("aria-expanded"),ne(),T(),K&&K(Q,le),y.popperInstance&&(G(),B().forEach(function(Re){requestAnimationFrame(Re._tippy.popperInstance.forceUpdate)})),M("onAfterUpdate",[y,O])}}function H(O){y.setProps({content:O})}function ce(){var O=y.state.isVisible,Q=y.state.isDestroyed,le=!y.state.isEnabled,Re=Wn.isTouch&&!y.props.touch,_e=Fh(y.props.duration,0,_n.duration);if(!(O||Q||le||Re)&&!Ee().hasAttribute("disabled")&&(M("onShow",[y],!1),y.props.onShow(y)!==!1)){if(y.state.isVisible=!0,ve()&&(R.style.visibility="visible"),T(),Le(),y.state.isMounted||(R.style.transition="none"),ve()){var Ft=Ue(),mn=Ft.box,ps=Ft.content;Vh([mn,ps],0)}d=function(){var ui;if(!(!y.state.isVisible||c)){if(c=!0,R.offsetHeight,R.style.transition=y.props.moveTransition,ve()&&y.props.animation){var ch=Ue(),ul=ch.box,gs=ch.content;Vh([ul,gs],_e),Ly([ul,gs],"visible")}q(),ne(),_y(zh,y),(ui=y.popperInstance)==null||ui.forceUpdate(),M("onMount",[y]),y.props.animation&&ve()&&Ct(_e,function(){y.state.isShown=!0,M("onShown",[y])})}},A()}}function De(){var O=!y.state.isVisible,Q=y.state.isDestroyed,le=!y.state.isEnabled,Re=Fh(y.props.duration,1,_n.duration);if(!(O||Q||le)&&(M("onHide",[y],!1),y.props.onHide(y)!==!1)){if(y.state.isVisible=!1,y.state.isShown=!1,c=!1,o=!1,ve()&&(R.style.visibility="hidden"),me(),je(),T(!0),ve()){var _e=Ue(),Ft=_e.box,mn=_e.content;y.props.animation&&(Vh([Ft,mn],Re),Ly([Ft,mn],"hidden"))}q(),ne(),y.props.animation?ve()&&gt(Re,y.unmount):y.unmount()}}function gn(O){Oe().addEventListener("mousemove",p),_y(Sl,p),p(O)}function Er(){y.state.isVisible&&y.hide(),y.state.isMounted&&(N(),B().forEach(function(O){O._tippy.unmount()}),R.parentNode&&R.parentNode.removeChild(R),zh=zh.filter(function(O){return O!==y}),y.state.isMounted=!1,M("onHidden",[y]))}function ci(){y.state.isDestroyed||(y.clearDelayTimeouts(),y.unmount(),b(),delete t._tippy,y.state.isDestroyed=!0,M("onDestroy",[y]))}}function bo(t,e){e===void 0&&(e={});var n=_n.plugins.concat(e.plugins||[]);XD();var r=Object.assign({},e,{plugins:n}),i=KD(t),s=i.reduce(function(o,a){var l=a&&o_(a,r);return l&&o.push(l),o},[]);return Tu(t)?s[0]:s}bo.defaultProps=_n;bo.setDefaultProps=n_;bo.currentInput=Wn;Object.assign({},oE,{effect:function(e){var n=e.state,r={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,r.popper),n.styles=r,n.elements.arrow&&Object.assign(n.elements.arrow.style,r.arrow)}});bo.setDefaultProps({render:EE});class a_{constructor({editor:e,element:n,view:r,tippyOptions:i={},shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:o,state:a,from:l,to:c})=>{const{doc:u,selection:h}=a,{empty:d}=h,f=!u.textBetween(l,c).length&&yp(a.selection),p=this.element.contains(document.activeElement);return!(!(o.hasFocus()||p)||d||f||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:o})=>{var a;if(this.preventHide){this.preventHide=!1;return}(o==null?void 0:o.relatedTarget)&&((a=this.element.parentNode)===null||a===void 0?void 0:a.contains(o.relatedTarget))||this.hide()},this.editor=e,this.element=n,this.view=r,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,n=!!e.parentElement;this.tippy||!n||(this.tippy=bo(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",r=>{this.blurHandler({event:r})}))}update(e,n){var r,i,s;const{state:o,composing:a}=e,{doc:l,selection:c}=o,u=n&&n.doc.eq(l)&&n.selection.eq(c);if(a||u)return;this.createTooltip();const{ranges:h}=c,d=Math.min(...h.map(g=>g.$from.pos)),f=Math.max(...h.map(g=>g.$to.pos));if(!((r=this.shouldShow)===null||r===void 0?void 0:r.call(this,{editor:this.editor,view:e,state:o,oldState:n,from:d,to:f}))){this.hide();return}(i=this.tippy)===null||i===void 0||i.setProps({getReferenceClientRect:((s=this.tippyOptions)===null||s===void 0?void 0:s.getReferenceClientRect)||(()=>{if(tO(o.selection)){const g=e.nodeDOM(d);if(g)return g.getBoundingClientRect()}return rE(e,d,f)})}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const xE=t=>new St({key:typeof t.pluginKey=="string"?new sn(t.pluginKey):t.pluginKey,view:e=>new a_({view:e,...t})});Gt.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[xE({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});class l_{constructor({editor:e,element:n,view:r,tippyOptions:i={},shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:o,state:a})=>{const{selection:l}=a,{$anchor:c,empty:u}=l,h=c.depth===1,d=c.parent.isTextblock&&!c.parent.type.spec.code&&!c.parent.textContent;return!(!o.hasFocus()||!u||!h||!d||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:o})=>{var a;if(this.preventHide){this.preventHide=!1;return}(o==null?void 0:o.relatedTarget)&&((a=this.element.parentNode)===null||a===void 0?void 0:a.contains(o.relatedTarget))||this.hide()},this.editor=e,this.element=n,this.view=r,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,n=!!e.parentElement;this.tippy||!n||(this.tippy=bo(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",r=>{this.blurHandler({event:r})}))}update(e,n){var r,i,s;const{state:o}=e,{doc:a,selection:l}=o,{from:c,to:u}=l;if(n&&n.doc.eq(a)&&n.selection.eq(l))return;if(this.createTooltip(),!((r=this.shouldShow)===null||r===void 0?void 0:r.call(this,{editor:this.editor,view:e,state:o,oldState:n}))){this.hide();return}(i=this.tippy)===null||i===void 0||i.setProps({getReferenceClientRect:((s=this.tippyOptions)===null||s===void 0?void 0:s.getReferenceClientRect)||(()=>rE(e,c,u))}),this.show()}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e;(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const SE=t=>new St({key:typeof t.pluginKey=="string"?new sn(t.pluginKey):t.pluginKey,view:e=>new l_({view:e,...t})});Gt.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[SE({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});const c_=ja({name:"BubbleMenu",props:{pluginKey:{type:null,default:"bubbleMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const n=qf(null);return lu(()=>{const{pluginKey:r,editor:i,tippyOptions:s,shouldShow:o}=t;i.registerPlugin(xE({pluginKey:r,editor:i,element:n.value,tippyOptions:s,shouldShow:o}))}),Ka(()=>{const{pluginKey:r,editor:i}=t;i.unregisterPlugin(r)}),()=>{var r;return Li("div",{ref:n},(r=e.default)===null||r===void 0?void 0:r.call(e))}}});function zy(t){return dC((e,n)=>({get(){return e(),t},set(r){t=r,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}class u_ extends NO{constructor(e={}){return super(e),this.vueRenderers=ru(new Map),this.contentComponent=null,this.reactiveState=zy(this.view.state),this.reactiveExtensionStorage=zy(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),Uf(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,n){super.registerPlugin(e,n),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const h_=ja({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=qf(),n=Ov();return AC(()=>{const r=t.editor;r&&r.options.element&&e.value&&lv(()=>{if(!e.value||!r.options.element.firstChild)return;const i=iv(e.value);e.value.append(...r.options.element.childNodes),r.contentComponent=n.ctx._,r.setOptions({element:i}),r.createNodeViews()})}),Ka(()=>{const r=t.editor;if(!r||(r.isDestroyed||r.view.setProps({nodeViews:{}}),r.contentComponent=null,!r.options.element.firstChild))return;const i=document.createElement("div");i.append(...r.options.element.childNodes),r.setOptions({element:i})}),{rootEl:e}},render(){const t=[];return this.editor&&this.editor.vueRenderers.forEach(e=>{const n=Li(hk,{to:e.teleportElement,key:e.id},Li(e.component,{ref:e.id,...e.props}));t.push(n)}),Li("div",{ref:e=>{this.rootEl=e}},...t)}});ja({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const n=qf(null);return lu(()=>{const{pluginKey:r,editor:i,tippyOptions:s,shouldShow:o}=t;i.registerPlugin(SE({pluginKey:r,editor:i,element:n.value,tippyOptions:s,shouldShow:o}))}),Ka(()=>{const{pluginKey:r,editor:i}=t;i.unregisterPlugin(r)}),()=>{var r;return Li("div",{ref:n},(r=e.default)===null||r===void 0?void 0:r.call(e))}}});ja({props:{as:{type:String,default:"div"}},render(){return Li(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});ja({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return Li(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(e=(t=this.$slots).default)===null||e===void 0?void 0:e.call(t))}});const d_=/^\s*>\s$/,f_=ht.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",st(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[vp({find:d_,type:this.type})]}}),p_=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,g_=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,m_=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,y_=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,b_=Yr.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",st(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Qs({find:p_,type:this.type}),Qs({find:m_,type:this.type})]},addPasteRules(){return[Zs({find:g_,type:this.type}),Zs({find:y_,type:this.type})]}}),w_=/^\s*([-+*])\s$/,v_=ht.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",st(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[vp({find:w_,type:this.type})]}}),E_=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,x_=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,S_=Yr.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",st(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Qs({find:E_,type:this.type})]},addPasteRules(){return[Zs({find:x_,type:this.type})]}}),T_=/^```([a-z]+)?[\s\n]$/,C_=/^~~~([a-z]+)?[\s\n]$/,TE=ht.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,s=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",st(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0||r.nodeAt(a)?!1:t.commands.exitCode()}}},addInputRules(){return[Hd({find:T_,type:this.type,getAttributes:t=>({language:t[1]})}),Hd({find:C_,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new St({key:new sn("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i==null?void 0:i.mode;if(!n||!s)return!1;const{tr:o}=t.state;return o.replaceSelectionWith(this.type.create({language:s})),o.setSelection(pe.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,`
`)),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),k_=ht.create({name:"doc",topNode:!0,content:"block+"});function I_(t={}){return new St({view(e){return new A_(e,t)}})}class A_{constructor(e,n){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=n.width||1,this.color=n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let i=s=>{this[r](s)};return e.dom.addEventListener(r,i),{name:r,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n;if(!e.parent.inlineContent){let o=e.nodeBefore,a=e.nodeAfter;if(o||a){let l=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0)).getBoundingClientRect(),c=o?l.bottom:l.top;o&&a&&(c=(c+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:l.left,right:l.right,top:c-this.width/2,bottom:c+this.width/2}}}if(!n){let o=this.editorView.coordsAtPos(this.cursorPos);n={left:o.left-this.width/2,right:o.left+this.width/2,top:o.top,bottom:o.bottom}}let r=this.editorView.dom.offsetParent;this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);let i,s;if(!r||r==document.body&&getComputedStyle(r).position=="static")i=-pageXOffset,s=-pageYOffset;else{let o=r.getBoundingClientRect();i=o.left-r.scrollLeft,s=o.top-r.scrollTop}this.element.style.left=n.left-i+"px",this.element.style.top=n.top-s+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(o=n0(this.editorView.state.doc,o,this.editorView.dragging.slice),o==null))return this.setCursor(null);this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const M_=Gt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[I_(this.options)]}});class Je extends ue{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Je.valid(r)?new Je(r):ue.near(r)}content(){return J.empty}eq(e){return e instanceof Je&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Je(e.resolve(n.pos))}getBookmark(){return new Mp(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!N_(e)||!O_(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Je.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(Je.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!fe.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(Je.valid(a))return a}return null}}}Je.prototype.visible=!1;Je.findFrom=Je.findGapCursorFrom;ue.jsonID("gapcursor",Je);class Mp{constructor(e){this.pos=e}map(e){return new Mp(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Je.valid(n)?new Je(n):ue.near(n)}}function N_(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function O_(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function D_(){return new St({props:{decorations:P_,createSelectionBetween(t,e,n){return e.pos==n.pos&&Je.valid(n)?new Je(n):null},handleClick:R_,handleKeyDown:__,handleDOMEvents:{beforeinput:L_}}})}const __=pp({ArrowLeft:Tl("horiz",-1),ArrowRight:Tl("horiz",1),ArrowUp:Tl("vert",-1),ArrowDown:Tl("vert",1)});function Tl(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof pe){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Je.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new Je(c))),!0):!1}}function R_(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Je.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&fe.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Je(r))),!0)}function L_(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Je))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=U.empty;for(let o=r.length-1;o>=0;o--)i=U.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new J(i,0,0));return s.setSelection(pe.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function P_(t){if(!(t.selection instanceof Je))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Ze.create(t.doc,[zt.widget(t.selection.head,e,{key:"gapcursor"})])}const B_=Gt.create({name:"gapCursor",addProseMirrorPlugins(){return[D_()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Se(re(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),F_=ht.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",st(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const h=l.filter(d=>a.includes(d.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),V_=ht.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,st(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Hd({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var kc=200,Et=function(){};Et.prototype.append=function(e){return e.length?(e=Et.from(e),!this.length&&e||e.length<kc&&this.leafAppend(e)||this.length<kc&&e.leafPrepend(this)||this.appendInner(e)):this};Et.prototype.prepend=function(e){return e.length?Et.from(e).append(this):this};Et.prototype.appendInner=function(e){return new $_(this,e)};Et.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Et.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Et.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Et.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Et.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};Et.from=function(e){return e instanceof Et?e:e&&e.length?new CE(e):Et.empty};var CE=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=kc)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=kc)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Et);Et.empty=new CE([]);var $_=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(Et),kE=Et;const z_=500;class On{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((h,d)=>{if(!h.step){i||(i=this.remapping(r,d+1),s=i.maps.length),s--,u.push(h);return}if(i){u.push(new Kn(h.map));let f=h.step.map(i.slice(s)),p;f&&o.maybeStep(f).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Kn(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(h.step);if(h.selection)return a=i?h.selection.map(i.slice(s)):h.selection,l=new On(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),d=new Kn(e.mapping.maps[u],h,n),f;(f=l&&l.merge(d))&&(d=f,u?s.pop():a=a.slice(0,a.length-1)),s.push(d),n&&(o++,n=void 0),i||(l=d)}let c=o-r.depth;return c>H_&&(a=U_(a,c),o-=c),new On(a.append(s),o)}remapping(e,n){let r=new Bs;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new On(this.items.append(e.map(n=>new Kn(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(d=>{d.selection&&a--},i);let l=n;this.items.forEach(d=>{let f=s.getMirror(--l);if(f==null)return;o=Math.min(o,f);let p=s.maps[f];if(d.step){let g=e.steps[f].invert(e.docs[f]),m=d.selection&&d.selection.map(s.slice(l+1,f));m&&a++,r.push(new Kn(p,g,m))}else r.push(new Kn(p))},i);let c=[];for(let d=n;d<o;d++)c.push(new Kn(s.maps[d]));let u=this.items.slice(0,i).append(c).append(r),h=new On(u,a);return h.emptyItemCount()>z_&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let h=new Kn(c.invert(),l,u),d,f=i.length-1;(d=i.length&&i[f].merge(h))?i[f]=d:i.push(h)}}else o.map&&r--},this.items.length,0),new On(kE.from(i.reverse()),s)}}On.empty=new On(kE.empty,0);function U_(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Kn{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Kn(n.getMap().invert(),n,this.selection)}}}class Ar{constructor(e,n,r,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i}}const H_=20;function j_(t,e,n,r){let i=n.getMeta(Ur),s;if(i)return i.historyState;n.getMeta(q_)&&(t=new Ar(t.done,t.undone,null,0));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ur))return o.getMeta(Ur).redo?new Ar(t.done.addTransform(n,void 0,r,Gl(e)),t.undone,Uy(n.mapping.maps[n.steps.length-1]),t.prevTime):new Ar(t.done,t.undone.addTransform(n,void 0,r,Gl(e)),null,t.prevTime);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.prevTime==0||!o&&(t.prevTime<(n.time||0)-r.newGroupDelay||!K_(n,t.prevRanges)),l=o?Uh(t.prevRanges,n.mapping):Uy(n.mapping.maps[n.steps.length-1]);return new Ar(t.done.addTransform(n,a?e.selection.getBookmark():void 0,r,Gl(e)),On.empty,l,n.time)}else return(s=n.getMeta("rebased"))?new Ar(t.done.rebased(n,s),t.undone.rebased(n,s),Uh(t.prevRanges,n.mapping),t.prevTime):new Ar(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Uh(t.prevRanges,n.mapping),t.prevTime)}function K_(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function Uy(t){let e=[];return t.forEach((n,r,i,s)=>e.push(i,s)),e}function Uh(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function IE(t,e,n,r){let i=Gl(e),s=Ur.get(e).spec.config,o=(r?t.undone:t.done).popEvent(e,i);if(!o)return;let a=o.selection.resolve(o.transform.doc),l=(r?t.done:t.undone).addTransform(o.transform,e.selection.getBookmark(),s,i),c=new Ar(r?l:o.remaining,r?o.remaining:l,null,0);n(o.transform.setSelection(a).setMeta(Ur,{redo:r,historyState:c}).scrollIntoView())}let Hh=!1,Hy=null;function Gl(t){let e=t.plugins;if(Hy!=e){Hh=!1,Hy=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Hh=!0;break}}return Hh}const Ur=new sn("history"),q_=new sn("closeHistory");function W_(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new St({key:Ur,state:{init(){return new Ar(On.empty,On.empty,null,0)},apply(e,n,r){return j_(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?AE:r=="historyRedo"?ME:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}const AE=(t,e)=>{let n=Ur.getState(t);return!n||n.done.eventCount==0?!1:(e&&IE(n,t,e,!1),!0)},ME=(t,e)=>{let n=Ur.getState(t);return!n||n.undone.eventCount==0?!1:(e&&IE(n,t,e,!0),!0)},G_=Gt.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>AE(t,e),redo:()=>({state:t,dispatch:e})=>ME(t,e)}},addProseMirrorPlugins(){return[W_(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}}),J_=ht.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",st(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t})=>t().insertContent({type:this.name}).command(({tr:e,dispatch:n})=>{var r;if(n){const{$to:i}=e.selection,s=i.end();if(i.nodeAfter)e.setSelection(pe.create(e.doc,i.pos));else{const o=(r=i.parent.type.contentMatch.defaultType)===null||r===void 0?void 0:r.create();o&&(e.insert(s,o),e.setSelection(pe.create(e.doc,s)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[OO({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),X_=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,Y_=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,Q_=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,Z_=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,eR=Yr.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",st(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Qs({find:X_,type:this.type}),Qs({find:Q_,type:this.type})]},addPasteRules(){return[Zs({find:Y_,type:this.type}),Zs({find:Z_,type:this.type})]}}),tR=ht.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",st(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),nR=/^(\d+)\.\s$/,rR=ht.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",st(this.options.HTMLAttributes,n),0]:["ol",st(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[vp({find:nR,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]})]}}),iR=ht.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",st(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),sR=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,oR=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,aR=Yr.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",st(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Qs({find:sR,type:this.type})]},addPasteRules(){return[Zs({find:oR,type:this.type})]}}),lR=ht.create({name:"text",group:"inline"}),cR=Gt.create({name:"starterKit",addExtensions(){var t,e,n,r,i,s,o,a,l,c,u,h,d,f,p,g,m,w;const D=[];return this.options.blockquote!==!1&&D.push(f_.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&D.push(b_.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&D.push(v_.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&D.push(S_.configure((r=this.options)===null||r===void 0?void 0:r.code)),this.options.codeBlock!==!1&&D.push(TE.configure((i=this.options)===null||i===void 0?void 0:i.codeBlock)),this.options.document!==!1&&D.push(k_.configure((s=this.options)===null||s===void 0?void 0:s.document)),this.options.dropcursor!==!1&&D.push(M_.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&D.push(B_.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&D.push(F_.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&D.push(V_.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&D.push(G_.configure((u=this.options)===null||u===void 0?void 0:u.history)),this.options.horizontalRule!==!1&&D.push(J_.configure((h=this.options)===null||h===void 0?void 0:h.horizontalRule)),this.options.italic!==!1&&D.push(eR.configure((d=this.options)===null||d===void 0?void 0:d.italic)),this.options.listItem!==!1&&D.push(tR.configure((f=this.options)===null||f===void 0?void 0:f.listItem)),this.options.orderedList!==!1&&D.push(rR.configure((p=this.options)===null||p===void 0?void 0:p.orderedList)),this.options.paragraph!==!1&&D.push(iR.configure((g=this.options)===null||g===void 0?void 0:g.paragraph)),this.options.strike!==!1&&D.push(aR.configure((m=this.options)===null||m===void 0?void 0:m.strike)),this.options.text!==!1&&D.push(lR.configure((w=this.options)===null||w===void 0?void 0:w.text)),D}});var Np={exports:{}};function Op(t){return t instanceof Map?t.clear=t.delete=t.set=function(){throw new Error("map is read-only")}:t instanceof Set&&(t.add=t.clear=t.delete=function(){throw new Error("set is read-only")}),Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];typeof n=="object"&&!Object.isFrozen(n)&&Op(n)}),t}Np.exports=Op;Np.exports.default=Op;class jy{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function NE(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function Lr(t,...e){const n=Object.create(null);for(const r in t)n[r]=t[r];return e.forEach(function(r){for(const i in r)n[i]=r[i]}),n}const uR="</span>",Ky=t=>!!t.scope||t.sublanguage&&t.language,hR=(t,{prefix:e})=>{if(t.includes(".")){const n=t.split(".");return[`${e}${n.shift()}`,...n.map((r,i)=>`${r}${"_".repeat(i+1)}`)].join(" ")}return`${e}${t}`};class dR{constructor(e,n){this.buffer="",this.classPrefix=n.classPrefix,e.walk(this)}addText(e){this.buffer+=NE(e)}openNode(e){if(!Ky(e))return;let n="";e.sublanguage?n=`language-${e.language}`:n=hR(e.scope,{prefix:this.classPrefix}),this.span(n)}closeNode(e){!Ky(e)||(this.buffer+=uR)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}const qy=(t={})=>{const e={children:[]};return Object.assign(e,t),e};class Dp{constructor(){this.rootNode=qy(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const n=qy({scope:e});this.add(n),this.stack.push(n)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,n){return typeof n=="string"?e.addText(n):n.children&&(e.openNode(n),n.children.forEach(r=>this._walk(e,r)),e.closeNode(n)),e}static _collapse(e){typeof e!="string"&&(!e.children||(e.children.every(n=>typeof n=="string")?e.children=[e.children.join("")]:e.children.forEach(n=>{Dp._collapse(n)})))}}class fR extends Dp{constructor(e){super(),this.options=e}addKeyword(e,n){e!==""&&(this.openNode(n),this.addText(e),this.closeNode())}addText(e){e!==""&&this.add(e)}addSublanguage(e,n){const r=e.root;r.sublanguage=!0,r.language=n,this.add(r)}toHTML(){return new dR(this,this.options).value()}finalize(){return!0}}function va(t){return t?typeof t=="string"?t:t.source:null}function OE(t){return as("(?=",t,")")}function pR(t){return as("(?:",t,")*")}function gR(t){return as("(?:",t,")?")}function as(...t){return t.map(n=>va(n)).join("")}function mR(t){const e=t[t.length-1];return typeof e=="object"&&e.constructor===Object?(t.splice(t.length-1,1),e):{}}function _p(...t){const e=mR(t);return"("+(e.capture?"":"?:")+t.map(r=>va(r)).join("|")+")"}function DE(t){return new RegExp(t.toString()+"|").exec("").length-1}function yR(t,e){const n=t&&t.exec(e);return n&&n.index===0}const bR=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function Rp(t,{joinWith:e}){let n=0;return t.map(r=>{n+=1;const i=n;let s=va(r),o="";for(;s.length>0;){const a=bR.exec(s);if(!a){o+=s;break}o+=s.substring(0,a.index),s=s.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?o+="\\"+String(Number(a[1])+i):(o+=a[0],a[0]==="("&&n++)}return o}).map(r=>`(${r})`).join(e)}const wR=/\b\B/,_E="[a-zA-Z]\\w*",Lp="[a-zA-Z_]\\w*",RE="\\b\\d+(\\.\\d+)?",LE="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",PE="\\b(0b[01]+)",vR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",ER=(t={})=>{const e=/^#![ ]*\//;return t.binary&&(t.begin=as(e,/.*\b/,t.binary,/\b.*/)),Lr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(n,r)=>{n.index!==0&&r.ignoreMatch()}},t)},Ea={begin:"\\\\[\\s\\S]",relevance:0},xR={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Ea]},SR={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Ea]},TR={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},Cu=function(t,e,n={}){const r=Lr({scope:"comment",begin:t,end:e,contains:[]},n);r.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const i=_p("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return r.contains.push({begin:as(/[ ]+/,"(",i,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),r},CR=Cu("//","$"),kR=Cu("/\\*","\\*/"),IR=Cu("#","$"),AR={scope:"number",begin:RE,relevance:0},MR={scope:"number",begin:LE,relevance:0},NR={scope:"number",begin:PE,relevance:0},OR={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[Ea,{begin:/\[/,end:/\]/,relevance:0,contains:[Ea]}]}]},DR={scope:"title",begin:_E,relevance:0},_R={scope:"title",begin:Lp,relevance:0},RR={begin:"\\.\\s*"+Lp,relevance:0},LR=function(t){return Object.assign(t,{"on:begin":(e,n)=>{n.data._beginMatch=e[1]},"on:end":(e,n)=>{n.data._beginMatch!==e[1]&&n.ignoreMatch()}})};var Cl=Object.freeze({__proto__:null,MATCH_NOTHING_RE:wR,IDENT_RE:_E,UNDERSCORE_IDENT_RE:Lp,NUMBER_RE:RE,C_NUMBER_RE:LE,BINARY_NUMBER_RE:PE,RE_STARTERS_RE:vR,SHEBANG:ER,BACKSLASH_ESCAPE:Ea,APOS_STRING_MODE:xR,QUOTE_STRING_MODE:SR,PHRASAL_WORDS_MODE:TR,COMMENT:Cu,C_LINE_COMMENT_MODE:CR,C_BLOCK_COMMENT_MODE:kR,HASH_COMMENT_MODE:IR,NUMBER_MODE:AR,C_NUMBER_MODE:MR,BINARY_NUMBER_MODE:NR,REGEXP_MODE:OR,TITLE_MODE:DR,UNDERSCORE_TITLE_MODE:_R,METHOD_GUARD:RR,END_SAME_AS_BEGIN:LR});function PR(t,e){t.input[t.index-1]==="."&&e.ignoreMatch()}function BR(t,e){t.className!==void 0&&(t.scope=t.className,delete t.className)}function FR(t,e){!e||!t.beginKeywords||(t.begin="\\b("+t.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",t.__beforeBegin=PR,t.keywords=t.keywords||t.beginKeywords,delete t.beginKeywords,t.relevance===void 0&&(t.relevance=0))}function VR(t,e){!Array.isArray(t.illegal)||(t.illegal=_p(...t.illegal))}function $R(t,e){if(!!t.match){if(t.begin||t.end)throw new Error("begin & end are not supported with match");t.begin=t.match,delete t.match}}function zR(t,e){t.relevance===void 0&&(t.relevance=1)}const UR=(t,e)=>{if(!t.beforeMatch)return;if(t.starts)throw new Error("beforeMatch cannot be used with starts");const n=Object.assign({},t);Object.keys(t).forEach(r=>{delete t[r]}),t.keywords=n.keywords,t.begin=as(n.beforeMatch,OE(n.begin)),t.starts={relevance:0,contains:[Object.assign(n,{endsParent:!0})]},t.relevance=0,delete n.beforeMatch},HR=["of","and","for","in","not","or","if","then","parent","list","value"],jR="keyword";function BE(t,e,n=jR){const r=Object.create(null);return typeof t=="string"?i(n,t.split(" ")):Array.isArray(t)?i(n,t):Object.keys(t).forEach(function(s){Object.assign(r,BE(t[s],e,s))}),r;function i(s,o){e&&(o=o.map(a=>a.toLowerCase())),o.forEach(function(a){const l=a.split("|");r[l[0]]=[s,KR(l[0],l[1])]})}}function KR(t,e){return e?Number(e):qR(t)?0:1}function qR(t){return HR.includes(t.toLowerCase())}const Wy={},zi=t=>{console.error(t)},Gy=(t,...e)=>{console.log(`WARN: ${t}`,...e)},ys=(t,e)=>{Wy[`${t}/${e}`]||(console.log(`Deprecated as of ${t}. ${e}`),Wy[`${t}/${e}`]=!0)},Ic=new Error;function FE(t,e,{key:n}){let r=0;const i=t[n],s={},o={};for(let a=1;a<=e.length;a++)o[a+r]=i[a],s[a+r]=!0,r+=DE(e[a-1]);t[n]=o,t[n]._emit=s,t[n]._multi=!0}function WR(t){if(!!Array.isArray(t.begin)){if(t.skip||t.excludeBegin||t.returnBegin)throw zi("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Ic;if(typeof t.beginScope!="object"||t.beginScope===null)throw zi("beginScope must be object"),Ic;FE(t,t.begin,{key:"beginScope"}),t.begin=Rp(t.begin,{joinWith:""})}}function GR(t){if(!!Array.isArray(t.end)){if(t.skip||t.excludeEnd||t.returnEnd)throw zi("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Ic;if(typeof t.endScope!="object"||t.endScope===null)throw zi("endScope must be object"),Ic;FE(t,t.end,{key:"endScope"}),t.end=Rp(t.end,{joinWith:""})}}function JR(t){t.scope&&typeof t.scope=="object"&&t.scope!==null&&(t.beginScope=t.scope,delete t.scope)}function XR(t){JR(t),typeof t.beginScope=="string"&&(t.beginScope={_wrap:t.beginScope}),typeof t.endScope=="string"&&(t.endScope={_wrap:t.endScope}),WR(t),GR(t)}function YR(t){function e(o,a){return new RegExp(va(o),"m"+(t.case_insensitive?"i":"")+(t.unicodeRegex?"u":"")+(a?"g":""))}class n{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=DE(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const a=this.regexes.map(l=>l[1]);this.matcherRe=e(Rp(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;const l=this.matcherRe.exec(a);if(!l)return null;const c=l.findIndex((h,d)=>d>0&&h!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class r{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];const l=new n;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){const l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function i(o){const a=new r;return o.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),o.terminatorEnd&&a.addRule(o.terminatorEnd,{type:"end"}),o.illegal&&a.addRule(o.illegal,{type:"illegal"}),a}function s(o,a){const l=o;if(o.isCompiled)return l;[BR,$R,XR,UR].forEach(u=>u(o,a)),t.compilerExtensions.forEach(u=>u(o,a)),o.__beforeBegin=null,[FR,VR,zR].forEach(u=>u(o,a)),o.isCompiled=!0;let c=null;return typeof o.keywords=="object"&&o.keywords.$pattern&&(o.keywords=Object.assign({},o.keywords),c=o.keywords.$pattern,delete o.keywords.$pattern),c=c||/\w+/,o.keywords&&(o.keywords=BE(o.keywords,t.case_insensitive)),l.keywordPatternRe=e(c,!0),a&&(o.begin||(o.begin=/\B|\b/),l.beginRe=e(l.begin),!o.end&&!o.endsWithParent&&(o.end=/\B|\b/),o.end&&(l.endRe=e(l.end)),l.terminatorEnd=va(l.end)||"",o.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(o.end?"|":"")+a.terminatorEnd)),o.illegal&&(l.illegalRe=e(o.illegal)),o.contains||(o.contains=[]),o.contains=[].concat(...o.contains.map(function(u){return QR(u==="self"?o:u)})),o.contains.forEach(function(u){s(u,l)}),o.starts&&s(o.starts,a),l.matcher=i(l),l}if(t.compilerExtensions||(t.compilerExtensions=[]),t.contains&&t.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return t.classNameAliases=Lr(t.classNameAliases||{}),s(t)}function VE(t){return t?t.endsWithParent||VE(t.starts):!1}function QR(t){return t.variants&&!t.cachedVariants&&(t.cachedVariants=t.variants.map(function(e){return Lr(t,{variants:null},e)})),t.cachedVariants?t.cachedVariants:VE(t)?Lr(t,{starts:t.starts?Lr(t.starts):null}):Object.isFrozen(t)?Lr(t):t}var ZR="11.6.0";class eL extends Error{constructor(e,n){super(e),this.name="HTMLInjectionError",this.html=n}}const jh=NE,Jy=Lr,Xy=Symbol("nomatch"),tL=7,nL=function(t){const e=Object.create(null),n=Object.create(null),r=[];let i=!0;const s="Could not find the language '{}', did you forget to load/include a language module?",o={disableAutodetect:!0,name:"Plain text",contains:[]};let a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:fR};function l(v){return a.noHighlightRe.test(v)}function c(v){let T=v.className+" ";T+=v.parentNode?v.parentNode.className:"";const M=a.languageDetectRe.exec(T);if(M){const q=Z(M[1]);return q||(Gy(s.replace("{}",M[1])),Gy("Falling back to no-highlight mode for this block.",v)),q?M[1]:"no-highlight"}return T.split(/\s+/).find(q=>l(q)||Z(q))}function u(v,T,M){let q="",ne="";typeof T=="object"?(q=v,M=T.ignoreIllegals,ne=T.language):(ys("10.7.0","highlight(lang, code, ...args) has been deprecated."),ys("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),ne=v,q=T),M===void 0&&(M=!0);const me={code:q,language:ne};Oe("before:highlight",me);const xe=me.result?me.result:h(me.language,me.code,M);return xe.code=me.code,Oe("after:highlight",xe),xe}function h(v,T,M,q){const ne=Object.create(null);function me(x,C){return x.keywords[C]}function xe(){if(!S.keywords){N.addText(A);return}let x=0;S.keywordPatternRe.lastIndex=0;let C=S.keywordPatternRe.exec(A),V="";for(;C;){V+=A.substring(x,C.index);const H=I.case_insensitive?C[0].toLowerCase():C[0],ce=me(S,H);if(ce){const[De,gn]=ce;if(N.addText(V),V="",ne[H]=(ne[H]||0)+1,ne[H]<=tL&&(B+=gn),De.startsWith("_"))V+=C[0];else{const Er=I.classNameAliases[De]||De;N.addKeyword(C[0],Er)}}else V+=C[0];x=S.keywordPatternRe.lastIndex,C=S.keywordPatternRe.exec(A)}V+=A.substring(x),N.addText(V)}function Ye(){if(A==="")return;let x=null;if(typeof S.subLanguage=="string"){if(!e[S.subLanguage]){N.addText(A);return}x=h(S.subLanguage,A,!0,G[S.subLanguage]),G[S.subLanguage]=x._top}else x=f(A,S.subLanguage.length?S.subLanguage:null);S.relevance>0&&(B+=x.relevance),N.addSublanguage(x._emitter,x.language)}function ke(){S.subLanguage!=null?Ye():xe(),A=""}function Le(x,C){let V=1;const H=C.length-1;for(;V<=H;){if(!x._emit[V]){V++;continue}const ce=I.classNameAliases[x[V]]||x[V],De=C[V];ce?N.addKeyword(De,ce):(A=De,xe(),A=""),V++}}function je(x,C){return x.scope&&typeof x.scope=="string"&&N.openNode(I.classNameAliases[x.scope]||x.scope),x.beginScope&&(x.beginScope._wrap?(N.addKeyword(A,I.classNameAliases[x.beginScope._wrap]||x.beginScope._wrap),A=""):x.beginScope._multi&&(Le(x.beginScope,C),A="")),S=Object.create(x,{parent:{value:S}}),S}function gt(x,C,V){let H=yR(x.endRe,V);if(H){if(x["on:end"]){const ce=new jy(x);x["on:end"](C,ce),ce.isMatchIgnored&&(H=!1)}if(H){for(;x.endsParent&&x.parent;)x=x.parent;return x}}if(x.endsWithParent)return gt(x.parent,C,V)}function Ct(x){return S.matcher.regexIndex===0?(A+=x[0],1):(te=!0,0)}function mt(x){const C=x[0],V=x.rule,H=new jy(V),ce=[V.__beforeBegin,V["on:begin"]];for(const De of ce)if(!!De&&(De(x,H),H.isMatchIgnored))return Ct(C);return V.skip?A+=C:(V.excludeBegin&&(A+=C),ke(),!V.returnBegin&&!V.excludeBegin&&(A=C)),je(V,x),V.returnBegin?0:C.length}function kt(x){const C=x[0],V=T.substring(x.index),H=gt(S,x,V);if(!H)return Xy;const ce=S;S.endScope&&S.endScope._wrap?(ke(),N.addKeyword(C,S.endScope._wrap)):S.endScope&&S.endScope._multi?(ke(),Le(S.endScope,x)):ce.skip?A+=C:(ce.returnEnd||ce.excludeEnd||(A+=C),ke(),ce.excludeEnd&&(A=C));do S.scope&&N.closeNode(),!S.skip&&!S.subLanguage&&(B+=S.relevance),S=S.parent;while(S!==H.parent);return H.starts&&je(H.starts,x),ce.returnEnd?0:C.length}function Jt(){const x=[];for(let C=S;C!==I;C=C.parent)C.scope&&x.unshift(C.scope);x.forEach(C=>N.openNode(C))}let b={};function E(x,C){const V=C&&C[0];if(A+=x,V==null)return ke(),0;if(b.type==="begin"&&C.type==="end"&&b.index===C.index&&V===""){if(A+=T.slice(C.index,C.index+1),!i){const H=new Error(`0 width match regex (${v})`);throw H.languageName=v,H.badRule=b.rule,H}return 1}if(b=C,C.type==="begin")return mt(C);if(C.type==="illegal"&&!M){const H=new Error('Illegal lexeme "'+V+'" for mode "'+(S.scope||"<unnamed>")+'"');throw H.mode=S,H}else if(C.type==="end"){const H=kt(C);if(H!==Xy)return H}if(C.type==="illegal"&&V==="")return 1;if(X>1e5&&X>C.index*3)throw new Error("potential infinite loop, way more iterations than matches");return A+=V,V.length}const I=Z(v);if(!I)throw zi(s.replace("{}",v)),new Error('Unknown language: "'+v+'"');const $=YR(I);let L="",S=q||$;const G={},N=new a.__emitter(a);Jt();let A="",B=0,Y=0,X=0,te=!1;try{for(S.matcher.considerAll();;){X++,te?te=!1:S.matcher.considerAll(),S.matcher.lastIndex=Y;const x=S.matcher.exec(T);if(!x)break;const C=T.substring(Y,x.index),V=E(C,x);Y=x.index+V}return E(T.substring(Y)),N.closeAllNodes(),N.finalize(),L=N.toHTML(),{language:v,value:L,relevance:B,illegal:!1,_emitter:N,_top:S}}catch(x){if(x.message&&x.message.includes("Illegal"))return{language:v,value:jh(T),illegal:!0,relevance:0,_illegalBy:{message:x.message,index:Y,context:T.slice(Y-100,Y+100),mode:x.mode,resultSoFar:L},_emitter:N};if(i)return{language:v,value:jh(T),illegal:!1,relevance:0,errorRaised:x,_emitter:N,_top:S};throw x}}function d(v){const T={value:jh(v),illegal:!1,relevance:0,_top:o,_emitter:new a.__emitter(a)};return T._emitter.addText(v),T}function f(v,T){T=T||a.languages||Object.keys(e);const M=d(v),q=T.filter(Z).filter(he).map(ke=>h(ke,v,!1));q.unshift(M);const ne=q.sort((ke,Le)=>{if(ke.relevance!==Le.relevance)return Le.relevance-ke.relevance;if(ke.language&&Le.language){if(Z(ke.language).supersetOf===Le.language)return 1;if(Z(Le.language).supersetOf===ke.language)return-1}return 0}),[me,xe]=ne,Ye=me;return Ye.secondBest=xe,Ye}function p(v,T,M){const q=T&&n[T]||M;v.classList.add("hljs"),v.classList.add(`language-${q}`)}function g(v){let T=null;const M=c(v);if(l(M))return;if(Oe("before:highlightElement",{el:v,language:M}),v.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(v)),a.throwUnescapedHTML))throw new eL("One of your code blocks includes unescaped HTML.",v.innerHTML);T=v;const q=T.textContent,ne=M?u(q,{language:M,ignoreIllegals:!0}):f(q);v.innerHTML=ne.value,p(v,M,ne.language),v.result={language:ne.language,re:ne.relevance,relevance:ne.relevance},ne.secondBest&&(v.secondBest={language:ne.secondBest.language,relevance:ne.secondBest.relevance}),Oe("after:highlightElement",{el:v,result:ne,text:q})}function m(v){a=Jy(a,v)}const w=()=>{y(),ys("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function D(){y(),ys("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let P=!1;function y(){if(document.readyState==="loading"){P=!0;return}document.querySelectorAll(a.cssSelector).forEach(g)}function F(){P&&y()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",F,!1);function R(v,T){let M=null;try{M=T(t)}catch(q){if(zi("Language definition for '{}' could not be registered.".replace("{}",v)),i)zi(q);else throw q;M=o}M.name||(M.name=v),e[v]=M,M.rawDefinition=T.bind(null,t),M.aliases&&ie(M.aliases,{languageName:v})}function K(v){delete e[v];for(const T of Object.keys(n))n[T]===v&&delete n[T]}function _(){return Object.keys(e)}function Z(v){return v=(v||"").toLowerCase(),e[v]||e[n[v]]}function ie(v,{languageName:T}){typeof v=="string"&&(v=[v]),v.forEach(M=>{n[M.toLowerCase()]=T})}function he(v){const T=Z(v);return T&&!T.disableAutodetect}function ve(v){v["before:highlightBlock"]&&!v["before:highlightElement"]&&(v["before:highlightElement"]=T=>{v["before:highlightBlock"](Object.assign({block:T.el},T))}),v["after:highlightBlock"]&&!v["after:highlightElement"]&&(v["after:highlightElement"]=T=>{v["after:highlightBlock"](Object.assign({block:T.el},T))})}function Ee(v){ve(v),r.push(v)}function Oe(v,T){const M=v;r.forEach(function(q){q[M]&&q[M](T)})}function Ue(v){return ys("10.7.0","highlightBlock will be removed entirely in v12.0"),ys("10.7.0","Please use highlightElement now."),g(v)}Object.assign(t,{highlight:u,highlightAuto:f,highlightAll:y,highlightElement:g,highlightBlock:Ue,configure:m,initHighlighting:w,initHighlightingOnLoad:D,registerLanguage:R,unregisterLanguage:K,listLanguages:_,getLanguage:Z,registerAliases:ie,autoDetection:he,inherit:Jy,addPlugin:Ee}),t.debugMode=function(){i=!1},t.safeMode=function(){i=!0},t.versionString=ZR,t.regex={concat:as,lookahead:OE,either:_p,optional:gR,anyNumberOfTimes:pR};for(const v in Cl)typeof Cl[v]=="object"&&Np.exports(Cl[v]);return Object.assign(t,Cl),t};var xa=nL({}),rL=xa;xa.HighlightJS=xa;xa.default=xa;var iL=rL;function $E(t,e=[]){return t.map(n=>{const r=[...e,...n.properties?n.properties.className:[]];return n.children?$E(n.children,r):{text:n.value,classes:r}}).flat()}function Yy(t){return t.value||t.children||[]}function sL(t){return Boolean(iL.getLanguage(t))}function Qy({doc:t,name:e,lowlight:n,defaultLanguage:r}){const i=[];return zd(t,s=>s.type.name===e).forEach(s=>{let o=s.pos+1;const a=s.node.attrs.language||r,l=n.listLanguages(),c=a&&(l.includes(a)||sL(a))?Yy(n.highlight(a,s.node.textContent)):Yy(n.highlightAuto(s.node.textContent));$E(c).forEach(u=>{const h=o+u.text.length;if(u.classes.length){const d=zt.inline(o,h,{class:u.classes.join(" ")});i.push(d)}o=h})}),Ze.create(t,i)}function oL(t){return typeof t=="function"}function aL({name:t,lowlight:e,defaultLanguage:n}){if(!["highlight","highlightAuto","listLanguages"].every(i=>oL(e[i])))throw Error("You should provide an instance of lowlight to use the code-block-lowlight extension");const r=new St({key:new sn("lowlight"),state:{init:(i,{doc:s})=>Qy({doc:s,name:t,lowlight:e,defaultLanguage:n}),apply:(i,s,o,a)=>{const l=o.selection.$head.parent.type.name,c=a.selection.$head.parent.type.name,u=zd(o.doc,d=>d.type.name===t),h=zd(a.doc,d=>d.type.name===t);return i.docChanged&&([l,c].includes(t)||h.length!==u.length||i.steps.some(d=>d.from!==void 0&&d.to!==void 0&&u.some(f=>f.pos>=d.from&&f.pos+f.node.nodeSize<=d.to)))?Qy({doc:i.doc,name:t,lowlight:e,defaultLanguage:n}):s.map(i.mapping,i.doc)}},props:{decorations(i){return r.getState(i)}}});return r}const lL=TE.extend({addOptions(){var t;return{...(t=this.parent)===null||t===void 0?void 0:t.call(this),lowlight:{},defaultLanguage:null}},addProseMirrorPlugins(){var t;return[...((t=this.parent)===null||t===void 0?void 0:t.call(this))||[],aL({name:this.name,lowlight:this.options.lowlight,defaultLanguage:this.options.defaultLanguage})]}}),cL=t=>({IMPORTANT:{scope:"meta",begin:"!important"},BLOCK_COMMENT:t.C_BLOCK_COMMENT_MODE,HEXCOLOR:{scope:"number",begin:/#(([0-9a-fA-F]{3,4})|(([0-9a-fA-F]{2}){3,4}))\b/},FUNCTION_DISPATCH:{className:"built_in",begin:/[\w-]+(?=\()/},ATTRIBUTE_SELECTOR_MODE:{scope:"selector-attr",begin:/\[/,end:/\]/,illegal:"$",contains:[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE]},CSS_NUMBER_MODE:{scope:"number",begin:t.NUMBER_RE+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",relevance:0},CSS_VARIABLE:{className:"attr",begin:/--[A-Za-z][A-Za-z0-9_-]*/}}),uL=["a","abbr","address","article","aside","audio","b","blockquote","body","button","canvas","caption","cite","code","dd","del","details","dfn","div","dl","dt","em","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","html","i","iframe","img","input","ins","kbd","label","legend","li","main","mark","menu","nav","object","ol","p","q","quote","samp","section","span","strong","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","ul","var","video"],hL=["any-hover","any-pointer","aspect-ratio","color","color-gamut","color-index","device-aspect-ratio","device-height","device-width","display-mode","forced-colors","grid","height","hover","inverted-colors","monochrome","orientation","overflow-block","overflow-inline","pointer","prefers-color-scheme","prefers-contrast","prefers-reduced-motion","prefers-reduced-transparency","resolution","scan","scripting","update","width","min-width","max-width","min-height","max-height"],dL=["active","any-link","blank","checked","current","default","defined","dir","disabled","drop","empty","enabled","first","first-child","first-of-type","fullscreen","future","focus","focus-visible","focus-within","has","host","host-context","hover","indeterminate","in-range","invalid","is","lang","last-child","last-of-type","left","link","local-link","not","nth-child","nth-col","nth-last-child","nth-last-col","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","past","placeholder-shown","read-only","read-write","required","right","root","scope","target","target-within","user-invalid","valid","visited","where"],fL=["after","backdrop","before","cue","cue-region","first-letter","first-line","grammar-error","marker","part","placeholder","selection","slotted","spelling-error"],pL=["align-content","align-items","align-self","all","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","backface-visibility","background","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","block-size","border","border-block","border-block-color","border-block-end","border-block-end-color","border-block-end-style","border-block-end-width","border-block-start","border-block-start-color","border-block-start-style","border-block-start-width","border-block-style","border-block-width","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-inline","border-inline-color","border-inline-end","border-inline-end-color","border-inline-end-style","border-inline-end-width","border-inline-start","border-inline-start-color","border-inline-start-style","border-inline-start-width","border-inline-style","border-inline-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","caret-color","clear","clip","clip-path","clip-rule","color","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","contain","content","content-visibility","counter-increment","counter-reset","cue","cue-after","cue-before","cursor","direction","display","empty-cells","filter","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","flow","font","font-display","font-family","font-feature-settings","font-kerning","font-language-override","font-size","font-size-adjust","font-smoothing","font-stretch","font-style","font-synthesis","font-variant","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variation-settings","font-weight","gap","glyph-orientation-vertical","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-gap","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","ime-mode","inline-size","isolation","justify-content","left","letter-spacing","line-break","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-block","margin-block-end","margin-block-start","margin-bottom","margin-inline","margin-inline-end","margin-inline-start","margin-left","margin-right","margin-top","marks","mask","mask-border","mask-border-mode","mask-border-outset","mask-border-repeat","mask-border-slice","mask-border-source","mask-border-width","mask-clip","mask-composite","mask-image","mask-mode","mask-origin","mask-position","mask-repeat","mask-size","mask-type","max-block-size","max-height","max-inline-size","max-width","min-block-size","min-height","min-inline-size","min-width","mix-blend-mode","nav-down","nav-index","nav-left","nav-right","nav-up","none","normal","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-wrap","overflow-x","overflow-y","padding","padding-block","padding-block-end","padding-block-start","padding-bottom","padding-inline","padding-inline-end","padding-inline-start","padding-left","padding-right","padding-top","page-break-after","page-break-before","page-break-inside","pause","pause-after","pause-before","perspective","perspective-origin","pointer-events","position","quotes","resize","rest","rest-after","rest-before","right","row-gap","scroll-margin","scroll-margin-block","scroll-margin-block-end","scroll-margin-block-start","scroll-margin-bottom","scroll-margin-inline","scroll-margin-inline-end","scroll-margin-inline-start","scroll-margin-left","scroll-margin-right","scroll-margin-top","scroll-padding","scroll-padding-block","scroll-padding-block-end","scroll-padding-block-start","scroll-padding-bottom","scroll-padding-inline","scroll-padding-inline-end","scroll-padding-inline-start","scroll-padding-left","scroll-padding-right","scroll-padding-top","scroll-snap-align","scroll-snap-stop","scroll-snap-type","scrollbar-color","scrollbar-gutter","scrollbar-width","shape-image-threshold","shape-margin","shape-outside","speak","speak-as","src","tab-size","table-layout","text-align","text-align-all","text-align-last","text-combine-upright","text-decoration","text-decoration-color","text-decoration-line","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-indent","text-justify","text-orientation","text-overflow","text-rendering","text-shadow","text-transform","text-underline-position","top","transform","transform-box","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","white-space","widows","width","will-change","word-break","word-spacing","word-wrap","writing-mode","z-index"].reverse();function gL(t){const e=t.regex,n=cL(t),r={begin:/-(webkit|moz|ms|o)-(?=[a-z])/},i="and or not only",s=/@-?\w[\w]*(-\w+)*/,o="[a-zA-Z-][a-zA-Z0-9_-]*",a=[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE];return{name:"CSS",case_insensitive:!0,illegal:/[=|'\$]/,keywords:{keyframePosition:"from to"},classNameAliases:{keyframePosition:"selector-tag"},contains:[n.BLOCK_COMMENT,r,n.CSS_NUMBER_MODE,{className:"selector-id",begin:/#[A-Za-z0-9_-]+/,relevance:0},{className:"selector-class",begin:"\\."+o,relevance:0},n.ATTRIBUTE_SELECTOR_MODE,{className:"selector-pseudo",variants:[{begin:":("+dL.join("|")+")"},{begin:":(:)?("+fL.join("|")+")"}]},n.CSS_VARIABLE,{className:"attribute",begin:"\\b("+pL.join("|")+")\\b"},{begin:/:/,end:/[;}{]/,contains:[n.BLOCK_COMMENT,n.HEXCOLOR,n.IMPORTANT,n.CSS_NUMBER_MODE,...a,{begin:/(url|data-uri)\(/,end:/\)/,relevance:0,keywords:{built_in:"url data-uri"},contains:[...a,{className:"string",begin:/[^)]/,endsWithParent:!0,excludeEnd:!0}]},n.FUNCTION_DISPATCH]},{begin:e.lookahead(/@/),end:"[{;]",relevance:0,illegal:/:/,contains:[{className:"keyword",begin:s},{begin:/\s/,endsWithParent:!0,excludeEnd:!0,relevance:0,keywords:{$pattern:/[a-z-]+/,keyword:i,attribute:hL.join(" ")},contains:[{begin:/[a-z-]+(?=:)/,className:"attribute"},...a,n.CSS_NUMBER_MODE]}]},{className:"selector-tag",begin:"\\b("+uL.join("|")+")\\b"}]}}const Zy="[A-Za-z$_][0-9A-Za-z$_]*",mL=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],yL=["true","false","null","undefined","NaN","Infinity"],zE=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],UE=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],HE=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],bL=["arguments","this","super","console","window","document","localStorage","module","global"],wL=[].concat(HE,zE,UE);function vL(t){const e=t.regex,n=(T,{after:M})=>{const q="</"+T[0].slice(1);return T.input.indexOf(q,M)!==-1},r=Zy,i={begin:"<>",end:"</>"},s=/<[A-Za-z0-9\\._:-]+\s*\/>/,o={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(T,M)=>{const q=T[0].length+T.index,ne=T.input[q];if(ne==="<"||ne===","){M.ignoreMatch();return}ne===">"&&(n(T,{after:q})||M.ignoreMatch());let me;if((me=T.input.substring(q).match(/^\s+extends\s+/))&&me.index===0){M.ignoreMatch();return}}},a={$pattern:Zy,keyword:mL,literal:yL,built_in:wL,"variable.language":bL},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",h={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},d={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},f={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"xml"}},p={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"css"}},g={className:"string",begin:"`",end:"`",contains:[t.BACKSLASH_ESCAPE,d]},m=t.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:r+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),w={className:"comment",variants:[m,t.C_BLOCK_COMMENT_MODE,t.C_LINE_COMMENT_MODE]},D=[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,h];d.contains=D.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(D)});const P=[].concat(w,d.contains),y=P.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(P)}]),F={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y},R={variants:[{match:[/class/,/\s+/,r,/\s+/,/extends/,/\s+/,e.concat(r,"(",e.concat(/\./,r),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,r],scope:{1:"keyword",3:"title.class"}}]},K={relevance:0,match:e.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...zE,...UE]}},_={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},Z={variants:[{match:[/function/,/\s+/,r,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[F],illegal:/%/},ie={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function he(T){return e.concat("(?!",T.join("|"),")")}const ve={match:e.concat(/\b/,he([...HE,"super"]),r,e.lookahead(/\(/)),className:"title.function",relevance:0},Ee={begin:e.concat(/\./,e.lookahead(e.concat(r,/(?![0-9A-Za-z$_(])/))),end:r,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},Oe={match:[/get|set/,/\s+/,r,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},F]},Ue="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+t.UNDERSCORE_IDENT_RE+")\\s*=>",v={match:[/const|var|let/,/\s+/,r,/\s*/,/=\s*/,/(async\s*)?/,e.lookahead(Ue)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[F]};return{name:"Javascript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:y,CLASS_REFERENCE:K},illegal:/#(?![$_A-z])/,contains:[t.SHEBANG({label:"shebang",binary:"node",relevance:5}),_,t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,w,h,K,{className:"attr",begin:r+e.lookahead(":"),relevance:0},v,{begin:"("+t.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[w,t.REGEXP_MODE,{className:"function",begin:Ue,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:t.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:i.begin,end:i.end},{match:s},{begin:o.begin,"on:begin":o.isTrulyOpeningTag,end:o.end}],subLanguage:"xml",contains:[{begin:o.begin,end:o.end,skip:!0,contains:["self"]}]}]},Z,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+t.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[F,t.inherit(t.TITLE_MODE,{begin:r,className:"title.function"})]},{match:/\.\.\./,relevance:0},Ee,{match:"\\$"+r,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[F]},ve,ie,R,Oe,{match:/\$[(.]/}]}}const Ac="[A-Za-z$_][0-9A-Za-z$_]*",jE=["as","in","of","if","for","while","finally","var","new","function","do","return","void","else","break","catch","instanceof","with","throw","case","default","try","switch","continue","typeof","delete","let","yield","const","class","debugger","async","await","static","import","from","export","extends"],KE=["true","false","null","undefined","NaN","Infinity"],qE=["Object","Function","Boolean","Symbol","Math","Date","Number","BigInt","String","RegExp","Array","Float32Array","Float64Array","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array","Set","Map","WeakSet","WeakMap","ArrayBuffer","SharedArrayBuffer","Atomics","DataView","JSON","Promise","Generator","GeneratorFunction","AsyncFunction","Reflect","Proxy","Intl","WebAssembly"],WE=["Error","EvalError","InternalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"],GE=["setInterval","setTimeout","clearInterval","clearTimeout","require","exports","eval","isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape"],JE=["arguments","this","super","console","window","document","localStorage","module","global"],XE=[].concat(GE,qE,WE);function EL(t){const e=t.regex,n=(T,{after:M})=>{const q="</"+T[0].slice(1);return T.input.indexOf(q,M)!==-1},r=Ac,i={begin:"<>",end:"</>"},s=/<[A-Za-z0-9\\._:-]+\s*\/>/,o={begin:/<[A-Za-z0-9\\._:-]+/,end:/\/[A-Za-z0-9\\._:-]+>|\/>/,isTrulyOpeningTag:(T,M)=>{const q=T[0].length+T.index,ne=T.input[q];if(ne==="<"||ne===","){M.ignoreMatch();return}ne===">"&&(n(T,{after:q})||M.ignoreMatch());let me;if((me=T.input.substring(q).match(/^\s+extends\s+/))&&me.index===0){M.ignoreMatch();return}}},a={$pattern:Ac,keyword:jE,literal:KE,built_in:XE,"variable.language":JE},l="[0-9](_?[0-9])*",c=`\\.(${l})`,u="0|[1-9](_?[0-9])*|0[0-7]*[89][0-9]*",h={className:"number",variants:[{begin:`(\\b(${u})((${c})|\\.)?|(${c}))[eE][+-]?(${l})\\b`},{begin:`\\b(${u})\\b((${c})\\b|\\.)?|(${c})\\b`},{begin:"\\b(0|[1-9](_?[0-9])*)n\\b"},{begin:"\\b0[xX][0-9a-fA-F](_?[0-9a-fA-F])*n?\\b"},{begin:"\\b0[bB][0-1](_?[0-1])*n?\\b"},{begin:"\\b0[oO][0-7](_?[0-7])*n?\\b"},{begin:"\\b0[0-7]+n?\\b"}],relevance:0},d={className:"subst",begin:"\\$\\{",end:"\\}",keywords:a,contains:[]},f={begin:"html`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"xml"}},p={begin:"css`",end:"",starts:{end:"`",returnEnd:!1,contains:[t.BACKSLASH_ESCAPE,d],subLanguage:"css"}},g={className:"string",begin:"`",end:"`",contains:[t.BACKSLASH_ESCAPE,d]},m=t.COMMENT(/\/\*\*(?!\/)/,"\\*/",{relevance:0,contains:[{begin:"(?=@[A-Za-z]+)",relevance:0,contains:[{className:"doctag",begin:"@[A-Za-z]+"},{className:"type",begin:"\\{",end:"\\}",excludeEnd:!0,excludeBegin:!0,relevance:0},{className:"variable",begin:r+"(?=\\s*(-)|$)",endsParent:!0,relevance:0},{begin:/(?=[^\n])\s/,relevance:0}]}]}),w={className:"comment",variants:[m,t.C_BLOCK_COMMENT_MODE,t.C_LINE_COMMENT_MODE]},D=[t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,h];d.contains=D.concat({begin:/\{/,end:/\}/,keywords:a,contains:["self"].concat(D)});const P=[].concat(w,d.contains),y=P.concat([{begin:/\(/,end:/\)/,keywords:a,contains:["self"].concat(P)}]),F={className:"params",begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y},R={variants:[{match:[/class/,/\s+/,r,/\s+/,/extends/,/\s+/,e.concat(r,"(",e.concat(/\./,r),")*")],scope:{1:"keyword",3:"title.class",5:"keyword",7:"title.class.inherited"}},{match:[/class/,/\s+/,r],scope:{1:"keyword",3:"title.class"}}]},K={relevance:0,match:e.either(/\bJSON/,/\b[A-Z][a-z]+([A-Z][a-z]*|\d)*/,/\b[A-Z]{2,}([A-Z][a-z]+|\d)+([A-Z][a-z]*)*/,/\b[A-Z]{2,}[a-z]+([A-Z][a-z]+|\d)*([A-Z][a-z]*)*/),className:"title.class",keywords:{_:[...qE,...WE]}},_={label:"use_strict",className:"meta",relevance:10,begin:/^\s*['"]use (strict|asm)['"]/},Z={variants:[{match:[/function/,/\s+/,r,/(?=\s*\()/]},{match:[/function/,/\s*(?=\()/]}],className:{1:"keyword",3:"title.function"},label:"func.def",contains:[F],illegal:/%/},ie={relevance:0,match:/\b[A-Z][A-Z_0-9]+\b/,className:"variable.constant"};function he(T){return e.concat("(?!",T.join("|"),")")}const ve={match:e.concat(/\b/,he([...GE,"super"]),r,e.lookahead(/\(/)),className:"title.function",relevance:0},Ee={begin:e.concat(/\./,e.lookahead(e.concat(r,/(?![0-9A-Za-z$_(])/))),end:r,excludeBegin:!0,keywords:"prototype",className:"property",relevance:0},Oe={match:[/get|set/,/\s+/,r,/(?=\()/],className:{1:"keyword",3:"title.function"},contains:[{begin:/\(\)/},F]},Ue="(\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)|"+t.UNDERSCORE_IDENT_RE+")\\s*=>",v={match:[/const|var|let/,/\s+/,r,/\s*/,/=\s*/,/(async\s*)?/,e.lookahead(Ue)],keywords:"async",className:{1:"keyword",3:"title.function"},contains:[F]};return{name:"Javascript",aliases:["js","jsx","mjs","cjs"],keywords:a,exports:{PARAMS_CONTAINS:y,CLASS_REFERENCE:K},illegal:/#(?![$_A-z])/,contains:[t.SHEBANG({label:"shebang",binary:"node",relevance:5}),_,t.APOS_STRING_MODE,t.QUOTE_STRING_MODE,f,p,g,w,h,K,{className:"attr",begin:r+e.lookahead(":"),relevance:0},v,{begin:"("+t.RE_STARTERS_RE+"|\\b(case|return|throw)\\b)\\s*",keywords:"return throw case",relevance:0,contains:[w,t.REGEXP_MODE,{className:"function",begin:Ue,returnBegin:!0,end:"\\s*=>",contains:[{className:"params",variants:[{begin:t.UNDERSCORE_IDENT_RE,relevance:0},{className:null,begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:a,contains:y}]}]},{begin:/,/,relevance:0},{match:/\s+/,relevance:0},{variants:[{begin:i.begin,end:i.end},{match:s},{begin:o.begin,"on:begin":o.isTrulyOpeningTag,end:o.end}],subLanguage:"xml",contains:[{begin:o.begin,end:o.end,skip:!0,contains:["self"]}]}]},Z,{beginKeywords:"while if switch catch for"},{begin:"\\b(?!function)"+t.UNDERSCORE_IDENT_RE+"\\([^()]*(\\([^()]*(\\([^()]*\\)[^()]*)*\\)[^()]*)*\\)\\s*\\{",returnBegin:!0,label:"func.def",contains:[F,t.inherit(t.TITLE_MODE,{begin:r,className:"title.function"})]},{match:/\.\.\./,relevance:0},Ee,{match:"\\$"+r,relevance:0},{match:[/\bconstructor(?=\s*\()/],className:{1:"title.function"},contains:[F]},ve,ie,R,Oe,{match:/\$[(.]/}]}}function xL(t){const e=EL(t),n=Ac,r=["any","void","number","boolean","string","object","never","symbol","bigint","unknown"],i={beginKeywords:"namespace",end:/\{/,excludeEnd:!0,contains:[e.exports.CLASS_REFERENCE]},s={beginKeywords:"interface",end:/\{/,excludeEnd:!0,keywords:{keyword:"interface extends",built_in:r},contains:[e.exports.CLASS_REFERENCE]},o={className:"meta",relevance:10,begin:/^\s*['"]use strict['"]/},a=["type","namespace","interface","public","private","protected","implements","declare","abstract","readonly","enum","override"],l={$pattern:Ac,keyword:jE.concat(a),literal:KE,built_in:XE.concat(r),"variable.language":JE},c={className:"meta",begin:"@"+n},u=(d,f,p)=>{const g=d.contains.findIndex(m=>m.label===f);if(g===-1)throw new Error("can not find mode to replace");d.contains.splice(g,1,p)};Object.assign(e.keywords,l),e.exports.PARAMS_CONTAINS.push(c),e.contains=e.contains.concat([c,i,s]),u(e,"shebang",t.SHEBANG()),u(e,"use_strict",o);const h=e.contains.find(d=>d.label==="func.def");return h.relevance=0,Object.assign(e,{name:"TypeScript",aliases:["ts","tsx"]}),e}function SL(t){const e=t.regex,n=e.concat(/[\p{L}_]/u,e.optional(/[\p{L}0-9_.-]*:/u),/[\p{L}0-9_.-]*/u),r=/[\p{L}0-9._:-]+/u,i={className:"symbol",begin:/&[a-z]+;|&#[0-9]+;|&#x[a-f0-9]+;/},s={begin:/\s/,contains:[{className:"keyword",begin:/#?[a-z_][a-z1-9_-]+/,illegal:/\n/}]},o=t.inherit(s,{begin:/\(/,end:/\)/}),a=t.inherit(t.APOS_STRING_MODE,{className:"string"}),l=t.inherit(t.QUOTE_STRING_MODE,{className:"string"}),c={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:r,relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",endsParent:!0,variants:[{begin:/"/,end:/"/,contains:[i]},{begin:/'/,end:/'/,contains:[i]},{begin:/[^\s"'=<>`]+/}]}]}]};return{name:"HTML, XML",aliases:["html","xhtml","rss","atom","xjb","xsd","xsl","plist","wsf","svg"],case_insensitive:!0,unicodeRegex:!0,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,relevance:10,contains:[s,l,a,o,{begin:/\[/,end:/\]/,contains:[{className:"meta",begin:/<![a-z]/,end:/>/,contains:[s,o,l,a]}]}]},t.COMMENT(/<!--/,/-->/,{relevance:10}),{begin:/<!\[CDATA\[/,end:/\]\]>/,relevance:10},i,{className:"meta",end:/\?>/,variants:[{begin:/<\?xml/,relevance:10,contains:[l]},{begin:/<\?[a-z][a-z0-9]+/}]},{className:"tag",begin:/<style(?=\s|>)/,end:/>/,keywords:{name:"style"},contains:[c],starts:{end:/<\/style>/,returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:/<script(?=\s|>)/,end:/>/,keywords:{name:"script"},contains:[c],starts:{end:/<\/script>/,returnEnd:!0,subLanguage:["javascript","handlebars","xml"]}},{className:"tag",begin:/<>|<\/>/},{className:"tag",begin:e.concat(/</,e.lookahead(e.concat(n,e.either(/\/>/,/>/,/\s/)))),end:/\/?>/,contains:[{className:"name",begin:n,relevance:0,starts:c}]},{className:"tag",begin:e.concat(/<\//,e.lookahead(e.concat(n,/>/))),contains:[{className:"name",begin:n,relevance:0},{begin:/>/,relevance:0,endsParent:!0}]}]}}var Pp={exports:{}};function Bp(t){return t instanceof Map?t.clear=t.delete=t.set=function(){throw new Error("map is read-only")}:t instanceof Set&&(t.add=t.clear=t.delete=function(){throw new Error("set is read-only")}),Object.freeze(t),Object.getOwnPropertyNames(t).forEach(function(e){var n=t[e];typeof n=="object"&&!Object.isFrozen(n)&&Bp(n)}),t}Pp.exports=Bp;Pp.exports.default=Bp;class eb{constructor(e){e.data===void 0&&(e.data={}),this.data=e.data,this.isMatchIgnored=!1}ignoreMatch(){this.isMatchIgnored=!0}}function YE(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function Pr(t,...e){const n=Object.create(null);for(const r in t)n[r]=t[r];return e.forEach(function(r){for(const i in r)n[i]=r[i]}),n}const TL="</span>",tb=t=>!!t.scope||t.sublanguage&&t.language,CL=(t,{prefix:e})=>{if(t.includes(".")){const n=t.split(".");return[`${e}${n.shift()}`,...n.map((r,i)=>`${r}${"_".repeat(i+1)}`)].join(" ")}return`${e}${t}`};class kL{constructor(e,n){this.buffer="",this.classPrefix=n.classPrefix,e.walk(this)}addText(e){this.buffer+=YE(e)}openNode(e){if(!tb(e))return;let n="";e.sublanguage?n=`language-${e.language}`:n=CL(e.scope,{prefix:this.classPrefix}),this.span(n)}closeNode(e){!tb(e)||(this.buffer+=TL)}value(){return this.buffer}span(e){this.buffer+=`<span class="${e}">`}}const nb=(t={})=>{const e={children:[]};return Object.assign(e,t),e};class Fp{constructor(){this.rootNode=nb(),this.stack=[this.rootNode]}get top(){return this.stack[this.stack.length-1]}get root(){return this.rootNode}add(e){this.top.children.push(e)}openNode(e){const n=nb({scope:e});this.add(n),this.stack.push(n)}closeNode(){if(this.stack.length>1)return this.stack.pop()}closeAllNodes(){for(;this.closeNode(););}toJSON(){return JSON.stringify(this.rootNode,null,4)}walk(e){return this.constructor._walk(e,this.rootNode)}static _walk(e,n){return typeof n=="string"?e.addText(n):n.children&&(e.openNode(n),n.children.forEach(r=>this._walk(e,r)),e.closeNode(n)),e}static _collapse(e){typeof e!="string"&&(!e.children||(e.children.every(n=>typeof n=="string")?e.children=[e.children.join("")]:e.children.forEach(n=>{Fp._collapse(n)})))}}class IL extends Fp{constructor(e){super(),this.options=e}addKeyword(e,n){e!==""&&(this.openNode(n),this.addText(e),this.closeNode())}addText(e){e!==""&&this.add(e)}addSublanguage(e,n){const r=e.root;r.sublanguage=!0,r.language=n,this.add(r)}toHTML(){return new kL(this,this.options).value()}finalize(){return!0}}function Sa(t){return t?typeof t=="string"?t:t.source:null}function QE(t){return ls("(?=",t,")")}function AL(t){return ls("(?:",t,")*")}function ML(t){return ls("(?:",t,")?")}function ls(...t){return t.map(n=>Sa(n)).join("")}function NL(t){const e=t[t.length-1];return typeof e=="object"&&e.constructor===Object?(t.splice(t.length-1,1),e):{}}function Vp(...t){const e=NL(t);return"("+(e.capture?"":"?:")+t.map(r=>Sa(r)).join("|")+")"}function ZE(t){return new RegExp(t.toString()+"|").exec("").length-1}function OL(t,e){const n=t&&t.exec(e);return n&&n.index===0}const DL=/\[(?:[^\\\]]|\\.)*\]|\(\??|\\([1-9][0-9]*)|\\./;function $p(t,{joinWith:e}){let n=0;return t.map(r=>{n+=1;const i=n;let s=Sa(r),o="";for(;s.length>0;){const a=DL.exec(s);if(!a){o+=s;break}o+=s.substring(0,a.index),s=s.substring(a.index+a[0].length),a[0][0]==="\\"&&a[1]?o+="\\"+String(Number(a[1])+i):(o+=a[0],a[0]==="("&&n++)}return o}).map(r=>`(${r})`).join(e)}const _L=/\b\B/,ex="[a-zA-Z]\\w*",zp="[a-zA-Z_]\\w*",tx="\\b\\d+(\\.\\d+)?",nx="(-?)(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",rx="\\b(0b[01]+)",RL="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",LL=(t={})=>{const e=/^#![ ]*\//;return t.binary&&(t.begin=ls(e,/.*\b/,t.binary,/\b.*/)),Pr({scope:"meta",begin:e,end:/$/,relevance:0,"on:begin":(n,r)=>{n.index!==0&&r.ignoreMatch()}},t)},Ta={begin:"\\\\[\\s\\S]",relevance:0},PL={scope:"string",begin:"'",end:"'",illegal:"\\n",contains:[Ta]},BL={scope:"string",begin:'"',end:'"',illegal:"\\n",contains:[Ta]},FL={begin:/\b(a|an|the|are|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|they|like|more)\b/},ku=function(t,e,n={}){const r=Pr({scope:"comment",begin:t,end:e,contains:[]},n);r.contains.push({scope:"doctag",begin:"[ ]*(?=(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):)",end:/(TODO|FIXME|NOTE|BUG|OPTIMIZE|HACK|XXX):/,excludeBegin:!0,relevance:0});const i=Vp("I","a","is","so","us","to","at","if","in","it","on",/[A-Za-z]+['](d|ve|re|ll|t|s|n)/,/[A-Za-z]+[-][a-z]+/,/[A-Za-z][a-z]{2,}/);return r.contains.push({begin:ls(/[ ]+/,"(",i,/[.]?[:]?([.][ ]|[ ])/,"){3}")}),r},VL=ku("//","$"),$L=ku("/\\*","\\*/"),zL=ku("#","$"),UL={scope:"number",begin:tx,relevance:0},HL={scope:"number",begin:nx,relevance:0},jL={scope:"number",begin:rx,relevance:0},KL={begin:/(?=\/[^/\n]*\/)/,contains:[{scope:"regexp",begin:/\//,end:/\/[gimuy]*/,illegal:/\n/,contains:[Ta,{begin:/\[/,end:/\]/,relevance:0,contains:[Ta]}]}]},qL={scope:"title",begin:ex,relevance:0},WL={scope:"title",begin:zp,relevance:0},GL={begin:"\\.\\s*"+zp,relevance:0},JL=function(t){return Object.assign(t,{"on:begin":(e,n)=>{n.data._beginMatch=e[1]},"on:end":(e,n)=>{n.data._beginMatch!==e[1]&&n.ignoreMatch()}})};var kl=Object.freeze({__proto__:null,MATCH_NOTHING_RE:_L,IDENT_RE:ex,UNDERSCORE_IDENT_RE:zp,NUMBER_RE:tx,C_NUMBER_RE:nx,BINARY_NUMBER_RE:rx,RE_STARTERS_RE:RL,SHEBANG:LL,BACKSLASH_ESCAPE:Ta,APOS_STRING_MODE:PL,QUOTE_STRING_MODE:BL,PHRASAL_WORDS_MODE:FL,COMMENT:ku,C_LINE_COMMENT_MODE:VL,C_BLOCK_COMMENT_MODE:$L,HASH_COMMENT_MODE:zL,NUMBER_MODE:UL,C_NUMBER_MODE:HL,BINARY_NUMBER_MODE:jL,REGEXP_MODE:KL,TITLE_MODE:qL,UNDERSCORE_TITLE_MODE:WL,METHOD_GUARD:GL,END_SAME_AS_BEGIN:JL});function XL(t,e){t.input[t.index-1]==="."&&e.ignoreMatch()}function YL(t,e){t.className!==void 0&&(t.scope=t.className,delete t.className)}function QL(t,e){!e||!t.beginKeywords||(t.begin="\\b("+t.beginKeywords.split(" ").join("|")+")(?!\\.)(?=\\b|\\s)",t.__beforeBegin=XL,t.keywords=t.keywords||t.beginKeywords,delete t.beginKeywords,t.relevance===void 0&&(t.relevance=0))}function ZL(t,e){!Array.isArray(t.illegal)||(t.illegal=Vp(...t.illegal))}function eP(t,e){if(!!t.match){if(t.begin||t.end)throw new Error("begin & end are not supported with match");t.begin=t.match,delete t.match}}function tP(t,e){t.relevance===void 0&&(t.relevance=1)}const nP=(t,e)=>{if(!t.beforeMatch)return;if(t.starts)throw new Error("beforeMatch cannot be used with starts");const n=Object.assign({},t);Object.keys(t).forEach(r=>{delete t[r]}),t.keywords=n.keywords,t.begin=ls(n.beforeMatch,QE(n.begin)),t.starts={relevance:0,contains:[Object.assign(n,{endsParent:!0})]},t.relevance=0,delete n.beforeMatch},rP=["of","and","for","in","not","or","if","then","parent","list","value"],iP="keyword";function ix(t,e,n=iP){const r=Object.create(null);return typeof t=="string"?i(n,t.split(" ")):Array.isArray(t)?i(n,t):Object.keys(t).forEach(function(s){Object.assign(r,ix(t[s],e,s))}),r;function i(s,o){e&&(o=o.map(a=>a.toLowerCase())),o.forEach(function(a){const l=a.split("|");r[l[0]]=[s,sP(l[0],l[1])]})}}function sP(t,e){return e?Number(e):oP(t)?0:1}function oP(t){return rP.includes(t.toLowerCase())}const rb={},Ui=t=>{console.error(t)},ib=(t,...e)=>{console.log(`WARN: ${t}`,...e)},bs=(t,e)=>{rb[`${t}/${e}`]||(console.log(`Deprecated as of ${t}. ${e}`),rb[`${t}/${e}`]=!0)},Mc=new Error;function sx(t,e,{key:n}){let r=0;const i=t[n],s={},o={};for(let a=1;a<=e.length;a++)o[a+r]=i[a],s[a+r]=!0,r+=ZE(e[a-1]);t[n]=o,t[n]._emit=s,t[n]._multi=!0}function aP(t){if(!!Array.isArray(t.begin)){if(t.skip||t.excludeBegin||t.returnBegin)throw Ui("skip, excludeBegin, returnBegin not compatible with beginScope: {}"),Mc;if(typeof t.beginScope!="object"||t.beginScope===null)throw Ui("beginScope must be object"),Mc;sx(t,t.begin,{key:"beginScope"}),t.begin=$p(t.begin,{joinWith:""})}}function lP(t){if(!!Array.isArray(t.end)){if(t.skip||t.excludeEnd||t.returnEnd)throw Ui("skip, excludeEnd, returnEnd not compatible with endScope: {}"),Mc;if(typeof t.endScope!="object"||t.endScope===null)throw Ui("endScope must be object"),Mc;sx(t,t.end,{key:"endScope"}),t.end=$p(t.end,{joinWith:""})}}function cP(t){t.scope&&typeof t.scope=="object"&&t.scope!==null&&(t.beginScope=t.scope,delete t.scope)}function uP(t){cP(t),typeof t.beginScope=="string"&&(t.beginScope={_wrap:t.beginScope}),typeof t.endScope=="string"&&(t.endScope={_wrap:t.endScope}),aP(t),lP(t)}function hP(t){function e(o,a){return new RegExp(Sa(o),"m"+(t.case_insensitive?"i":"")+(t.unicodeRegex?"u":"")+(a?"g":""))}class n{constructor(){this.matchIndexes={},this.regexes=[],this.matchAt=1,this.position=0}addRule(a,l){l.position=this.position++,this.matchIndexes[this.matchAt]=l,this.regexes.push([l,a]),this.matchAt+=ZE(a)+1}compile(){this.regexes.length===0&&(this.exec=()=>null);const a=this.regexes.map(l=>l[1]);this.matcherRe=e($p(a,{joinWith:"|"}),!0),this.lastIndex=0}exec(a){this.matcherRe.lastIndex=this.lastIndex;const l=this.matcherRe.exec(a);if(!l)return null;const c=l.findIndex((h,d)=>d>0&&h!==void 0),u=this.matchIndexes[c];return l.splice(0,c),Object.assign(l,u)}}class r{constructor(){this.rules=[],this.multiRegexes=[],this.count=0,this.lastIndex=0,this.regexIndex=0}getMatcher(a){if(this.multiRegexes[a])return this.multiRegexes[a];const l=new n;return this.rules.slice(a).forEach(([c,u])=>l.addRule(c,u)),l.compile(),this.multiRegexes[a]=l,l}resumingScanAtSamePosition(){return this.regexIndex!==0}considerAll(){this.regexIndex=0}addRule(a,l){this.rules.push([a,l]),l.type==="begin"&&this.count++}exec(a){const l=this.getMatcher(this.regexIndex);l.lastIndex=this.lastIndex;let c=l.exec(a);if(this.resumingScanAtSamePosition()&&!(c&&c.index===this.lastIndex)){const u=this.getMatcher(0);u.lastIndex=this.lastIndex+1,c=u.exec(a)}return c&&(this.regexIndex+=c.position+1,this.regexIndex===this.count&&this.considerAll()),c}}function i(o){const a=new r;return o.contains.forEach(l=>a.addRule(l.begin,{rule:l,type:"begin"})),o.terminatorEnd&&a.addRule(o.terminatorEnd,{type:"end"}),o.illegal&&a.addRule(o.illegal,{type:"illegal"}),a}function s(o,a){const l=o;if(o.isCompiled)return l;[YL,eP,uP,nP].forEach(u=>u(o,a)),t.compilerExtensions.forEach(u=>u(o,a)),o.__beforeBegin=null,[QL,ZL,tP].forEach(u=>u(o,a)),o.isCompiled=!0;let c=null;return typeof o.keywords=="object"&&o.keywords.$pattern&&(o.keywords=Object.assign({},o.keywords),c=o.keywords.$pattern,delete o.keywords.$pattern),c=c||/\w+/,o.keywords&&(o.keywords=ix(o.keywords,t.case_insensitive)),l.keywordPatternRe=e(c,!0),a&&(o.begin||(o.begin=/\B|\b/),l.beginRe=e(l.begin),!o.end&&!o.endsWithParent&&(o.end=/\B|\b/),o.end&&(l.endRe=e(l.end)),l.terminatorEnd=Sa(l.end)||"",o.endsWithParent&&a.terminatorEnd&&(l.terminatorEnd+=(o.end?"|":"")+a.terminatorEnd)),o.illegal&&(l.illegalRe=e(o.illegal)),o.contains||(o.contains=[]),o.contains=[].concat(...o.contains.map(function(u){return dP(u==="self"?o:u)})),o.contains.forEach(function(u){s(u,l)}),o.starts&&s(o.starts,a),l.matcher=i(l),l}if(t.compilerExtensions||(t.compilerExtensions=[]),t.contains&&t.contains.includes("self"))throw new Error("ERR: contains `self` is not supported at the top-level of a language.  See documentation.");return t.classNameAliases=Pr(t.classNameAliases||{}),s(t)}function ox(t){return t?t.endsWithParent||ox(t.starts):!1}function dP(t){return t.variants&&!t.cachedVariants&&(t.cachedVariants=t.variants.map(function(e){return Pr(t,{variants:null},e)})),t.cachedVariants?t.cachedVariants:ox(t)?Pr(t,{starts:t.starts?Pr(t.starts):null}):Object.isFrozen(t)?Pr(t):t}var fP="11.6.0";class pP extends Error{constructor(e,n){super(e),this.name="HTMLInjectionError",this.html=n}}const Kh=YE,sb=Pr,ob=Symbol("nomatch"),gP=7,mP=function(t){const e=Object.create(null),n=Object.create(null),r=[];let i=!0;const s="Could not find the language '{}', did you forget to load/include a language module?",o={disableAutodetect:!0,name:"Plain text",contains:[]};let a={ignoreUnescapedHTML:!1,throwUnescapedHTML:!1,noHighlightRe:/^(no-?highlight)$/i,languageDetectRe:/\blang(?:uage)?-([\w-]+)\b/i,classPrefix:"hljs-",cssSelector:"pre code",languages:null,__emitter:IL};function l(v){return a.noHighlightRe.test(v)}function c(v){let T=v.className+" ";T+=v.parentNode?v.parentNode.className:"";const M=a.languageDetectRe.exec(T);if(M){const q=Z(M[1]);return q||(ib(s.replace("{}",M[1])),ib("Falling back to no-highlight mode for this block.",v)),q?M[1]:"no-highlight"}return T.split(/\s+/).find(q=>l(q)||Z(q))}function u(v,T,M){let q="",ne="";typeof T=="object"?(q=v,M=T.ignoreIllegals,ne=T.language):(bs("10.7.0","highlight(lang, code, ...args) has been deprecated."),bs("10.7.0",`Please use highlight(code, options) instead.
https://github.com/highlightjs/highlight.js/issues/2277`),ne=v,q=T),M===void 0&&(M=!0);const me={code:q,language:ne};Oe("before:highlight",me);const xe=me.result?me.result:h(me.language,me.code,M);return xe.code=me.code,Oe("after:highlight",xe),xe}function h(v,T,M,q){const ne=Object.create(null);function me(x,C){return x.keywords[C]}function xe(){if(!S.keywords){N.addText(A);return}let x=0;S.keywordPatternRe.lastIndex=0;let C=S.keywordPatternRe.exec(A),V="";for(;C;){V+=A.substring(x,C.index);const H=I.case_insensitive?C[0].toLowerCase():C[0],ce=me(S,H);if(ce){const[De,gn]=ce;if(N.addText(V),V="",ne[H]=(ne[H]||0)+1,ne[H]<=gP&&(B+=gn),De.startsWith("_"))V+=C[0];else{const Er=I.classNameAliases[De]||De;N.addKeyword(C[0],Er)}}else V+=C[0];x=S.keywordPatternRe.lastIndex,C=S.keywordPatternRe.exec(A)}V+=A.substring(x),N.addText(V)}function Ye(){if(A==="")return;let x=null;if(typeof S.subLanguage=="string"){if(!e[S.subLanguage]){N.addText(A);return}x=h(S.subLanguage,A,!0,G[S.subLanguage]),G[S.subLanguage]=x._top}else x=f(A,S.subLanguage.length?S.subLanguage:null);S.relevance>0&&(B+=x.relevance),N.addSublanguage(x._emitter,x.language)}function ke(){S.subLanguage!=null?Ye():xe(),A=""}function Le(x,C){let V=1;const H=C.length-1;for(;V<=H;){if(!x._emit[V]){V++;continue}const ce=I.classNameAliases[x[V]]||x[V],De=C[V];ce?N.addKeyword(De,ce):(A=De,xe(),A=""),V++}}function je(x,C){return x.scope&&typeof x.scope=="string"&&N.openNode(I.classNameAliases[x.scope]||x.scope),x.beginScope&&(x.beginScope._wrap?(N.addKeyword(A,I.classNameAliases[x.beginScope._wrap]||x.beginScope._wrap),A=""):x.beginScope._multi&&(Le(x.beginScope,C),A="")),S=Object.create(x,{parent:{value:S}}),S}function gt(x,C,V){let H=OL(x.endRe,V);if(H){if(x["on:end"]){const ce=new eb(x);x["on:end"](C,ce),ce.isMatchIgnored&&(H=!1)}if(H){for(;x.endsParent&&x.parent;)x=x.parent;return x}}if(x.endsWithParent)return gt(x.parent,C,V)}function Ct(x){return S.matcher.regexIndex===0?(A+=x[0],1):(te=!0,0)}function mt(x){const C=x[0],V=x.rule,H=new eb(V),ce=[V.__beforeBegin,V["on:begin"]];for(const De of ce)if(!!De&&(De(x,H),H.isMatchIgnored))return Ct(C);return V.skip?A+=C:(V.excludeBegin&&(A+=C),ke(),!V.returnBegin&&!V.excludeBegin&&(A=C)),je(V,x),V.returnBegin?0:C.length}function kt(x){const C=x[0],V=T.substring(x.index),H=gt(S,x,V);if(!H)return ob;const ce=S;S.endScope&&S.endScope._wrap?(ke(),N.addKeyword(C,S.endScope._wrap)):S.endScope&&S.endScope._multi?(ke(),Le(S.endScope,x)):ce.skip?A+=C:(ce.returnEnd||ce.excludeEnd||(A+=C),ke(),ce.excludeEnd&&(A=C));do S.scope&&N.closeNode(),!S.skip&&!S.subLanguage&&(B+=S.relevance),S=S.parent;while(S!==H.parent);return H.starts&&je(H.starts,x),ce.returnEnd?0:C.length}function Jt(){const x=[];for(let C=S;C!==I;C=C.parent)C.scope&&x.unshift(C.scope);x.forEach(C=>N.openNode(C))}let b={};function E(x,C){const V=C&&C[0];if(A+=x,V==null)return ke(),0;if(b.type==="begin"&&C.type==="end"&&b.index===C.index&&V===""){if(A+=T.slice(C.index,C.index+1),!i){const H=new Error(`0 width match regex (${v})`);throw H.languageName=v,H.badRule=b.rule,H}return 1}if(b=C,C.type==="begin")return mt(C);if(C.type==="illegal"&&!M){const H=new Error('Illegal lexeme "'+V+'" for mode "'+(S.scope||"<unnamed>")+'"');throw H.mode=S,H}else if(C.type==="end"){const H=kt(C);if(H!==ob)return H}if(C.type==="illegal"&&V==="")return 1;if(X>1e5&&X>C.index*3)throw new Error("potential infinite loop, way more iterations than matches");return A+=V,V.length}const I=Z(v);if(!I)throw Ui(s.replace("{}",v)),new Error('Unknown language: "'+v+'"');const $=hP(I);let L="",S=q||$;const G={},N=new a.__emitter(a);Jt();let A="",B=0,Y=0,X=0,te=!1;try{for(S.matcher.considerAll();;){X++,te?te=!1:S.matcher.considerAll(),S.matcher.lastIndex=Y;const x=S.matcher.exec(T);if(!x)break;const C=T.substring(Y,x.index),V=E(C,x);Y=x.index+V}return E(T.substring(Y)),N.closeAllNodes(),N.finalize(),L=N.toHTML(),{language:v,value:L,relevance:B,illegal:!1,_emitter:N,_top:S}}catch(x){if(x.message&&x.message.includes("Illegal"))return{language:v,value:Kh(T),illegal:!0,relevance:0,_illegalBy:{message:x.message,index:Y,context:T.slice(Y-100,Y+100),mode:x.mode,resultSoFar:L},_emitter:N};if(i)return{language:v,value:Kh(T),illegal:!1,relevance:0,errorRaised:x,_emitter:N,_top:S};throw x}}function d(v){const T={value:Kh(v),illegal:!1,relevance:0,_top:o,_emitter:new a.__emitter(a)};return T._emitter.addText(v),T}function f(v,T){T=T||a.languages||Object.keys(e);const M=d(v),q=T.filter(Z).filter(he).map(ke=>h(ke,v,!1));q.unshift(M);const ne=q.sort((ke,Le)=>{if(ke.relevance!==Le.relevance)return Le.relevance-ke.relevance;if(ke.language&&Le.language){if(Z(ke.language).supersetOf===Le.language)return 1;if(Z(Le.language).supersetOf===ke.language)return-1}return 0}),[me,xe]=ne,Ye=me;return Ye.secondBest=xe,Ye}function p(v,T,M){const q=T&&n[T]||M;v.classList.add("hljs"),v.classList.add(`language-${q}`)}function g(v){let T=null;const M=c(v);if(l(M))return;if(Oe("before:highlightElement",{el:v,language:M}),v.children.length>0&&(a.ignoreUnescapedHTML||(console.warn("One of your code blocks includes unescaped HTML. This is a potentially serious security risk."),console.warn("https://github.com/highlightjs/highlight.js/wiki/security"),console.warn("The element with unescaped HTML:"),console.warn(v)),a.throwUnescapedHTML))throw new pP("One of your code blocks includes unescaped HTML.",v.innerHTML);T=v;const q=T.textContent,ne=M?u(q,{language:M,ignoreIllegals:!0}):f(q);v.innerHTML=ne.value,p(v,M,ne.language),v.result={language:ne.language,re:ne.relevance,relevance:ne.relevance},ne.secondBest&&(v.secondBest={language:ne.secondBest.language,relevance:ne.secondBest.relevance}),Oe("after:highlightElement",{el:v,result:ne,text:q})}function m(v){a=sb(a,v)}const w=()=>{y(),bs("10.6.0","initHighlighting() deprecated.  Use highlightAll() now.")};function D(){y(),bs("10.6.0","initHighlightingOnLoad() deprecated.  Use highlightAll() now.")}let P=!1;function y(){if(document.readyState==="loading"){P=!0;return}document.querySelectorAll(a.cssSelector).forEach(g)}function F(){P&&y()}typeof window<"u"&&window.addEventListener&&window.addEventListener("DOMContentLoaded",F,!1);function R(v,T){let M=null;try{M=T(t)}catch(q){if(Ui("Language definition for '{}' could not be registered.".replace("{}",v)),i)Ui(q);else throw q;M=o}M.name||(M.name=v),e[v]=M,M.rawDefinition=T.bind(null,t),M.aliases&&ie(M.aliases,{languageName:v})}function K(v){delete e[v];for(const T of Object.keys(n))n[T]===v&&delete n[T]}function _(){return Object.keys(e)}function Z(v){return v=(v||"").toLowerCase(),e[v]||e[n[v]]}function ie(v,{languageName:T}){typeof v=="string"&&(v=[v]),v.forEach(M=>{n[M.toLowerCase()]=T})}function he(v){const T=Z(v);return T&&!T.disableAutodetect}function ve(v){v["before:highlightBlock"]&&!v["before:highlightElement"]&&(v["before:highlightElement"]=T=>{v["before:highlightBlock"](Object.assign({block:T.el},T))}),v["after:highlightBlock"]&&!v["after:highlightElement"]&&(v["after:highlightElement"]=T=>{v["after:highlightBlock"](Object.assign({block:T.el},T))})}function Ee(v){ve(v),r.push(v)}function Oe(v,T){const M=v;r.forEach(function(q){q[M]&&q[M](T)})}function Ue(v){return bs("10.7.0","highlightBlock will be removed entirely in v12.0"),bs("10.7.0","Please use highlightElement now."),g(v)}Object.assign(t,{highlight:u,highlightAuto:f,highlightAll:y,highlightElement:g,highlightBlock:Ue,configure:m,initHighlighting:w,initHighlightingOnLoad:D,registerLanguage:R,unregisterLanguage:K,listLanguages:_,getLanguage:Z,registerAliases:ie,autoDetection:he,inherit:sb,addPlugin:Ee}),t.debugMode=function(){i=!1},t.safeMode=function(){i=!0},t.versionString=fP,t.regex={concat:ls,lookahead:QE,either:Vp,optional:ML,anyNumberOfTimes:AL};for(const v in kl)typeof kl[v]=="object"&&Pp.exports(kl[v]);return Object.assign(t,kl),t};var Ca=mP({}),yP=Ca;Ca.HighlightJS=Ca;Ca.default=Ca;const Rn=yP;var ax={exports:{}};(function(t){(function(){var e;e=t.exports=i,e.format=i,e.vsprintf=r,typeof console<"u"&&typeof console.log=="function"&&(e.printf=n);function n(){console.log(i.apply(null,arguments))}function r(s,o){return i.apply(null,[s].concat(o))}function i(s){for(var o=1,a=[].slice.call(arguments),l=0,c=s.length,u="",h,d=!1,f,p,g=!1,m,w=function(){return a[o++]},D=function(){for(var P="";/\d/.test(s[l]);)P+=s[l++],h=s[l];return P.length>0?parseInt(P):null};l<c;++l)if(h=s[l],d)switch(d=!1,h=="."?(g=!1,h=s[++l]):h=="0"&&s[l+1]=="."?(g=!0,l+=2,h=s[l]):g=!0,m=D(),h){case"b":u+=parseInt(w(),10).toString(2);break;case"c":f=w(),typeof f=="string"||f instanceof String?u+=f:u+=String.fromCharCode(parseInt(f,10));break;case"d":u+=parseInt(w(),10);break;case"f":p=String(parseFloat(w()).toFixed(m||6)),u+=g?p:p.replace(/^0/,"");break;case"j":u+=JSON.stringify(w());break;case"o":u+="0"+parseInt(w(),10).toString(8);break;case"s":u+=w();break;case"x":u+="0x"+parseInt(w(),10).toString(16);break;case"X":u+="0x"+parseInt(w(),10).toString(16).toUpperCase();break;default:u+=h;break}else h==="%"?d=!0:u+=h;return u}})()})(ax);const bP=ax.exports,Jl=Object.assign(fi(Error),{eval:fi(EvalError),range:fi(RangeError),reference:fi(ReferenceError),syntax:fi(SyntaxError),type:fi(TypeError),uri:fi(URIError)});function fi(t){return e.displayName=t.displayName||t.name,e;function e(n,...r){const i=n&&bP(n,...r);return new t(i)}}const wP={}.hasOwnProperty,vP="hljs-";function lx(t,e,n={}){let r=n.prefix;if(typeof t!="string")throw Jl("Expected `string` for name, got `%s`",t);if(!Rn.getLanguage(t))throw Jl("Unknown language: `%s` is not registered",t);if(typeof e!="string")throw Jl("Expected `string` for value, got `%s`",e);r==null&&(r=vP),Rn.configure({__emitter:kP,classPrefix:r});const i=Rn.highlight(e,{language:t,ignoreIllegals:!0});if(Rn.configure({}),i.errorRaised)throw i.errorRaised;return i._emitter.root.data.language=i.language,i._emitter.root.data.relevance=i.relevance,i._emitter.root}function EP(t,e={}){const n=e.subset||Rn.listLanguages();e.prefix;let r=-1,i={type:"root",data:{language:null,relevance:0},children:[]};if(typeof t!="string")throw Jl("Expected `string` for value, got `%s`",t);for(;++r<n.length;){const s=n[r];if(!Rn.getLanguage(s))continue;const o=lx(s,t,e);o.data.relevance>i.data.relevance&&(i=o)}return i}function xP(t,e){Rn.registerLanguage(t,e)}const SP=function(t,e){if(typeof t=="string")Rn.registerAliases(e,{languageName:t});else{let n;for(n in t)wP.call(t,n)&&Rn.registerAliases(t[n],{languageName:n})}};function TP(t){return Boolean(Rn.getLanguage(t))}function CP(){return Rn.listLanguages()}class kP{constructor(e){this.options=e,this.root={type:"root",data:{language:null,relevance:0},children:[]},this.stack=[this.root]}addText(e){if(e==="")return;const n=this.stack[this.stack.length-1],r=n.children[n.children.length-1];r&&r.type==="text"?r.value+=e:n.children.push({type:"text",value:e})}addKeyword(e,n){this.openNode(n),this.addText(e),this.closeNode()}addSublanguage(e,n){const r=this.stack[this.stack.length-1],i=e.root.children;n?r.children.push({type:"element",tagName:"span",properties:{className:[n]},children:i}):r.children.push(...i)}openNode(e){const n=e.split(".").map((s,o)=>o?s+"_".repeat(o):this.options.classPrefix+s),r=this.stack[this.stack.length-1],i={type:"element",tagName:"span",properties:{className:n},children:[]};r.children.push(i),this.stack.push(i)}closeNode(){this.stack.pop()}closeAllNodes(){}finalize(){}toHTML(){return""}}const Ja={highlight:lx,highlightAuto:EP,registerLanguage:xP,registered:TP,listLanguages:CP,registerAlias:SP};let Gd,Jd;if(typeof WeakMap<"u"){let t=new WeakMap;Gd=e=>t.get(e),Jd=(e,n)=>(t.set(e,n),n)}else{let t=[],e=10,n=0;Gd=r=>{for(let i=0;i<t.length;i+=2)if(t[i]==r)return t[i+1]},Jd=(r,i)=>(n==e&&(n=0),t[n++]=r,t[n++]=i)}class io{constructor(e,n,r,i){this.left=e,this.top=n,this.right=r,this.bottom=i}}class Xe{constructor(e,n,r,i){this.width=e,this.height=n,this.map=r,this.problems=i}findCell(e){for(let n=0;n<this.map.length;n++){let r=this.map[n];if(r!=e)continue;let i=n%this.width,s=n/this.width|0,o=i+1,a=s+1;for(let l=1;o<this.width&&this.map[n+l]==r;l++)o++;for(let l=1;a<this.height&&this.map[n+this.width*l]==r;l++)a++;return new io(i,s,o,a)}throw new RangeError("No cell with offset "+e+" found")}colCount(e){for(let n=0;n<this.map.length;n++)if(this.map[n]==e)return n%this.width;throw new RangeError("No cell with offset "+e+" found")}nextCell(e,n,r){let{left:i,right:s,top:o,bottom:a}=this.findCell(e);return n=="horiz"?(r<0?i==0:s==this.width)?null:this.map[o*this.width+(r<0?i-1:s)]:(r<0?o==0:a==this.height)?null:this.map[i+this.width*(r<0?o-1:a)]}rectBetween(e,n){let{left:r,right:i,top:s,bottom:o}=this.findCell(e),{left:a,right:l,top:c,bottom:u}=this.findCell(n);return new io(Math.min(r,a),Math.min(s,c),Math.max(i,l),Math.max(o,u))}cellsInRect(e){let n=[],r={};for(let i=e.top;i<e.bottom;i++)for(let s=e.left;s<e.right;s++){let o=i*this.width+s,a=this.map[o];r[a]||(r[a]=!0,(s!=e.left||!s||this.map[o-1]!=a)&&(i!=e.top||!i||this.map[o-this.width]!=a)&&n.push(a))}return n}positionAt(e,n,r){for(let i=0,s=0;;i++){let o=s+r.child(i).nodeSize;if(i==e){let a=n+e*this.width,l=(e+1)*this.width;for(;a<l&&this.map[a]<s;)a++;return a==l?o-1:this.map[a]}s=o}}static get(e){return Gd(e)||Jd(e,IP(e))}}function IP(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);let e=AP(t),n=t.childCount,r=[],i=0,s=null,o=[];for(let c=0,u=e*n;c<u;c++)r[c]=0;for(let c=0,u=0;c<n;c++){let h=t.child(c);u++;for(let p=0;;p++){for(;i<r.length&&r[i]!=0;)i++;if(p==h.childCount)break;let g=h.child(p),{colspan:m,rowspan:w,colwidth:D}=g.attrs;for(let P=0;P<w;P++){if(P+c>=n){(s||(s=[])).push({type:"overlong_rowspan",pos:u,n:w-P});break}let y=i+P*e;for(let F=0;F<m;F++){r[y+F]==0?r[y+F]=u:(s||(s=[])).push({type:"collision",row:c,pos:u,n:m-F});let R=D&&D[F];if(R){let K=(y+F)%e*2,_=o[K];_==null||_!=R&&o[K+1]==1?(o[K]=R,o[K+1]=1):_==R&&o[K+1]++}}}i+=m,u+=g.nodeSize}let d=(c+1)*e,f=0;for(;i<d;)r[i++]==0&&f++;f&&(s||(s=[])).push({type:"missing",row:c,n:f}),u++}let a=new Xe(e,n,r,s),l=!1;for(let c=0;!l&&c<o.length;c+=2)o[c]!=null&&o[c+1]<n&&(l=!0);return l&&MP(a,o,t),a}function AP(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){let i=t.child(r),s=0;if(n)for(let o=0;o<r;o++){let a=t.child(o);for(let l=0;l<a.childCount;l++){let c=a.child(l);o+c.attrs.rowspan>r&&(s+=c.attrs.colspan)}}for(let o=0;o<i.childCount;o++){let a=i.child(o);s+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}e==-1?e=s:e!=s&&(e=Math.max(e,s))}return e}function MP(t,e,n){t.problems||(t.problems=[]);for(let r=0,i={};r<t.map.length;r++){let s=t.map[r];if(i[s])continue;i[s]=!0;let o=n.nodeAt(s),a=null;for(let l=0;l<o.attrs.colspan;l++){let c=(r+l)%t.width,u=e[c*2];u!=null&&(!o.attrs.colwidth||o.attrs.colwidth[l]!=u)&&((a||(a=NP(o.attrs)))[l]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:s,colwidth:a})}}function NP(t){if(t.colwidth)return t.colwidth.slice();let e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function Bt(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(let n in t.nodes){let r=t.nodes[n],i=r.spec.tableRole;i&&(e[i]=r)}}return e}const Nr=new sn("selectingCells");function wo(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function OP(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function Un(t){let e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function Iu(t){let e=t.selection;return e.$anchorCell?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&e.node.type.spec.tableRole=="cell"?e.$anchor:wo(e.$head)||DP(e.$head)}function DP(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){let r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){let r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function Xd(t){return t.parent.type.spec.tableRole=="row"&&t.nodeAfter}function _P(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function Up(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function cx(t,e,n){let r=t.start(-1),s=Xe.get(t.node(-1)).nextCell(t.pos-r,e,n);return s==null?null:t.node(0).resolve(r+s)}function ct(t,e,n){let r={};for(let i in t)r[i]=t[i];return r[e]=n,r}function Xi(t,e,n=1){let r=ct(t,"colspan",t.colspan-n);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(i=>i>0)||(r.colwidth=null)),r}function ux(t,e,n=1){let r=ct(t,"colspan",t.colspan+n);if(r.colwidth){r.colwidth=r.colwidth.slice();for(let i=0;i<n;i++)r.colwidth.splice(e,0,0)}return r}function RP(t,e,n){let r=Bt(e.type.schema).header_cell;for(let i=0;i<t.height;i++)if(e.nodeAt(t.map[n+i*t.width]).type!=r)return!1;return!0}class Ae extends ue{constructor(e,n=e){let r=e.node(-1),i=Xe.get(r),s=e.start(-1),o=i.rectBetween(e.pos-s,n.pos-s),a=e.node(0),l=i.cellsInRect(o).filter(u=>u!=n.pos-s);l.unshift(n.pos-s);let c=l.map(u=>{let h=r.nodeAt(u),d=u+s+1;return new l0(a.resolve(d),a.resolve(d+h.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){let r=e.resolve(n.map(this.$anchorCell.pos)),i=e.resolve(n.map(this.$headCell.pos));if(Xd(r)&&Xd(i)&&Up(r,i)){let s=this.$anchorCell.node(-1)!=r.node(-1);return s&&this.isRowSelection()?Ae.rowSelection(r,i):s&&this.isColSelection()?Ae.colSelection(r,i):new Ae(r,i)}return pe.between(r,i)}content(){let e=this.$anchorCell.node(-1),n=Xe.get(e),r=this.$anchorCell.start(-1),i=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),s={},o=[];for(let l=i.top;l<i.bottom;l++){let c=[];for(let u=l*n.width+i.left,h=i.left;h<i.right;h++,u++){let d=n.map[u];if(!s[d]){s[d]=!0;let f=n.findCell(d),p=e.nodeAt(d),g=i.left-f.left,m=f.right-i.right;if(g>0||m>0){let w=p.attrs;g>0&&(w=Xi(w,0,g)),m>0&&(w=Xi(w,w.colspan-m,m)),f.left<i.left?p=p.type.createAndFill(w):p=p.type.create(w,p.content)}if(f.top<i.top||f.bottom>i.bottom){let w=ct(p.attrs,"rowspan",Math.min(f.bottom,i.bottom)-Math.max(f.top,i.top));f.top<i.top?p=p.type.createAndFill(w):p=p.type.create(w,p.content)}c.push(p)}}o.push(e.child(l).copy(U.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:o;return new J(U.from(a),1,1)}replace(e,n=J.empty){let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:a,$to:l}=i[o],c=e.mapping.slice(r);e.replace(c.map(a.pos),c.map(l.pos),o?J.empty:n)}let s=ue.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);s&&e.setSelection(s)}replaceWith(e,n){this.replace(e,new J(U.from(n),0,0))}forEachCell(e){let n=this.$anchorCell.node(-1),r=Xe.get(n),i=this.$anchorCell.start(-1),s=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-i,this.$headCell.pos-i));for(let o=0;o<s.length;o++)e(n.nodeAt(s[o]),i+s[o])}isColSelection(){let e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;let r=e+this.$anchorCell.nodeAfter.attrs.rowspan,i=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,i)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){let r=Xe.get(e.node(-1)),i=e.start(-1),s=r.findCell(e.pos-i),o=r.findCell(n.pos-i),a=e.node(0);return s.top<=o.top?(s.top>0&&(e=a.resolve(i+r.map[s.left])),o.bottom<r.height&&(n=a.resolve(i+r.map[r.width*(r.height-1)+o.right-1]))):(o.top>0&&(n=a.resolve(i+r.map[o.left])),s.bottom<r.height&&(e=a.resolve(i+r.map[r.width*(r.height-1)+s.right-1]))),new Ae(e,n)}isRowSelection(){let e=Xe.get(this.$anchorCell.node(-1)),n=this.$anchorCell.start(-1),r=e.colCount(this.$anchorCell.pos-n),i=e.colCount(this.$headCell.pos-n);if(Math.min(r,i)>0)return!1;let s=r+this.$anchorCell.nodeAfter.attrs.colspan,o=i+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,o)==e.width}eq(e){return e instanceof Ae&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){let r=Xe.get(e.node(-1)),i=e.start(-1),s=r.findCell(e.pos-i),o=r.findCell(n.pos-i),a=e.node(0);return s.left<=o.left?(s.left>0&&(e=a.resolve(i+r.map[s.top*r.width])),o.right<r.width&&(n=a.resolve(i+r.map[r.width*(o.top+1)-1]))):(o.left>0&&(n=a.resolve(i+r.map[o.top*r.width])),s.right<r.width&&(e=a.resolve(i+r.map[r.width*(s.top+1)-1]))),new Ae(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new Ae(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new Ae(e.resolve(n),e.resolve(r))}getBookmark(){return new Hp(this.$anchorCell.pos,this.$headCell.pos)}}Ae.prototype.visible=!1;ue.jsonID("cell",Ae);class Hp{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Hp(e.map(this.anchor),e.map(this.head))}resolve(e){let n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&Up(n,r)?new Ae(n,r):ue.near(r,1)}}function LP(t){if(!(t.selection instanceof Ae))return null;let e=[];return t.selection.forEachCell((n,r)=>{e.push(zt.node(r,r+n.nodeSize,{class:"selectedCell"}))}),Ze.create(t.doc,e)}function PP({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let n=t.pos,r=e.pos,i=t.depth;for(;i>=0&&!(t.after(i+1)<t.end(i));i--,n++);for(let s=e.depth;s>=0&&!(e.before(s+1)>e.start(s));s--,r--);return n==r&&/row|table/.test(t.node(i).type.spec.tableRole)}function BP({$from:t,$to:e}){let n,r;for(let i=t.depth;i>0;i--){let s=t.node(i);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){n=s;break}}for(let i=e.depth;i>0;i--){let s=e.node(i);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){r=s;break}}return n!==r&&e.parentOffset===0}function FP(t,e,n){let r=(e||t).selection,i=(e||t).doc,s,o;if(r instanceof fe&&(o=r.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")s=Ae.create(i,r.from);else if(o=="row"){let a=i.resolve(r.from+1);s=Ae.rowSelection(a,a)}else if(!n){let a=Xe.get(r.node),l=r.from+1,c=l+a.map[a.width*a.height-1];s=Ae.create(i,l+1,c)}}else r instanceof pe&&PP(r)?s=pe.create(i,r.from):r instanceof pe&&BP(r)&&(s=pe.create(i,r.$from.start(),r.$from.end()));return s&&(e||(e=t.tr)).setSelection(s),e}function VP(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:r}=t;for(;e.childCount==1&&(n>0&&r>0||e.firstChild.type.spec.tableRole=="table");)n--,r--,e=e.firstChild.content;let i=e.firstChild,s=i.type.spec.tableRole,o=i.type.schema,a=[];if(s=="row")for(let l=0;l<e.childCount;l++){let c=e.child(l).content,u=l?0:Math.max(0,n-1),h=l<e.childCount-1?0:Math.max(0,r-1);(u||h)&&(c=Yd(Bt(o).row,new J(c,u,h)).content),a.push(c)}else if(s=="cell"||s=="header_cell")a.push(n||r?Yd(Bt(o).row,new J(e,n,r)).content:e);else return null;return $P(o,a)}function $P(t,e){let n=[];for(let i=0;i<e.length;i++){let s=e[i];for(let o=s.childCount-1;o>=0;o--){let{rowspan:a,colspan:l}=s.child(o).attrs;for(let c=i;c<i+a;c++)n[c]=(n[c]||0)+l}}let r=0;for(let i=0;i<n.length;i++)r=Math.max(r,n[i]);for(let i=0;i<n.length;i++)if(i>=e.length&&e.push(U.empty),n[i]<r){let s=Bt(t).cell.createAndFill(),o=[];for(let a=n[i];a<r;a++)o.push(s);e[i]=e[i].append(U.from(o))}return{height:e.length,width:r,rows:e}}function Yd(t,e){let n=t.createAndFill();return new a0(n).replace(0,n.content.size,e).doc}function zP({width:t,height:e,rows:n},r,i){if(t!=r){let s=[],o=[];for(let a=0;a<n.length;a++){let l=n[a],c=[];for(let u=s[a]||0,h=0;u<r;h++){let d=l.child(h%l.childCount);u+d.attrs.colspan>r&&(d=d.type.create(Xi(d.attrs,d.attrs.colspan,u+d.attrs.colspan-r),d.content)),c.push(d),u+=d.attrs.colspan;for(let f=1;f<d.attrs.rowspan;f++)s[a+f]=(s[a+f]||0)+d.attrs.colspan}o.push(U.from(c))}n=o,t=r}if(e!=i){let s=[];for(let o=0,a=0;o<i;o++,a++){let l=[],c=n[a%e];for(let u=0;u<c.childCount;u++){let h=c.child(u);o+h.attrs.rowspan>i&&(h=h.type.create(ct(h.attrs,"rowspan",Math.max(1,i-h.attrs.rowspan)),h.content)),l.push(h)}s.push(U.from(l))}n=s,e=i}return{width:t,height:e,rows:n}}function UP(t,e,n,r,i,s,o){let a=t.doc.type.schema,l=Bt(a),c,u;if(i>e.width)for(let h=0,d=0;h<e.height;h++){let f=n.child(h);d+=f.nodeSize;let p=[],g;f.lastChild==null||f.lastChild.type==l.cell?g=c||(c=l.cell.createAndFill()):g=u||(u=l.header_cell.createAndFill());for(let m=e.width;m<i;m++)p.push(g);t.insert(t.mapping.slice(o).map(d-1+r),p)}if(s>e.height){let h=[];for(let p=0,g=(e.height-1)*e.width;p<Math.max(e.width,i);p++){let m=p>=e.width?!1:n.nodeAt(e.map[g+p]).type==l.header_cell;h.push(m?u||(u=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}let d=l.row.create(null,U.from(h)),f=[];for(let p=e.height;p<s;p++)f.push(d);t.insert(t.mapping.slice(o).map(r+n.nodeSize-2),f)}return!!(c||u)}function ab(t,e,n,r,i,s,o,a){if(o==0||o==e.height)return!1;let l=!1;for(let c=i;c<s;c++){let u=o*e.width+c,h=e.map[u];if(e.map[u-e.width]==h){l=!0;let d=n.nodeAt(h),{top:f,left:p}=e.findCell(h);t.setNodeMarkup(t.mapping.slice(a).map(h+r),null,ct(d.attrs,"rowspan",o-f)),t.insert(t.mapping.slice(a).map(e.positionAt(o,p,n)),d.type.createAndFill(ct(d.attrs,"rowspan",f+d.attrs.rowspan-o))),c+=d.attrs.colspan-1}}return l}function lb(t,e,n,r,i,s,o,a){if(o==0||o==e.width)return!1;let l=!1;for(let c=i;c<s;c++){let u=c*e.width+o,h=e.map[u];if(e.map[u-1]==h){l=!0;let d=n.nodeAt(h),f=e.colCount(h),p=t.mapping.slice(a).map(h+r);t.setNodeMarkup(p,null,Xi(d.attrs,o-f,d.attrs.colspan-(o-f))),t.insert(p+d.nodeSize,d.type.createAndFill(Xi(d.attrs,0,o-f))),c+=d.attrs.rowspan-1}}return l}function cb(t,e,n,r,i){let s=n?t.doc.nodeAt(n-1):t.doc,o=Xe.get(s),{top:a,left:l}=r,c=l+i.width,u=a+i.height,h=t.tr,d=0;function f(){s=n?h.doc.nodeAt(n-1):h.doc,o=Xe.get(s),d=h.mapping.maps.length}UP(h,o,s,n,c,u,d)&&f(),ab(h,o,s,n,l,c,a,d)&&f(),ab(h,o,s,n,l,c,u,d)&&f(),lb(h,o,s,n,a,u,l,d)&&f(),lb(h,o,s,n,a,u,c,d)&&f();for(let p=a;p<u;p++){let g=o.positionAt(p,l,s),m=o.positionAt(p,c,s);h.replace(h.mapping.slice(d).map(g+n),h.mapping.slice(d).map(m+n),new J(i.rows[p-a],0,0))}f(),h.setSelection(new Ae(h.doc.resolve(n+o.positionAt(a,l,s)),h.doc.resolve(n+o.positionAt(u-1,c-1,s)))),e(h)}const HP=pp({ArrowLeft:Il("horiz",-1),ArrowRight:Il("horiz",1),ArrowUp:Il("vert",-1),ArrowDown:Il("vert",1),"Shift-ArrowLeft":Al("horiz",-1),"Shift-ArrowRight":Al("horiz",1),"Shift-ArrowUp":Al("vert",-1),"Shift-ArrowDown":Al("vert",1),Backspace:Ml,"Mod-Backspace":Ml,Delete:Ml,"Mod-Delete":Ml});function Xl(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Il(t,e){return(n,r,i)=>{let s=n.selection;if(s instanceof Ae)return Xl(n,r,ue.near(s.$headCell,e));if(t!="horiz"&&!s.empty)return!1;let o=hx(i,t,e);if(o==null)return!1;if(t=="horiz")return Xl(n,r,ue.near(n.doc.resolve(s.head+e),e));{let a=n.doc.resolve(o),l=cx(a,t,e),c;return l?c=ue.near(l,1):e<0?c=ue.near(n.doc.resolve(a.before(-1)),-1):c=ue.near(n.doc.resolve(a.after(-1)),1),Xl(n,r,c)}}}function Al(t,e){return(n,r,i)=>{let s=n.selection;if(!(s instanceof Ae)){let a=hx(i,t,e);if(a==null)return!1;s=new Ae(n.doc.resolve(a))}let o=cx(s.$headCell,t,e);return o?Xl(n,r,new Ae(s.$anchorCell,o)):!1}}function Ml(t,e){let n=t.selection;if(!(n instanceof Ae))return!1;if(e){let r=t.tr,i=Bt(t.schema).cell.createAndFill().content;n.forEachCell((s,o)=>{s.content.eq(i)||r.replace(r.mapping.map(o+1),r.mapping.map(o+s.nodeSize-1),new J(i,0,0))}),r.docChanged&&e(r)}return!0}function jP(t,e){let n=t.state.doc,r=wo(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new Ae(r))),!0):!1}function KP(t,e,n){if(!Un(t.state))return!1;let r=VP(n),i=t.state.selection;if(i instanceof Ae){r||(r={width:1,height:1,rows:[U.from(Yd(Bt(t.state.schema).cell,n))]});let s=i.$anchorCell.node(-1),o=i.$anchorCell.start(-1),a=Xe.get(s).rectBetween(i.$anchorCell.pos-o,i.$headCell.pos-o);return r=zP(r,a.right-a.left,a.bottom-a.top),cb(t.state,t.dispatch,o,a,r),!0}else if(r){let s=Iu(t.state),o=s.start(-1);return cb(t.state,t.dispatch,o,Xe.get(s.node(-1)).findCell(s.pos-o),r),!0}else return!1}function qP(t,e){if(e.ctrlKey||e.metaKey)return;let n=ub(t,e.target),r;if(e.shiftKey&&t.state.selection instanceof Ae)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&(r=wo(t.state.selection.$anchor))!=null&&qh(t,e).pos!=r.pos)i(r,e),e.preventDefault();else if(!n)return;function i(a,l){let c=qh(t,l),u=Nr.getState(t.state)==null;if(!c||!Up(a,c))if(u)c=a;else return;let h=new Ae(a,c);if(u||!t.state.selection.eq(h)){let d=t.state.tr.setSelection(h);u&&d.setMeta(Nr,a.pos),t.dispatch(d)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",o),Nr.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(Nr,-1))}function o(a){let l=Nr.getState(t.state),c;if(l!=null)c=t.state.doc.resolve(l);else if(ub(t,a.target)!=n&&(c=qh(t,e),!c))return s();c&&i(c,a)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",o)}function hx(t,e,n){if(!(t.state.selection instanceof pe))return null;let{$head:r}=t.state.selection;for(let i=r.depth-1;i>=0;i--){let s=r.node(i);if((n<0?r.index(i):r.indexAfter(i))!=(n<0?0:s.childCount))return null;if(s.type.spec.tableRole=="cell"||s.type.spec.tableRole=="header_cell"){let a=r.before(i),l=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(l)?a:null}}return null}function ub(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e}function qh(t,e){let n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?wo(t.state.doc.resolve(n.pos)):null}const WP=new sn("fix-tables");function dx(t,e,n,r){let i=t.childCount,s=e.childCount;e:for(let o=0,a=0;o<s;o++){let l=e.child(o);for(let c=a,u=Math.min(i,o+3);c<u;c++)if(t.child(c)==l){a=c+1,n+=l.nodeSize;continue e}r(l,n),a<i&&t.child(a).sameMarkup(l)?dx(t.child(a),l,n+1,r):l.nodesBetween(0,l.content.size,r,n+1),n+=l.nodeSize}}function fx(t,e){let n,r=(i,s)=>{i.type.spec.tableRole=="table"&&(n=GP(t,i,s,n))};return e?e.doc!=t.doc&&dx(e.doc,t.doc,0,r):t.doc.descendants(r),n}function GP(t,e,n,r){let i=Xe.get(e);if(!i.problems)return r;r||(r=t.tr);let s=[];for(let l=0;l<i.height;l++)s.push(0);for(let l=0;l<i.problems.length;l++){let c=i.problems[l];if(c.type=="collision"){let u=e.nodeAt(c.pos);for(let h=0;h<u.attrs.rowspan;h++)s[c.row+h]+=c.n;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,Xi(u.attrs,u.attrs.colspan-c.n,c.n))}else if(c.type=="missing")s[c.row]+=c.n;else if(c.type=="overlong_rowspan"){let u=e.nodeAt(c.pos);r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,ct(u.attrs,"rowspan",u.attrs.rowspan-c.n))}else if(c.type=="colwidth mismatch"){let u=e.nodeAt(c.pos);r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,ct(u.attrs,"colwidth",c.colwidth))}}let o,a;for(let l=0;l<s.length;l++)s[l]&&(o==null&&(o=l),a=l);for(let l=0,c=n+1;l<i.height;l++){let u=e.child(l),h=c+u.nodeSize,d=s[l];if(d>0){let f="cell";u.firstChild&&(f=u.firstChild.type.spec.tableRole);let p=[];for(let m=0;m<d;m++)p.push(Bt(t.schema)[f].createAndFill());let g=(l==0||o==l-1)&&a==l?c+1:h-1;r.insert(r.mapping.map(g),p)}c=h}return r.setMeta(WP,{fixTables:!0})}function cr(t){let e=t.selection,n=Iu(t),r=n.node(-1),i=n.start(-1),s=Xe.get(r),o;return e instanceof Ae?o=s.rectBetween(e.$anchorCell.pos-i,e.$headCell.pos-i):o=s.findCell(n.pos-i),o.tableStart=i,o.map=s,o.table=r,o}function px(t,{map:e,tableStart:n,table:r},i){let s=i>0?-1:0;RP(e,r,i+s)&&(s=i==0||i==e.width?null:0);for(let o=0;o<e.height;o++){let a=o*e.width+i;if(i>0&&i<e.width&&e.map[a-1]==e.map[a]){let l=e.map[a],c=r.nodeAt(l);t.setNodeMarkup(t.mapping.map(n+l),null,ux(c.attrs,i-e.colCount(l))),o+=c.attrs.rowspan-1}else{let l=s==null?Bt(r.type.schema).cell:r.nodeAt(e.map[a+s]).type,c=e.positionAt(o,i,r);t.insert(t.mapping.map(n+c),l.createAndFill())}}return t}function JP(t,e){if(!Un(t))return!1;if(e){let n=cr(t);e(px(t.tr,n,n.left))}return!0}function XP(t,e){if(!Un(t))return!1;if(e){let n=cr(t);e(px(t.tr,n,n.right))}return!0}function YP(t,{map:e,table:n,tableStart:r},i){let s=t.mapping.maps.length;for(let o=0;o<e.height;){let a=o*e.width+i,l=e.map[a],c=n.nodeAt(l);if(i>0&&e.map[a-1]==l||i<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(s).map(r+l),null,Xi(c.attrs,i-e.colCount(l)));else{let u=t.mapping.slice(s).map(r+l);t.delete(u,u+c.nodeSize)}o+=c.attrs.rowspan}}function QP(t,e){if(!Un(t))return!1;if(e){let n=cr(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let i=n.right-1;YP(r,n,i),i!=n.left;i--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Xe.get(n.table);e(r)}return!0}function ZP(t,e,n){let r=Bt(e.type.schema).header_cell;for(let i=0;i<t.width;i++)if(e.nodeAt(t.map[i+n*t.width]).type!=r)return!1;return!0}function gx(t,{map:e,tableStart:n,table:r},i){let s=n;for(let l=0;l<i;l++)s+=r.child(l).nodeSize;let o=[],a=i>0?-1:0;ZP(e,r,i+a)&&(a=i==0||i==e.height?null:0);for(let l=0,c=e.width*i;l<e.width;l++,c++)if(i>0&&i<e.height&&e.map[c]==e.map[c-e.width]){let u=e.map[c],h=r.nodeAt(u).attrs;t.setNodeMarkup(n+u,null,ct(h,"rowspan",h.rowspan+1)),l+=h.colspan-1}else{let u=a==null?Bt(r.type.schema).cell:r.nodeAt(e.map[c+a*e.width]).type;o.push(u.createAndFill())}return t.insert(s,Bt(r.type.schema).row.create(null,o)),t}function eB(t,e){if(!Un(t))return!1;if(e){let n=cr(t);e(gx(t.tr,n,n.top))}return!0}function tB(t,e){if(!Un(t))return!1;if(e){let n=cr(t);e(gx(t.tr,n,n.bottom))}return!0}function nB(t,{map:e,table:n,tableStart:r},i){let s=0;for(let l=0;l<i;l++)s+=n.child(l).nodeSize;let o=s+n.child(i).nodeSize,a=t.mapping.maps.length;t.delete(s+r,o+r);for(let l=0,c=i*e.width;l<e.width;l++,c++){let u=e.map[c];if(i>0&&u==e.map[c-e.width]){let h=n.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(a).map(u+r),null,ct(h,"rowspan",h.rowspan-1)),l+=h.colspan-1}else if(i<e.width&&u==e.map[c+e.width]){let h=n.nodeAt(u),d=h.type.create(ct(h.attrs,"rowspan",h.attrs.rowspan-1),h.content),f=e.positionAt(i+1,l,n);t.insert(t.mapping.slice(a).map(r+f),d),l+=h.attrs.colspan-1}}}function rB(t,e){if(!Un(t))return!1;if(e){let n=cr(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let i=n.bottom-1;nB(r,n,i),i!=n.top;i--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Xe.get(n.table);e(r)}return!0}function hb(t){let e=t.content;return e.childCount==1&&e.firstChild.isTextblock&&e.firstChild.childCount==0}function iB({width:t,height:e,map:n},r){let i=r.top*t+r.left,s=i,o=(r.bottom-1)*t+r.left,a=i+(r.right-r.left-1);for(let l=r.top;l<r.bottom;l++){if(r.left>0&&n[s]==n[s-1]||r.right<t&&n[a]==n[a+1])return!0;s+=t,a+=t}for(let l=r.left;l<r.right;l++){if(r.top>0&&n[i]==n[i-t]||r.bottom<e&&n[o]==n[o+t])return!0;i++,o++}return!1}function db(t,e){let n=t.selection;if(!(n instanceof Ae)||n.$anchorCell.pos==n.$headCell.pos)return!1;let r=cr(t),{map:i}=r;if(iB(i,r))return!1;if(e){let s=t.tr,o={},a=U.empty,l,c;for(let u=r.top;u<r.bottom;u++)for(let h=r.left;h<r.right;h++){let d=i.map[u*i.width+h],f=r.table.nodeAt(d);if(!o[d])if(o[d]=!0,l==null)l=d,c=f;else{hb(f)||(a=a.append(f.content));let p=s.mapping.map(d+r.tableStart);s.delete(p,p+f.nodeSize)}}if(s.setNodeMarkup(l+r.tableStart,null,ct(ux(c.attrs,c.attrs.colspan,r.right-r.left-c.attrs.colspan),"rowspan",r.bottom-r.top)),a.size){let u=l+1+c.content.size,h=hb(c)?l+1:u;s.replaceWith(h+r.tableStart,u+r.tableStart,a)}s.setSelection(new Ae(s.doc.resolve(l+r.tableStart))),e(s)}return!0}function fb(t,e){const n=Bt(t.schema);return sB(({node:r})=>n[r.type.spec.tableRole])(t,e)}function sB(t){return(e,n)=>{let r=e.selection,i,s;if(r instanceof Ae){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;i=r.$anchorCell.nodeAfter,s=r.$anchorCell.pos}else{if(i=OP(r.$from),!i)return!1;s=wo(r.$from).pos}if(i.attrs.colspan==1&&i.attrs.rowspan==1)return!1;if(n){let o=i.attrs,a=[],l=o.colwidth;o.rowspan>1&&(o=ct(o,"rowspan",1)),o.colspan>1&&(o=ct(o,"colspan",1));let c=cr(e),u=e.tr;for(let d=0;d<c.right-c.left;d++)a.push(l?ct(o,"colwidth",l&&l[d]?[l[d]]:null):o);let h;for(let d=c.top;d<c.bottom;d++){let f=c.map.positionAt(d,c.left,c.table);d==c.top&&(f+=i.nodeSize);for(let p=c.left,g=0;p<c.right;p++,g++)p==c.left&&d==c.top||u.insert(h=u.mapping.map(f+c.tableStart,1),t({node:i,row:d,col:p}).createAndFill(a[g]))}u.setNodeMarkup(s,t({node:i,row:c.top,col:c.left}),a[0]),r instanceof Ae&&u.setSelection(new Ae(u.doc.resolve(r.$anchorCell.pos),h&&u.doc.resolve(h))),n(u)}return!0}}function oB(t,e){return function(n,r){if(!Un(n))return!1;let i=Iu(n);if(i.nodeAfter.attrs[t]===e)return!1;if(r){let s=n.tr;n.selection instanceof Ae?n.selection.forEachCell((o,a)=>{o.attrs[t]!==e&&s.setNodeMarkup(a,null,ct(o.attrs,t,e))}):s.setNodeMarkup(i.pos,null,ct(i.nodeAfter.attrs,t,e)),r(s)}return!0}}function aB(t){return function(e,n){if(!Un(e))return!1;if(n){let r=Bt(e.schema),i=cr(e),s=e.tr,o=i.map.cellsInRect(t=="column"?new io(i.left,0,i.right,i.map.height):t=="row"?new io(0,i.top,i.map.width,i.bottom):i),a=o.map(l=>i.table.nodeAt(l));for(let l=0;l<o.length;l++)a[l].type==r.header_cell&&s.setNodeMarkup(i.tableStart+o[l],r.cell,a[l].attrs);if(s.steps.length==0)for(let l=0;l<o.length;l++)s.setNodeMarkup(i.tableStart+o[l],r.header_cell,a[l].attrs);n(s)}return!0}}function pb(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let i=0;i<r.length;i++){const s=e.table.nodeAt(r[i]);if(s&&s.type!==n.header_cell)return!1}return!0}function ka(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?aB(t):function(n,r){if(!Un(n))return!1;if(r){let i=Bt(n.schema),s=cr(n),o=n.tr,a=pb("row",s,i),l=pb("column",s,i),u=(t==="column"?a:t==="row"?l:!1)?1:0,h=t=="column"?new io(0,u,1,s.map.height):t=="row"?new io(u,0,s.map.width,1):s,d=t=="column"?l?i.cell:i.header_cell:t=="row"?a?i.cell:i.header_cell:i.cell;s.map.cellsInRect(h).forEach(f=>{const p=f+s.tableStart,g=o.doc.nodeAt(p);g&&o.setNodeMarkup(p,d,g.attrs)}),r(o)}return!0}}ka("row",{useDeprecatedLogic:!0});ka("column",{useDeprecatedLogic:!0});let lB=ka("cell",{useDeprecatedLogic:!0});function cB(t,e){if(e<0){let n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let r=t.index(-1)-1,i=t.before();r>=0;r--){let s=t.node(-1).child(r);if(s.childCount)return i-1-s.lastChild.nodeSize;i-=s.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;let n=t.node(-1);for(let r=t.indexAfter(-1),i=t.after();r<n.childCount;r++){let s=n.child(r);if(s.childCount)return i+1;i+=s.nodeSize}}}function gb(t){return function(e,n){if(!Un(e))return!1;let r=cB(Iu(e),t);if(r!=null){if(n){let i=e.doc.resolve(r);n(e.tr.setSelection(pe.between(i,_P(i))).scrollIntoView())}return!0}}}function uB(t,e){let n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}class hB{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Qd(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,Qd(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}}function Qd(t,e,n,r,i,s){let o=0,a=!0,l=e.firstChild,c=t.firstChild;for(let u=0,h=0;u<c.childCount;u++){let{colspan:d,colwidth:f}=c.child(u).attrs;for(let p=0;p<d;p++,h++){let g=i==h?s:f&&f[p],m=g?g+"px":"";o+=g||r,g||(a=!1),l?(l.style.width!=m&&(l.style.width=m),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=m}}for(;l;){let u=l.nextSibling;l.parentNode.removeChild(l),l=u}a?(n.style.width=o+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=o+"px")}const En=new sn("tableColumnResizing");function dB({handleWidth:t=5,cellMinWidth:e=25,View:n=hB,lastColumnResizable:r=!0}={}){return new St({key:En,state:{init(s,o){return this.spec.props.nodeViews[Bt(o.schema).table.name]=(a,l)=>new n(a,e,l),new Zo(-1,!1)},apply(s,o){return o.apply(s)}},props:{attributes(s){return En.getState(s).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove(s,o){fB(s,o,t,e,r)},mouseleave(s){pB(s)},mousedown(s,o){gB(s,o,e)}},decorations(s){let o=En.getState(s);if(o.activeHandle>-1)return EB(s,o.activeHandle)},nodeViews:{}}})}class Zo{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){let n=this,r=e.getMeta(En);if(r&&r.setHandle!=null)return new Zo(r.setHandle,null);if(r&&r.setDragging!==void 0)return new Zo(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let i=e.mapping.map(n.activeHandle,-1);Xd(e.doc.resolve(i))||(i=null),n=new Zo(i,n.dragging)}return n}}function fB(t,e,n,r,i){let s=En.getState(t.state);if(!s.dragging){let o=yB(e.target),a=-1;if(o){let{left:l,right:c}=o.getBoundingClientRect();e.clientX-l<=n?a=mb(t,e,"left"):c-e.clientX<=n&&(a=mb(t,e,"right"))}if(a!=s.activeHandle){if(!i&&a!==-1){let l=t.state.doc.resolve(a),c=l.node(-1),u=Xe.get(c),h=l.start(-1);if(u.colCount(l.pos-h)+l.nodeAfter.attrs.colspan-1==u.width-1)return}mx(t,a)}}}function pB(t){let e=En.getState(t.state);e.activeHandle>-1&&!e.dragging&&mx(t,-1)}function gB(t,e,n){let r=En.getState(t.state);if(r.activeHandle==-1||r.dragging)return!1;let i=t.state.doc.nodeAt(r.activeHandle),s=mB(t,r.activeHandle,i.attrs);t.dispatch(t.state.tr.setMeta(En,{setDragging:{startX:e.clientX,startWidth:s}}));function o(l){window.removeEventListener("mouseup",o),window.removeEventListener("mousemove",a);let c=En.getState(t.state);c.dragging&&(bB(t,c.activeHandle,yb(c.dragging,l,n)),t.dispatch(t.state.tr.setMeta(En,{setDragging:null})))}function a(l){if(!l.which)return o(l);let c=En.getState(t.state),u=yb(c.dragging,l,n);wB(t,c.activeHandle,u,n)}return window.addEventListener("mouseup",o),window.addEventListener("mousemove",a),e.preventDefault(),!0}function mB(t,e,{colspan:n,colwidth:r}){let i=r&&r[r.length-1];if(i)return i;let s=t.domAtPos(e),a=s.node.childNodes[s.offset].offsetWidth,l=n;if(r)for(let c=0;c<n;c++)r[c]&&(a-=r[c],l--);return a/l}function yB(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}function mb(t,e,n){let r=t.posAtCoords({left:e.clientX,top:e.clientY});if(!r)return-1;let{pos:i}=r,s=wo(t.state.doc.resolve(i));if(!s)return-1;if(n=="right")return s.pos;let o=Xe.get(s.node(-1)),a=s.start(-1),l=o.map.indexOf(s.pos-a);return l%o.width==0?-1:a+o.map[l-1]}function yb(t,e,n){let r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function mx(t,e){t.dispatch(t.state.tr.setMeta(En,{setHandle:e}))}function bB(t,e,n){let r=t.state.doc.resolve(e),i=r.node(-1),s=Xe.get(i),o=r.start(-1),a=s.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<s.height;c++){let u=c*s.width+a;if(c&&s.map[u]==s.map[u-s.width])continue;let h=s.map[u],{attrs:d}=i.nodeAt(h),f=d.colspan==1?0:a-s.colCount(h);if(d.colwidth&&d.colwidth[f]==n)continue;let p=d.colwidth?d.colwidth.slice():vB(d.colspan);p[f]=n,l.setNodeMarkup(o+h,null,ct(d,"colwidth",p))}l.docChanged&&t.dispatch(l)}function wB(t,e,n,r){let i=t.state.doc.resolve(e),s=i.node(-1),o=i.start(-1),a=Xe.get(s).colCount(i.pos-o)+i.nodeAfter.attrs.colspan-1,l=t.domAtPos(i.start(-1)).node;for(;l.nodeName!="TABLE";)l=l.parentNode;Qd(s,l.firstChild,l,r,a,n)}function vB(t){let e=[];for(let n=0;n<t;n++)e.push(0);return e}function EB(t,e){let n=[],r=t.doc.resolve(e),i=r.node(-1),s=Xe.get(i),o=r.start(-1),a=s.colCount(r.pos-o)+r.nodeAfter.attrs.colspan;for(let l=0;l<s.height;l++){let c=a+l*s.width-1;if((a==s.width||s.map[c]!=s.map[c+1])&&(l==0||s.map[c-1]!=s.map[c-1-s.width])){let u=s.map[c],h=o+u+i.nodeAt(u).nodeSize-1,d=document.createElement("div");d.className="column-resize-handle",n.push(zt.widget(h,d))}}return Ze.create(t.doc,n)}function xB({allowTableNodeSelection:t=!1}={}){return new St({key:Nr,state:{init(){return null},apply(e,n){let r=e.getMeta(Nr);if(r!=null)return r==-1?null:r;if(n==null||!e.docChanged)return n;let{deleted:i,pos:s}=e.mapping.mapResult(n);return i?null:s}},props:{decorations:LP,handleDOMEvents:{mousedown:qP},createSelectionBetween(e){if(Nr.getState(e.state)!=null)return e.state.selection},handleTripleClick:jP,handleKeyDown:HP,handlePaste:KP},appendTransaction(e,n,r){return FP(r,fx(r,n),t)}})}function bb(t,e,n,r,i,s){let o=0,a=!0,l=e.firstChild;const c=t.firstChild;for(let u=0,h=0;u<c.childCount;u+=1){const{colspan:d,colwidth:f}=c.child(u).attrs;for(let p=0;p<d;p+=1,h+=1){const g=i===h?s:f&&f[p],m=g?`${g}px`:"";o+=g||r,g||(a=!1),l?(l.style.width!==m&&(l.style.width=m),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=m}}for(;l;){const u=l.nextSibling;l.parentNode.removeChild(l),l=u}a?(n.style.width=`${o}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${o}px`)}class SB{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),bb(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,bb(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function wb(t,e){return e?t.createChecked(null,e):t.createAndFill()}function TB(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function CB(t,e,n,r,i){const s=TB(t),o=[],a=[];for(let c=0;c<n;c+=1){const u=wb(s.cell,i);if(u&&a.push(u),r){const h=wb(s.header_cell,i);h&&o.push(h)}}const l=[];for(let c=0;c<e;c+=1)l.push(s.row.createChecked(null,r&&c===0?o:a));return s.table.createChecked(null,l)}function kB(t){return t instanceof Ae}const Nl=({editor:t})=>{const{selection:e}=t.state;if(!kB(e))return!1;let n=0;const r=eE(e.ranges[0].$from,s=>s.type.name==="table");return r==null||r.node.descendants(s=>{if(s.type.name==="table")return!1;["tableCell","tableHeader"].includes(s.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},IB=ht.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:SB,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",st(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:i,editor:s})=>{const o=CB(s.schema,t,e,n);if(i){const a=r.selection.anchor+1;r.replaceSelectionWith(o).scrollIntoView().setSelection(pe.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>JP(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>XP(t,e),deleteColumn:()=>({state:t,dispatch:e})=>QP(t,e),addRowBefore:()=>({state:t,dispatch:e})=>eB(t,e),addRowAfter:()=>({state:t,dispatch:e})=>tB(t,e),deleteRow:()=>({state:t,dispatch:e})=>rB(t,e),deleteTable:()=>({state:t,dispatch:e})=>uB(t,e),mergeCells:()=>({state:t,dispatch:e})=>db(t,e),splitCell:()=>({state:t,dispatch:e})=>fb(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>ka("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>ka("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>lB(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>db(t,e)?!0:fb(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>oB(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>gb(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>gb(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&fx(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const r=Ae.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Nl,"Mod-Backspace":Nl,Delete:Nl,"Mod-Delete":Nl}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[dB({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],xB({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Se(re(t,"tableRole",e))}}}),AB=ht.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",st(this.options.HTMLAttributes,t),0]}}),MB=ht.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",st(this.options.HTMLAttributes,t),0]}}),NB=ht.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",st(this.options.HTMLAttributes,t),0]}});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yx=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},OB=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},bx={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,c=l?t[i+2]:0,u=s>>2,h=(s&3)<<4|a>>4;let d=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(d=64)),r.push(n[u],n[h],n[d],n[f])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(yx(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):OB(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const c=i<t.length?n[t.charAt(i)]:64;++i;const h=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||c==null||h==null)throw Error();const d=s<<2|a>>4;if(r.push(d),c!==64){const f=a<<4&240|c>>2;if(r.push(f),h!==64){const p=c<<6&192|h;r.push(p)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},DB=function(t){const e=yx(t);return bx.encodeByteArray(e,!0)},Nc=function(t){return DB(t).replace(/\./g,"")},_B=function(t){try{return bx.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RB(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function LB(){return!RB()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function wx(){return typeof indexedDB=="object"}function PB(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}function BB(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FB=()=>BB().__FIREBASE_DEFAULTS__,VB=()=>{if(typeof process>"u")return;const t=process.env.__FIREBASE_DEFAULTS__,e=process.env.__FIREBASE_DEFAULTS_PATH__;if(t)return e&&console.warn("Values were provided for both __FIREBASE_DEFAULTS__ and __FIREBASE_DEFAULTS_PATH__. __FIREBASE_DEFAULTS_PATH__ will be ignored."),JSON.parse(t);if(e&&typeof require<"u")try{return require(e)}catch{console.warn(`Unable to read defaults from file provided to __FIREBASE_DEFAULTS_PATH__: ${e}`)}},$B=()=>{if(typeof document>"u")return;const t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/),e=t&&_B(t[1]);return e&&JSON.parse(e)},vx=()=>FB()||VB()||$B(),zB=t=>{var e,n;return(n=(e=vx())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},UB=()=>{var t;return(t=vx())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HB{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jB(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Nc(JSON.stringify(n)),Nc(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB="FirebaseError";class vo extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=KB,Object.setPrototypeOf(this,vo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ex.prototype.create)}}class Ex{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?qB(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new vo(i,a,r)}}function qB(t,e){return t.replace(WB,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const WB=/\{\$([^}]+)}/g;function ef(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(vb(s)&&vb(o)){if(!ef(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function vb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qr(t){return t&&t._delegate?t._delegate:t}class Ia{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GB{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new HB;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(XB(e))try{this.getOrInitializeService({instanceIdentifier:bi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=bi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=bi){return this.instances.has(e)}getOptions(e=bi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(!!r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:JB(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=bi){return this.component?this.component.multipleInstances?e:bi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function JB(t){return t===bi?void 0:t}function XB(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YB{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new GB(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Pe||(Pe={}));const QB={debug:Pe.DEBUG,verbose:Pe.VERBOSE,info:Pe.INFO,warn:Pe.WARN,error:Pe.ERROR,silent:Pe.SILENT},ZB=Pe.INFO,eF={[Pe.DEBUG]:"log",[Pe.VERBOSE]:"log",[Pe.INFO]:"info",[Pe.WARN]:"warn",[Pe.ERROR]:"error"},tF=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=eF[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class xx{constructor(e){this.name=e,this._logLevel=ZB,this._logHandler=tF,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Pe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?QB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Pe.DEBUG,...e),this._logHandler(this,Pe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Pe.VERBOSE,...e),this._logHandler(this,Pe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Pe.INFO,...e),this._logHandler(this,Pe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Pe.WARN,...e),this._logHandler(this,Pe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Pe.ERROR,...e),this._logHandler(this,Pe.ERROR,...e)}}const nF=(t,e)=>e.some(n=>t instanceof n);let Eb,xb;function rF(){return Eb||(Eb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function iF(){return xb||(xb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Sx=new WeakMap,tf=new WeakMap,Tx=new WeakMap,Wh=new WeakMap,jp=new WeakMap;function sF(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Hr(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Sx.set(n,t)}).catch(()=>{}),jp.set(e,t),e}function oF(t){if(tf.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});tf.set(t,e)}let nf={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return tf.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Tx.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Hr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function aF(t){nf=t(nf)}function lF(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Gh(this),e,...n);return Tx.set(r,e.sort?e.sort():[e]),Hr(r)}:iF().includes(t)?function(...e){return t.apply(Gh(this),e),Hr(Sx.get(this))}:function(...e){return Hr(t.apply(Gh(this),e))}}function cF(t){return typeof t=="function"?lF(t):(t instanceof IDBTransaction&&oF(t),nF(t,rF())?new Proxy(t,nf):t)}function Hr(t){if(t instanceof IDBRequest)return sF(t);if(Wh.has(t))return Wh.get(t);const e=cF(t);return e!==t&&(Wh.set(t,e),jp.set(e,t)),e}const Gh=t=>jp.get(t);function uF(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Hr(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Hr(o.result),l.oldVersion,l.newVersion,Hr(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}const hF=["get","getKey","getAll","getAllKeys","count"],dF=["put","add","delete","clear"],Jh=new Map;function Sb(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Jh.get(e))return Jh.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=dF.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||hF.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return Jh.set(e,s),s}aF(t=>({...t,get:(e,n,r)=>Sb(e,n)||t.get(e,n,r),has:(e,n)=>!!Sb(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(pF(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function pF(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const rf="@firebase/app",Tb="0.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yi=new xx("@firebase/app"),gF="@firebase/app-compat",mF="@firebase/analytics-compat",yF="@firebase/analytics",bF="@firebase/app-check-compat",wF="@firebase/app-check",vF="@firebase/auth",EF="@firebase/auth-compat",xF="@firebase/database",SF="@firebase/database-compat",TF="@firebase/functions",CF="@firebase/functions-compat",kF="@firebase/installations",IF="@firebase/installations-compat",AF="@firebase/messaging",MF="@firebase/messaging-compat",NF="@firebase/performance",OF="@firebase/performance-compat",DF="@firebase/remote-config",_F="@firebase/remote-config-compat",RF="@firebase/storage",LF="@firebase/storage-compat",PF="@firebase/firestore",BF="@firebase/firestore-compat",FF="firebase",VF="9.11.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="[DEFAULT]",$F={[rf]:"fire-core",[gF]:"fire-core-compat",[yF]:"fire-analytics",[mF]:"fire-analytics-compat",[wF]:"fire-app-check",[bF]:"fire-app-check-compat",[vF]:"fire-auth",[EF]:"fire-auth-compat",[xF]:"fire-rtdb",[SF]:"fire-rtdb-compat",[TF]:"fire-fn",[CF]:"fire-fn-compat",[kF]:"fire-iid",[IF]:"fire-iid-compat",[AF]:"fire-fcm",[MF]:"fire-fcm-compat",[NF]:"fire-perf",[OF]:"fire-perf-compat",[DF]:"fire-rc",[_F]:"fire-rc-compat",[RF]:"fire-gcs",[LF]:"fire-gcs-compat",[PF]:"fire-fst",[BF]:"fire-fst-compat","fire-js":"fire-js",[FF]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc=new Map,of=new Map;function zF(t,e){try{t.container.addComponent(e)}catch(n){Yi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Dc(t){const e=t.name;if(of.has(e))return Yi.debug(`There were multiple attempts to register component ${e}.`),!1;of.set(e,t);for(const n of Oc.values())zF(n,t);return!0}function UF(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HF={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},jr=new Ex("app","Firebase",HF);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ia("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw jr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KF=VF;function Cx(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:sf,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw jr.create("bad-app-name",{appName:String(i)});if(n||(n=UB()),!n)throw jr.create("no-options");const s=Oc.get(i);if(s){if(ef(n,s.options)&&ef(r,s.config))return s;throw jr.create("duplicate-app",{appName:i})}const o=new YB(i);for(const l of of.values())o.addComponent(l);const a=new jF(n,r,o);return Oc.set(i,a),a}function qF(t=sf){const e=Oc.get(t);if(!e&&t===sf)return Cx();if(!e)throw jr.create("no-app",{appName:t});return e}function zs(t,e,n){var r;let i=(r=$F[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Yi.warn(a.join(" "));return}Dc(new Ia(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WF="firebase-heartbeat-database",GF=1,Aa="firebase-heartbeat-store";let Xh=null;function kx(){return Xh||(Xh=uF(WF,GF,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Aa)}}}).catch(t=>{throw jr.create("idb-open",{originalErrorMessage:t.message})})),Xh}async function JF(t){var e;try{return(await kx()).transaction(Aa).objectStore(Aa).get(Ix(t))}catch(n){if(n instanceof vo)Yi.warn(n.message);else{const r=jr.create("idb-get",{originalErrorMessage:(e=n)===null||e===void 0?void 0:e.message});Yi.warn(r.message)}}}async function Cb(t,e){var n;try{const i=(await kx()).transaction(Aa,"readwrite");return await i.objectStore(Aa).put(e,Ix(t)),i.done}catch(r){if(r instanceof vo)Yi.warn(r.message);else{const i=jr.create("idb-set",{originalErrorMessage:(n=r)===null||n===void 0?void 0:n.message});Yi.warn(i.message)}}}function Ix(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XF=1024,YF=30*24*60*60*1e3;class QF{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new eV(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=kb();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(i=>{const s=new Date(i.date).valueOf();return Date.now()-s<=YF}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=kb(),{heartbeatsToSend:n,unsentEntries:r}=ZF(this._heartbeatsCache.heartbeats),i=Nc(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function kb(){return new Date().toISOString().substring(0,10)}function ZF(t,e=XF){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Ib(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ib(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class eV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return wx()?PB().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await JF(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return Cb(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return Cb(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Ib(t){return Nc(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tV(t){Dc(new Ia("platform-logger",e=>new fF(e),"PRIVATE")),Dc(new Ia("heartbeat",e=>new QF(e),"PRIVATE")),zs(rf,Tb,t),zs(rf,Tb,"esm2017"),zs("fire-js","")}tV("");var nV="firebase",rV="9.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zs(nV,rV,"app");var iV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},oe,Kp=Kp||{},ye=iV||self;function _c(){}function Au(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function Xa(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function sV(t){return Object.prototype.hasOwnProperty.call(t,Yh)&&t[Yh]||(t[Yh]=++oV)}var Yh="closure_uid_"+(1e9*Math.random()>>>0),oV=0;function aV(t,e,n){return t.call.apply(t.bind,arguments)}function lV(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Rt(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Rt=aV:Rt=lV,Rt.apply(null,arguments)}function Ol(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function Tt(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function si(){this.s=this.s,this.o=this.o}var cV=0;si.prototype.s=!1;si.prototype.na=function(){!this.s&&(this.s=!0,this.M(),cV!=0)&&sV(this)};si.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ax=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function qp(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Ab(t,e){for(let n=1;n<arguments.length;n++){const r=arguments[n];if(Au(r)){const i=t.length||0,s=r.length||0;t.length=i+s;for(let o=0;o<s;o++)t[i+o]=r[o]}else t.push(r)}}function Lt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Lt.prototype.h=function(){this.defaultPrevented=!0};var uV=function(){if(!ye.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ye.addEventListener("test",_c,e),ye.removeEventListener("test",_c,e)}catch{}return t}();function Rc(t){return/^[\s\xa0]*$/.test(t)}var Mb=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Qh(t,e){return t<e?-1:t>e?1:0}function Mu(){var t=ye.navigator;return t&&(t=t.userAgent)?t:""}function Yn(t){return Mu().indexOf(t)!=-1}function Wp(t){return Wp[" "](t),t}Wp[" "]=_c;function hV(t){var e=pV;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var dV=Yn("Opera"),so=Yn("Trident")||Yn("MSIE"),Mx=Yn("Edge"),af=Mx||so,Nx=Yn("Gecko")&&!(Mu().toLowerCase().indexOf("webkit")!=-1&&!Yn("Edge"))&&!(Yn("Trident")||Yn("MSIE"))&&!Yn("Edge"),fV=Mu().toLowerCase().indexOf("webkit")!=-1&&!Yn("Edge");function Ox(){var t=ye.document;return t?t.documentMode:void 0}var Lc;e:{var Zh="",ed=function(){var t=Mu();if(Nx)return/rv:([^\);]+)(\)|;)/.exec(t);if(Mx)return/Edge\/([\d\.]+)/.exec(t);if(so)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(fV)return/WebKit\/(\S+)/.exec(t);if(dV)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(ed&&(Zh=ed?ed[1]:""),so){var td=Ox();if(td!=null&&td>parseFloat(Zh)){Lc=String(td);break e}}Lc=Zh}var pV={};function gV(){return hV(function(){let t=0;const e=Mb(String(Lc)).split("."),n=Mb("9").split("."),r=Math.max(e.length,n.length);for(let o=0;t==0&&o<r;o++){var i=e[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i[0].length==0&&s[0].length==0)break;t=Qh(i[1].length==0?0:parseInt(i[1],10),s[1].length==0?0:parseInt(s[1],10))||Qh(i[2].length==0,s[2].length==0)||Qh(i[2],s[2]),i=i[3],s=s[3]}while(t==0)}return 0<=t})}var lf;if(ye.document&&so){var Nb=Ox();lf=Nb||parseInt(Lc,10)||void 0}else lf=void 0;var mV=lf;function Ma(t,e){if(Lt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Nx){e:{try{Wp(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:yV[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ma.X.h.call(this)}}Tt(Ma,Lt);var yV={2:"touch",3:"pen",4:"mouse"};Ma.prototype.h=function(){Ma.X.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ya="closure_listenable_"+(1e6*Math.random()|0),bV=0;function wV(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++bV,this.ba=this.ea=!1}function Nu(t){t.ba=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function Gp(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Dx(t){const e={};for(const n in t)e[n]=t[n];return e}const Ob="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _x(t,e){let n,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(n in r)t[n]=r[n];for(let s=0;s<Ob.length;s++)n=Ob[s],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Ou(t){this.src=t,this.g={},this.h=0}Ou.prototype.add=function(t,e,n,r,i){var s=t.toString();t=this.g[s],t||(t=this.g[s]=[],this.h++);var o=uf(t,e,r,i);return-1<o?(e=t[o],n||(e.ea=!1)):(e=new wV(e,this.src,s,!!r,i),e.ea=n,t.push(e)),e};function cf(t,e){var n=e.type;if(n in t.g){var r=t.g[n],i=Ax(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Nu(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function uf(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.ba&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}var Jp="closure_lm_"+(1e6*Math.random()|0),nd={};function Rx(t,e,n,r,i){if(r&&r.once)return Px(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Rx(t,e[s],n,r,i);return null}return n=Qp(n),t&&t[Ya]?t.N(e,n,Xa(r)?!!r.capture:!!r,i):Lx(t,e,n,!1,r,i)}function Lx(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=Xa(i)?!!i.capture:!!i,a=Yp(t);if(a||(t[Jp]=a=new Ou(t)),n=a.add(e,n,r,o,s),n.proxy)return n;if(r=vV(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)uV||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Fx(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function vV(){function t(n){return e.call(t.src,t.listener,n)}const e=EV;return t}function Px(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Px(t,e[s],n,r,i);return null}return n=Qp(n),t&&t[Ya]?t.O(e,n,Xa(r)?!!r.capture:!!r,i):Lx(t,e,n,!0,r,i)}function Bx(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Bx(t,e[s],n,r,i);else r=Xa(r)?!!r.capture:!!r,n=Qp(n),t&&t[Ya]?(t=t.i,e=String(e).toString(),e in t.g&&(s=t.g[e],n=uf(s,n,r,i),-1<n&&(Nu(s[n]),Array.prototype.splice.call(s,n,1),s.length==0&&(delete t.g[e],t.h--)))):t&&(t=Yp(t))&&(e=t.g[e.toString()],t=-1,e&&(t=uf(e,n,r,i)),(n=-1<t?e[t]:null)&&Xp(n))}function Xp(t){if(typeof t!="number"&&t&&!t.ba){var e=t.src;if(e&&e[Ya])cf(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Fx(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Yp(e))?(cf(n,t),n.h==0&&(n.src=null,e[Jp]=null)):Nu(t)}}}function Fx(t){return t in nd?nd[t]:nd[t]="on"+t}function EV(t,e){if(t.ba)t=!0;else{e=new Ma(e,this);var n=t.listener,r=t.ha||t.src;t.ea&&Xp(t),t=n.call(r,e)}return t}function Yp(t){return t=t[Jp],t instanceof Ou?t:null}var rd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qp(t){return typeof t=="function"?t:(t[rd]||(t[rd]=function(e){return t.handleEvent(e)}),t[rd])}function dt(){si.call(this),this.i=new Ou(this),this.P=this,this.I=null}Tt(dt,si);dt.prototype[Ya]=!0;dt.prototype.removeEventListener=function(t,e,n,r){Bx(this,t,e,n,r)};function xt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,typeof e=="string")e=new Lt(e,t);else if(e instanceof Lt)e.target=e.target||t;else{var i=e;e=new Lt(r,t),_x(e,i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Dl(o,r,!0,e)&&i}if(o=e.g=t,i=Dl(o,r,!0,e)&&i,i=Dl(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)o=e.g=n[s],i=Dl(o,r,!1,e)&&i}dt.prototype.M=function(){if(dt.X.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Nu(n[r]);delete t.g[e],t.h--}}this.I=null};dt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)};dt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};function Dl(t,e,n,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.ea&&cf(t.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var Zp=ye.JSON.stringify;function xV(){var t=zx;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class SV{constructor(){this.h=this.g=null}add(e,n){const r=Vx.get();r.set(e,n),this.h?this.h.next=r:this.g=r,this.h=r}}var Vx=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new TV,t=>t.reset());class TV{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function CV(t){ye.setTimeout(()=>{throw t},0)}function $x(t,e){hf||kV(),df||(hf(),df=!0),zx.add(t,e)}var hf;function kV(){var t=ye.Promise.resolve(void 0);hf=function(){t.then(IV)}}var df=!1,zx=new SV;function IV(){for(var t;t=xV();){try{t.h.call(t.g)}catch(n){CV(n)}var e=Vx;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}df=!1}function Du(t,e){dt.call(this),this.h=t||1,this.g=e||ye,this.j=Rt(this.kb,this),this.l=Date.now()}Tt(Du,dt);oe=Du.prototype;oe.ca=!1;oe.R=null;oe.kb=function(){if(this.ca){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-t):(this.R&&(this.g.clearTimeout(this.R),this.R=null),xt(this,"tick"),this.ca&&(eg(this),this.start()))}};oe.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function eg(t){t.ca=!1,t.R&&(t.g.clearTimeout(t.R),t.R=null)}oe.M=function(){Du.X.M.call(this),eg(this),delete this.g};function tg(t,e,n){if(typeof t=="function")n&&(t=Rt(t,n));else if(t&&typeof t.handleEvent=="function")t=Rt(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ye.setTimeout(t,e||0)}function Ux(t){t.g=tg(()=>{t.g=null,t.i&&(t.i=!1,Ux(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class AV extends si{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ux(this)}M(){super.M(),this.g&&(ye.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Na(t){si.call(this),this.h=t,this.g={}}Tt(Na,si);var Db=[];function Hx(t,e,n,r){Array.isArray(n)||(n&&(Db[0]=n.toString()),n=Db);for(var i=0;i<n.length;i++){var s=Rx(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function jx(t){Gp(t.g,function(e,n){this.g.hasOwnProperty(n)&&Xp(e)},t),t.g={}}Na.prototype.M=function(){Na.X.M.call(this),jx(this)};Na.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function _u(){this.g=!0}_u.prototype.Aa=function(){this.g=!1};function MV(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function NV(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+n+`
`+s+" "+o})}function Os(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+DV(t,n)+(r?" "+r:"")})}function OV(t,e){t.info(function(){return"TIMEOUT: "+e})}_u.prototype.info=function(){};function DV(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Zp(n)}catch{return e}}var cs={},_b=null;function Ru(){return _b=_b||new dt}cs.Oa="serverreachability";function Kx(t){Lt.call(this,cs.Oa,t)}Tt(Kx,Lt);function Oa(t){const e=Ru();xt(e,new Kx(e))}cs.STAT_EVENT="statevent";function qx(t,e){Lt.call(this,cs.STAT_EVENT,t),this.stat=e}Tt(qx,Lt);function Ut(t){const e=Ru();xt(e,new qx(e,t))}cs.Pa="timingevent";function Wx(t,e){Lt.call(this,cs.Pa,t),this.size=e}Tt(Wx,Lt);function Qa(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return ye.setTimeout(function(){t()},e)}var Lu={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,La:7,TIMEOUT:8,Cb:9},Gx={qb:"complete",Mb:"success",Ma:"error",La:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ng(){}ng.prototype.h=null;function Rb(t){return t.h||(t.h=t.i())}function Jx(){}var Za={OPEN:"a",pb:"b",Ma:"c",Bb:"d"};function rg(){Lt.call(this,"d")}Tt(rg,Lt);function ig(){Lt.call(this,"c")}Tt(ig,Lt);var ff;function Pu(){}Tt(Pu,ng);Pu.prototype.g=function(){return new XMLHttpRequest};Pu.prototype.i=function(){return{}};ff=new Pu;function el(t,e,n,r){this.l=t,this.j=e,this.m=n,this.U=r||1,this.S=new Na(this),this.O=_V,t=af?125:void 0,this.T=new Du(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Xx}function Xx(){this.i=null,this.g="",this.h=!1}var _V=45e3,pf={},Pc={};oe=el.prototype;oe.setTimeout=function(t){this.O=t};function gf(t,e,n){t.K=1,t.v=Fu(br(e)),t.s=n,t.P=!0,Yx(t,null)}function Yx(t,e){t.F=Date.now(),tl(t),t.A=br(t.v);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),sS(n.i,"t",r),t.C=0,n=t.l.H,t.h=new Xx,t.g=kS(t.l,n?e:null,!t.s),0<t.N&&(t.L=new AV(Rt(t.Ka,t,t.g),t.N)),Hx(t.S,t.g,"readystatechange",t.hb),e=t.H?Dx(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.da(t.A,t.u,t.s,e)):(t.u="GET",t.g.da(t.A,t.u,null,e)),Oa(),MV(t.j,t.u,t.A,t.m,t.U,t.s)}oe.hb=function(t){t=t.target;const e=this.L;e&&fr(t)==3?e.l():this.Ka(t)};oe.Ka=function(t){try{if(t==this.g)e:{const u=fr(this.g);var e=this.g.Ea();const h=this.g.aa();if(!(3>u)&&(u!=3||af||this.g&&(this.h.h||this.g.fa()||Fb(this.g)))){this.I||u!=4||e==7||(e==8||0>=h?Oa(3):Oa(2)),Bu(this);var n=this.g.aa();this.Y=n;t:if(Qx(this)){var r=Fb(this.g);t="";var i=r.length,s=fr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Oi(this),ea(this);var o="";break t}this.h.i=new ye.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=n==200,NV(this.j,this.u,this.A,this.m,this.U,u,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Rc(a)){var c=a;break t}}c=null}if(n=c)Os(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,mf(this,n);else{this.i=!1,this.o=3,Ut(12),Oi(this),ea(this);break e}}this.P?(Zx(this,u,o),af&&this.i&&u==3&&(Hx(this.S,this.T,"tick",this.gb),this.T.start())):(Os(this.j,this.m,o,null),mf(this,o)),u==4&&Oi(this),this.i&&!this.I&&(u==4?xS(this.l,this):(this.i=!1,tl(this)))}else n==400&&0<o.indexOf("Unknown SID")?(this.o=3,Ut(12)):(this.o=0,Ut(13)),Oi(this),ea(this)}}}catch{}finally{}};function Qx(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Da:!1}function Zx(t,e,n){let r=!0,i;for(;!t.I&&t.C<n.length;)if(i=RV(t,n),i==Pc){e==4&&(t.o=4,Ut(14),r=!1),Os(t.j,t.m,null,"[Incomplete Response]");break}else if(i==pf){t.o=4,Ut(15),Os(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}else Os(t.j,t.m,i,null),mf(t,i);Qx(t)&&i!=Pc&&i!=pf&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,Ut(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.$&&(t.$=!0,e=t.l,e.g==t&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),hg(e),e.K=!0,Ut(11))):(Os(t.j,t.m,n,"[Invalid Chunked Response]"),Oi(t),ea(t))}oe.gb=function(){if(this.g){var t=fr(this.g),e=this.g.fa();this.C<e.length&&(Bu(this),Zx(this,t,e),this.i&&t!=4&&tl(this))}};function RV(t,e){var n=t.C,r=e.indexOf(`
`,n);return r==-1?Pc:(n=Number(e.substring(n,r)),isNaN(n)?pf:(r+=1,r+n>e.length?Pc:(e=e.substr(r,n),t.C=r+n,e)))}oe.cancel=function(){this.I=!0,Oi(this)};function tl(t){t.V=Date.now()+t.O,eS(t,t.O)}function eS(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=Qa(Rt(t.fb,t),e)}function Bu(t){t.B&&(ye.clearTimeout(t.B),t.B=null)}oe.fb=function(){this.B=null;const t=Date.now();0<=t-this.V?(OV(this.j,this.A),this.K!=2&&(Oa(),Ut(17)),Oi(this),this.o=2,ea(this)):eS(this,this.V-t)};function ea(t){t.l.G==0||t.I||xS(t.l,t)}function Oi(t){Bu(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,eg(t.T),jx(t.S),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function mf(t,e){try{var n=t.l;if(n.G!=0&&(n.g==t||yf(n.h,t))){if(!t.J&&yf(n.h,t)&&n.G==3){try{var r=n.Fa.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.F+3e3<t.F)Vc(n),zu(n);else break e;ug(n),Ut(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&n.A==0&&!n.v&&(n.v=Qa(Rt(n.bb,n),6e3));if(1>=lS(n.h)&&n.ja){try{n.ja()}catch{}n.ja=void 0}}else Di(n,11)}else if((t.J||n.g==t)&&Vc(n),!Rc(e))for(i=n.Fa.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.T=c[0],c=c[1],n.G==2)if(c[0]=="c"){n.I=c[1],n.ka=c[2];const u=c[3];u!=null&&(n.ma=u,n.j.info("VER="+n.ma));const h=c[4];h!=null&&(n.Ca=h,n.j.info("SVER="+n.Ca));const d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=t.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var s=r.h;s.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(sg(s,s.h),s.h=null))}if(r.D){const g=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;g&&(r.za=g,Ke(r.F,r.D,g))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-t.F,n.j.info("Handshake RTT: "+n.P+"ms")),r=n;var o=t;if(r.sa=CS(r,r.H?r.ka:null,r.V),o.J){cS(r.h,o);var a=o,l=r.J;l&&a.setTimeout(l),a.B&&(Bu(a),tl(a)),r.g=o}else vS(r);0<n.i.length&&Uu(n)}else c[0]!="stop"&&c[0]!="close"||Di(n,7);else n.G==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Di(n,7):cg(n):c[0]!="noop"&&n.l&&n.l.wa(c),n.A=0)}}Oa(4)}catch{}}function LV(t){if(t.W&&typeof t.W=="function")return t.W();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(Au(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}e=[],n=0;for(r in t)e[n++]=t[r];return e}function PV(t){if(t.oa&&typeof t.oa=="function")return t.oa();if(!t.W||typeof t.W!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(Au(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}function tS(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Au(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=PV(t),r=LV(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}var nS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function BV(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Hi(t,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Hi){this.h=e!==void 0?e:t.h,Bc(this,t.j),this.s=t.s,this.g=t.g,Fc(this,t.m),this.l=t.l,e=t.i;var n=new Da;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Lb(this,n),this.o=t.o}else t&&(n=String(t).match(nS))?(this.h=!!e,Bc(this,n[1]||"",!0),this.s=Vo(n[2]||""),this.g=Vo(n[3]||"",!0),Fc(this,n[4]),this.l=Vo(n[5]||"",!0),Lb(this,n[6]||"",!0),this.o=Vo(n[7]||"")):(this.h=!!e,this.i=new Da(null,this.h))}Hi.prototype.toString=function(){var t=[],e=this.j;e&&t.push($o(e,Pb,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push($o(e,Pb,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push($o(n,n.charAt(0)=="/"?$V:VV,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",$o(n,UV)),t.join("")};function br(t){return new Hi(t)}function Bc(t,e,n){t.j=n?Vo(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Fc(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Lb(t,e,n){e instanceof Da?(t.i=e,HV(t.i,t.h)):(n||(e=$o(e,zV)),t.i=new Da(e,t.h))}function Ke(t,e,n){t.i.set(e,n)}function Fu(t){return Ke(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Vo(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $o(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,FV),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function FV(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Pb=/[#\/\?@]/g,VV=/[#\?:]/g,$V=/[#\?]/g,zV=/[#\?@]/g,UV=/#/g;function Da(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function oi(t){t.g||(t.g=new Map,t.h=0,t.i&&BV(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}oe=Da.prototype;oe.add=function(t,e){oi(this),this.i=null,t=Eo(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function rS(t,e){oi(t),e=Eo(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function iS(t,e){return oi(t),e=Eo(t,e),t.g.has(e)}oe.forEach=function(t,e){oi(this),this.g.forEach(function(n,r){n.forEach(function(i){t.call(e,i,r,this)},this)},this)};oe.oa=function(){oi(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let s=0;s<i.length;s++)n.push(e[r])}return n};oe.W=function(t){oi(this);let e=[];if(typeof t=="string")iS(this,t)&&(e=e.concat(this.g.get(Eo(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};oe.set=function(t,e){return oi(this),this.i=null,t=Eo(this,t),iS(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};oe.get=function(t,e){return t?(t=this.W(t),0<t.length?String(t[0]):e):e};function sS(t,e,n){rS(t,e),0<n.length&&(t.i=null,t.g.set(Eo(t,e),qp(n)),t.h+=n.length)}oe.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};function Eo(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function HV(t,e){e&&!t.j&&(oi(t),t.i=null,t.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(rS(this,r),sS(this,i,n))},t)),t.j=e}var jV=class{constructor(t,e){this.h=t,this.g=e}};function oS(t){this.l=t||KV,ye.PerformanceNavigationTiming?(t=ye.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(ye.g&&ye.g.Ga&&ye.g.Ga()&&ye.g.Ga().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var KV=10;function aS(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function lS(t){return t.h?1:t.g?t.g.size:0}function yf(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function sg(t,e){t.g?t.g.add(e):t.h=e}function cS(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}oS.prototype.cancel=function(){if(this.i=uS(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function uS(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return qp(t.i)}function og(){}og.prototype.stringify=function(t){return ye.JSON.stringify(t,void 0)};og.prototype.parse=function(t){return ye.JSON.parse(t,void 0)};function qV(){this.g=new og}function WV(t,e,n){const r=n||"";try{tS(t,function(i,s){let o=i;Xa(i)&&(o=Zp(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function GV(t,e){const n=new _u;if(ye.Image){const r=new Image;r.onload=Ol(_l,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Ol(_l,n,r,"TestLoadImage: error",!1,e),r.onabort=Ol(_l,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ol(_l,n,r,"TestLoadImage: timeout",!1,e),ye.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function _l(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function nl(t){this.l=t.$b||null,this.j=t.ib||!1}Tt(nl,ng);nl.prototype.g=function(){return new Vu(this.l,this.j)};nl.prototype.i=function(t){return function(){return t}}({});function Vu(t,e){dt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=ag,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Tt(Vu,dt);var ag=0;oe=Vu.prototype;oe.open=function(t,e){if(this.readyState!=ag)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,_a(this)};oe.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ye).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ga.bind(this))};oe.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,rl(this)),this.readyState=ag};oe.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,_a(this)),this.g&&(this.readyState=3,_a(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ta.bind(this),this.ga.bind(this));else if(typeof ye.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hS(this)}else t.text().then(this.Ua.bind(this),this.ga.bind(this))};function hS(t){t.j.read().then(t.Sa.bind(t)).catch(t.ga.bind(t))}oe.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?rl(this):_a(this),this.readyState==3&&hS(this)}};oe.Ua=function(t){this.g&&(this.response=this.responseText=t,rl(this))};oe.Ta=function(t){this.g&&(this.response=t,rl(this))};oe.ga=function(){this.g&&rl(this)};function rl(t){t.readyState=4,t.l=null,t.j=null,t.A=null,_a(t)}oe.setRequestHeader=function(t,e){this.v.append(t,e)};oe.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};oe.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function _a(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Vu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var JV=ye.JSON.parse;function tt(t){dt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=dS,this.K=this.L=!1}Tt(tt,dt);var dS="",XV=/^https?$/i,YV=["POST","PUT"];oe=tt.prototype;oe.da=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ff.g(),this.C=this.u?Rb(this.u):Rb(ff),this.g.onreadystatechange=Rt(this.Ha,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(s){Bb(this,s);return}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())n.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(s=>s.toLowerCase()=="content-type"),i=ye.FormData&&t instanceof ye.FormData,!(0<=Ax(YV,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of n)this.g.setRequestHeader(s,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gS(this),0<this.B&&((this.K=QV(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Rt(this.qa,this)):this.A=tg(this.qa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(s){Bb(this,s)}};function QV(t){return so&&gV()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}oe.qa=function(){typeof Kp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xt(this,"timeout"),this.abort(8))};function Bb(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,fS(t),$u(t)}function fS(t){t.D||(t.D=!0,xt(t,"complete"),xt(t,"error"))}oe.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,xt(this,"complete"),xt(this,"abort"),$u(this))};oe.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$u(this,!0)),tt.X.M.call(this)};oe.Ha=function(){this.s||(this.F||this.v||this.l?pS(this):this.eb())};oe.eb=function(){pS(this)};function pS(t){if(t.h&&typeof Kp<"u"&&(!t.C[1]||fr(t)!=4||t.aa()!=2)){if(t.v&&fr(t)==4)tg(t.Ha,0,t);else if(xt(t,"readystatechange"),fr(t)==4){t.h=!1;try{const a=t.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var r;if(r=a===0){var i=String(t.H).match(nS)[1]||null;if(!i&&ye.self&&ye.self.location){var s=ye.self.location.protocol;i=s.substr(0,s.length-1)}r=!XV.test(i?i.toLowerCase():"")}n=r}if(n)xt(t,"complete"),xt(t,"success");else{t.m=6;try{var o=2<fr(t)?t.g.statusText:""}catch{o=""}t.j=o+" ["+t.aa()+"]",fS(t)}}finally{$u(t)}}}}function $u(t,e){if(t.g){gS(t);const n=t.g,r=t.C[0]?_c:null;t.g=null,t.C=null,e||xt(t,"ready");try{n.onreadystatechange=r}catch{}}}function gS(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ye.clearTimeout(t.A),t.A=null)}function fr(t){return t.g?t.g.readyState:0}oe.aa=function(){try{return 2<fr(this)?this.g.status:-1}catch{return-1}};oe.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};oe.Ra=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),JV(e)}};function Fb(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case dS:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}oe.Ea=function(){return this.m};oe.Na=function(){return typeof this.j=="string"?this.j:String(this.j)};function mS(t){let e="";return Gp(t,function(n,r){e+=r,e+=":",e+=n,e+=`\r
`}),e}function lg(t,e,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=mS(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):Ke(t,e,n))}function Ao(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function yS(t){this.Ca=0,this.i=[],this.j=new _u,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.$a=this.U=0,this.Ya=Ao("failFast",!1,t),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Wa=Ao("baseRetryDelayMs",5e3,t),this.ab=Ao("retryDelaySeedMs",1e4,t),this.Za=Ao("forwardChannelMaxRetries",2,t),this.ta=Ao("forwardChannelRequestTimeoutMs",2e4,t),this.ra=t&&t.xmlHttpFactory||void 0,this.Da=t&&t.Yb||!1,this.J=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.I="",this.h=new oS(t&&t.concurrentRequestLimit),this.Fa=new qV,this.O=t&&t.fastHandshake||!1,this.N=t&&t.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Xa=t&&t.Wb||!1,t&&t.Aa&&this.j.Aa(),t&&t.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&t&&t.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}oe=yS.prototype;oe.ma=8;oe.G=1;function cg(t){if(bS(t),t.G==3){var e=t.U++,n=br(t.F);Ke(n,"SID",t.I),Ke(n,"RID",e),Ke(n,"TYPE","terminate"),il(t,n),e=new el(t,t.j,e,void 0),e.K=2,e.v=Fu(br(n)),n=!1,ye.navigator&&ye.navigator.sendBeacon&&(n=ye.navigator.sendBeacon(e.v.toString(),"")),!n&&ye.Image&&(new Image().src=e.v,n=!0),n||(e.g=kS(e.l,null),e.g.da(e.v)),e.F=Date.now(),tl(e)}TS(t)}function zu(t){t.g&&(hg(t),t.g.cancel(),t.g=null)}function bS(t){zu(t),t.u&&(ye.clearTimeout(t.u),t.u=null),Vc(t),t.h.cancel(),t.m&&(typeof t.m=="number"&&ye.clearTimeout(t.m),t.m=null)}function Uu(t){aS(t.h)||t.m||(t.m=!0,$x(t.Ja,t),t.C=0)}function ZV(t,e){return lS(t.h)>=t.h.j-(t.m?1:0)?!1:t.m?(t.i=e.D.concat(t.i),!0):t.G==1||t.G==2||t.C>=(t.Ya?0:t.Za)?!1:(t.m=Qa(Rt(t.Ja,t,e),SS(t,t.C)),t.C++,!0)}oe.Ja=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new el(this,this.j,t,void 0);let s=this.s;if(this.S&&(s?(s=Dx(s),_x(s,this.S)):s=this.S),this.o!==null||this.N||(i.H=s,s=null),this.O)e:{for(var e=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.g&&(r=r.g.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=n;break e}if(e===4096||n===this.i.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=wS(this,i,e),n=br(this.F),Ke(n,"RID",t),Ke(n,"CVER",22),this.D&&Ke(n,"X-HTTP-Session-Id",this.D),il(this,n),s&&(this.N?e="headers="+encodeURIComponent(String(mS(s)))+"&"+e:this.o&&lg(n,this.o,s)),sg(this.h,i),this.Xa&&Ke(n,"TYPE","init"),this.O?(Ke(n,"$req",e),Ke(n,"SID","null"),i.Z=!0,gf(i,n,null)):gf(i,n,e),this.G=2}}else this.G==3&&(t?Vb(this,t):this.i.length==0||aS(this.h)||Vb(this))};function Vb(t,e){var n;e?n=e.m:n=t.U++;const r=br(t.F);Ke(r,"SID",t.I),Ke(r,"RID",n),Ke(r,"AID",t.T),il(t,r),t.o&&t.s&&lg(r,t.o,t.s),n=new el(t,t.j,n,t.C+1),t.o===null&&(n.H=t.s),e&&(t.i=e.D.concat(t.i)),e=wS(t,n,1e3),n.setTimeout(Math.round(.5*t.ta)+Math.round(.5*t.ta*Math.random())),sg(t.h,n),gf(n,r,e)}function il(t,e){t.ia&&Gp(t.ia,function(n,r){Ke(e,r,n)}),t.l&&tS({},function(n,r){Ke(e,r,n)})}function wS(t,e,n){n=Math.min(t.i.length,n);var r=t.l?Rt(t.l.Qa,t.l,t):null;e:{var i=t.i;let s=-1;for(;;){const o=["count="+n];s==-1?0<n?(s=i[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<n;l++){let c=i[l].h;const u=i[l].g;if(c-=s,0>c)s=Math.max(0,i[l].h-100),a=!1;else try{WV(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return t=t.i.splice(0,n),e.D=t,r}function vS(t){t.g||t.u||(t.Z=1,$x(t.Ia,t),t.A=0)}function ug(t){return t.g||t.u||3<=t.A?!1:(t.Z++,t.u=Qa(Rt(t.Ia,t),SS(t,t.A)),t.A++,!0)}oe.Ia=function(){if(this.u=null,ES(this),this.$&&!(this.K||this.g==null||0>=this.P)){var t=2*this.P;this.j.info("BP detection timer enabled: "+t),this.B=Qa(Rt(this.cb,this),t)}};oe.cb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ut(10),zu(this),ES(this))};function hg(t){t.B!=null&&(ye.clearTimeout(t.B),t.B=null)}function ES(t){t.g=new el(t,t.j,"rpc",t.Z),t.o===null&&(t.g.H=t.s),t.g.N=0;var e=br(t.sa);Ke(e,"RID","rpc"),Ke(e,"SID",t.I),Ke(e,"CI",t.L?"0":"1"),Ke(e,"AID",t.T),Ke(e,"TYPE","xmlhttp"),il(t,e),t.o&&t.s&&lg(e,t.o,t.s),t.J&&t.g.setTimeout(t.J);var n=t.g;t=t.ka,n.K=1,n.v=Fu(br(e)),n.s=null,n.P=!0,Yx(n,t)}oe.bb=function(){this.v!=null&&(this.v=null,zu(this),ug(this),Ut(19))};function Vc(t){t.v!=null&&(ye.clearTimeout(t.v),t.v=null)}function xS(t,e){var n=null;if(t.g==e){Vc(t),hg(t),t.g=null;var r=2}else if(yf(t.h,e))n=e.D,cS(t.h,e),r=1;else return;if(t.G!=0){if(t.pa=e.Y,e.i)if(r==1){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;r=Ru(),xt(r,new Wx(r,n)),Uu(t)}else vS(t);else if(i=e.o,i==3||i==0&&0<t.pa||!(r==1&&ZV(t,e)||r==2&&ug(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:Di(t,5);break;case 4:Di(t,10);break;case 3:Di(t,6);break;default:Di(t,2)}}}function SS(t,e){let n=t.Wa+Math.floor(Math.random()*t.ab);return t.l||(n*=2),n*e}function Di(t,e){if(t.j.info("Error code "+e),e==2){var n=null;t.l&&(n=null);var r=Rt(t.jb,t);n||(n=new Hi("//www.google.com/images/cleardot.gif"),ye.location&&ye.location.protocol=="http"||Bc(n,"https"),Fu(n)),GV(n.toString(),r)}else Ut(2);t.G=0,t.l&&t.l.va(e),TS(t),bS(t)}oe.jb=function(t){t?(this.j.info("Successfully pinged google.com"),Ut(2)):(this.j.info("Failed to ping google.com"),Ut(1))};function TS(t){if(t.G=0,t.la=[],t.l){const e=uS(t.h);(e.length!=0||t.i.length!=0)&&(Ab(t.la,e),Ab(t.la,t.i),t.h.i.length=0,qp(t.i),t.i.length=0),t.l.ua()}}function CS(t,e,n){var r=n instanceof Hi?br(n):new Hi(n,void 0);if(r.g!="")e&&(r.g=e+"."+r.g),Fc(r,r.m);else{var i=ye.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Hi(null,void 0);r&&Bc(s,r),e&&(s.g=e),i&&Fc(s,i),n&&(s.l=n),r=s}return n=t.D,e=t.za,n&&e&&Ke(r,n,e),Ke(r,"VER",t.ma),il(t,r),r}function kS(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Da&&!t.ra?new tt(new nl({ib:!0})):new tt(t.ra),e.L=t.H,e}function IS(){}oe=IS.prototype;oe.xa=function(){};oe.wa=function(){};oe.va=function(){};oe.ua=function(){};oe.Qa=function(){};function $c(){if(so&&!(10<=Number(mV)))throw Error("Environmental error: no available transport.")}$c.prototype.g=function(t,e){return new fn(t,e)};function fn(t,e){dt.call(this),this.g=new yS(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.S=t,(t=e&&e.Xb)&&!Rc(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Rc(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new xo(this)}Tt(fn,dt);fn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;Ut(0),t.V=e,t.ia=n||{},t.L=t.Y,t.F=CS(t,null,t.V),Uu(t)};fn.prototype.close=function(){cg(this.g)};fn.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=Zp(t),t=n);e.i.push(new jV(e.$a++,t)),e.G==3&&Uu(e)};fn.prototype.M=function(){this.g.l=null,delete this.j,cg(this.g),delete this.g,fn.X.M.call(this)};function AS(t){rg.call(this);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Tt(AS,rg);function MS(){ig.call(this),this.status=1}Tt(MS,ig);function xo(t){this.g=t}Tt(xo,IS);xo.prototype.xa=function(){xt(this.g,"a")};xo.prototype.wa=function(t){xt(this.g,new AS(t))};xo.prototype.va=function(t){xt(this.g,new MS)};xo.prototype.ua=function(){xt(this.g,"b")};$c.prototype.createWebChannel=$c.prototype.g;fn.prototype.send=fn.prototype.u;fn.prototype.open=fn.prototype.m;fn.prototype.close=fn.prototype.close;Lu.NO_ERROR=0;Lu.TIMEOUT=8;Lu.HTTP_ERROR=6;Gx.COMPLETE="complete";Jx.EventType=Za;Za.OPEN="a";Za.CLOSE="b";Za.ERROR="c";Za.MESSAGE="d";dt.prototype.listen=dt.prototype.N;tt.prototype.listenOnce=tt.prototype.O;tt.prototype.getLastError=tt.prototype.Na;tt.prototype.getLastErrorCode=tt.prototype.Ea;tt.prototype.getStatus=tt.prototype.aa;tt.prototype.getResponseJson=tt.prototype.Ra;tt.prototype.getResponseText=tt.prototype.fa;tt.prototype.send=tt.prototype.da;var e$=function(){return new $c},t$=function(){return Ru()},id=Lu,n$=Gx,r$=cs,$b={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},i$=nl,Rl=Jx,s$=tt;const zb="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bt.UNAUTHENTICATED=new bt(null),bt.GOOGLE_CREDENTIALS=new bt("google-credentials-uid"),bt.FIRST_PARTY=new bt("first-party-uid"),bt.MOCK_USER=new bt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let So="9.11.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qi=new xx("@firebase/firestore");function bf(){return Qi.logLevel}function j(t,...e){if(Qi.logLevel<=Pe.DEBUG){const n=e.map(dg);Qi.debug(`Firestore (${So}): ${t}`,...n)}}function $t(t,...e){if(Qi.logLevel<=Pe.ERROR){const n=e.map(dg);Qi.error(`Firestore (${So}): ${t}`,...n)}}function zc(t,...e){if(Qi.logLevel<=Pe.WARN){const n=e.map(dg);Qi.warn(`Firestore (${So}): ${t}`,...n)}}function dg(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(t="Unexpected state"){const e=`FIRESTORE (${So}) INTERNAL ASSERTION FAILED: `+t;throw $t(e),new Error(e)}function be(t,e){t||ae()}function we(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends vo{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class o${getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(bt.UNAUTHENTICATED))}shutdown(){}}class a${constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class l${constructor(e){this.t=e,this.currentUser=bt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new Vn;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Vn,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{j("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(j("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Vn)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(j("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(be(typeof r.accessToken=="string"),new NS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return be(e===null||typeof e=="string"),new bt(e)}}class c${constructor(e,n,r,i){this.h=e,this.l=n,this.m=r,this.g=i,this.type="FirstParty",this.user=bt.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(be(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class u${constructor(e,n,r,i){this.h=e,this.l=n,this.m=r,this.g=i}getToken(){return Promise.resolve(new c$(this.h,this.l,this.m,this.g))}start(e,n){e.enqueueRetryable(()=>n(bt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class h${constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class d${constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,n){const r=s=>{s.error!=null&&j("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.A;return this.A=s.token,j("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{j("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?i(s):j("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(be(typeof n.token=="string"),this.A=n.token,new h$(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f$(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OS{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=f$(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}}function Te(t,e){return t<e?-1:t>e?1:0}function oo(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function DS(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class We{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new se(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new se(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new se(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new We(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Te(this.nanoseconds,e.nanoseconds):Te(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ge{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ge(e)}static min(){return new ge(new We(0,0))}static max(){return new ge(new We(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e,n,r){n===void 0?n=0:n>e.length&&ae(),r===void 0?r=e.length-n:r>e.length-n&&ae(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ra.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ra?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class Ve extends Ra{construct(e,n,r){return new Ve(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new se(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new Ve(n)}static emptyPath(){return new Ve([])}}const p$=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends Ra{construct(e,n,r){return new et(e,n,r)}static isValidIdentifier(e){return p$.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),et.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new et(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new se(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new se(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new se(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new se(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new et(n)}static emptyPath(){return new et([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Ve.fromString(e))}static fromName(e){return new ee(Ve.fromString(e).popFirst(5))}static empty(){return new ee(Ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ve.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Ve(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _S{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}}function wf(t){return t.fields.find(e=>e.kind===2)}function wi(t){return t.fields.filter(e=>e.kind!==2)}_S.UNKNOWN_ID=-1;class g${constructor(e,n){this.fieldPath=e,this.kind=n}}class Uc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Uc(0,pn.min())}}function m$(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=ge.fromTimestamp(r===1e9?new We(n+1,0):new We(n,r));return new pn(i,ee.empty(),e)}function RS(t){return new pn(t.readTime,t.key,-1)}class pn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new pn(ge.min(),ee.empty(),-1)}static max(){return new pn(ge.max(),ee.empty(),-1)}}function fg(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ee.comparator(t.documentKey,e.documentKey),n!==0?n:Te(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function us(t){if(t.code!==z.FAILED_PRECONDITION||t.message!==LS)throw t;j("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ae(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new k((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof k?n:k.resolve(n)}catch(n){return k.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):k.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):k.reject(n)}static resolve(e){return new k((n,r)=>{n(e)})}static reject(e){return new k((n,r)=>{r(e)})}static waitFor(e){return new k((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},l=>r(l))}),o=!0,s===i&&n()})}static or(e){let n=k.resolve(!1);for(const r of e)n=n.next(i=>i?k.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new k((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const c=l;n(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,n){return new k((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.P=new Vn,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{n.error?this.P.reject(new ta(e,n.error)):this.P.resolve()},this.transaction.onerror=r=>{const i=pg(r.target.error);this.P.reject(new ta(e,i))}}static open(e,n,r,i){try{return new Hu(n,e.transaction(i,r))}catch(s){throw new ta(n,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(j("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new b$(n)}}class pr{constructor(e,n,r){this.name=e,this.version=n,this.S=r,pr.D(Zd())===12.2&&$t("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return j("SimpleDb","Removing database:",e),Ci(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!wx())return!1;if(pr.N())return!0;const e=Zd(),n=pr.D(e),r=0<n&&n<10,i=pr.k(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static N(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.O)==="YES"}static M(e,n){return e.store(n)}static D(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const n=e.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}async F(e){return this.db||(j("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const o=s.target.result;n(o)},i.onblocked=()=>{r(new ta(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const o=s.target.error;o.name==="VersionError"?r(new se(z.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new se(z.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ta(e,o))},i.onupgradeneeded=s=>{j("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.S.$(o,i.transaction,s.oldVersion,this.version).next(()=>{j("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=n=>this.B(n)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,i){const s=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.F(e);const a=Hu.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.V(),c)).catch(c=>(a.abort(c),k.reject(c))).toPromise();return l.catch(()=>{}),await a.v,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(j("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}class y${constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return Ci(this.U.delete())}}class ta extends se{constructor(e,n){super(z.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function ai(t){return t.name==="IndexedDbTransactionError"}class b${constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(j("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(j("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ci(r)}add(e){return j("SimpleDb","ADD",this.store.name,e,e),Ci(this.store.add(e))}get(e){return Ci(this.store.get(e)).next(n=>(n===void 0&&(n=null),j("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return j("SimpleDb","DELETE",this.store.name,e),Ci(this.store.delete(e))}count(){return j("SimpleDb","COUNT",this.store.name),Ci(this.store.count())}W(e,n){const r=this.options(e,n);if(r.index||typeof this.store.getAll!="function"){const i=this.cursor(r),s=[];return this.H(i,(o,a)=>{s.push(a)}).next(()=>s)}{const i=this.store.getAll(r.range);return new k((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}J(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new k((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(e,n){j("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const i=this.cursor(r);return this.H(i,(s,o,a)=>a.delete())}Z(e,n){let r;n?r=e:(r={},n=e);const i=this.cursor(r);return this.H(i,n)}tt(e){const n=this.cursor({});return new k((r,i)=>{n.onerror=s=>{const o=pg(s.target.error);i(o)},n.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,n){const r=[];return new k((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const l=new y$(a),c=n(a.primaryKey,a.value,l);if(c instanceof k){const u=c.catch(h=>(l.done(),k.reject(h)));r.push(u)}l.isDone?i():l.G===null?a.continue():a.continue(l.G)}}).next(()=>k.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Ci(t){return new k((e,n)=>{t.onsuccess=r=>{const i=r.target.result;e(i)},t.onerror=r=>{const i=pg(r.target.error);n(i)}})}let Ub=!1;function pg(t){const e=pr.D(Zd());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new se("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ub||(Ub=!0,setTimeout(()=>{throw r},0)),r}}return t}class w${constructor(e,n){this.asyncQueue=e,this.et=n,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}nt(e){j("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{j("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(n){ai(n)?j("IndexBackiller","Ignoring IndexedDB error during index backfill: ",n):await us(n)}await this.nt(6e4)})}}class v${constructor(e,n){this.localStore=e,this.persistence=n}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.it(n,e))}it(e,n){const r=new Set;let i=n,s=!0;return k.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return j("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>n-i)}rt(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(i=>this.localStore.localDocuments.getNextDocuments(e,n,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(i,s)).next(a=>(j("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}ot(e,n){let r=e;return n.changes.forEach((i,s)=>{const o=RS(s);fg(o,r)>0&&(r=o)}),new pn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>n.writeSequenceNumber(r))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hb(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function hs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function BS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sn.at=-1;class nt{constructor(e,n){this.comparator=e,this.root=n||wt.EMPTY}insert(e,n){return new nt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,wt.BLACK,null,null))}remove(e){return new nt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,wt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ll(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ll(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ll(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ll(this.root,e,this.comparator,!0)}}class Ll{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class wt{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r!=null?r:wt.RED,this.left=i!=null?i:wt.EMPTY,this.right=s!=null?s:wt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new wt(e!=null?e:this.key,n!=null?n:this.value,r!=null?r:this.color,i!=null?i:this.left,s!=null?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return wt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return wt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,wt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,wt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ae();const e=this.left.check();if(e!==this.right.check())throw ae();return e+(this.isRed()?0:1)}}wt.EMPTY=null,wt.RED=!0,wt.BLACK=!1;wt.EMPTY=new class{constructor(){this.size=0}get key(){throw ae()}get value(){throw ae()}get color(){throw ae()}get left(){throw ae()}get right(){throw ae()}copy(t,e,n,r,i){return this}insert(t,e,n){return new wt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.comparator=e,this.data=new nt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new jb(this.data.getIterator())}getIteratorFrom(e){return new jb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof $e)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new $e(this.comparator);return n.data=e,n}}class jb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ws(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new cn([])}unionWith(e){let n=new $e(et.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new cn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return oo(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e){this.binaryString=e}static fromBase64String(e){const n=atob(e);return new ft(n)}static fromUint8Array(e){const n=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new ft(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Te(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ft.EMPTY_BYTE_STRING=new ft("");const E$=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zr(t){if(be(!!t),typeof t=="string"){let e=0;const n=E$.exec(t);if(be(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ge(t.seconds),nanos:Ge(t.nanos)}}function Ge(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Zi(t){return typeof t=="string"?ft.fromBase64String(t):ft.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FS(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function VS(t){const e=t.mapValue.fields.__previous_value__;return FS(e)?VS(e):e}function La(t){const e=Zr(t.mapValue.fields.__local_write_time__.timestampValue);return new We(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x${constructor(e,n,r,i,s,o,a,l){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=l}}class es{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new es("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof es&&e.projectId===this.projectId&&e.database===this.database}}function ju(t){return t==null}function Pa(t){return t===0&&1/t==-1/0}function S$(t){return typeof t=="number"&&Number.isInteger(t)&&!Pa(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Br={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Yl={nullValue:"NULL_VALUE"};function ts(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?FS(t)?4:$S(t)?9007199254740991:10:ae()}function ar(t,e){if(t===e)return!0;const n=ts(t);if(n!==ts(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return La(t).isEqual(La(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=Zr(r.timestampValue),o=Zr(i.timestampValue);return s.seconds===o.seconds&&s.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,i){return Zi(r.bytesValue).isEqual(Zi(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,i){return Ge(r.geoPointValue.latitude)===Ge(i.geoPointValue.latitude)&&Ge(r.geoPointValue.longitude)===Ge(i.geoPointValue.longitude)}(t,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Ge(r.integerValue)===Ge(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Ge(r.doubleValue),o=Ge(i.doubleValue);return s===o?Pa(s)===Pa(o):isNaN(s)&&isNaN(o)}return!1}(t,e);case 9:return oo(t.arrayValue.values||[],e.arrayValue.values||[],ar);case 10:return function(r,i){const s=r.mapValue.fields||{},o=i.mapValue.fields||{};if(Hb(s)!==Hb(o))return!1;for(const a in s)if(s.hasOwnProperty(a)&&(o[a]===void 0||!ar(s[a],o[a])))return!1;return!0}(t,e);default:return ae()}}function Ba(t,e){return(t.values||[]).find(n=>ar(n,e))!==void 0}function ei(t,e){if(t===e)return 0;const n=ts(t),r=ts(e);if(n!==r)return Te(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Te(t.booleanValue,e.booleanValue);case 2:return function(i,s){const o=Ge(i.integerValue||i.doubleValue),a=Ge(s.integerValue||s.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Kb(t.timestampValue,e.timestampValue);case 4:return Kb(La(t),La(e));case 5:return Te(t.stringValue,e.stringValue);case 6:return function(i,s){const o=Zi(i),a=Zi(s);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(i,s){const o=i.split("/"),a=s.split("/");for(let l=0;l<o.length&&l<a.length;l++){const c=Te(o[l],a[l]);if(c!==0)return c}return Te(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,s){const o=Te(Ge(i.latitude),Ge(s.latitude));return o!==0?o:Te(Ge(i.longitude),Ge(s.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(i,s){const o=i.values||[],a=s.values||[];for(let l=0;l<o.length&&l<a.length;++l){const c=ei(o[l],a[l]);if(c)return c}return Te(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===Br.mapValue&&s===Br.mapValue)return 0;if(i===Br.mapValue)return 1;if(s===Br.mapValue)return-1;const o=i.fields||{},a=Object.keys(o),l=s.fields||{},c=Object.keys(l);a.sort(),c.sort();for(let u=0;u<a.length&&u<c.length;++u){const h=Te(a[u],c[u]);if(h!==0)return h;const d=ei(o[a[u]],l[c[u]]);if(d!==0)return d}return Te(a.length,c.length)}(t.mapValue,e.mapValue);default:throw ae()}}function Kb(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Te(t,e);const n=Zr(t),r=Zr(e),i=Te(n.seconds,r.seconds);return i!==0?i:Te(n.nanos,r.nanos)}function Us(t){return vf(t)}function vf(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const i=Zr(r);return`time(${i.seconds},${i.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Zi(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ee.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(r){let i="[",s=!0;for(const o of r.values||[])s?s=!1:i+=",",i+=vf(o);return i+"]"}(t.arrayValue):"mapValue"in t?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",o=!0;for(const a of i)o?o=!1:s+=",",s+=`${a}:${vf(r.fields[a])}`;return s+"}"}(t.mapValue):ae();var e,n}function gg(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ef(t){return!!t&&"integerValue"in t}function Fa(t){return!!t&&"arrayValue"in t}function qb(t){return!!t&&"nullValue"in t}function Wb(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ql(t){return!!t&&"mapValue"in t}function na(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return hs(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=na(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=na(t.arrayValue.values[n]);return e}return Object.assign({},t)}function $S(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function T$(t){return"nullValue"in t?Yl:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?gg(es.empty(),ee.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:ae()}function C$(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?gg(es.empty(),ee.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?Br:ae()}function Gb(t,e){const n=ei(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Jb(t,e){const n=ei(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e){this.value=e}static empty(){return new Nt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Ql(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=na(n)}setAll(e){let n=et.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=na(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());Ql(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return ar(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Ql(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){hs(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Nt(na(this.value))}}function zS(t){const e=[];return hs(t.fields,(n,r)=>{const i=new et([n]);if(Ql(r)){const s=zS(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new cn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e,n,r,i,s,o){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new qe(e,0,ge.min(),ge.min(),Nt.empty(),0)}static newFoundDocument(e,n,r){return new qe(e,1,n,ge.min(),r,0)}static newNoDocument(e,n){return new qe(e,2,n,ge.min(),Nt.empty(),0)}static newUnknownDocument(e,n){return new qe(e,3,n,ge.min(),Nt.empty(),2)}convertToFoundDocument(e,n){return this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Nt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Nt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ge.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new qe(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k${constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ht=null}}function Xb(t,e=null,n=[],r=[],i=null,s=null,o=null){return new k$(t,e,n,r,i,s,o)}function ns(t){const e=we(t);if(e.ht===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>{return(i=r).field.canonicalString()+i.op.toString()+Us(i.value);var i}).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ju(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Us(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Us(r)).join(",")),e.ht=n}return e.ht}function I$(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(n=>{return`${(r=n).field.canonicalString()} ${r.op} ${Us(r.value)}`;var r}).join(", ")}]`),ju(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(n=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(n)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Us(n)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Us(n)).join(",")),`Target(${e})`}function sl(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<t.orderBy.length;i++)if(!L$(t.orderBy[i],e.orderBy[i]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],r=e.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!ar(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ew(t.startAt,e.startAt)&&ew(t.endAt,e.endAt)}function Hc(t){return ee.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function jc(t,e){return t.filters.filter(n=>n instanceof _t&&n.field.isEqual(e))}function Yb(t,e,n){let r=Yl,i=!0;for(const s of jc(t,e)){let o=Yl,a=!0;switch(s.op){case"<":case"<=":o=T$(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Yl}Gb({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const o=n.position[s];Gb({value:r,inclusive:i},{value:o,inclusive:n.inclusive})<0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}function Qb(t,e,n){let r=Br,i=!0;for(const s of jc(t,e)){let o=Br,a=!0;switch(s.op){case">=":case">":o=C$(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Br}Jb({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const o=n.position[s];Jb({value:r,inclusive:i},{value:o,inclusive:n.inclusive})>0&&(r=o,i=n.inclusive);break}}return{value:r,inclusive:i}}class _t extends class{}{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.lt(e,n,r):new A$(e,n,r):n==="array-contains"?new O$(e,r):n==="in"?new D$(e,r):n==="not-in"?new _$(e,r):n==="array-contains-any"?new R$(e,r):new _t(e,n,r)}static lt(e,n,r){return n==="in"?new M$(e,r):new N$(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.ft(ei(n,this.value)):n!==null&&ts(this.value)===ts(n)&&this.ft(ei(n,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ae()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class A$ extends _t{constructor(e,n,r){super(e,n,r),this.key=ee.fromName(r.referenceValue)}matches(e){const n=ee.comparator(e.key,this.key);return this.ft(n)}}class M$ extends _t{constructor(e,n){super(e,"in",n),this.keys=US("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class N$ extends _t{constructor(e,n){super(e,"not-in",n),this.keys=US("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function US(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>ee.fromName(r.referenceValue))}class O$ extends _t{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Fa(n)&&Ba(n.arrayValue,this.value)}}class D$ extends _t{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Ba(this.value.arrayValue,n)}}class _$ extends _t{constructor(e,n){super(e,"not-in",n)}matches(e){if(Ba(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Ba(this.value.arrayValue,n)}}class R$ extends _t{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Fa(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Ba(this.value.arrayValue,r))}}class ao{constructor(e,n){this.position=e,this.inclusive=n}}class ra{constructor(e,n="asc"){this.field=e,this.dir=n}}function L$(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Zb(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=ee.comparator(ee.fromName(o.referenceValue),n.key):r=ei(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function ew(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ar(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this._t=null,this.wt=null,this.startAt,this.endAt}}function P$(t,e,n,r,i,s,o,a){return new Ku(t,e,n,r,i,s,o,a)}function qu(t){return new Ku(t)}function tw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function B$(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function F$(t){for(const e of t.filters)if(e.dt())return e.field;return null}function V$(t){return t.collectionGroup!==null}function Va(t){const e=we(t);if(e._t===null){e._t=[];const n=F$(e),r=B$(e);if(n!==null&&r===null)n.isKeyField()||e._t.push(new ra(n)),e._t.push(new ra(et.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e._t.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new ra(et.keyField(),s))}}}return e._t}function zn(t){const e=we(t);if(!e.wt)if(e.limitType==="F")e.wt=Xb(e.path,e.collectionGroup,Va(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const s of Va(e)){const o=s.dir==="desc"?"asc":"desc";n.push(new ra(s.field,o))}const r=e.endAt?new ao(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new ao(e.startAt.position,e.startAt.inclusive):null;e.wt=Xb(e.path,e.collectionGroup,n,e.filters,e.limit,r,i)}return e.wt}function xf(t,e,n){return new Ku(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Wu(t,e){return sl(zn(t),zn(e))&&t.limitType===e.limitType}function HS(t){return`${ns(zn(t))}|lt:${t.limitType}`}function Sf(t){return`Query(target=${I$(zn(t))}; limitType=${t.limitType})`}function mg(t,e){return e.isFoundDocument()&&function(n,r){const i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):ee.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(t,e)&&function(n,r){for(const i of n.explicitOrderBy)if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(t,e)&&function(n,r){for(const i of n.filters)if(!i.matches(r))return!1;return!0}(t,e)&&function(n,r){return!(n.startAt&&!function(i,s,o){const a=Zb(i,s,o);return i.inclusive?a<=0:a<0}(n.startAt,Va(n),r)||n.endAt&&!function(i,s,o){const a=Zb(i,s,o);return i.inclusive?a>=0:a>0}(n.endAt,Va(n),r))}(t,e)}function $$(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function jS(t){return(e,n)=>{let r=!1;for(const i of Va(t)){const s=z$(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function z$(t,e,n){const r=t.field.isKeyField()?ee.comparator(e.key,n.key):function(i,s,o){const a=s.data.field(i),l=o.data.field(i);return a!==null&&l!==null?ei(a,l):ae()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ae()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(t,e){if(t.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pa(e)?"-0":e}}function qS(t){return{integerValue:""+t}}function U$(t,e){return S$(e)?qS(e):KS(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(){this._=void 0}}function H$(t,e,n){return t instanceof $a?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(s.fields.__previous_value__=i),{mapValue:s}}(n,e):t instanceof lo?GS(t,e):t instanceof co?JS(t,e):function(r,i){const s=WS(r,i),o=nw(s)+nw(r.yt);return Ef(s)&&Ef(r.yt)?qS(o):KS(r.It,o)}(t,e)}function j$(t,e,n){return t instanceof lo?GS(t,e):t instanceof co?JS(t,e):n}function WS(t,e){return t instanceof za?Ef(n=e)||function(r){return!!r&&"doubleValue"in r}(n)?e:{integerValue:0}:null;var n}class $a extends Gu{}class lo extends Gu{constructor(e){super(),this.elements=e}}function GS(t,e){const n=XS(e);for(const r of t.elements)n.some(i=>ar(i,r))||n.push(r);return{arrayValue:{values:n}}}class co extends Gu{constructor(e){super(),this.elements=e}}function JS(t,e){let n=XS(e);for(const r of t.elements)n=n.filter(i=>!ar(i,r));return{arrayValue:{values:n}}}class za extends Gu{constructor(e,n){super(),this.It=e,this.yt=n}}function nw(t){return Ge(t.integerValue||t.doubleValue)}function XS(t){return Fa(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K${constructor(e,n){this.field=e,this.transform=n}}function q$(t,e){return t.field.isEqual(e.field)&&function(n,r){return n instanceof lo&&r instanceof lo||n instanceof co&&r instanceof co?oo(n.elements,r.elements,ar):n instanceof za&&r instanceof za?ar(n.yt,r.yt):n instanceof $a&&r instanceof $a}(t.transform,e.transform)}class W${constructor(e,n){this.version=e,this.transformResults=n}}class Ht{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Ht}static exists(e){return new Ht(void 0,e)}static updateTime(e){return new Ht(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zl(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ju{}function YS(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Xu(t.key,Ht.none()):new To(t.key,t.data,Ht.none());{const n=t.data,r=Nt.empty();let i=new $e(et.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new vr(t.key,r,new cn(i.toArray()),Ht.none())}}function G$(t,e,n){t instanceof To?function(r,i,s){const o=r.value.clone(),a=iw(r.fieldTransforms,i,s.transformResults);o.setAll(a),i.convertToFoundDocument(s.version,o).setHasCommittedMutations()}(t,e,n):t instanceof vr?function(r,i,s){if(!Zl(r.precondition,i))return void i.convertToUnknownDocument(s.version);const o=iw(r.fieldTransforms,i,s.transformResults),a=i.data;a.setAll(QS(r)),a.setAll(o),i.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(t,e,n):function(r,i,s){i.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,n)}function ia(t,e,n,r){return t instanceof To?function(i,s,o,a){if(!Zl(i.precondition,s))return o;const l=i.value.clone(),c=sw(i.fieldTransforms,a,s);return l.setAll(c),s.convertToFoundDocument(s.version,l).setHasLocalMutations(),null}(t,e,n,r):t instanceof vr?function(i,s,o,a){if(!Zl(i.precondition,s))return o;const l=sw(i.fieldTransforms,a,s),c=s.data;return c.setAll(QS(i)),c.setAll(l),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),o===null?null:o.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(u=>u.field))}(t,e,n,r):function(i,s,o){return Zl(i.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):o}(t,e,n)}function J$(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=WS(r.transform,i||null);s!=null&&(n===null&&(n=Nt.empty()),n.set(r.field,s))}return n||null}function rw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&oo(n,r,(i,s)=>q$(i,s))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class To extends Ju{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class vr extends Ju{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function QS(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function iw(t,e,n){const r=new Map;be(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,j$(o,a,n[i]))}return r}function sw(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,H$(s,o,e))}return r}class Xu extends Ju{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ZS extends Ju{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X${constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qe,Me;function Y$(t){switch(t){default:return ae();case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0}}function e1(t){if(t===void 0)return $t("GRPC error has no .code"),z.UNKNOWN;switch(t){case Qe.OK:return z.OK;case Qe.CANCELLED:return z.CANCELLED;case Qe.UNKNOWN:return z.UNKNOWN;case Qe.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case Qe.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case Qe.INTERNAL:return z.INTERNAL;case Qe.UNAVAILABLE:return z.UNAVAILABLE;case Qe.UNAUTHENTICATED:return z.UNAUTHENTICATED;case Qe.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case Qe.NOT_FOUND:return z.NOT_FOUND;case Qe.ALREADY_EXISTS:return z.ALREADY_EXISTS;case Qe.PERMISSION_DENIED:return z.PERMISSION_DENIED;case Qe.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case Qe.ABORTED:return z.ABORTED;case Qe.OUT_OF_RANGE:return z.OUT_OF_RANGE;case Qe.UNIMPLEMENTED:return z.UNIMPLEMENTED;case Qe.DATA_LOSS:return z.DATA_LOSS;default:return ae()}}(Me=Qe||(Qe={}))[Me.OK=0]="OK",Me[Me.CANCELLED=1]="CANCELLED",Me[Me.UNKNOWN=2]="UNKNOWN",Me[Me.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Me[Me.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Me[Me.NOT_FOUND=5]="NOT_FOUND",Me[Me.ALREADY_EXISTS=6]="ALREADY_EXISTS",Me[Me.PERMISSION_DENIED=7]="PERMISSION_DENIED",Me[Me.UNAUTHENTICATED=16]="UNAUTHENTICATED",Me[Me.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Me[Me.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Me[Me.ABORTED=10]="ABORTED",Me[Me.OUT_OF_RANGE=11]="OUT_OF_RANGE",Me[Me.UNIMPLEMENTED=12]="UNIMPLEMENTED",Me[Me.INTERNAL=13]="INTERNAL",Me[Me.UNAVAILABLE=14]="UNAVAILABLE",Me[Me.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){hs(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return BS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q$=new nt(ee.comparator);function ln(){return Q$}const t1=new nt(ee.comparator);function zo(...t){let e=t1;for(const n of t)e=e.insert(n.key,n);return e}function n1(t){let e=t1;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function er(){return sa()}function r1(){return sa()}function sa(){return new li(t=>t.toString(),(t,e)=>t.isEqual(e))}const Z$=new nt(ee.comparator),ez=new $e(ee.comparator);function Ie(...t){let e=ez;for(const n of t)e=e.add(n);return e}const tz=new $e(Te);function i1(){return tz}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n){const r=new Map;return r.set(e,ol.createSynthesizedTargetChangeForCurrentChange(e,n)),new Yu(ge.min(),r,i1(),ln(),Ie())}}class ol{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n){return new ol(ft.EMPTY_BYTE_STRING,n,Ie(),Ie(),Ie())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e,n,r,i){this.Tt=e,this.removedTargetIds=n,this.key=r,this.Et=i}}class s1{constructor(e,n){this.targetId=e,this.At=n}}class o1{constructor(e,n,r=ft.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class ow{constructor(){this.Rt=0,this.bt=lw(),this.Pt=ft.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return this.Rt!==0}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=Ie(),n=Ie(),r=Ie();return this.bt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:ae()}}),new ol(this.Pt,this.vt,e,n,r)}Nt(){this.Vt=!1,this.bt=lw()}kt(e,n){this.Vt=!0,this.bt=this.bt.insert(e,n)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class nz{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=ln(),this.qt=aw(),this.Kt=new $e(Te)}Gt(e){for(const n of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(n,e.Et):this.jt(n,e.key,e.Et);for(const n of e.removedTargetIds)this.jt(n,e.key,e.Et)}Wt(e){this.forEachTarget(e,n=>{const r=this.zt(n);switch(e.state){case 0:this.Ht(n)&&r.Ct(e.resumeToken);break;case 1:r.Ft(),r.St||r.Nt(),r.Ct(e.resumeToken);break;case 2:r.Ft(),r.St||this.removeTarget(n);break;case 3:this.Ht(n)&&(r.$t(),r.Ct(e.resumeToken));break;case 4:this.Ht(n)&&(this.Jt(n),r.Ct(e.resumeToken));break;default:ae()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Lt.forEach((r,i)=>{this.Ht(i)&&n(i)})}Yt(e){const n=e.targetId,r=e.At.count,i=this.Xt(n);if(i){const s=i.target;if(Hc(s))if(r===0){const o=new ee(s.path);this.jt(n,o,qe.newNoDocument(o,ge.min()))}else be(r===1);else this.Zt(n)!==r&&(this.Jt(n),this.Kt=this.Kt.add(n))}}te(e){const n=new Map;this.Lt.forEach((s,o)=>{const a=this.Xt(o);if(a){if(s.current&&Hc(a.target)){const l=new ee(a.target.path);this.Ut.get(l)!==null||this.ee(o,l)||this.jt(o,l,qe.newNoDocument(l,e))}s.Dt&&(n.set(o,s.xt()),s.Nt())}});let r=Ie();this.qt.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Xt(l);return!c||c.purpose===2||(a=!1,!1)}),a&&(r=r.add(s))}),this.Ut.forEach((s,o)=>o.setReadTime(e));const i=new Yu(e,n,this.Kt,this.Ut,r);return this.Ut=ln(),this.qt=aw(),this.Kt=new $e(Te),i}Qt(e,n){if(!this.Ht(e))return;const r=this.ee(e,n.key)?2:0;this.zt(e).kt(n.key,r),this.Ut=this.Ut.insert(n.key,n),this.qt=this.qt.insert(n.key,this.ne(n.key).add(e))}jt(e,n,r){if(!this.Ht(e))return;const i=this.zt(e);this.ee(e,n)?i.kt(n,1):i.Ot(n),this.qt=this.qt.insert(n,this.ne(n).delete(e)),r&&(this.Ut=this.Ut.insert(n,r))}removeTarget(e){this.Lt.delete(e)}Zt(e){const n=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let n=this.Lt.get(e);return n||(n=new ow,this.Lt.set(e,n)),n}ne(e){let n=this.qt.get(e);return n||(n=new $e(Te),this.qt=this.qt.insert(e,n)),n}Ht(e){const n=this.Xt(e)!==null;return n||j("WatchChangeAggregator","Detected inactive target",e),n}Xt(e){const n=this.Lt.get(e);return n&&n.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new ow),this.Bt.getRemoteKeysForTarget(e).forEach(n=>{this.jt(e,n,null)})}ee(e,n){return this.Bt.getRemoteKeysForTarget(e).has(n)}}function aw(){return new nt(ee.comparator)}function lw(){return new nt(ee.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rz=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),iz=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class sz{constructor(e,n){this.databaseId=e,this.gt=n}}function Ua(t,e){return t.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function a1(t,e){return t.gt?e.toBase64():e.toUint8Array()}function oz(t,e){return Ua(t,e.toTimestamp())}function un(t){return be(!!t),ge.fromTimestamp(function(e){const n=Zr(e);return new We(n.seconds,n.nanos)}(t))}function yg(t,e){return function(n){return new Ve(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function l1(t){const e=Ve.fromString(t);return be(g1(e)),e}function Kc(t,e){return yg(t.databaseId,e.path)}function ji(t,e){const n=l1(e);if(n.get(1)!==t.databaseId.projectId)throw new se(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new se(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ee(u1(n))}function Tf(t,e){return yg(t.databaseId,e)}function c1(t){const e=l1(t);return e.length===4?Ve.emptyPath():u1(e)}function Cf(t){return new Ve(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function u1(t){return be(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function cw(t,e,n){return{name:Kc(t,e),fields:n.value.mapValue.fields}}function az(t,e,n){const r=ji(t,e.name),i=un(e.updateTime),s=new Nt({mapValue:{fields:e.fields}}),o=qe.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function lz(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:ae()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,c){return l.gt?(be(c===void 0||typeof c=="string"),ft.fromBase64String(c||"")):(be(c===void 0||c instanceof Uint8Array),ft.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=l.code===void 0?z.UNKNOWN:e1(l.code);return new se(c,l.message||"")}(o);n=new o1(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=ji(t,r.document.name),s=un(r.document.updateTime),o=new Nt({mapValue:{fields:r.document.fields}}),a=qe.newFoundDocument(i,s,o),l=r.targetIds||[],c=r.removedTargetIds||[];n=new ec(l,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=ji(t,r.document),s=r.readTime?un(r.readTime):ge.min(),o=qe.newNoDocument(i,s),a=r.removedTargetIds||[];n=new ec([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=ji(t,r.document),s=r.removedTargetIds||[];n=new ec([],s,i,null)}else{if(!("filter"in e))return ae();{e.filter;const r=e.filter;r.targetId;const i=r.count||0,s=new X$(i),o=r.targetId;n=new s1(o,s)}}return n}function qc(t,e){let n;if(e instanceof To)n={update:cw(t,e.key,e.value)};else if(e instanceof Xu)n={delete:Kc(t,e.key)};else if(e instanceof vr)n={update:cw(t,e.key,e.data),updateMask:gz(e.fieldMask)};else{if(!(e instanceof ZS))return ae();n={verify:Kc(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const o=s.transform;if(o instanceof $a)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof lo)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof co)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof za)return{fieldPath:s.field.canonicalString(),increment:o.yt};throw ae()}(0,r))),e.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:oz(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ae()}(t,e.precondition)),n}function kf(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?Ht.updateTime(un(i.updateTime)):i.exists!==void 0?Ht.exists(i.exists):Ht.none()}(e.currentDocument):Ht.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,o){let a=null;if("setToServerValue"in o)be(o.setToServerValue==="REQUEST_TIME"),a=new $a;else if("appendMissingElements"in o){const c=o.appendMissingElements.values||[];a=new lo(c)}else if("removeAllFromArray"in o){const c=o.removeAllFromArray.values||[];a=new co(c)}else"increment"in o?a=new za(s,o.increment):ae();const l=et.fromServerFormat(o.fieldPath);return new K$(l,a)}(t,i)):[];if(e.update){e.update.name;const i=ji(t,e.update.name),s=new Nt({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(a){const l=a.fieldPaths||[];return new cn(l.map(c=>et.fromServerFormat(c)))}(e.updateMask);return new vr(i,s,o,n,r)}return new To(i,s,n,r)}if(e.delete){const i=ji(t,e.delete);return new Xu(i,n)}if(e.verify){const i=ji(t,e.verify);return new ZS(i,n)}return ae()}function cz(t,e){return t&&t.length>0?(be(e!==void 0),t.map(n=>function(r,i){let s=r.updateTime?un(r.updateTime):un(i);return s.isEqual(ge.min())&&(s=un(i)),new W$(s,r.transformResults||[])}(n,e))):[]}function h1(t,e){return{documents:[Tf(t,e.path)]}}function d1(t,e){const n={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(n.parent=Tf(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Tf(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(l){if(l.length===0)return;const c=l.map(u=>function(h){if(h.op==="=="){if(Wb(h.value))return{unaryFilter:{field:vs(h.field),op:"IS_NAN"}};if(qb(h.value))return{unaryFilter:{field:vs(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(Wb(h.value))return{unaryFilter:{field:vs(h.field),op:"IS_NOT_NAN"}};if(qb(h.value))return{unaryFilter:{field:vs(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vs(h.field),op:dz(h.op),value:h.value}}}(u));return c.length===1?c[0]:{compositeFilter:{op:"AND",filters:c}}}(e.filters);i&&(n.structuredQuery.where=i);const s=function(l){if(l.length!==0)return l.map(c=>function(u){return{field:vs(u.field),direction:hz(u.dir)}}(c))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(l,c){return l.gt||ju(c)?c:{value:c}}(t,e.limit);var a;return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),n}function f1(t){let e=c1(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){be(r===1);const u=n.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];n.where&&(s=p1(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(u=>function(h){return new ra(Ds(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(u)));let a=null;n.limit&&(a=function(u){let h;return h=typeof u=="object"?u.value:u,ju(h)?null:h}(n.limit));let l=null;n.startAt&&(l=function(u){const h=!!u.before,d=u.values||[];return new ao(d,h)}(n.startAt));let c=null;return n.endAt&&(c=function(u){const h=!u.before,d=u.values||[];return new ao(d,h)}(n.endAt)),P$(e,i,o,s,a,"F",l,c)}function uz(t,e){const n=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ae()}}(0,e.purpose);return n==null?null:{"goog-listen-tags":n}}function p1(t){return t?t.unaryFilter!==void 0?[pz(t)]:t.fieldFilter!==void 0?[fz(t)]:t.compositeFilter!==void 0?t.compositeFilter.filters.map(e=>p1(e)).reduce((e,n)=>e.concat(n)):ae():[]}function hz(t){return rz[t]}function dz(t){return iz[t]}function vs(t){return{fieldPath:t.canonicalString()}}function Ds(t){return et.fromServerFormat(t.fieldPath)}function fz(t){return _t.create(Ds(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ae()}}(t.fieldFilter.op),t.fieldFilter.value)}function pz(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ds(t.unaryFilter.field);return _t.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ds(t.unaryFilter.field);return _t.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ds(t.unaryFilter.field);return _t.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ds(t.unaryFilter.field);return _t.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ae()}}function gz(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function g1(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=uw(e)),e=mz(t.get(n),e);return uw(e)}function mz(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function uw(t){return t+""}function tr(t){const e=t.length;if(be(e>=2),e===2)return be(t.charAt(0)===""&&t.charAt(1)===""),Ve.emptyPath();const n=e-2,r=[];let i="";for(let s=0;s<e;){const o=t.indexOf("",s);switch((o<0||o>n)&&ae(),t.charAt(o+1)){case"":const a=t.substring(s,o);let l;i.length===0?l=a:(i+=a,l=i,i=""),r.push(l);break;case"":i+=t.substring(s,o),i+="\0";break;case"":i+=t.substring(s,o+1);break;default:ae()}s=o+2}return new Ve(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hw=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(t,e){return[t,jt(e)]}function m1(t,e,n){return[t,jt(e),n]}const yz={},bz=["prefixPath","collectionGroup","readTime","documentId"],wz=["prefixPath","collectionGroup","documentId"],vz=["collectionGroup","readTime","prefixPath","documentId"],Ez=["canonicalId","targetId"],xz=["targetId","path"],Sz=["path","targetId"],Tz=["collectionId","parent"],Cz=["indexId","uid"],kz=["uid","sequenceNumber"],Iz=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Az=["indexId","uid","orderedDocumentKey"],Mz=["userId","collectionPath","documentId"],Nz=["userId","collectionPath","largestBatchId"],Oz=["userId","collectionGroup","largestBatchId"],y1=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Dz=[...y1,"documentOverlays"],b1=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],w1=b1,_z=[...w1,"indexConfiguration","indexState","indexEntries"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If extends PS{constructor(e,n){super(),this.ie=e,this.currentSequenceNumber=n}}function pt(t,e){const n=we(t);return pr.M(n.ie,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&G$(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=ia(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=ia(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=r1();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const l=YS(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(ge.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ie())}isEqual(e){return this.batchId===e.batchId&&oo(this.mutations,e.mutations,(n,r)=>rw(n,r))&&oo(this.baseMutations,e.baseMutations,(n,r)=>rw(n,r))}}class wg{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){be(e.mutations.length===r.length);let i=Z$;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new wg(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,n,r,i,s=ge.min(),o=ge.min(),a=ft.EMPTY_BYTE_STRING){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new Kr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,n){return new Kr(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Kr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e){this.re=e}}function Rz(t,e){let n;if(e.document)n=az(t.re,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ee.fromSegments(e.noDocument.path),i=is(e.noDocument.readTime);n=qe.newNoDocument(r,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return ae();{const r=ee.fromSegments(e.unknownDocument.path),i=is(e.unknownDocument.version);n=qe.newUnknownDocument(r,i)}}return e.readTime&&n.setReadTime(function(r){const i=new We(r[0],r[1]);return ge.fromTimestamp(i)}(e.readTime)),n}function dw(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Wc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,s){return{name:Kc(i,s.key),fields:s.data.value.mapValue.fields,updateTime:Ua(i,s.version.toTimestamp())}}(t.re,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:rs(e.version)};else{if(!e.isUnknownDocument())return ae();r.unknownDocument={path:n.path.toArray(),version:rs(e.version)}}return r}function Wc(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function rs(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function is(t){const e=new We(t.seconds,t.nanoseconds);return ge.fromTimestamp(e)}function ki(t,e){const n=(e.baseMutations||[]).map(s=>kf(t.re,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>kf(t.re,s)),i=We.fromMillis(e.localWriteTimeMs);return new bg(e.batchId,i,n,r)}function Uo(t){const e=is(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?is(t.lastLimboFreeSnapshotVersion):ge.min();let r;var i;return t.query.documents!==void 0?(be((i=t.query).documents.length===1),r=zn(qu(c1(i.documents[0])))):r=function(s){return zn(f1(s))}(t.query),new Kr(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ft.fromBase64String(t.resumeToken))}function E1(t,e){const n=rs(e.snapshotVersion),r=rs(e.lastLimboFreeSnapshotVersion);let i;i=Hc(e.target)?h1(t.re,e.target):d1(t.re,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ns(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function x1(t){const e=f1({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?xf(e,e.limit,"L"):e}function sd(t,e){return new vg(e.largestBatchId,kf(t.re,e.overlayMutation))}function fw(t,e){const n=e.path.lastSegment();return[t,jt(e.path.popLast()),n]}function pw(t,e,n,r){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:rs(r.readTime),documentKey:jt(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lz{getBundleMetadata(e,n){return gw(e).get(n).next(r=>{if(r)return{id:(i=r).bundleId,createTime:is(i.createTime),version:i.version};var i})}saveBundleMetadata(e,n){return gw(e).put({bundleId:(r=n).id,createTime:rs(un(r.createTime)),version:r.version});var r}getNamedQuery(e,n){return mw(e).get(n).next(r=>{if(r)return{name:(i=r).name,query:x1(i.bundledQuery),readTime:is(i.readTime)};var i})}saveNamedQuery(e,n){return mw(e).put(function(r){return{name:r.name,readTime:rs(un(r.readTime)),bundledQuery:r.bundledQuery}}(n))}}function gw(t){return pt(t,"bundles")}function mw(t){return pt(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(e,n){this.It=e,this.userId=n}static oe(e,n){const r=n.uid||"";return new Qu(e,r)}getOverlay(e,n){return Mo(e).get(fw(this.userId,n)).next(r=>r?sd(this.It,r):null)}getOverlays(e,n){const r=er();return k.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){const i=[];return r.forEach((s,o)=>{const a=new vg(n,o);i.push(this.ue(e,a))}),k.waitFor(i)}removeOverlaysForBatchId(e,n,r){const i=new Set;n.forEach(o=>i.add(jt(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Mo(e).Y("collectionPathOverlayIndex",a))}),k.waitFor(s)}getOverlaysForCollection(e,n,r){const i=er(),s=jt(n),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Mo(e).W("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=sd(this.It,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,n,r,i){const s=er();let o;const a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Mo(e).Z({index:"collectionGroupOverlayIndex",range:a},(l,c,u)=>{const h=sd(this.It,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}ue(e,n){return Mo(e).put(function(r,i,s){const[o,a,l]=fw(i,s.mutation.key);return{userId:i,collectionPath:a,documentId:l,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:qc(r.re,s.mutation)}}(this.It,this.userId,n))}}function Mo(t){return pt(t,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(){}ce(e,n){this.ae(e,n),n.he()}ae(e,n){if("nullValue"in e)this.le(n,5);else if("booleanValue"in e)this.le(n,10),n.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(n,15),n.fe(Ge(e.integerValue));else if("doubleValue"in e){const r=Ge(e.doubleValue);isNaN(r)?this.le(n,13):(this.le(n,15),Pa(r)?n.fe(0):n.fe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.le(n,20),typeof r=="string"?n.de(r):(n.de(`${r.seconds||""}`),n.fe(r.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,n),this.we(n);else if("bytesValue"in e)this.le(n,30),n.me(Zi(e.bytesValue)),this.we(n);else if("referenceValue"in e)this.ge(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.le(n,45),n.fe(r.latitude||0),n.fe(r.longitude||0)}else"mapValue"in e?$S(e)?this.le(n,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,n),this.we(n)):"arrayValue"in e?(this.pe(e.arrayValue,n),this.we(n)):ae()}_e(e,n){this.le(n,25),this.Ie(e,n)}Ie(e,n){n.de(e)}ye(e,n){const r=e.fields||{};this.le(n,55);for(const i of Object.keys(r))this._e(i,n),this.ae(r[i],n)}pe(e,n){const r=e.values||[];this.le(n,50);for(const i of r)this.ae(i,n)}ge(e,n){this.le(n,37),ee.fromName(e).path.forEach(r=>{this.le(n,60),this.Ie(r,n)})}le(e,n){e.fe(n)}we(e){e.fe(2)}}Ii.Te=new Ii;function Pz(t){if(t===0)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function yw(t){const e=64-function(n){let r=0;for(let i=0;i<8;++i){const s=Pz(255&n[i]);if(r+=s,s!==8)break}return r}(t);return Math.ceil(e/8)}class Bz{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ae(r.value),r=n.next();this.Re()}be(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Pe(r.value),r=n.next();this.ve()}Ve(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ae(r);else if(r<2048)this.Ae(960|r>>>6),this.Ae(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ae(480|r>>>12),this.Ae(128|63&r>>>6),this.Ae(128|63&r);else{const i=n.codePointAt(0);this.Ae(240|i>>>18),this.Ae(128|63&i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i)}}this.Re()}Se(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Pe(r);else if(r<2048)this.Pe(960|r>>>6),this.Pe(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Pe(480|r>>>12),this.Pe(128|63&r>>>6),this.Pe(128|63&r);else{const i=n.codePointAt(0);this.Pe(240|i>>>18),this.Pe(128|63&i>>>12),this.Pe(128|63&i>>>6),this.Pe(128|63&i)}}this.ve()}De(e){const n=this.Ce(e),r=yw(n);this.xe(1+r),this.buffer[this.position++]=255&r;for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=255&n[i]}Ne(e){const n=this.Ce(e),r=yw(n);this.xe(1+r),this.buffer[this.position++]=~(255&r);for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=~(255&n[i])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const n=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let i=1;i<n.length;++i)n[i]^=r?255:0;return n}Ae(e){const n=255&e;n===0?(this.Oe(0),this.Oe(255)):n===255?(this.Oe(255),this.Oe(0)):this.Oe(n)}Pe(e){const n=255&e;n===0?(this.Fe(0),this.Fe(255)):n===255?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Fz{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class Vz{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Me()}}class No{constructor(){this.Be=new Bz,this.Le=new Fz(this.Be),this.Ue=new Vz(this.Be)}seed(e){this.Be.seed(e)}qe(e){return e===0?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e,n,r,i){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}Ke(){const e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ai(this.indexId,this.documentKey,this.arrayValue,r)}}function pi(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=bw(t.arrayValue,e.arrayValue),n!==0?n:(n=bw(t.directionalValue,e.directionalValue),n!==0?n:ee.comparator(t.documentKey,e.documentKey)))}function bw(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $z{constructor(e){this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const n of e.filters){const r=n;r.dt()?this.je=r:this.Qe.push(r)}}We(e){const n=wf(e);if(n!==void 0&&!this.ze(n))return!1;const r=wi(e);let i=0,s=0;for(;i<r.length&&this.ze(r[i]);++i);if(i===r.length)return!0;if(this.je!==void 0){const o=r[i];if(!this.He(this.je,o)||!this.Je(this.Ge[s++],o))return!1;++i}for(;i<r.length;++i){const o=r[i];if(s>=this.Ge.length||!this.Je(this.Ge[s++],o))return!1}return!0}ze(e){for(const n of this.Qe)if(this.He(n,e))return!0;return!1}He(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}Je(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zz{constructor(){this.Ye=new Eg}addToCollectionParentIndex(e,n){return this.Ye.add(n),k.resolve()}getCollectionParents(e,n){return k.resolve(this.Ye.getEntries(n))}addFieldIndex(e,n){return k.resolve()}deleteFieldIndex(e,n){return k.resolve()}getDocumentsMatchingTarget(e,n){return k.resolve(null)}getIndexType(e,n){return k.resolve(0)}getFieldIndexes(e,n){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,n){return k.resolve(pn.min())}getMinOffsetFromCollectionGroup(e,n){return k.resolve(pn.min())}updateCollectionGroup(e,n,r){return k.resolve()}updateIndexEntries(e,n){return k.resolve()}}class Eg{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new $e(Ve.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new $e(Ve.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl=new Uint8Array(0);class Uz{constructor(e,n){this.user=e,this.databaseId=n,this.Xe=new Eg,this.Ze=new li(r=>ns(r),(r,i)=>sl(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.Xe.has(n)){const r=n.lastSegment(),i=n.popLast();e.addOnCommittedListener(()=>{this.Xe.add(n)});const s={collectionId:r,parent:jt(i)};return ww(e).put(s)}return k.resolve()}getCollectionParents(e,n){const r=[],i=IDBKeyRange.bound([n,""],[DS(n),""],!1,!0);return ww(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==n)break;r.push(tr(o.parent))}return r})}addFieldIndex(e,n){const r=Bl(e),i=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(n);delete i.indexId;const s=r.add(i);if(n.indexState){const o=Do(e);return s.next(a=>{o.put(pw(a,this.user,n.indexState.sequenceNumber,n.indexState.offset))})}return s.next()}deleteFieldIndex(e,n){const r=Bl(e),i=Do(e),s=Oo(e);return r.delete(n.indexId).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,n){const r=Oo(e);let i=!0;const s=new Map;return k.forEach(this.tn(n),o=>this.en(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Ie();const a=[];return k.forEach(s,(l,c)=>{var u;j("IndexedDbIndexManager",`Using index ${u=l,`id=${u.indexId}|cg=${u.collectionGroup}|f=${u.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`} to execute ${ns(n)}`);const h=function(P,y){const F=wf(y);if(F===void 0)return null;for(const R of jc(P,F.fieldPath))switch(R.op){case"array-contains-any":return R.value.arrayValue.values||[];case"array-contains":return[R.value]}return null}(c,l),d=function(P,y){const F=new Map;for(const R of wi(y))for(const K of jc(P,R.fieldPath))switch(K.op){case"==":case"in":F.set(R.fieldPath.canonicalString(),K.value);break;case"not-in":case"!=":return F.set(R.fieldPath.canonicalString(),K.value),Array.from(F.values())}return null}(c,l),f=function(P,y){const F=[];let R=!0;for(const K of wi(y)){const _=K.kind===0?Yb(P,K.fieldPath,P.startAt):Qb(P,K.fieldPath,P.startAt);F.push(_.value),R&&(R=_.inclusive)}return new ao(F,R)}(c,l),p=function(P,y){const F=[];let R=!0;for(const K of wi(y)){const _=K.kind===0?Qb(P,K.fieldPath,P.endAt):Yb(P,K.fieldPath,P.endAt);F.push(_.value),R&&(R=_.inclusive)}return new ao(F,R)}(c,l),g=this.nn(l,c,f),m=this.nn(l,c,p),w=this.sn(l,c,d),D=this.rn(l.indexId,h,g,f.inclusive,m,p.inclusive,w);return k.forEach(D,P=>r.J(P,n.limit).next(y=>{y.forEach(F=>{const R=ee.fromSegments(F.documentKey);o.has(R)||(o=o.add(R),a.push(R))})}))}).next(()=>a)}return k.resolve(null)})}tn(e){let n=this.Ze.get(e);return n||(n=[e],this.Ze.set(e,n),n)}rn(e,n,r,i,s,o,a){const l=(n!=null?n.length:1)*Math.max(r.length,s.length),c=l/(n!=null?n.length:1),u=[];for(let h=0;h<l;++h){const d=n?this.on(n[h/c]):Pl,f=this.un(e,d,r[h%c],i),p=this.cn(e,d,s[h%c],o),g=a.map(m=>this.un(e,d,m,!0));u.push(...this.createRange(f,p,g))}return u}un(e,n,r,i){const s=new Ai(e,ee.empty(),n,r);return i?s:s.Ke()}cn(e,n,r,i){const s=new Ai(e,ee.empty(),n,r);return i?s.Ke():s}en(e,n){const r=new $z(n),i=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.We(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2;return k.forEach(this.tn(n),i=>this.en(e,i).next(s=>{s?r!==0&&s.fields.length<function(o){let a=new $e(et.comparator),l=!1;for(const c of o.filters){const u=c;u.field.isKeyField()||(u.op==="array-contains"||u.op==="array-contains-any"?l=!0:a=a.add(u.field))}for(const c of o.orderBy)c.field.isKeyField()||(a=a.add(c.field));return a.size+(l?1:0)}(i)&&(r=1):r=0})).next(()=>r)}an(e,n){const r=new No;for(const i of wi(e)){const s=n.data.field(i.fieldPath);if(s==null)return null;const o=r.qe(i.kind);Ii.Te.ce(s,o)}return r.$e()}on(e){const n=new No;return Ii.Te.ce(e,n.qe(0)),n.$e()}hn(e,n){const r=new No;return Ii.Te.ce(gg(this.databaseId,n),r.qe(function(i){const s=wi(i);return s.length===0?0:s[s.length-1].kind}(e))),r.$e()}sn(e,n,r){if(r===null)return[];let i=[];i.push(new No);let s=0;for(const o of wi(e)){const a=r[s++];for(const l of i)if(this.ln(n,o.fieldPath)&&Fa(a))i=this.fn(i,o,a);else{const c=l.qe(o.kind);Ii.Te.ce(a,c)}}return this.dn(i)}nn(e,n,r){return this.sn(e,n,r.position)}dn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].$e();return n}fn(e,n,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const l=new No;l.seed(a.$e()),Ii.Te.ce(o,l.qe(n.kind)),s.push(l)}return s}ln(e,n){return!!e.filters.find(r=>r instanceof _t&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Bl(e),i=Do(e);return(n?r.W("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.W()).next(s=>{const o=[];return k.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(function(c,u){const h=u?new Uc(u.sequenceNumber,new pn(is(u.readTime),new ee(tr(u.documentKey)),u.largestBatchId)):Uc.empty(),d=c.fields.map(([f,p])=>new g$(et.fromServerFormat(f),p));return new _S(c.indexId,c.collectionGroup,d,h)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Te(r.collectionGroup,i.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=Bl(e),s=Do(e);return this._n(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(a=>k.forEach(a,l=>s.put(pw(l.indexId,this.user,o,r)))))}updateIndexEntries(e,n){const r=new Map;return k.forEach(n,(i,s)=>{const o=r.get(i.collectionGroup);return(o?k.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),k.forEach(a,l=>this.wn(e,i,l).next(c=>{const u=this.mn(s,l);return c.isEqual(u)?k.resolve():this.gn(e,s,l,c,u)}))))})}yn(e,n,r,i){return Oo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.hn(r,n.key),documentKey:n.key.path.toArray()})}pn(e,n,r,i){return Oo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.hn(r,n.key),n.key.path.toArray()])}wn(e,n,r){const i=Oo(e);let s=new $e(pi);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.hn(r,n)])},(o,a)=>{s=s.add(new Ai(r.indexId,n,a.arrayValue,a.directionalValue))}).next(()=>s)}mn(e,n){let r=new $e(pi);const i=this.an(n,e);if(i==null)return r;const s=wf(n);if(s!=null){const o=e.data.field(s.fieldPath);if(Fa(o))for(const a of o.arrayValue.values||[])r=r.add(new Ai(n.indexId,e.key,this.on(a),i))}else r=r.add(new Ai(n.indexId,e.key,Pl,i));return r}gn(e,n,r,i,s){j("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const o=[];return function(a,l,c,u,h){const d=a.getIterator(),f=l.getIterator();let p=ws(d),g=ws(f);for(;p||g;){let m=!1,w=!1;if(p&&g){const D=c(p,g);D<0?w=!0:D>0&&(m=!0)}else p!=null?w=!0:m=!0;m?(u(g),g=ws(f)):w?(h(p),p=ws(d)):(p=ws(d),g=ws(f))}}(i,s,pi,a=>{o.push(this.yn(e,n,r,a))},a=>{o.push(this.pn(e,n,r,a))}),k.waitFor(o)}_n(e){let n=1;return Do(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),n=i.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>pi(o,a)).filter((o,a,l)=>!a||pi(o,l[a-1])!==0);const i=[];i.push(e);for(const o of r){const a=pi(o,e),l=pi(o,n);if(a===0)i[0]=e.Ke();else if(a>0&&l<0)i.push(o),i.push(o.Ke());else if(l>0)break}i.push(n);const s=[];for(let o=0;o<i.length;o+=2)s.push(IDBKeyRange.bound([i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Pl,[]],[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Pl,[]]));return s}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(vw)}getMinOffset(e,n){return k.mapArray(this.tn(n),r=>this.en(e,r).next(i=>i||ae())).next(vw)}}function ww(t){return pt(t,"collectionParents")}function Oo(t){return pt(t,"indexEntries")}function Bl(t){return pt(t,"indexConfiguration")}function Do(t){return pt(t,"indexState")}function vw(t){be(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const i=t[r].indexState.offset;fg(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new pn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Qt{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Qt(e,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(t,e,n){const r=t.store("mutations"),i=t.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const l=r.Z({range:o},(u,h,d)=>(a++,d.delete()));s.push(l.next(()=>{be(a===1)}));const c=[];for(const u of n.mutations){const h=m1(e,u.key.path,n.batchId);s.push(i.delete(h)),c.push(u.key)}return k.waitFor(s).next(()=>c)}function Gc(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ae();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qt.DEFAULT_COLLECTION_PERCENTILE=10,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qt.DEFAULT=new Qt(41943040,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qt.DISABLED=new Qt(-1,0,0);class Zu{constructor(e,n,r,i){this.userId=e,this.It=n,this.indexManager=r,this.referenceDelegate=i,this.In={}}static oe(e,n,r,i){be(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new Zu(s,n,r,i)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Tr(e).Z({index:"userMutationsIndex",range:r},(i,s,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,i){const s=Cs(e),o=Tr(e);return o.add({}).next(a=>{be(typeof a=="number");const l=new bg(a,n,r,i),c=function(d,f,p){const g=p.baseMutations.map(w=>qc(d.re,w)),m=p.mutations.map(w=>qc(d.re,w));return{userId:f,batchId:p.batchId,localWriteTimeMs:p.localWriteTime.toMillis(),baseMutations:g,mutations:m}}(this.It,this.userId,l),u=[];let h=new $e((d,f)=>Te(d.canonicalString(),f.canonicalString()));for(const d of i){const f=m1(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(c)),u.push(s.put(f,yz))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=l.keys()}),k.waitFor(u).next(()=>l)})}lookupMutationBatch(e,n){return Tr(e).get(n).next(r=>r?(be(r.userId===this.userId),ki(this.It,r)):null)}Tn(e,n){return this.In[n]?k.resolve(this.In[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const i=r.keys();return this.In[n]=i,i}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Tr(e).Z({index:"userMutationsIndex",range:i},(o,a,l)=>{a.userId===this.userId&&(be(a.batchId>=r),s=ki(this.It,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Tr(e).Z({index:"userMutationsIndex",range:n,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Tr(e).W("userMutationsIndex",n).next(r=>r.map(i=>ki(this.It,i)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=tc(this.userId,n.path),i=IDBKeyRange.lowerBound(r),s=[];return Cs(e).Z({range:i},(o,a,l)=>{const[c,u,h]=o,d=tr(u);if(c===this.userId&&n.path.isEqual(d))return Tr(e).get(h).next(f=>{if(!f)throw ae();be(f.userId===this.userId),s.push(ki(this.It,f))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new $e(Te);const i=[];return n.forEach(s=>{const o=tc(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Cs(e).Z({range:a},(c,u,h)=>{const[d,f,p]=c,g=tr(f);d===this.userId&&s.path.isEqual(g)?r=r.add(p):h.done()});i.push(l)}),k.waitFor(i).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1,s=tc(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new $e(Te);return Cs(e).Z({range:o},(l,c,u)=>{const[h,d,f]=l,p=tr(d);h===this.userId&&r.isPrefixOf(p)?p.length===i&&(a=a.add(f)):u.done()}).next(()=>this.En(e,a))}En(e,n){const r=[],i=[];return n.forEach(s=>{i.push(Tr(e).get(s).next(o=>{if(o===null)throw ae();be(o.userId===this.userId),r.push(ki(this.It,o))}))}),k.waitFor(i).next(()=>r)}removeMutationBatch(e,n){return S1(e.ie,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.An(n.batchId)}),k.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return k.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Cs(e).Z({range:r},(s,o,a)=>{if(s[0]===this.userId){const l=tr(s[1]);i.push(l)}else a.done()}).next(()=>{be(i.length===0)})})}containsKey(e,n){return T1(e,this.userId,n)}Rn(e){return C1(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function T1(t,e,n){const r=tc(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Cs(t).Z({range:s,X:!0},(a,l,c)=>{const[u,h,d]=a;u===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function Tr(t){return pt(t,"mutations")}function Cs(t){return pt(t,"documentMutations")}function C1(t){return pt(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new ss(0)}static vn(){return new ss(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hz{constructor(e,n){this.referenceDelegate=e,this.It=n}allocateTargetId(e){return this.Vn(e).next(n=>{const r=new ss(n.highestTargetId);return n.highestTargetId=r.next(),this.Sn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(n=>ge.fromTimestamp(new We(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=n,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),n>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=n),this.Sn(e,i)))}addTargetData(e,n){return this.Dn(e,n).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(n,r),this.Sn(e,r))))}updateTargetData(e,n){return this.Dn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Es(e).delete(n.targetId)).next(()=>this.Vn(e)).next(r=>(be(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,n,r){let i=0;const s=[];return Es(e).Z((o,a)=>{const l=Uo(a);l.sequenceNumber<=n&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>k.waitFor(s)).next(()=>i)}forEachTarget(e,n){return Es(e).Z((r,i)=>{const s=Uo(i);n(s)})}Vn(e){return xw(e).get("targetGlobalKey").next(n=>(be(n!==null),n))}Sn(e,n){return xw(e).put("targetGlobalKey",n)}Dn(e,n){return Es(e).put(E1(this.It,n))}Cn(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(n=>n.targetCount)}getTargetData(e,n){const r=ns(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Es(e).Z({range:i,index:"queryTargetsIndex"},(o,a,l)=>{const c=Uo(a);sl(n,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,n,r){const i=[],s=Or(e);return n.forEach(o=>{const a=jt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),k.waitFor(i)}removeMatchingKeys(e,n,r){const i=Or(e);return k.forEach(n,s=>{const o=jt(s.path);return k.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,n){const r=Or(e),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),i=Or(e);let s=Ie();return i.Z({range:r,X:!0},(o,a,l)=>{const c=tr(o[1]),u=new ee(c);s=s.add(u)}).next(()=>s)}containsKey(e,n){const r=jt(n.path),i=IDBKeyRange.bound([r],[DS(r)],!1,!0);let s=0;return Or(e).Z({index:"documentTargetsIndex",X:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}se(e,n){return Es(e).get(n).next(r=>r?Uo(r):null)}}function Es(t){return pt(t,"targets")}function xw(t){return pt(t,"targetGlobal")}function Or(t){return pt(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sw([t,e],[n,r]){const i=Te(t,n);return i===0?Te(e,r):i}class jz{constructor(e){this.xn=e,this.buffer=new $e(Sw),this.Nn=0}kn(){return++this.Nn}On(e){const n=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Sw(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class Kz{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Mn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return this.Mn!==null}Fn(e){j("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){ai(n)?j("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await us(n)}await this.Fn(3e5)})}}class qz{constructor(e,n){this.$n=e,this.params=n}calculateTargetCount(e,n){return this.$n.Bn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return k.resolve(Sn.at);const r=new jz(n);return this.$n.forEachTarget(e,i=>r.On(i.sequenceNumber)).next(()=>this.$n.Ln(e,i=>r.On(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.$n.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.$n.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(j("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Ew)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ew):this.Un(e,n))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(e,n){let r,i,s,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(j("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,n))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),bf()<=Pe.DEBUG&&j("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wz{constructor(e,n){this.db=e,this.garbageCollector=function(r,i){return new qz(r,i)}(this,n)}Bn(e){const n=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}qn(e){let n=0;return this.Ln(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Ln(e,n){return this.Kn(e,(r,i)=>n(i))}addReference(e,n,r){return Fl(e,r)}removeReference(e,n,r){return Fl(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Fl(e,n)}Gn(e,n){return function(r,i){let s=!1;return C1(r).tt(o=>T1(r,o,i).next(a=>(a&&(s=!0),k.resolve(!a)))).next(()=>s)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Kn(e,(o,a)=>{if(a<=n){const l=this.Gn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ge.min()),Or(e).delete([0,jt(o.path)])))});i.push(l)}}).next(()=>k.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Fl(e,n)}Kn(e,n){const r=Or(e);let i,s=Sn.at;return r.Z({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(s!==Sn.at&&n(new ee(tr(i)),s),s=c,i=l):s=Sn.at}).next(()=>{s!==Sn.at&&n(new ee(tr(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Fl(t,e){return Or(t).put(function(n,r){return{targetId:0,path:jt(n.path),sequenceNumber:r}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(){this.changes=new li(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?k.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gz{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return gi(e).put(r)}removeEntry(e,n,r){return gi(e).delete(function(i,s){const o=i.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],Wc(s),o[o.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Qn(e,r)))}getEntry(e,n){let r=qe.newInvalidDocument(n);return gi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(_o(n))},(i,s)=>{r=this.jn(n,s)}).next(()=>r)}Wn(e,n){let r={size:0,document:qe.newInvalidDocument(n)};return gi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(_o(n))},(i,s)=>{r={document:this.jn(n,s),size:Gc(s)}}).next(()=>r)}getEntries(e,n){let r=ln();return this.zn(e,n,(i,s)=>{const o=this.jn(i,s);r=r.insert(i,o)}).next(()=>r)}Hn(e,n){let r=ln(),i=new nt(ee.comparator);return this.zn(e,n,(s,o)=>{const a=this.jn(s,o);r=r.insert(s,a),i=i.insert(s,Gc(o))}).next(()=>({documents:r,Jn:i}))}zn(e,n,r){if(n.isEmpty())return k.resolve();let i=new $e(kw);n.forEach(l=>i=i.add(l));const s=IDBKeyRange.bound(_o(i.first()),_o(i.last())),o=i.getIterator();let a=o.getNext();return gi(e).Z({index:"documentKeyIndex",range:s},(l,c,u)=>{const h=ee.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&kw(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.j(_o(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,n,r){const i=[n.popLast().toArray(),n.lastSegment(),Wc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gi(e).W(IDBKeyRange.bound(i,s,!0)).next(o=>{let a=ln();for(const l of o){const c=this.jn(ee.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);a=a.insert(c.key,c)}return a})}getAllFromCollectionGroup(e,n,r,i){let s=ln();const o=Cw(n,r),a=Cw(n,pn.max());return gi(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{const h=this.jn(ee.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Jz(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return Tw(e).get("remoteDocumentGlobalKey").next(n=>(be(!!n),n))}Qn(e,n){return Tw(e).put("remoteDocumentGlobalKey",n)}jn(e,n){if(n){const r=Rz(this.It,n);if(!(r.isNoDocument()&&r.version.isEqual(ge.min())))return r}return qe.newInvalidDocument(e)}}function I1(t){return new Gz(t)}class Jz extends k1{constructor(e,n){super(),this.Yn=e,this.trackRemovals=n,this.Xn=new li(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const n=[];let r=0,i=new $e((s,o)=>Te(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.Xn.get(s);if(n.push(this.Yn.removeEntry(e,s,a.readTime)),o.isValidDocument()){const l=dw(this.Yn.It,o);i=i.add(s.path.popLast()),r+=Gc(l)-a.size,n.push(this.Yn.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){const l=dw(this.Yn.It,o.convertToNoDocument(ge.min()));n.push(this.Yn.addEntry(e,s,l))}}),i.forEach(s=>{n.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),n.push(this.Yn.updateMetadata(e,r)),k.waitFor(n)}getFromCache(e,n){return this.Yn.Wn(e,n).next(r=>(this.Xn.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Yn.Hn(e,n).next(({documents:r,Jn:i})=>(i.forEach((s,o)=>{this.Xn.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function Tw(t){return pt(t,"remoteDocumentGlobal")}function gi(t){return pt(t,"remoteDocumentsV14")}function _o(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Cw(t,e){const n=e.documentKey.path.toArray();return[t,Wc(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function kw(t,e){const n=t.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=Te(n[s],r[s]),i)return i;return i=Te(n.length,r.length),i||(i=Te(n[n.length-2],r[r.length-2]),i||Te(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xz{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.getBaseDocument(e,n,r))).next(i=>(r!==null&&ia(r.mutation,i,cn.empty(),We.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ie()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ie()){const i=er();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=zo();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=er();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ie()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=ln();const o=sa(),a=sa();return n.forEach((l,c)=>{const u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof vr)?s=s.insert(c.key,c):u!==void 0&&(o.set(c.key,u.mutation.getFieldMask()),ia(u.mutation,c,u.mutation.getFieldMask(),We.now()))}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),n.forEach((c,u)=>{var h;return a.set(c,new Xz(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,n){const r=sa();let i=new nt((o,a)=>o-a),s=Ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let u=r.get(l)||cn.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(i.get(a.batchId)||Ie()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=r1();u.forEach(d=>{if(!s.has(d)){const f=YS(n.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return k.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r){return function(i){return ee.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):V$(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r):this.getDocumentsMatchingCollectionQuery(e,n,r)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):k.resolve(er());let a=-1,l=s;return o.next(c=>k.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?k.resolve():this.getBaseDocument(e,u,h).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Ie())).next(u=>({batchId:a,changes:n1(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ee(n)).next(r=>{let i=zo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r){const i=n.collectionGroup;let s=zo();return this.indexManager.getCollectionParents(e,i).next(o=>k.forEach(o,a=>{const l=function(c,u){return new Ku(u,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(n,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,l,r).next(c=>{c.forEach((u,h)=>{s=s.insert(u,h)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,n,r){let i;return this.remoteDocumentCache.getAllFromCollection(e,n.path,r).next(s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId))).next(s=>{s.forEach((a,l)=>{const c=l.getKey();i.get(c)===null&&(i=i.insert(c,qe.newInvalidDocument(c)))});let o=zo();return i.forEach((a,l)=>{const c=s.get(a);c!==void 0&&ia(c.mutation,l,cn.empty(),We.now()),mg(n,l)&&(o=o.insert(a,l))}),o})}getBaseDocument(e,n,r){return r===null||r.mutation.type===1?this.remoteDocumentCache.getEntry(e,n):k.resolve(qe.newInvalidDocument(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yz{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,n){return k.resolve(this.Zn.get(n))}saveBundleMetadata(e,n){var r;return this.Zn.set(n.id,{id:(r=n).id,version:r.version,createTime:un(r.createTime)}),k.resolve()}getNamedQuery(e,n){return k.resolve(this.ts.get(n))}saveNamedQuery(e,n){return this.ts.set(n.name,function(r){return{name:r.name,query:x1(r.bundledQuery),readTime:un(r.readTime)}}(n)),k.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qz{constructor(){this.overlays=new nt(ee.comparator),this.es=new Map}getOverlay(e,n){return k.resolve(this.overlays.get(n))}getOverlays(e,n){const r=er();return k.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.ue(e,n,s)}),k.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.es.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(r)),k.resolve()}getOverlaysForCollection(e,n,r){const i=er(),s=n.length+1,o=new ee(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return k.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new nt((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let u=s.get(c.largestBatchId);u===null&&(u=er(),s=s.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=er(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=i)););return k.resolve(a)}ue(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.es.get(i.largestBatchId).delete(r.key);this.es.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new vg(n,r));let s=this.es.get(n);s===void 0&&(s=Ie(),this.es.set(n,s)),this.es.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(){this.ns=new $e(ot.ss),this.rs=new $e(ot.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,n){const r=new ot(e,n);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.cs(new ot(e,n))}hs(e,n){e.forEach(r=>this.removeReference(r,n))}ls(e){const n=new ee(new Ve([])),r=new ot(n,e),i=new ot(n,e+1),s=[];return this.rs.forEachInRange([r,i],o=>{this.cs(o),s.push(o.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const n=new ee(new Ve([])),r=new ot(n,e),i=new ot(n,e+1);let s=Ie();return this.rs.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new ot(e,0),r=this.ns.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class ot{constructor(e,n){this.key=e,this._s=n}static ss(e,n){return ee.comparator(e.key,n.key)||Te(e._s,n._s)}static os(e,n){return Te(e._s,n._s)||ee.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.ws=1,this.gs=new $e(ot.ss)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new bg(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.gs=this.gs.add(new ot(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return k.resolve(o)}lookupMutationBatch(e,n){return k.resolve(this.ys(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ps(r),s=i<0?0:i;return k.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new ot(n,0),i=new ot(n,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([r,i],o=>{const a=this.ys(o._s);s.push(a)}),k.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new $e(Te);return n.forEach(i=>{const s=new ot(i,0),o=new ot(i,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,o],a=>{r=r.add(a._s)})}),k.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;ee.isDocumentKey(s)||(s=s.child(""));const o=new ot(new ee(s),0);let a=new $e(Te);return this.gs.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(l._s)),!0)},o),k.resolve(this.Is(a))}Is(e){const n=[];return e.forEach(r=>{const i=this.ys(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){be(this.Ts(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.gs;return k.forEach(n.mutations,i=>{const s=new ot(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,n){const r=new ot(n,0),i=this.gs.firstAfterOrEqual(r);return k.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}Ts(e,n){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const n=this.ps(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eU{constructor(e){this.Es=e,this.docs=new nt(ee.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.Es(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return k.resolve(r?r.document.mutableCopy():qe.newInvalidDocument(n))}getEntries(e,n){let r=ln();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():qe.newInvalidDocument(i))}),k.resolve(r)}getAllFromCollection(e,n,r){let i=ln();const s=new ee(n.child("")),o=this.docs.getIteratorFrom(s);for(;o.hasNext();){const{key:a,value:{document:l}}=o.getNext();if(!n.isPrefixOf(a.path))break;a.path.length>n.length+1||fg(RS(l),r)<=0||(i=i.insert(l.key,l.mutableCopy()))}return k.resolve(i)}getAllFromCollectionGroup(e,n,r,i){ae()}As(e,n){return k.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new tU(this)}getSize(e){return k.resolve(this.size)}}class tU extends k1{constructor(e){super(),this.Yn=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(r)}),k.waitFor(n)}getFromCache(e,n){return this.Yn.getEntry(e,n)}getAllFromCache(e,n){return this.Yn.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nU{constructor(e){this.persistence=e,this.Rs=new li(n=>ns(n),sl),this.lastRemoteSnapshotVersion=ge.min(),this.highestTargetId=0,this.bs=0,this.Ps=new xg,this.targetCount=0,this.vs=ss.Pn()}forEachTarget(e,n){return this.Rs.forEach((r,i)=>n(i)),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.bs&&(this.bs=n),k.resolve()}Dn(e){this.Rs.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.vs=new ss(n),this.highestTargetId=n),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,n){return this.Dn(n),this.targetCount+=1,k.resolve()}updateTargetData(e,n){return this.Dn(n),k.resolve()}removeTargetData(e,n){return this.Rs.delete(n.target),this.Ps.ls(n.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Rs.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),k.waitFor(s).next(()=>i)}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,n){const r=this.Rs.get(n)||null;return k.resolve(r)}addMatchingKeys(e,n,r){return this.Ps.us(n,r),k.resolve()}removeMatchingKeys(e,n,r){this.Ps.hs(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),k.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Ps.ls(n),k.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Ps.ds(n);return k.resolve(r)}containsKey(e,n){return k.resolve(this.Ps.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(e,n){this.Vs={},this.overlays={},this.Ss=new Sn(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new nU(this),this.indexManager=new zz,this.remoteDocumentCache=function(r){return new eU(r)}(r=>this.referenceDelegate.xs(r)),this.It=new v1(n),this.Ns=new Yz(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Qz,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Vs[e.toKey()];return r||(r=new Zz(n,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,n,r){j("MemoryPersistence","Starting transaction:",e);const i=new rU(this.Ss.next());return this.referenceDelegate.ks(),r(i).next(s=>this.referenceDelegate.Os(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ms(e,n){return k.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,n)))}}class rU extends PS{constructor(e){super(),this.currentSequenceNumber=e}}class eh{constructor(e){this.persistence=e,this.Fs=new xg,this.$s=null}static Bs(e){return new eh(e)}get Ls(){if(this.$s)return this.$s;throw ae()}addReference(e,n,r){return this.Fs.addReference(r,n),this.Ls.delete(r.toString()),k.resolve()}removeReference(e,n,r){return this.Fs.removeReference(r,n),this.Ls.add(r.toString()),k.resolve()}markPotentiallyOrphaned(e,n){return this.Ls.add(n.toString()),k.resolve()}removeTarget(e,n){this.Fs.ls(n.targetId).forEach(i=>this.Ls.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Ls.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}ks(){this.$s=new Set}Os(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.Ls,r=>{const i=ee.fromPath(r);return this.Us(e,i).next(s=>{s||n.removeEntry(i,ge.min())})}).next(()=>(this.$s=null,n.apply(e)))}updateLimboDocument(e,n){return this.Us(e,n).next(r=>{r?this.Ls.delete(n.toString()):this.Ls.add(n.toString())})}xs(e){return 0}Us(e,n){return k.or([()=>k.resolve(this.Fs.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ms(e,n)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(e){this.It=e}$(e,n,r,i){const s=new Hu("createOrUpgrade",n);r<1&&i>=1&&(function(a){a.createObjectStore("owner")}(e),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hw,{unique:!0}),a.createObjectStore("documentMutations")}(e),Iw(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=k.resolve();return r<3&&i>=3&&(r!==0&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),Iw(e)),o=o.next(()=>function(a){const l=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ge.min().toTimestamp(),targetCount:0};return l.put("targetGlobalKey",c)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(a,l){return l.store("mutations").W().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hw,{unique:!0});const u=l.store("mutations"),h=c.map(d=>u.put(d));return k.waitFor(h)})}(e,s))),o=o.next(()=>{(function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.qs(s))),r<6&&i>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),r<7&&i>=7&&(o=o.next(()=>this.Gs(s))),r<8&&i>=8&&(o=o.next(()=>this.Qs(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.js(s))),r<11&&i>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(a){const l=a.createObjectStore("documentOverlays",{keyPath:Mz});l.createIndex("collectionPathOverlayIndex",Nz,{unique:!1}),l.createIndex("collectionGroupOverlayIndex",Oz,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(a){const l=a.createObjectStore("remoteDocumentsV14",{keyPath:bz});l.createIndex("documentKeyIndex",wz),l.createIndex("collectionGroupIndex",vz)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.zs(e,s))),r<15&&i>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:Cz}).createIndex("sequenceNumberIndex",kz,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:Iz}).createIndex("documentKeyIndex",Az,{unique:!1})}(e))),o}Ks(e){let n=0;return e.store("remoteDocuments").Z((r,i)=>{n+=Gc(i)}).next(()=>{const r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}qs(e){const n=e.store("mutationQueues"),r=e.store("mutations");return n.W().next(i=>k.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>k.forEach(a,l=>{be(l.userId===s.userId);const c=ki(this.It,l);return S1(e,s.userId,c).next(()=>{})}))}))}Gs(e){const n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((o,a)=>{const l=new Ve(o),c=function(u){return[0,jt(u)]}(l);s.push(n.get(c).next(u=>u?k.resolve():(h=>n.put({targetId:0,path:jt(h),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>k.waitFor(s))})}Qs(e,n){e.createObjectStore("collectionParents",{keyPath:Tz});const r=n.store("collectionParents"),i=new Eg,s=o=>{if(i.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:jt(l)})}};return n.store("remoteDocuments").Z({X:!0},(o,a)=>{const l=new Ve(o);return s(l.popLast())}).next(()=>n.store("documentMutations").Z({X:!0},([o,a,l],c)=>{const u=tr(a);return s(u.popLast())}))}js(e){const n=e.store("targets");return n.Z((r,i)=>{const s=Uo(i),o=E1(this.It,s);return n.put(o)})}Ws(e,n){const r=n.store("remoteDocuments"),i=[];return r.Z((s,o)=>{const a=n.store("remoteDocumentsV14"),l=(c=o,c.document?new ee(Ve.fromString(c.document.name).popFirst(5)):c.noDocument?ee.fromSegments(c.noDocument.path):c.unknownDocument?ee.fromSegments(c.unknownDocument.path):ae()).path.toArray();var c;/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>k.waitFor(i))}zs(e,n){const r=n.store("mutations"),i=I1(this.It),s=new M1(eh.Bs,this.It.re);return r.W().next(o=>{const a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Ie();ki(this.It,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),k.forEach(a,(l,c)=>{const u=new bt(c),h=Qu.oe(this.It,u),d=s.getIndexManager(u),f=Zu.oe(u,this.It,d,s.referenceDelegate);return new A1(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new If(n,Sn.at),l).next()})})}}function Iw(t){t.createObjectStore("targetDocuments",{keyPath:xz}).createIndex("documentTargetsIndex",Sz,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Ez,{unique:!0}),t.createObjectStore("targetGlobal")}const od="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Sg{constructor(e,n,r,i,s,o,a,l,c,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Hs=s,this.window=o,this.document=a,this.Js=c,this.Ys=u,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!Sg.C())throw new se(z.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Wz(this,i),this.ii=n+"main",this.It=new v1(l),this.ri=new pr(this.ii,this.Xs,new iU(this.It)),this.Cs=new Hz(this.referenceDelegate,this.It),this.remoteDocumentCache=I1(this.It),this.Ns=new Lz,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,u===!1&&$t("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new se(z.FAILED_PRECONDITION,od);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new Sn(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Vl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(n=>{n||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(n=>this.isPrimary&&!n?this._i(e).next(()=>!1):!!n&&this.wi(e).next(()=>!0))).catch(e=>{if(ai(e))return j("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return j("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Ro(e).get("owner").next(n=>k.resolve(this.mi(n)))}gi(e){return Vl(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=pt(n,"clientMetadata");return r.W().next(i=>{const s=this.Ii(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return k.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.oi)for(const n of e)this.oi.removeItem(this.Ti(n.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?k.resolve(!0):Ro(e).get("owner").next(n=>{if(n!==null&&this.pi(n.leaseTimestampMs,5e3)&&!this.Ei(n.ownerId)){if(this.mi(n)&&this.networkEnabled)return!0;if(!this.mi(n)){if(!n.allowTabSynchronization)throw new se(z.FAILED_PRECONDITION,od);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vl(e).W().next(r=>this.Ii(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&j("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const n=new If(e,Sn.at);return this._i(n).next(()=>this.gi(n))}),this.ri.close(),this.Pi()}Ii(e,n){return e.filter(r=>this.pi(r.updateTimeMs,n)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Vl(e).W().next(n=>this.Ii(n,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,n){return Zu.oe(e,this.It,n,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Uz(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return Qu.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(e,n,r){j("IndexedDbPersistence","Starting transaction:",e);const i=n==="readonly"?"readonly":"readwrite",s=(o=this.Xs)===15?_z:o===14?w1:o===13?b1:o===12?Dz:o===11?y1:void ae();var o;let a;return this.ri.runTransaction(e,i,s,l=>(a=new If(l,this.Ss?this.Ss.next():Sn.at),n==="readwrite-primary"?this.fi(a).next(c=>!!c||this.di(a)).next(c=>{if(!c)throw $t(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new se(z.FAILED_PRECONDITION,LS);return r(a)}).next(c=>this.wi(a).next(()=>c)):this.Vi(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Vi(e){return Ro(e).get("owner").next(n=>{if(n!==null&&this.pi(n.leaseTimestampMs,5e3)&&!this.Ei(n.ownerId)&&!this.mi(n)&&!(this.Ys||this.allowTabSynchronization&&n.allowTabSynchronization))throw new se(z.FAILED_PRECONDITION,od)})}wi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ro(e).put("owner",n)}static C(){return pr.C()}_i(e){const n=Ro(e);return n.get("owner").next(r=>this.mi(r)?(j("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):k.resolve())}pi(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||($t(`Detected an update time that is in the future: ${e} > ${r}`),!1))}ci(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground=this.document.visibilityState==="visible")}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Zs=()=>{this.Ai(),LB()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var n;try{const r=((n=this.oi)===null||n===void 0?void 0:n.getItem(this.Ti(e)))!==null;return j("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return $t("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){$t("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ro(t){return pt(t,"owner")}function Vl(t){return pt(t,"clientMetadata")}function sU(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Si=r,this.Di=i}static Ci(e,n){let r=Ie(),i=Ie();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Tg(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N1{constructor(){this.xi=!1}initialize(e,n){this.Ni=e,this.indexManager=n,this.xi=!0}getDocumentsMatchingQuery(e,n,r,i){return this.ki(e,n).next(s=>s||this.Oi(e,n,i,r)).next(s=>s||this.Mi(e,n))}ki(e,n){if(tw(n))return k.resolve(null);let r=zn(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=xf(n,null,"F"),r=zn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Ie(...s);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.Fi(n,a);return this.$i(n,c,o,l.readTime)?this.ki(e,xf(n,null,"F")):this.Bi(e,c,n,l)}))})))}Oi(e,n,r,i){return tw(n)||i.isEqual(ge.min())?this.Mi(e,n):this.Ni.getDocuments(e,r).next(s=>{const o=this.Fi(n,s);return this.$i(n,o,r,i)?this.Mi(e,n):(bf()<=Pe.DEBUG&&j("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sf(n)),this.Bi(e,o,n,m$(i,-1)))})}Fi(e,n){let r=new $e(jS(e));return n.forEach((i,s)=>{mg(e,s)&&(r=r.add(s))}),r}$i(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Mi(e,n){return bf()<=Pe.DEBUG&&j("QueryEngine","Using full collection scan to execute query:",Sf(n)),this.Ni.getDocumentsMatchingQuery(e,n,pn.min())}Bi(e,n,r,i){return this.Ni.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,n,r,i){this.persistence=e,this.Li=n,this.It=i,this.Ui=new nt(Te),this.qi=new li(s=>ns(s),sl),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new A1(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ui))}}function O1(t,e,n,r){return new oU(t,e,n,r)}async function D1(t,e){const n=we(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Qi(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=Ie();for(const c of i){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of s){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return n.localDocuments.getDocuments(r,l).next(c=>({ji:c,removedBatchIds:o,addedBatchIds:a}))})})}function aU(t,e){const n=we(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,l,c){const u=l.batch,h=u.keys();let d=k.resolve();return h.forEach(f=>{d=d.next(()=>c.getEntry(a,f)).next(p=>{const g=l.docVersions.get(f);be(g!==null),p.version.compareTo(g)<0&&(u.applyToRemoteDocument(p,l),p.isValidDocument()&&(p.setReadTime(l.commitVersion),c.addEntry(p)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,u))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=Ie();for(let l=0;l<o.mutationResults.length;++l)o.mutationResults[l].transformResults.length>0&&(a=a.add(o.batch.mutations[l].key));return a}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function _1(t){const e=we(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Cs.getLastRemoteSnapshotVersion(n))}function lU(t,e){const n=we(t),r=e.snapshotVersion;let i=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.Ui;const a=[];e.targetChanges.forEach((u,h)=>{const d=i.get(h);if(!d)return;a.push(n.Cs.removeMatchingKeys(s,u.removedDocuments,h).next(()=>n.Cs.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.has(h)?f=f.withResumeToken(ft.EMPTY_BYTE_STRING,ge.min()).withLastLimboFreeSnapshotVersion(ge.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),i=i.insert(h,f),function(p,g,m){return p.resumeToken.approximateByteSize()===0||g.snapshotVersion.toMicroseconds()-p.snapshotVersion.toMicroseconds()>=3e8?!0:m.addedDocuments.size+m.modifiedDocuments.size+m.removedDocuments.size>0}(d,f,u)&&a.push(n.Cs.updateTargetData(s,f))});let l=ln(),c=Ie();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(cU(s,o,e.documentUpdates).next(u=>{l=u.Wi,c=u.zi})),!r.isEqual(ge.min())){const u=n.Cs.getLastRemoteSnapshotVersion(s).next(h=>n.Cs.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return k.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(n.Ui=i,s))}function cU(t,e,n){let r=Ie(),i=Ie();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=ln();return n.forEach((a,l)=>{const c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(ge.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):j("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Wi:o,zi:i}})}function uU(t,e){const n=we(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function hU(t,e){const n=we(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Cs.getTargetData(r,e).next(s=>s?(i=s,k.resolve(i)):n.Cs.allocateTargetId(r).next(o=>(i=new Kr(e,o,0,r.currentSequenceNumber),n.Cs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.Ui.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(r.targetId,r),n.qi.set(e,r.targetId)),r})}async function Af(t,e,n){const r=we(t),i=r.Ui.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ai(o))throw o;j("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ui=r.Ui.remove(e),r.qi.delete(i.target)}function Aw(t,e,n){const r=we(t);let i=ge.min(),s=Ie();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,l,c){const u=we(a),h=u.qi.get(c);return h!==void 0?k.resolve(u.Ui.get(h)):u.Cs.getTargetData(l,c)}(r,o,zn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.Li.getDocumentsMatchingQuery(o,e,n?i:ge.min(),n?s:Ie())).next(a=>(dU(r,$$(e),a),{documents:a,Hi:s})))}function dU(t,e,n){let r=t.Ki.get(e)||ge.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Ki.set(e,r)}class Mw{constructor(){this.activeTargetIds=i1()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class R1{constructor(){this.Lr=new Mw,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,n,r){this.Ur[e]=n}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Mw,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fU{qr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){j("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){j("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.oo=n+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,n,r,i,s){const o=this.ho(e,n);j("RestConnection","Sending: ",o,r);const a={};return this.lo(a,i,s),this.fo(e,o,a,r).then(l=>(j("RestConnection","Received: ",l),l),l=>{throw zc("RestConnection",`${e} failed with error: `,l,"url: ",o,"request:",r),l})}_o(e,n,r,i,s,o){return this.ao(e,n,r,i,s)}lo(e,n,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+So,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}ho(e,n){const r=pU[e];return`${this.oo}/v1/${n}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,n,r,i){return new Promise((s,o)=>{const a=new s$;a.listenOnce(n$.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case id.NO_ERROR:const c=a.getResponseJson();j("Connection","XHR received:",JSON.stringify(c)),s(c);break;case id.TIMEOUT:j("Connection",'RPC "'+e+'" timed out'),o(new se(z.DEADLINE_EXCEEDED,"Request time out"));break;case id.HTTP_ERROR:const u=a.getStatus();if(j("Connection",'RPC "'+e+'" failed with status:',u,"response text:",a.getResponseText()),u>0){const h=a.getResponseJson().error;if(h&&h.status&&h.message){const d=function(f){const p=f.toLowerCase().replace(/_/g,"-");return Object.values(z).indexOf(p)>=0?p:z.UNKNOWN}(h.status);o(new se(d,h.message))}else o(new se(z.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new se(z.UNAVAILABLE,"Connection failed."));break;default:ae()}}finally{j("Connection",'RPC "'+e+'" completed.')}});const l=JSON.stringify(i);a.send(n,"POST",l,r,15)})}wo(e,n,r){const i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=e$(),o=t$(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new i$({})),this.lo(a.initMessageHeaders,n,r),a.encodeInitMessageHeaders=!0;const l=i.join("");j("Connection","Creating WebChannel: "+l,a);const c=s.createWebChannel(l,a);let u=!1,h=!1;const d=new gU({Hr:p=>{h?j("Connection","Not sending because WebChannel is closed:",p):(u||(j("Connection","Opening WebChannel transport."),c.open(),u=!0),j("Connection","WebChannel sending:",p),c.send(p))},Jr:()=>c.close()}),f=(p,g,m)=>{p.listen(g,w=>{try{m(w)}catch(D){setTimeout(()=>{throw D},0)}})};return f(c,Rl.EventType.OPEN,()=>{h||j("Connection","WebChannel transport opened.")}),f(c,Rl.EventType.CLOSE,()=>{h||(h=!0,j("Connection","WebChannel transport closed"),d.io())}),f(c,Rl.EventType.ERROR,p=>{h||(h=!0,zc("Connection","WebChannel transport errored:",p),d.io(new se(z.UNAVAILABLE,"The operation could not be completed")))}),f(c,Rl.EventType.MESSAGE,p=>{var g;if(!h){const m=p.data[0];be(!!m);const w=m,D=w.error||((g=w[0])===null||g===void 0?void 0:g.error);if(D){j("Connection","WebChannel received error:",D);const P=D.status;let y=function(R){const K=Qe[R];if(K!==void 0)return e1(K)}(P),F=D.message;y===void 0&&(y=z.INTERNAL,F="Unknown error status: "+P+" with message "+D.message),h=!0,d.io(new se(y,F)),c.close()}else j("Connection","WebChannel received:",m),d.ro(m)}}),f(o,r$.STAT_EVENT,p=>{p.stat===$b.PROXY?j("Connection","Detected buffering proxy"):p.stat===$b.NOPROXY&&j("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yU(){return typeof window<"u"?window:null}function nc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(t){return new sz(t,!0)}class L1{constructor(e,n,r=1e3,i=1.5,s=6e4){this.Hs=e,this.timerId=n,this.mo=r,this.yo=i,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const n=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,n-r);i>0&&j("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,n,r,i,s,o,a,l){this.Hs=e,this.vo=r,this.Vo=i,this.So=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new L1(e,n)}ko(){return this.state===1||this.state===5||this.Oo()}Oo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Mo()}async stop(){this.ko()&&await this.close(0)}Fo(){this.state=0,this.No.reset()}$o(){this.Oo()&&this.Co===null&&(this.Co=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.Bo()))}Lo(e){this.Uo(),this.stream.send(e)}async Bo(){if(this.Oo())return this.close(0)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}async close(e,n){this.Uo(),this.qo(),this.No.cancel(),this.Do++,e!==4?this.No.reset():n&&n.code===z.RESOURCE_EXHAUSTED?($t(n.toString()),$t("Using maximum backoff delay to prevent overloading the backend."),this.No.Ao()):n&&n.code===z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Ko(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(n)}Ko(){}auth(){this.state=1;const e=this.Go(this.Do),n=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Do===n&&this.Qo(r,i)},r=>{e(()=>{const i=new se(z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.jo(i)})})}Qo(e,n){const r=this.Go(this.Do);this.stream=this.Wo(e,n),this.stream.Yr(()=>{r(()=>(this.state=2,this.xo=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.Oo()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(i=>{r(()=>this.jo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Mo(){this.state=5,this.No.Ro(async()=>{this.state=0,this.start()})}jo(e){return j("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Go(e){return n=>{this.Hs.enqueueAndForget(()=>this.Do===e?n():(j("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class bU extends P1{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.It=s}Wo(e,n){return this.So.wo("Listen",e,n)}onMessage(e){this.No.reset();const n=lz(this.It,e),r=function(i){if(!("targetChange"in i))return ge.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?ge.min():s.readTime?un(s.readTime):ge.min()}(e);return this.listener.zo(n,r)}Ho(e){const n={};n.database=Cf(this.It),n.addTarget=function(i,s){let o;const a=s.target;return o=Hc(a)?{documents:h1(i,a)}:{query:d1(i,a)},o.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?o.resumeToken=a1(i,s.resumeToken):s.snapshotVersion.compareTo(ge.min())>0&&(o.readTime=Ua(i,s.snapshotVersion.toTimestamp())),o}(this.It,e);const r=uz(this.It,e);r&&(n.labels=r),this.Lo(n)}Jo(e){const n={};n.database=Cf(this.It),n.removeTarget=e,this.Lo(n)}}class wU extends P1{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.It=s,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(e,n){return this.So.wo("Write",e,n)}onMessage(e){if(be(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Yo){this.No.reset();const n=cz(e.writeResults,e.commitTime),r=un(e.commitTime);return this.listener.tu(r,n)}return be(!e.writeResults||e.writeResults.length===0),this.Yo=!0,this.listener.eu()}nu(){const e={};e.database=Cf(this.It),this.Lo(e)}Zo(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>qc(this.It,r))};this.Lo(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.So=r,this.It=i,this.su=!1}iu(){if(this.su)throw new se(z.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,n,r){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.So.ao(e,n,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new se(z.UNKNOWN,i.toString())})}_o(e,n,r,i){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.So._o(e,n,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new se(z.UNKNOWN,s.toString())})}terminate(){this.su=!0}}class EU{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}cu(){this.ru===0&&(this.au("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.au("Offline"),Promise.resolve())))}lu(e){this.state==="Online"?this.au("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.au("Offline")))}set(e){this.fu(),this.ru=0,e==="Online"&&(this.uu=!1),this.au(e)}au(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}hu(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?($t(n),this.uu=!1):j("OnlineStateTracker",n)}fu(){this.ou!==null&&(this.ou.cancel(),this.ou=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xU{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=s,this.gu.qr(o=>{r.enqueueAndForget(async()=>{ds(this)&&(j("RemoteStore","Restarting streams for network reachability change."),await async function(a){const l=we(a);l.wu.add(4),await al(l),l.yu.set("Unknown"),l.wu.delete(4),await nh(l)}(this))})}),this.yu=new EU(r,i)}}async function nh(t){if(ds(t))for(const e of t.mu)await e(!0)}async function al(t){for(const e of t.mu)await e(!1)}function B1(t,e){const n=we(t);n._u.has(e.targetId)||(n._u.set(e.targetId,e),Ig(n)?kg(n):Co(n).Oo()&&Cg(n,e))}function F1(t,e){const n=we(t),r=Co(n);n._u.delete(e),r.Oo()&&V1(n,e),n._u.size===0&&(r.Oo()?r.$o():ds(n)&&n.yu.set("Unknown"))}function Cg(t,e){t.pu.Mt(e.targetId),Co(t).Ho(e)}function V1(t,e){t.pu.Mt(e),Co(t).Jo(e)}function kg(t){t.pu=new nz({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t._u.get(e)||null}),Co(t).start(),t.yu.cu()}function Ig(t){return ds(t)&&!Co(t).ko()&&t._u.size>0}function ds(t){return we(t).wu.size===0}function $1(t){t.pu=void 0}async function SU(t){t._u.forEach((e,n)=>{Cg(t,e)})}async function TU(t,e){$1(t),Ig(t)?(t.yu.lu(e),kg(t)):t.yu.set("Unknown")}async function CU(t,e,n){if(t.yu.set("Online"),e instanceof o1&&e.state===2&&e.cause)try{await async function(r,i){const s=i.cause;for(const o of i.targetIds)r._u.has(o)&&(await r.remoteSyncer.rejectListen(o,s),r._u.delete(o),r.pu.removeTarget(o))}(t,e)}catch(r){j("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Jc(t,r)}else if(e instanceof ec?t.pu.Gt(e):e instanceof s1?t.pu.Yt(e):t.pu.Wt(e),!n.isEqual(ge.min()))try{const r=await _1(t.localStore);n.compareTo(r)>=0&&await function(i,s){const o=i.pu.te(s);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const c=i._u.get(l);c&&i._u.set(l,c.withResumeToken(a.resumeToken,s))}}),o.targetMismatches.forEach(a=>{const l=i._u.get(a);if(!l)return;i._u.set(a,l.withResumeToken(ft.EMPTY_BYTE_STRING,l.snapshotVersion)),V1(i,a);const c=new Kr(l.target,a,1,l.sequenceNumber);Cg(i,c)}),i.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(r){j("RemoteStore","Failed to raise snapshot:",r),await Jc(t,r)}}async function Jc(t,e,n){if(!ai(e))throw e;t.wu.add(1),await al(t),t.yu.set("Offline"),n||(n=()=>_1(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{j("RemoteStore","Retrying IndexedDB access"),await n(),t.wu.delete(1),await nh(t)})}function z1(t,e){return e().catch(n=>Jc(t,n,e))}async function ll(t){const e=we(t),n=ti(e);let r=e.du.length>0?e.du[e.du.length-1].batchId:-1;for(;kU(e);)try{const i=await uU(e.localStore,r);if(i===null){e.du.length===0&&n.$o();break}r=i.batchId,IU(e,i)}catch(i){await Jc(e,i)}U1(e)&&H1(e)}function kU(t){return ds(t)&&t.du.length<10}function IU(t,e){t.du.push(e);const n=ti(t);n.Oo()&&n.Xo&&n.Zo(e.mutations)}function U1(t){return ds(t)&&!ti(t).ko()&&t.du.length>0}function H1(t){ti(t).start()}async function AU(t){ti(t).nu()}async function MU(t){const e=ti(t);for(const n of t.du)e.Zo(n.mutations)}async function NU(t,e,n){const r=t.du.shift(),i=wg.from(r,e,n);await z1(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await ll(t)}async function OU(t,e){e&&ti(t).Xo&&await async function(n,r){if(i=r.code,Y$(i)&&i!==z.ABORTED){const s=n.du.shift();ti(n).Fo(),await z1(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r)),await ll(n)}var i}(t,e),U1(t)&&H1(t)}async function Ow(t,e){const n=we(t);n.asyncQueue.verifyOperationInProgress(),j("RemoteStore","RemoteStore received new credentials");const r=ds(n);n.wu.add(3),await al(n),r&&n.yu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.wu.delete(3),await nh(n)}async function DU(t,e){const n=we(t);e?(n.wu.delete(2),await nh(n)):e||(n.wu.add(2),await al(n),n.yu.set("Unknown"))}function Co(t){return t.Iu||(t.Iu=function(e,n,r){const i=we(e);return i.iu(),new bU(n,i.So,i.authCredentials,i.appCheckCredentials,i.It,r)}(t.datastore,t.asyncQueue,{Yr:SU.bind(null,t),Zr:TU.bind(null,t),zo:CU.bind(null,t)}),t.mu.push(async e=>{e?(t.Iu.Fo(),Ig(t)?kg(t):t.yu.set("Unknown")):(await t.Iu.stop(),$1(t))})),t.Iu}function ti(t){return t.Tu||(t.Tu=function(e,n,r){const i=we(e);return i.iu(),new wU(n,i.So,i.authCredentials,i.appCheckCredentials,i.It,r)}(t.datastore,t.asyncQueue,{Yr:AU.bind(null,t),Zr:OU.bind(null,t),eu:MU.bind(null,t),tu:NU.bind(null,t)}),t.mu.push(async e=>{e?(t.Tu.Fo(),await ll(t)):(await t.Tu.stop(),t.du.length>0&&(j("RemoteStore",`Stopping write stream with ${t.du.length} pending writes`),t.du=[]))})),t.Tu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Vn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new Ag(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new se(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mg(t,e){if($t("AsyncQueue",`${e}: ${t}`),ai(t))return new se(z.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e){this.comparator=e?(n,r)=>e(n,r)||ee.comparator(n.key,r.key):(n,r)=>ee.comparator(n.key,r.key),this.keyedMap=zo(),this.sortedSet=new nt(this.comparator)}static emptySet(e){return new Hs(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Hs)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Hs;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(){this.Eu=new nt(ee.comparator)}track(e){const n=e.doc.key,r=this.Eu.get(n);r?e.type!==0&&r.type===3?this.Eu=this.Eu.insert(n,e):e.type===3&&r.type!==1?this.Eu=this.Eu.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Eu=this.Eu.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Eu=this.Eu.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Eu=this.Eu.remove(n):e.type===1&&r.type===2?this.Eu=this.Eu.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Eu=this.Eu.insert(n,{type:2,doc:e.doc}):ae():this.Eu=this.Eu.insert(n,e)}Au(){const e=[];return this.Eu.inorderTraversal((n,r)=>{e.push(r)}),e}}class uo{constructor(e,n,r,i,s,o,a,l){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l}static fromInitialDocuments(e,n,r,i){const s=[];return n.forEach(o=>{s.push({type:0,doc:o})}),new uo(e,n,Hs.emptySet(n),s,r,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Wu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U{constructor(){this.Ru=void 0,this.listeners=[]}}class RU{constructor(){this.queries=new li(e=>HS(e),Wu),this.onlineState="Unknown",this.bu=new Set}}async function j1(t,e){const n=we(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new _U),i)try{s.Ru=await n.onListen(r)}catch(o){const a=Mg(o,`Initialization of query '${Sf(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,s),s.listeners.push(e),e.Pu(n.onlineState),s.Ru&&e.vu(s.Ru)&&Ng(n)}async function K1(t,e){const n=we(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function LU(t,e){const n=we(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.listeners)a.vu(i)&&(r=!0);o.Ru=i}}r&&Ng(n)}function PU(t,e,n){const r=we(t),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(e)}function Ng(t){t.bu.forEach(e=>{e.next()})}class q1{constructor(e,n,r){this.query=e,this.Vu=n,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=r||{}}vu(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new uo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let n=!1;return this.Su?this.Cu(e)&&(this.Vu.next(e),n=!0):this.xu(e,this.onlineState)&&(this.Nu(e),n=!0),this.Du=e,n}onError(e){this.Vu.error(e)}Pu(e){this.onlineState=e;let n=!1;return this.Du&&!this.Su&&this.xu(this.Du,e)&&(this.Nu(this.Du),n=!0),n}xu(e,n){if(!e.fromCache)return!0;const r=n!=="Offline";return(!this.options.ku||!r)&&(!e.docs.isEmpty()||n==="Offline")}Cu(e){if(e.docChanges.length>0)return!0;const n=this.Du&&this.Du.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Nu(e){e=uo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Su=!0,this.Vu.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e){this.key=e}}class G1{constructor(e){this.key=e}}class BU{constructor(e,n){this.query=e,this.Uu=n,this.qu=null,this.current=!1,this.Ku=Ie(),this.mutatedKeys=Ie(),this.Gu=jS(e),this.Qu=new Hs(this.Gu)}get ju(){return this.Uu}Wu(e,n){const r=n?n.zu:new Dw,i=n?n.Qu:this.Qu;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{const d=i.get(u),f=mg(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),g=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let m=!1;d&&f?d.data.isEqual(f.data)?p!==g&&(r.track({type:3,doc:f}),m=!0):this.Hu(d,f)||(r.track({type:2,doc:f}),m=!0,(l&&this.Gu(f,l)>0||c&&this.Gu(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),m=!0):d&&!f&&(r.track({type:1,doc:d}),m=!0,(l||c)&&(a=!0)),m&&(f?(o=o.add(f),s=g?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{Qu:o,zu:r,$i:a,mutatedKeys:s}}Hu(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Au();s.sort((c,u)=>function(h,d){const f=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ae()}};return f(h)-f(d)}(c.type,u.type)||this.Gu(c.doc,u.doc)),this.Ju(r);const o=n?this.Yu():[],a=this.Ku.size===0&&this.current?1:0,l=a!==this.qu;return this.qu=a,s.length!==0||l?{snapshot:new uo(this.query,e.Qu,i,s,e.mutatedKeys,a===0,l,!1),Xu:o}:{Xu:o}}Pu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Dw,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(n=>this.Uu=this.Uu.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Uu=this.Uu.delete(n)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Ie(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const n=[];return e.forEach(r=>{this.Ku.has(r)||n.push(new G1(r))}),this.Ku.forEach(r=>{e.has(r)||n.push(new W1(r))}),n}tc(e){this.Uu=e.Hi,this.Ku=Ie();const n=this.Wu(e.documents);return this.applyChanges(n,!0)}ec(){return uo.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.qu===0)}}class FU{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class VU{constructor(e){this.key=e,this.nc=!1}}class $U{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new li(a=>HS(a),Wu),this.rc=new Map,this.oc=new Set,this.uc=new nt(ee.comparator),this.cc=new Map,this.ac=new xg,this.hc={},this.lc=new Map,this.fc=ss.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function zU(t,e){const n=YU(t);let r,i;const s=n.ic.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const o=await hU(n.localStore,zn(e));n.isPrimaryClient&&B1(n.remoteStore,o);const a=n.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=await UU(n,e,r,a==="current")}return i}async function UU(t,e,n,r){t._c=(u,h,d)=>async function(f,p,g,m){let w=p.view.Wu(g);w.$i&&(w=await Aw(f.localStore,p.query,!1).then(({documents:y})=>p.view.Wu(y,w)));const D=m&&m.targetChanges.get(p.targetId),P=p.view.applyChanges(w,f.isPrimaryClient,D);return Rw(f,p.targetId,P.Xu),P.snapshot}(t,u,h,d);const i=await Aw(t.localStore,e,!0),s=new BU(e,i.Hi),o=s.Wu(i.documents),a=ol.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline"),l=s.applyChanges(o,t.isPrimaryClient,a);Rw(t,n,l.Xu);const c=new FU(e,n,s);return t.ic.set(e,c),t.rc.has(n)?t.rc.get(n).push(e):t.rc.set(n,[e]),l.snapshot}async function HU(t,e){const n=we(t),r=n.ic.get(e),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter(s=>!Wu(s,e))),void n.ic.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Af(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),F1(n.remoteStore,r.targetId),Mf(n,r.targetId)}).catch(us)):(Mf(n,r.targetId),await Af(n.localStore,r.targetId,!0))}async function jU(t,e,n){const r=Z1(t);try{const i=await function(s,o){const a=we(s),l=We.now(),c=o.reduce((d,f)=>d.add(f.key),Ie());let u,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let f=ln(),p=Ie();return a.Gi.getEntries(d,c).next(g=>{f=g,f.forEach((m,w)=>{w.isValidDocument()||(p=p.add(m))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,f)).next(g=>{u=g;const m=[];for(const w of o){const D=J$(w,u.get(w.key).overlayedDocument);D!=null&&m.push(new vr(w.key,D,zS(D.value.mapValue),Ht.exists(!0)))}return a.mutationQueue.addMutationBatch(d,l,m,o)}).next(g=>{h=g;const m=g.applyToLocalDocumentSet(u,p);return a.documentOverlayCache.saveOverlays(d,g.batchId,m)})}).then(()=>({batchId:h.batchId,changes:n1(u)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,o,a){let l=s.hc[s.currentUser.toKey()];l||(l=new nt(Te)),l=l.insert(o,a),s.hc[s.currentUser.toKey()]=l}(r,i.batchId,n),await cl(r,i.changes),await ll(r.remoteStore)}catch(i){const s=Mg(i,"Failed to persist write");n.reject(s)}}async function J1(t,e){const n=we(t);try{const r=await lU(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.cc.get(s);o&&(be(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.nc=!0:i.modifiedDocuments.size>0?be(o.nc):i.removedDocuments.size>0&&(be(o.nc),o.nc=!1))}),await cl(n,r,e)}catch(r){await us(r)}}function _w(t,e,n){const r=we(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.ic.forEach((s,o)=>{const a=o.view.Pu(e);a.snapshot&&i.push(a.snapshot)}),function(s,o){const a=we(s);a.onlineState=o;let l=!1;a.queries.forEach((c,u)=>{for(const h of u.listeners)h.Pu(o)&&(l=!0)}),l&&Ng(a)}(r.eventManager,e),i.length&&r.sc.zo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function KU(t,e,n){const r=we(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.cc.get(e),s=i&&i.key;if(s){let o=new nt(ee.comparator);o=o.insert(s,qe.newNoDocument(s,ge.min()));const a=Ie().add(s),l=new Yu(ge.min(),new Map,new $e(Te),o,a);await J1(r,l),r.uc=r.uc.remove(s),r.cc.delete(e),Og(r)}else await Af(r.localStore,e,!1).then(()=>Mf(r,e,n)).catch(us)}async function qU(t,e){const n=we(t),r=e.batch.batchId;try{const i=await aU(n.localStore,e);Y1(n,r,null),X1(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await cl(n,i)}catch(i){await us(i)}}async function WU(t,e,n){const r=we(t);try{const i=await function(s,o){const a=we(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return a.mutationQueue.lookupMutationBatch(l,o).next(u=>(be(u!==null),c=u.keys(),a.mutationQueue.removeMutationBatch(l,u))).next(()=>a.mutationQueue.performConsistencyCheck(l)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(l,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(l,c)).next(()=>a.localDocuments.getDocuments(l,c))})}(r.localStore,e);Y1(r,e,n),X1(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await cl(r,i)}catch(i){await us(i)}}function X1(t,e){(t.lc.get(e)||[]).forEach(n=>{n.resolve()}),t.lc.delete(e)}function Y1(t,e,n){const r=we(t);let i=r.hc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.hc[r.currentUser.toKey()]=i}}function Mf(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.rc.get(e))t.ic.delete(r),n&&t.sc.wc(r,n);t.rc.delete(e),t.isPrimaryClient&&t.ac.ls(e).forEach(r=>{t.ac.containsKey(r)||Q1(t,r)})}function Q1(t,e){t.oc.delete(e.path.canonicalString());const n=t.uc.get(e);n!==null&&(F1(t.remoteStore,n),t.uc=t.uc.remove(e),t.cc.delete(n),Og(t))}function Rw(t,e,n){for(const r of n)r instanceof W1?(t.ac.addReference(r.key,e),GU(t,r)):r instanceof G1?(j("SyncEngine","Document no longer in limbo: "+r.key),t.ac.removeReference(r.key,e),t.ac.containsKey(r.key)||Q1(t,r.key)):ae()}function GU(t,e){const n=e.key,r=n.path.canonicalString();t.uc.get(n)||t.oc.has(r)||(j("SyncEngine","New document in limbo: "+n),t.oc.add(r),Og(t))}function Og(t){for(;t.oc.size>0&&t.uc.size<t.maxConcurrentLimboResolutions;){const e=t.oc.values().next().value;t.oc.delete(e);const n=new ee(Ve.fromString(e)),r=t.fc.next();t.cc.set(r,new VU(n)),t.uc=t.uc.insert(n,r),B1(t.remoteStore,new Kr(zn(qu(n.path)),r,2,Sn.at))}}async function cl(t,e,n){const r=we(t),i=[],s=[],o=[];r.ic.isEmpty()||(r.ic.forEach((a,l)=>{o.push(r._c(l,e,n).then(c=>{if((c||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c!=null&&c.fromCache?"not-current":"current"),c){i.push(c);const u=Tg.Ci(l.targetId,c);s.push(u)}}))}),await Promise.all(o),r.sc.zo(i),await async function(a,l){const c=we(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>k.forEach(l,h=>k.forEach(h.Si,d=>c.persistence.referenceDelegate.addReference(u,h.targetId,d)).next(()=>k.forEach(h.Di,d=>c.persistence.referenceDelegate.removeReference(u,h.targetId,d)))))}catch(u){if(!ai(u))throw u;j("LocalStore","Failed to update sequence numbers: "+u)}for(const u of l){const h=u.targetId;if(!u.fromCache){const d=c.Ui.get(h),f=d.snapshotVersion,p=d.withLastLimboFreeSnapshotVersion(f);c.Ui=c.Ui.insert(h,p)}}}(r.localStore,s))}async function JU(t,e){const n=we(t);if(!n.currentUser.isEqual(e)){j("SyncEngine","User change. New user:",e.toKey());const r=await D1(n.localStore,e);n.currentUser=e,function(i,s){i.lc.forEach(o=>{o.forEach(a=>{a.reject(new se(z.CANCELLED,s))})}),i.lc.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cl(n,r.ji)}}function XU(t,e){const n=we(t),r=n.cc.get(e);if(r&&r.nc)return Ie().add(r.key);{let i=Ie();const s=n.rc.get(e);if(!s)return i;for(const o of s){const a=n.ic.get(o);i=i.unionWith(a.view.ju)}return i}}function YU(t){const e=we(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=J1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=XU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=KU.bind(null,e),e.sc.zo=LU.bind(null,e.eventManager),e.sc.wc=PU.bind(null,e.eventManager),e}function Z1(t){const e=we(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=WU.bind(null,e),e}class eT{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=th(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,n){return null}Ec(e,n){return null}Ic(e){return O1(this.persistence,new N1,e.initialUser,this.It)}yc(e){return new M1(eh.Bs,this.It)}gc(e){return new R1}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class QU extends eT{constructor(e,n,r){super(),this.Ac=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await Z1(this.Ac.syncEngine),await ll(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return O1(this.persistence,new N1,e.initialUser,this.It)}Tc(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new Kz(r,e.asyncQueue,n)}Ec(e,n){const r=new v$(n,this.persistence);return new w$(e.asyncQueue,r)}yc(e){const n=sU(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new Sg(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,yU(),nc(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(e){return new R1}}class tT{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>_w(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=JU.bind(null,this.syncEngine),await DU(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new RU}createDatastore(e){const n=th(e.databaseInfo.databaseId),r=(i=e.databaseInfo,new mU(i));var i;return function(s,o,a,l){return new vU(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return n=this.localStore,r=this.datastore,i=e.asyncQueue,s=a=>_w(this.syncEngine,a,0),o=Nw.C()?new Nw:new fU,new xU(n,r,i,s,o);var n,r,i,s,o}createSyncEngine(e,n){return function(r,i,s,o,a,l,c){const u=new $U(r,i,s,o,a,l);return c&&(u.dc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=we(e);j("RemoteStore","RemoteStore shutting down."),n.wu.add(5),await al(n),n.gu.shutdown(),n.yu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nT(t,e,n){if(!n)throw new se(z.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ZU(t,e,n,r){if(e===!0&&r===!0)throw new se(z.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Lw(t){if(!ee.isDocumentKey(t))throw new se(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Pw(t){if(ee.isDocumentKey(t))throw new se(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Dg(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ae()}function lr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new se(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Dg(t);throw new se(z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bw=new Map;class Fw{constructor(e){var n;if(e.host===void 0){if(e.ssl!==void 0)throw new se(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new se(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,ZU("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fw({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new se(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new se(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fw(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new o$;switch(n.type){case"gapi":const r=n.client;return new u$(r,n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new se(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=Bw.get(e);n&&(j("ComponentProvider","Removing Datastore"),Bw.delete(e),n.terminate())}(this),Promise.resolve()}}function eH(t,e,n,r={}){var i;const s=(t=lr(t,rh))._getSettings();if(s.host!=="firestore.googleapis.com"&&s.host!==e&&zc("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){let o,a;if(typeof r.mockUserToken=="string")o=r.mockUserToken,a=bt.MOCK_USER;else{o=jB(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new se(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new bt(l)}t._authCredentials=new a$(new NS(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hn(this.firestore,e,this._key)}}class ih{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ih(this.firestore,e,this._query)}}class qr extends ih{constructor(e,n,r){super(e,n,qu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hn(this.firestore,null,new ee(e))}withConverter(e){return new qr(this.firestore,e,this._path)}}function Vw(t,e,...n){if(t=Qr(t),nT("collection","path",e),t instanceof rh){const r=Ve.fromString(e,...n);return Pw(r),new qr(t,null,r)}{if(!(t instanceof hn||t instanceof qr))throw new se(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ve.fromString(e,...n));return Pw(r),new qr(t.firestore,null,r)}}function rc(t,e,...n){if(t=Qr(t),arguments.length===1&&(e=OS.R()),nT("doc","path",e),t instanceof rh){const r=Ve.fromString(e,...n);return Lw(r),new hn(t,null,new ee(r))}{if(!(t instanceof hn||t instanceof qr))throw new se(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ve.fromString(e,...n));return Lw(r),new hn(t.firestore,t instanceof qr?t.converter:null,new ee(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rT{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):$t("Uncaught Error in snapshot listener:",e)}bc(){this.muted=!0}Rc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tH{constructor(e,n,r,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=bt.UNAUTHENTICATED,this.clientId=OS.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{j("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(j("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new se(z.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Mg(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function iT(t,e){t.asyncQueue.verifyOperationInProgress(),j("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await D1(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function sT(t,e){t.asyncQueue.verifyOperationInProgress();const n=await nH(t);j("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener(i=>Ow(e.remoteStore,i)),t.setAppCheckTokenChangeListener((i,s)=>Ow(e.remoteStore,s)),t.onlineComponents=e}async function nH(t){return t.offlineComponents||(j("FirestoreClient","Using default OfflineComponentProvider"),await iT(t,new eT)),t.offlineComponents}async function oT(t){return t.onlineComponents||(j("FirestoreClient","Using default OnlineComponentProvider"),await sT(t,new tT)),t.onlineComponents}function rH(t){return oT(t).then(e=>e.syncEngine)}async function aT(t){const e=await oT(t),n=e.eventManager;return n.onListen=zU.bind(null,e.syncEngine),n.onUnlisten=HU.bind(null,e.syncEngine),n}function iH(t,e,n={}){const r=new Vn;return t.asyncQueue.enqueueAndForget(async()=>function(i,s,o,a,l){const c=new rT({next:h=>{s.enqueueAndForget(()=>K1(i,u));const d=h.docs.has(o);!d&&h.fromCache?l.reject(new se(z.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?l.reject(new se(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(h)},error:h=>l.reject(h)}),u=new q1(qu(o.path),c,{includeMetadataChanges:!0,ku:!0});return j1(i,u)}(await aT(t),t.asyncQueue,e,n,r)),r.promise}function sH(t,e,n={}){const r=new Vn;return t.asyncQueue.enqueueAndForget(async()=>function(i,s,o,a,l){const c=new rT({next:h=>{s.enqueueAndForget(()=>K1(i,u)),h.fromCache&&a.source==="server"?l.reject(new se(z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(h)},error:h=>l.reject(h)}),u=new q1(o,c,{includeMetadataChanges:!0,ku:!0});return j1(i,u)}(await aT(t),t.asyncQueue,e,n,r)),r.promise}class oH{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.No=new L1(this,"async_queue_retry"),this.Wc=()=>{const n=nc();n&&j("AsyncQueue","Visibility state changed to "+n.visibilityState),this.No.Po()};const e=nc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const n=nc();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const n=new Vn;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.No.reset()}catch(e){if(!ai(e))throw e;j("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.No.Ro(()=>this.Jc())}}Hc(e){const n=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{this.Kc=r,this.Gc=!1;const i=function(s){let o=s.message||"";return s.stack&&(o=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),o}(r);throw $t("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Gc=!1,r))));return this.Bc=n,n}enqueueAfterDelay(e,n,r){this.zc(),this.jc.indexOf(e)>-1&&(n=0);const i=Ag.createAndSchedule(this,e,n,r,s=>this.Yc(s));return this.qc.push(i),i}zc(){this.Kc&&ae()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const n of this.qc)if(n.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.qc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.qc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const n=this.qc.indexOf(e);this.qc.splice(n,1)}}class fs extends rh{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new oH,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||lT(this),this._firestoreClient.terminate()}}function aH(t,e){const n=typeof t=="object"?t:qF(),r=typeof t=="string"?t:e||"(default)",i=UF(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=zB("firestore");if(s){const[o,a]=s.split(":");eH(i,o,parseInt(a,10))}}return i}function sh(t){return t._firestoreClient||lT(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function lT(t){var e;const n=t._freezeSettings(),r=function(i,s,o,a){return new x$(i,s,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new tH(t._authCredentials,t._appCheckCredentials,t._queue,r)}function lH(t,e){uH(t=lr(t,fs));const n=sh(t),r=t._freezeSettings(),i=new tT;return cH(n,i,new QU(i,r.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function cH(t,e,n){const r=new Vn;return t.asyncQueue.enqueue(async()=>{try{await iT(t,n),await sT(t,e),r.resolve()}catch(i){const s=i;if(!function(o){return o.name==="FirebaseError"?o.code===z.FAILED_PRECONDITION||o.code===z.UNIMPLEMENTED:typeof DOMException<"u"&&o instanceof DOMException?o.code===22||o.code===20||o.code===11:!0}(s))throw s;zc("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}}).then(()=>r.promise)}function uH(t){if(t._initialized||t._terminated)throw new se(z.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ho(ft.fromBase64String(e))}catch(n){throw new se(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new ho(ft.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new se(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new se(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new se(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Te(this._lat,e._lat)||Te(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hH=/^__.*__$/;class dH{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new vr(e,this.data,this.fieldMask,n,this.fieldTransforms):new To(e,this.data,n,this.fieldTransforms)}}class cT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new vr(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function uT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ae()}}class Lg{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.It=r,this.ignoreUndefinedProperties=i,s===void 0&&this.na(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Lg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ia({path:r,oa:!1});return i.ua(e),i}ca(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ia({path:r,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Xc(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(uT(this.sa)&&hH.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class fH{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.It=r||th(e)}da(e,n,r,i=!1){return new Lg({sa:e,methodName:n,fa:r,path:et.emptyPath(),oa:!1,la:i},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function hT(t){const e=t._freezeSettings(),n=th(t._databaseId);return new fH(t._databaseId,!!e.ignoreUndefinedProperties,n)}function pH(t,e,n,r,i,s={}){const o=t.da(s.merge||s.mergeFields?2:0,e,n,i);Pg("Data must be an object, but it was:",o,r);const a=dT(r,o);let l,c;if(s.merge)l=new cn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const d=Nf(e,h,n);if(!o.contains(d))throw new se(z.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);pT(u,d)||u.push(d)}l=new cn(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new dH(new Nt(a),l,c)}class ah extends _g{_toFieldTransform(e){if(e.sa!==2)throw e.sa===1?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ah}}function gH(t,e,n,r){const i=t.da(1,e,n);Pg("Data must be an object, but it was:",i,r);const s=[],o=Nt.empty();hs(r,(l,c)=>{const u=Bg(e,l,n);c=Qr(c);const h=i.ca(u);if(c instanceof ah)s.push(u);else{const d=lh(c,h);d!=null&&(s.push(u),o.set(u,d))}});const a=new cn(s);return new cT(o,a,i.fieldTransforms)}function mH(t,e,n,r,i,s){const o=t.da(1,e,n),a=[Nf(e,r,n)],l=[i];if(s.length%2!=0)throw new se(z.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Nf(e,s[d])),l.push(s[d+1]);const c=[],u=Nt.empty();for(let d=a.length-1;d>=0;--d)if(!pT(c,a[d])){const f=a[d];let p=l[d];p=Qr(p);const g=o.ca(f);if(p instanceof ah)c.push(f);else{const m=lh(p,g);m!=null&&(c.push(f),u.set(f,m))}}const h=new cn(c);return new cT(u,h,o.fieldTransforms)}function lh(t,e){if(fT(t=Qr(t)))return Pg("Unsupported field value:",e,t),dT(t,e);if(t instanceof _g)return function(n,r){if(!uT(r.sa))throw r.ha(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(n,r){const i=[];let s=0;for(const o of n){let a=lh(o,r.aa(s));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),s++}return{arrayValue:{values:i}}}(t,e)}return function(n,r){if((n=Qr(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return U$(r.It,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=We.fromDate(n);return{timestampValue:Ua(r.It,i)}}if(n instanceof We){const i=new We(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ua(r.It,i)}}if(n instanceof Rg)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ho)return{bytesValue:a1(r.It,n._byteString)};if(n instanceof hn){const i=r.databaseId,s=n.firestore._databaseId;if(!s.isEqual(i))throw r.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:yg(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.ha(`Unsupported field value: ${Dg(n)}`)}(t,e)}function dT(t,e){const n={};return BS(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):hs(t,(r,i)=>{const s=lh(i,e.ra(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function fT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof We||t instanceof Rg||t instanceof ho||t instanceof hn||t instanceof _g)}function Pg(t,e,n){if(!fT(n)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(n)){const r=Dg(n);throw r==="an object"?e.ha(t+" a custom object"):e.ha(t+" "+r)}}function Nf(t,e,n){if((e=Qr(e))instanceof oh)return e._internalPath;if(typeof e=="string")return Bg(t,e);throw Xc("Field path arguments must be of type string or ",t,!1,void 0,n)}const yH=new RegExp("[~\\*/\\[\\]]");function Bg(t,e,n){if(e.search(yH)>=0)throw Xc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new oh(...e.split("."))._internalPath}catch{throw Xc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Xc(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new se(z.INVALID_ARGUMENT,a+t+l)}function pT(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gT{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new hn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new bH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(mT("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class bH extends gT{data(){return super.data()}}function mT(t,e){return typeof e=="string"?Bg(t,e):e instanceof oh?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wH(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new se(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vH{convertValue(e,n="none"){switch(ts(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Zi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw ae()}}convertObject(e,n){const r={};return hs(e.fields,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertGeoPoint(e){return new Rg(Ge(e.latitude),Ge(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=VS(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(La(e));default:return null}}convertTimestamp(e){const n=Zr(e);return new We(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ve.fromString(e);be(g1(r));const i=new es(r.get(1),r.get(3)),s=new ee(r.popFirst(5));return i.isEqual(n)||$t(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EH(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yT extends gT{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new ic(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(mT("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class ic extends yT{data(e={}){return super.data(e)}}class xH{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Ho(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new ic(this._firestore,this._userDataWriter,r.key,r,new Ho(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new se(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new ic(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Ho(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>i||o.type!==3).map(o=>{const a=new ic(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Ho(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let l=-1,c=-1;return o.type!==0&&(l=s.indexOf(o.doc.key),s=s.delete(o.doc.key)),o.type!==1&&(s=s.add(o.doc),c=s.indexOf(o.doc.key)),{type:SH(o.type),doc:a,oldIndex:l,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function SH(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ae()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TH(t){t=lr(t,hn);const e=lr(t.firestore,fs);return iH(sh(e),t._key).then(n=>MH(e,t,n))}class bT extends vH{constructor(e){super(),this.firestore=e}convertBytes(e){return new ho(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new hn(this.firestore,null,n)}}function CH(t){t=lr(t,ih);const e=lr(t.firestore,fs),n=sh(e),r=new bT(e);return wH(t._query),sH(n,t._query).then(i=>new xH(e,r,t,i))}function kH(t,e,n,...r){t=lr(t,hn);const i=lr(t.firestore,fs),s=hT(i);let o;return o=typeof(e=Qr(e))=="string"||e instanceof oh?mH(s,"updateDoc",t._key,e,n,r):gH(s,"updateDoc",t._key,e),Fg(i,[o.toMutation(t._key,Ht.exists(!0))])}function IH(t){return Fg(lr(t.firestore,fs),[new Xu(t._key,Ht.none())])}function AH(t,e){const n=lr(t.firestore,fs),r=rc(t),i=EH(t.converter,e);return Fg(n,[pH(hT(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,Ht.exists(!1))]).then(()=>r)}function Fg(t,e){return function(n,r){const i=new Vn;return n.asyncQueue.enqueueAndForget(async()=>jU(await rH(n),r,i)),i.promise}(sh(t),e)}function MH(t,e,n){const r=n.docs.get(e._key),i=new bT(t);return new yT(t,i,e._key,r,new Ho(n.hasPendingWrites,n.fromCache),e.converter)}(function(t,e=!0){(function(n){So=n})(KF),Dc(new Ia("firestore",(n,{instanceIdentifier:r,options:i})=>{const s=n.getProvider("app").getImmediate(),o=new fs(new l$(n.getProvider("auth-internal")),new d$(n.getProvider("app-check-internal")),function(a,l){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new se(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new es(a.options.projectId,l)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),zs(zb,"3.6.0",t),zs(zb,"3.6.0","esm2017")})();const wT=(t,e)=>{const n=t.__vccOpts||t;for(const[r,i]of e)n[r]=i;return n};Ja.registerLanguage("html",SL);Ja.registerLanguage("css",gL);Ja.registerLanguage("js",vL);Ja.registerLanguage("ts",xL);const NH={apiKey:"AIzaSyCubD42khVRvb7mj1TGhiZCih0XOLUc9bM",authDomain:"pcou-editor.firebaseapp.com",projectId:"pcou-editor",storageBucket:"pcou-editor.appspot.com",messagingSenderId:"810870940225",appId:"1:810870940225:web:9b6169b6168c80ef8cdcc0"},OH=Cx(NH),ks=aH(OH);lH(ks).catch(t=>{(t.code=="failed-precondition"||t.code=="unimplemented")&&console.log(t.code)});const DH={components:{EditorContent:h_,BubbleMenu:c_},data(){return{editor:null,html:null,htmltitle:null,pageid:null,editable:!1,isLoading:!1,isDeleting:!1,isSaving:!1,toc:[]}},mounted(){this.openToc(),this.editor=new u_({editable:this.editable,content:this.openContent("r0eEMUtWa3jGwTdWrYTk"),extensions:[cR,lL.configure({lowlight:Ja}),IB.configure({resizable:!0}),NB,MB,AB]}),this.html=this.editor.getHTML(),this.editor.on("update",()=>{this.html=this.editor.getHTML()})},watch:{editable(){this.editor.setEditable(this.editable)}},methods:{setContent(){this.editor.commands.setContent(`
        <p>
          test content
        </p>
      `,!0),this.editor.commands.focus()},clearContent(){this.editor.chain().clearContent(!0).focus().run()},openToc:async function(){this.isLoading=!0,await CH(Vw(ks,"topics")).then(t=>this.toc=t.docs).finally(()=>this.isLoading=!1)},openContent:async function(t){const e=rc(ks,"topics",t),n=await TH(e);n.exists()&&(this.editor.commands.setContent(n.data().body,!0),this.pageid=t,this.htmltitle=n.data().title)},saveContent:async function(t){this.isSaving=!0;const e=rc(ks,"topics",t);await kH(e,{body:this.html,title:this.htmltitle}).then(()=>this.isSaving=!1),this.editor.commands.setContent(this.html,!0),this.editor.commands.focus()},deletePage:async function(t){this.isDeleting=!0;const e=rc(ks,"topics",t);await IH(e).then(()=>{console.log("Entire Document has been deleted successfully.")}).finally(()=>this.isDeleting=!1),this.editor.commands.setContent("<p>content deleted</p>",!0),this.editor.commands.focus()},newContent:async function(){this.editor.commands.setContent("<p>new content</p>",!0),this.editor.commands.focus();const t=await AH(Vw(ks,"topics"),{title:"Title temp",body:"<p>new content</p>"});this.pageid=t.id}},beforeUnmount(){this.editor.destroy()}},_H={class:"actions"},RH={class:"map-actions"},LH=W("i",{class:"fa fa-plus"},null,-1),PH=[LH],BH=W("i",{class:"fa fa-minus"},null,-1),FH=[BH],VH={class:"content-actions"},$H={class:"checkboxedit",style:{"text-align":"right"}},zH=W("label",{for:"editable"},"edit",-1),UH=W("i",{class:"fa fa-bold"},null,-1),HH=[UH],jH=W("i",{class:"fa fa-italic"},null,-1),KH=[jH],qH=W("i",{class:"fa fa-list"},null,-1),WH=[qH],GH=["disabled"],JH=["disabled"],XH=W("i",{class:"fa fa-rotate-left"},null,-1),YH=[XH],QH=["disabled"],ZH=W("i",{class:"fa fa-rotate-right"},null,-1),ej=[ZH],tj=W("i",{class:"fa fa-new"},null,-1),nj=W("i",{class:"fa fa-save"},null,-1),rj=W("i",{class:"fa fa-upload"},null,-1),ij=W("i",{class:"fa fa-trash"},null,-1),sj=W("i",{class:"fa fa-table"},null,-1),oj=[sj],aj={key:1,class:"view-actions"},lj=W("i",{class:"fa fa-star"},null,-1),cj=W("i",{class:"fa fa-file-pdf"},null,-1),uj=W("i",{class:"fa fa-share"},null,-1),hj=W("div",{class:"rw-actions"},null,-1),dj={class:"content-row"},fj={class:"map-tree"},pj=W("h4",null,"Map",-1),gj={key:0},mj=["onClick"],yj={class:"editor"},bj={key:0},wj={key:1},vj=W("i",{class:"fa fa-bold"},null,-1),Ej=[vj],xj=W("i",{class:"fa fa-italic"},null,-1),Sj=[xj],Tj={class:"export"},Cj=W("h4",null,"HTML Rendering for check",-1),kj={class:"rw-content"},Ij={key:0},Aj=W("label",null,"Topic title: ",-1),Mj=gk('<p></p><label for="fname">Page alias: </label><br><input type="text" id="fname" name="fname" value="page1"><br><p></p><label class="container">Machine translation <input type="checkbox" checked="checked"><span class="checkmark"></span></label><p>Redability index: 30</p><p>seo-suggested search term: acme, pcou, </p><p>Product: Acme</p><p>Version: prod</p><h4>Chat/feedback </h4>',12),Nj={key:1},Oj=W("h4",null," On this page ",-1),Dj=W("p",null,"DataRelated Information ",-1),_j=W("h4",null,"Was this page helpful? ",-1),Rj=W("p",null,"Yes/No",-1),Lj=[Oj,Dj,_j,Rj];function Pj(t,e,n,r,i,s){const o=gd("bubble-menu"),a=gd("editor-content");return on(),Mn(wn,null,[W("div",_H,[W("div",RH,[W("button",{onClick:e[0]||(e[0]=(...l)=>t.tbd&&t.tbd(...l))},PH),W("button",{onClick:e[1]||(e[1]=(...l)=>t.tbd&&t.tbd(...l))},FH)]),W("div",VH,[W("div",$H,[zH,em(W("input",{type:"checkbox",id:"editable","onUpdate:modelValue":e[2]||(e[2]=l=>i.editable=l)},null,512),[[Jk,i.editable]])]),i.editable?(on(),Mn("div",{key:0,class:Xt(["edit-actions",{editable:i.editable}])},[W("button",{class:Xt(["button",{"is-active":i.editor.isActive("heading",{level:1})}]),onClick:e[3]||(e[3]=l=>i.editor.chain().focus().toggleHeading({level:1}).run())},"H1",2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("heading",{level:2})}]),onClick:e[4]||(e[4]=l=>i.editor.chain().focus().toggleHeading({level:2}).run())},"H2",2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("heading",{level:3})}]),onClick:e[5]||(e[5]=l=>i.editor.chain().focus().toggleHeading({level:3}).run())},"H3",2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("bold")}]),onClick:e[6]||(e[6]=l=>i.editor.chain().focus().toggleBold().run())},HH,2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("italic")}]),style:{"margin-right":"10px"},onClick:e[7]||(e[7]=l=>i.editor.chain().focus().toggleItalic().run())},KH,2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("bulletList")}]),onClick:e[8]||(e[8]=l=>i.editor.chain().focus().toggleBulletList().run())},WH,2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("codeBlock")}]),onClick:e[9]||(e[9]=l=>i.editor.chain().focus().toggleCodeBlock().run())},"CodeBlock-",2),W("button",{class:"button",onClick:e[10]||(e[10]=l=>i.editor.chain().focus().setCodeBlock().run()),disabled:i.editor.isActive("codeBlock")},"CodeBlock+",8,GH),W("button",{class:"button",onClick:e[11]||(e[11]=l=>i.editor.chain().focus().undo().run()),disabled:!i.editor.can().undo()},YH,8,JH),W("button",{class:"button",onClick:e[12]||(e[12]=l=>i.editor.chain().focus().redo().run()),disabled:!i.editor.can().redo()},ej,8,QH),W("button",{class:"button",onClick:e[13]||(e[13]=l=>s.newContent())},[Cr("New page"),tj]),W("button",{class:"button",onClick:e[14]||(e[14]=l=>s.saveContent(i.pageid))},[Cr("Save draft "),nj]),W("button",{onClick:e[15]||(e[15]=(...l)=>t.tbd&&t.tbd(...l))},[Cr("Publish (tbd) "),rj]),W("button",{class:"button",onClick:e[16]||(e[16]=l=>s.deletePage(i.pageid))},[Cr("delete "),ij]),W("button",{class:"button",onClick:e[17]||(e[17]=l=>i.editor.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run())},oj),W("button",{class:"button",onClick:e[18]||(e[18]=l=>i.editor.chain().focus().addColumnBefore().run())},"addColumnBefore"),W("button",{class:"button",onClick:e[19]||(e[19]=l=>i.editor.chain().focus().addColumnAfter().run())},"addColumnAfter"),W("button",{class:"button",onClick:e[20]||(e[20]=l=>i.editor.chain().focus().deleteColumn().run())},"deleteColumn"),W("button",{class:"button",onClick:e[21]||(e[21]=l=>i.editor.chain().focus().addRowBefore().run())},"addRowBefore"),W("button",{class:"button",onClick:e[22]||(e[22]=l=>i.editor.chain().focus().addRowAfter().run())},"addRowAfter"),W("button",{class:"button",onClick:e[23]||(e[23]=l=>i.editor.chain().focus().deleteRow().run())},"deleteRow"),W("button",{class:"button",onClick:e[24]||(e[24]=l=>i.editor.chain().focus().deleteTable().run())},"deleteTable"),W("button",{class:"button",onClick:e[25]||(e[25]=l=>i.editor.chain().focus().mergeCells().run())},"mergeCells"),W("button",{class:"button",onClick:e[26]||(e[26]=l=>i.editor.chain().focus().splitCell().run())},"splitCell"),W("button",{class:"button",onClick:e[27]||(e[27]=l=>i.editor.chain().focus().toggleHeaderColumn().run())},"toggleHeaderColumn"),W("button",{class:"button",onClick:e[28]||(e[28]=l=>i.editor.chain().focus().toggleHeaderRow().run())},"toggleHeaderRow"),W("button",{class:"button",onClick:e[29]||(e[29]=l=>i.editor.chain().focus().toggleHeaderCell().run())},"toggleHeaderCell"),W("button",{onClick:e[30]||(e[30]=l=>i.editor.chain().focus().mergeOrSplit().run())},"mergeOrSplit")],2)):(on(),Mn("div",aj,[W("button",{onClick:e[31]||(e[31]=(...l)=>t.tbd&&t.tbd(...l))},[Cr("Favorite "),lj]),W("button",{onClick:e[32]||(e[32]=(...l)=>t.tbd&&t.tbd(...l))},[Cr("pdf "),cj]),W("button",{onClick:e[33]||(e[33]=(...l)=>t.tbd&&t.tbd(...l))},[Cr("share "),uj])]))]),hj]),W("div",dj,[W("div",fj,[pj,i.isLoading?(on(),Mn("div",gj,"Loading... ")):bl("",!0),W("ul",null,[(on(!0),Mn(wn,null,KC(i.toc,l=>(on(),Mn("li",null,[W("a",{href:"#",onClick:Zk(c=>s.openContent(l.id),["prevent"]),target:"_blank"},$g(l.data().title),9,mj)]))),256))])]),W("div",yj,[i.isDeleting?(on(),Mn("div",bj,"Deleting...")):bl("",!0),i.isSaving?(on(),Mn("div",wj,"Saving...")):bl("",!0),i.editor?(on(),Mv(o,{key:2,editor:i.editor,"tippy-options":{duration:100}},{default:pv(()=>[W("button",{class:Xt(["button",{"is-active":i.editor.isActive("bold")}]),onClick:e[34]||(e[34]=l=>i.editor.chain().focus().toggleBold().run())},Ej,2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("italic")}]),onClick:e[35]||(e[35]=l=>i.editor.chain().focus().toggleItalic().run())},Sj,2),W("button",{class:Xt(["button",{"is-active":i.editor.isActive("strike")}]),onClick:e[36]||(e[36]=l=>i.editor.chain().focus().toggleStrike().run())},"uicommand",2)]),_:1},8,["editor"])):bl("",!0),Dt(a,{editor:i.editor},null,8,["editor"]),W("div",Tj,[Cj,W("pre",null,[W("code",null,$g(i.html),1)])])]),W("div",kj,[i.editable?(on(),Mn("div",Ij,[Aj,em(W("input",{type:"text","onUpdate:modelValue":e[37]||(e[37]=l=>i.htmltitle=l),class:"input",required:""},null,512),[[Gk,i.htmltitle]]),Mj])):(on(),Mn("div",Nj,Lj))])])],64)}const Bj=wT(DH,[["render",Pj]]);const Fj={name:"app",components:{tthtml:Bj}},Vj={id:"app"},$j=W("div",{class:"header"},[W("p",{class:"header"}," Gazelle ua")],-1),zj=W("div",{class:"infos"},[W("p",{class:"infos"}," Item > Collection > topic1")],-1),Uj={class:"viewer"};function Hj(t,e,n,r,i,s){const o=gd("tthtml");return on(),Mn("div",Vj,[$j,zj,W("div",Uj,[Dt(o)])])}const jj=wT(Fj,[["render",Hj]]);const Kj=nI(jj);Kj.mount("#app");
